<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="description" content="The modular micro web framework for Java">
<meta name="keywords" content="Java, Modern, Micro, Web, Framework, Reactive, Lightweight, Microservices">
<meta name="author" content="4.0.12">
<link rel="icon" type="image/png" href="images/favicon96.png">
<title>jooby: do more! more easily!!</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="js/styles/agate.min.css">
<style>
  /** ToC */
  #tocbot a.toc-link.node-name--H1{ font-style: italic }
  @media screen{
    #tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
    #tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
      padding-left: 0 }
    #tocbot a.toc-link{ height:100% }
    .is-collapsible{ max-height:3000px; overflow:hidden; }
    .is-collapsed{ max-height:0 }
    .is-active-link{ font-weight:700 }
  }
  @media print{
    #tocbot a.toc-link.node-name--H4{ display:none }
  }

  /** Tabs */
  .hidden {
    display: none;
  }

  .switch {
    display: inline-block;
  }

  .switch--item {
    padding: 5px 10px;
    color: #fff;
    display: inline-block;
    cursor: pointer;
    background-color: #333;
    border-left: 1px solid #ffa;
  }

  .switch--item:not(:first-child) {
  }

  .switch--item:last-child {
    border-radius: 0 5px 0 0;
  }

  .switch--item.selected {
    color: #ffa;
    border-bottom: 1px solid #ffa;
  }

  .clipboard {
      position: absolute;
      bottom: .1rem;
      right: .1rem;
      display: inline-block;
      padding: 4px 8px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc,#eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-appearance: none
  }

  .clipboard i {
      font-style: normal;
      font-weight: 500;
      opacity: .6
  }

  .clipboard .octicon {
      vertical-align: text-top
  }

  .clipboard .counter {
      text-shadow: none;
      background-color: #e5e5e5
  }

  .clipboard:focus {
      text-decoration: none;
      border-color: #51a7e8;
      outline: none;
      box-shadow: 0 0 5px rgba(81,167,232,.5)
  }

  .clipboard:focus:hover,.clipboard.selected:focus {
      border-color: #51a7e8
  }

  .clipboard:hover,.clipboard:active,.clipboard.zeroclipboard-is-hover,.clipboard.zeroclipboard-is-active {
      text-decoration: none;
      background-color: #ddd;
      background-image: linear-gradient(#eee,#ddd);
      border-color: #ccc
  }

  .clipboard:active,.clipboard.selected,.clipboard.zeroclipboard-is-active {
      background-color: #dcdcdc;
      background-image: none;
      border-color: #b5b5b5;
      box-shadow: inset 0 2px 4px rgba(0,0,0,.15)
  }

  .clipboard.selected:hover {
      background-color: #cfcfcf
  }

  .clipboard:disabled,.clipboard:disabled:hover,.clipboard.disabled,.clipboard.disabled:hover {
      color: rgba(102,102,102,.5);
      cursor: default;
      background-color: rgba(229,229,229,.5);
      background-image: none;
      border-color: rgba(197,197,197,.5);
      box-shadow: none
  }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Welcome to Jooby!</h1>
<div class="details">
<span id="author" class="author">4.0.12</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#features">1.1. Features</a></li>
<li><a href="#script-api">1.2. Script API</a></li>
<li><a href="#mvc-api">1.3. MVC API</a></li>
</ul>
</li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#code-snippets">2.1. Code Snippets</a></li>
</ul>
</li>
<li><a href="#router">3. Router</a>
<ul class="sectlevel2">
<li><a href="#route">3.1. Route</a>
<ul class="sectlevel3">
<li><a href="#attributes">3.1.1. Attributes</a></li>
</ul>
</li>
<li><a href="#path-pattern">3.2. Path Pattern</a>
<ul class="sectlevel3">
<li><a href="#static">3.2.1. Static</a></li>
<li><a href="#variable">3.2.2. Variable</a></li>
<li><a href="#regex">3.2.3. Regex</a></li>
<li><a href="#catchall">3.2.4. * Catchall</a></li>
</ul>
</li>
<li><a href="#handler">3.3. Handler</a>
<ul class="sectlevel3">
<li><a href="#filter">3.3.1. Filter</a></li>
<li><a href="#before">3.3.2. Before</a></li>
<li><a href="#after">3.3.3. After</a></li>
<li><a href="#complete">3.3.4. Complete</a></li>
</ul>
</li>
<li><a href="#pipeline">3.4. Pipeline</a>
<ul class="sectlevel3">
<li><a href="#order">3.4.1. Order</a></li>
<li><a href="#scoped-filter">3.4.2. Scoped Filter</a></li>
</ul>
</li>
<li><a href="#grouping-routes">3.5. Grouping routes</a></li>
<li><a href="#composing">3.6. Composing</a>
<ul class="sectlevel3">
<li><a href="#mount">3.6.1. Mount</a></li>
<li><a href="#install">3.6.2. Install</a></li>
</ul>
</li>
<li><a href="#dynamic-routing">3.7. Dynamic Routing</a></li>
<li><a href="#multiple-routers">3.8. Multiple routers</a></li>
<li><a href="#options">3.9. Options</a>
<ul class="sectlevel3">
<li><a href="#routing">3.9.1. Routing</a></li>
<li><a href="#hidden-method">3.9.2. Hidden Method</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#context">4. Context</a>
<ul class="sectlevel2">
<li><a href="#parameters">4.1. Parameters</a>
<ul class="sectlevel3">
<li><a href="#header">4.1.1. Header</a></li>
<li><a href="#cookie">4.1.2. Cookie</a></li>
<li><a href="#path">4.1.3. Path</a></li>
<li><a href="#query">4.1.4. Query</a></li>
<li><a href="#formdata">4.1.5. Formdata</a></li>
<li><a href="#multipart">4.1.6. Multipart</a></li>
<li><a href="#session">4.1.7. Session</a></li>
<li><a href="#flash">4.1.8. Flash</a></li>
<li><a href="#parameter-lookup">4.1.9. Parameter Lookup</a></li>
<li><a href="#client-certificates">4.1.10. Client Certificates</a></li>
</ul>
</li>
<li><a href="#value-api">4.2. Value API</a>
<ul class="sectlevel3">
<li><a href="#single-value">4.2.1. Single value</a></li>
<li><a href="#default-and-optional-value">4.2.2. Default and Optional value</a></li>
<li><a href="#multiple-values">4.2.3. Multiple values</a></li>
<li><a href="#structured-data">4.2.4. Structured data</a></li>
<li><a href="#value-factory">4.2.5. Value Factory</a></li>
</ul>
</li>
<li><a href="#request-body">4.3. Request Body</a>
<ul class="sectlevel3">
<li><a href="#message-decoder">4.3.1. Message Decoder</a></li>
</ul>
</li>
<li><a href="#response-body">4.4. Response Body</a>
<ul class="sectlevel3">
<li><a href="#message-encoder">4.4.1. Message Encoder</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mvc-api-2">5. MVC API</a>
<ul class="sectlevel2">
<li><a href="#getting-started-2">5.1. Getting Started</a></li>
<li><a href="#registration">5.2. Registration</a></li>
<li><a href="#parameters-2">5.3. Parameters</a>
<ul class="sectlevel3">
<li><a href="#header-2">5.3.1. Header</a></li>
<li><a href="#cookie-2">5.3.2. Cookie</a></li>
<li><a href="#path-2">5.3.3. Path</a></li>
<li><a href="#query-2">5.3.4. Query</a></li>
<li><a href="#formdatamultipart">5.3.5. Formdata/Multipart</a></li>
<li><a href="#body">5.3.6. Body</a></li>
<li><a href="#bind">5.3.7. Bind</a></li>
<li><a href="#flash-2">5.3.8. Flash</a></li>
<li><a href="#session-2">5.3.9. Session</a></li>
<li><a href="#context-2">5.3.10. Context</a></li>
<li><a href="#multiple-sources">5.3.11. Multiple Sources</a></li>
</ul>
</li>
<li><a href="#responses">5.4. Responses</a>
<ul class="sectlevel3">
<li><a href="#status-code">5.4.1. Status Code</a></li>
<li><a href="#nonblocking">5.4.2. NonBlocking</a></li>
</ul>
</li>
<li><a href="#execution-model">5.5. Execution model</a></li>
<li><a href="#jax-rs-annotations">5.6. JAX-RS Annotations</a></li>
<li><a href="#generated-router">5.7. Generated router</a></li>
<li><a href="#annotation-processor-options">5.8. Annotation Processor Options</a>
<ul class="sectlevel3">
<li><a href="#setting-options">5.8.1. Setting options</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#static-files">6. Static Files</a>
<ul class="sectlevel2">
<li><a href="#static-site">6.1. Static Site</a></li>
<li><a href="#spas">6.2. SPAs</a></li>
<li><a href="#options-2">6.3. Options</a></li>
</ul>
</li>
<li><a href="#templates">7. Templates</a>
<ul class="sectlevel2">
<li><a href="#template-engine">7.1. Template Engine</a></li>
<li><a href="#view-model">7.2. View Model</a></li>
</ul>
</li>
<li><a href="#session-3">8. Session</a>
<ul class="sectlevel2">
<li><a href="#in-memory-session">8.1. In-Memory Session</a></li>
<li><a href="#signed-session">8.2. Signed Session</a></li>
<li><a href="#stores">8.3. Stores</a></li>
</ul>
</li>
<li><a href="#web-sockets">9. Web Sockets</a>
<ul class="sectlevel2">
<li><a href="#structured-data-2">9.1. Structured data</a></li>
<li><a href="#options-3">9.2. Options</a>
<ul class="sectlevel3">
<li><a href="#connection-timeouts">9.2.1. Connection Timeouts</a></li>
<li><a href="#max-size">9.2.2. Max size</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server-sent-events">10. Server-Sent Events</a>
<ul class="sectlevel2">
<li><a href="#message-options">10.1. Message Options</a></li>
<li><a href="#connection-lost">10.2. Connection Lost</a></li>
<li><a href="#keep-alive">10.3. Keep Alive</a></li>
</ul>
</li>
<li><a href="#execution-model-2">11. Execution Model</a>
<ul class="sectlevel2">
<li><a href="#mode">11.1. Mode</a>
<ul class="sectlevel3">
<li><a href="#event-loop">11.1.1. Event Loop</a></li>
<li><a href="#worker">11.1.2. Worker</a></li>
<li><a href="#default">11.1.3. Default</a></li>
</ul>
</li>
<li><a href="#worker-executor">11.2. Worker Executor</a></li>
</ul>
</li>
<li><a href="#responses-2">12. Responses</a>
<ul class="sectlevel2">
<li><a href="#raw">12.1. Raw</a></li>
<li><a href="#streaming-chunked">12.2. Streaming / Chunked</a></li>
<li><a href="#file-download">12.3. File download</a></li>
<li><a href="#nonblocking-2">12.4. NonBlocking</a>
<ul class="sectlevel3">
<li><a href="#completablefuture">12.4.1. CompletableFuture</a></li>
<li><a href="#mutiny">12.4.2. Mutiny</a></li>
<li><a href="#rxjava">12.4.3. RxJava</a></li>
<li><a href="#reactor">12.4.4. Reactor</a></li>
<li><a href="#kotlin-coroutines">12.4.5. Kotlin Coroutines</a></li>
</ul>
</li>
<li><a href="#send-methods">12.5. Send methods</a></li>
</ul>
</li>
<li><a href="#error-handler">13. Error Handler</a>
<ul class="sectlevel2">
<li><a href="#custom-error-handler">13.1. Custom Error Handler</a></li>
<li><a href="#catch-by-code">13.2. Catch by Code</a></li>
<li><a href="#catch-by-exception">13.3. Catch by Exception</a></li>
<li><a href="#problem-details">13.4. Problem Details</a>
<ul class="sectlevel3">
<li><a href="#set-up-problemdetails">13.4.1. Set up ProblemDetails</a></li>
<li><a href="#creating-problems">13.4.2. Creating problems</a></li>
<li><a href="#adding-extra-parameters">13.4.3. Adding extra parameters</a></li>
<li><a href="#adding-headers">13.4.4. Adding headers</a></li>
<li><a href="#respond-with-errors-details">13.4.5. Respond with errors details</a></li>
<li><a href="#custom-exception-to-httpproblem">13.4.6. Custom <code>Exception</code> to <code>HttpProblem</code></a></li>
<li><a href="#custom-problems">13.4.7. Custom Problems</a></li>
<li><a href="#custom-exception-handlers">13.4.8. Custom Exception Handlers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration">14. Configuration</a>
<ul class="sectlevel2">
<li><a href="#environment">14.1. Environment</a></li>
<li><a href="#default-environment">14.2. Default Environment</a></li>
<li><a href="#overrides">14.3. Overrides</a></li>
<li><a href="#custom-environment">14.4. Custom environment</a></li>
<li><a href="#logging">14.5. Logging</a>
<ul class="sectlevel3">
<li><a href="#logback">14.5.1. Logback</a></li>
<li><a href="#log4j2">14.5.2. Log4j2</a></li>
<li><a href="#environment-logging">14.5.3. Environment logging</a></li>
</ul>
</li>
<li><a href="#application-properties">14.6. Application Properties</a></li>
</ul>
</li>
<li><a href="#extensions-and-services">15. Extensions and Services</a>
<ul class="sectlevel2">
<li><a href="#writing-custom-extension">15.1. Writing Custom Extension</a></li>
<li><a href="#collection-of-services">15.2. Collection of Services</a></li>
<li><a href="#dependency-injection">15.3. Dependency Injection</a>
<ul class="sectlevel3">
<li><a href="#avaje-inject">15.3.1. Avaje Inject</a></li>
<li><a href="#dagger">15.3.2. Dagger</a></li>
<li><a href="#guice">15.3.3. Guice</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#testing">16. Testing</a>
<ul class="sectlevel2">
<li><a href="#unit-testing">16.1. Unit Testing</a>
<ul class="sectlevel3">
<li><a href="#options-4">16.1.1. Options</a></li>
</ul>
</li>
<li><a href="#integration-testing">16.2. Integration Testing</a>
<ul class="sectlevel3">
<li><a href="#arguments">16.2.1. Arguments</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#development">17. Development</a>
<ul class="sectlevel2">
<li><a href="#usage">17.1. Usage</a></li>
<li><a href="#compilation-restart">17.2. Compilation &amp; Restart</a></li>
<li><a href="#options-5">17.3. Options</a></li>
</ul>
</li>
<li><a href="#handlers">18. Handlers</a>
<ul class="sectlevel2">
<li><a href="#accessloghandler">18.1. AccessLogHandler</a></li>
<li><a href="#corshandler">18.2. CorsHandler</a></li>
<li><a href="#csrfhandler">18.3. CsrfHandler</a></li>
<li><a href="#gracefulshutdown">18.4. GracefulShutdown</a></li>
<li><a href="#headhandler">18.5. HeadHandler</a></li>
<li><a href="#ratelimithandler">18.6. RateLimitHandler</a></li>
<li><a href="#sslhandler">18.7. SSLHandler</a></li>
<li><a href="#tracehandler">18.8. TraceHandler</a></li>
</ul>
</li>
<li><a href="#packaging">19. Packaging</a>
<ul class="sectlevel2">
<li><a href="#single-jar">19.1. Single jar</a></li>
<li><a href="#stork">19.2. Stork</a></li>
</ul>
</li>
<li><a href="#server">20. Server</a>
<ul class="sectlevel2">
<li><a href="#run-multiple-apps">20.1. Run multiple apps</a></li>
<li><a href="#manual-setup">20.2. Manual setup</a></li>
<li><a href="#options-6">20.3. Options</a></li>
<li><a href="#https-support">20.4. HTTPS Support</a>
<ul class="sectlevel3">
<li><a href="#using-x-509">20.4.1. Using X.509</a></li>
<li><a href="#using-pkcs12">20.4.2. Using PKCS12</a></li>
<li><a href="#client-authentication-mutual-tls">20.4.3. Client Authentication (Mutual TLS)</a></li>
<li><a href="#tls-protocol">20.4.4. TLS protocol</a></li>
<li><a href="#openssl">20.4.5. OpenSSL</a></li>
</ul>
</li>
<li><a href="#http2-support">20.5. HTTP/2 Support</a></li>
</ul>
</li>
<li><a href="#modules">21. Modules</a>
<ul class="sectlevel2">
<li><a href="#cloud">21.1. Cloud</a></li>
<li><a href="#data">21.2. Data</a></li>
<li><a href="#validation">21.3. Validation</a></li>
<li><a href="#development-tools">21.4. Development Tools</a></li>
<li><a href="#event-bus">21.5. Event Bus</a></li>
<li><a href="#json">21.6. JSON</a></li>
<li><a href="#openapi">21.7. OpenAPI</a></li>
<li><a href="#template-engine-2">21.8. Template Engine</a></li>
<li><a href="#security">21.9. Security</a></li>
<li><a href="#session-store">21.10. Session Store</a></li>
<li><a href="#scheduler">21.11. Scheduler</a></li>
</ul>
</li>
<li><a href="#appendix">22. Appendix</a>
<ul class="sectlevel2">
<li><a href="#upgrading-from-3-x-to-4-x">22.1. Upgrading from 3.x to 4.x</a>
<ul class="sectlevel3">
<li><a href="#requirements">22.1.1. Requirements</a></li>
<li><a href="#buffer-api">22.1.2. Buffer API</a></li>
<li><a href="#value-api-2">22.1.3. Value API</a></li>
<li><a href="#session-api">22.1.4. Session API</a></li>
<li><a href="#server-configuration">22.1.5. Server configuration</a></li>
<li><a href="#packages">22.1.6. Packages</a></li>
<li><a href="#classes">22.1.7. Classes</a></li>
<li><a href="#method">22.1.8. Method</a></li>
</ul>
</li>
<li><a href="#upgrading-from-2-x-to-3-x">22.2. Upgrading from 2.x to 3.x</a>
<ul class="sectlevel3">
<li><a href="#requirements-2">22.2.1. Requirements</a></li>
<li><a href="#module-info-java">22.2.2. module-info.java</a></li>
<li><a href="#kotlin">22.2.3. Kotlin</a></li>
<li><a href="#jakarta">22.2.4. jakarta</a></li>
<li><a href="#modules-2">22.2.5. Modules</a></li>
<li><a href="#package-renames">22.2.6. Package renames</a></li>
<li><a href="#class-renames">22.2.7. Class renames</a></li>
<li><a href="#method-renames">22.2.8. Method renames</a></li>
<li><a href="#dependencies">22.2.9. Dependencies</a></li>
<li><a href="#reactive-support">22.2.10. Reactive support</a></li>
</ul>
</li>
<li><a href="#upgrading-from-1-x-to-2-x">22.3. Upgrading from 1.x to 2.x</a>
<ul class="sectlevel3">
<li><a href="#maven-coordinates">22.3.1. Maven coordinates</a></li>
<li><a href="#modules-3">22.3.2. Modules</a></li>
<li><a href="#api">22.3.3. API</a></li>
<li><a href="#route-pipeline">22.3.4. Route Pipeline</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h2 id="do-more-more-easily" class="discrete">âˆž do more, more easily</h2>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby is a modern, performant and easy to use web framework for Java and Kotlin built on top of your
favorite web server.</p>
</div>
<div class="listingblock primary">
<div class="title">Welcome!!</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4cc8a87bc3db496b">import io.jooby.Jooby;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "Welcome to Jooby!");
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x4cc8a87bc3db496b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x94bb65c687554ecc">import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    get ("/") { "Welcome to Jooby!" }
  }
}</code><button class="clipboard" data-clipboard-target="#x94bb65c687554ecc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Latest Release: <a href="https://github.com/jooby-project/jooby/releases/tag/v4.0.12" target="_blank">4.0.12</a>.</p>
</div>
<div class="paragraph">
<p>Looking for a previous version?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to <a href="v3">3.x</a> documentation. <a href="/migration/4.x">Migrating from 3.x to 4.x</a></p>
</li>
<li>
<p>Access to <a href="v2">2.x</a> documentation. <a href="/migration/3.x">Migrating from 2.x to 3.x</a></p>
</li>
<li>
<p>Access to <a href="v1">1.x</a> documentation.</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="introduction-features"><a class="anchor" href="#introduction-features"></a><a class="link" href="#introduction-features">1.1. Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Lightweight and Fast. See <a href="https://www.techempower.com/benchmarks/#section=data-r19&amp;hw=ph&amp;test=composite&amp;l=xan9tr-1r" target="_blank">Tech Empower Benchmark</a></p>
</li>
<li>
<p>Increase productivity with <a href="#development-compilation-restart">Hot-Reload for development</a></p>
</li>
<li>
<p>Script/lambda routes using fluent API</p>
</li>
<li>
<p><a href="#mvc-api">MVC routes</a> using Jooby or JAX-RS annotations</p>
</li>
<li>
<p><a href="modules/openapi">OpenAPI 3</a> support</p>
</li>
<li>
<p><a href="#execution-model">Event Loop and blocking execution modes</a></p>
</li>
<li>
<p><a href="#responses">Reactive responses</a> (Completable Futures, RxJava, Reactor, SmallRye types and Kotlin Coroutines)</p>
</li>
<li>
<p><a href="#server">Multi-server</a> including <a href="https://www.eclipse.org/jetty" target="_blank">Jetty</a>, <a href="https://netty.io" target="_blank">Netty</a>, <a href="https://vertx.io" target="_blank">Vertx</a> and <a href="http://undertow.io" target="_blank">Undertow</a></p>
</li>
<li>
<p>Make the jump to full-stack framework with the extension/plugin mechanism and a variety of <a href="modules" class="bare">modules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="introduction-script-api"><a class="anchor" href="#introduction-script-api"></a><a class="link" href="#introduction-script-api">1.2. Script API</a></h3>
<div class="paragraph">
<p>Script API (a.k.a. script routes) provides a fluent DSL based on <code>lambda</code> functions, free of
reflection and annotations.</p>
</div>
<div class="paragraph">
<p>We usually extend <code>Jooby</code> and define routes in the instance initializer:</p>
</div>
<div class="listingblock primary">
<div class="title">Script with sub-class:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xcdbb0fc4b1894fdf">import io.jooby.Jooby;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "Hello Jooby!");
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xcdbb0fc4b1894fdf"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe6a93c9bb3414455">import io.jooby.kt.Kooby
import io.jooby.kt.runApp

class App : Kooby({

  get("/") { "Hello Jooby!" }

})

fun main(args: Array&lt;String&gt;) {
  runApp(args, ::App)
}</code><button class="clipboard" data-clipboard-target="#xe6a93c9bb3414455"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For Java applications we favor extending <code>Jooby</code> because the DSL looks better (no need
to prefix the <code>get</code> method with a variable).</p>
</div>
<div class="paragraph">
<p>This is not strictly necessary (of course); you may prefer to do it without extending <code>Jooby</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">Script without subclass:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x45f4595ebe834b8e">import io.jooby.Jooby;

public class App {

  public static void main(String[] args) {
    runApp(args, app -&gt; {

      app.get("/", ctx -&gt; "Hello Jooby!");

    });
  }
}</code><button class="clipboard" data-clipboard-target="#x45f4595ebe834b8e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc34a45549cf64061">import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    get("/") { "Hello Jooby!" }

  }
}</code><button class="clipboard" data-clipboard-target="#xc34a45549cf64061"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For Kotlin, it doesnâ€™t matter which one you choose. The DSL looks great with or without extending
<code>Kooby</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-mvc-api"><a class="anchor" href="#introduction-mvc-api"></a><a class="link" href="#introduction-mvc-api">1.3. MVC API</a></h3>
<div class="paragraph">
<p>The MVC API (a.k.a. MVC routes) uses annotation to define routes and byte code generation to execute
them.</p>
</div>
<div class="listingblock primary">
<div class="title">MVC API:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x228a785d5c8f4419">import io.jooby.annotation.*;

public class MyController {

  @GET
  public String sayHi() {
    return "Hello Jooby!";
  }
}

public class App {

  public static void main(String[] args) {
    runApp(args, app -&gt; {

      app.use(new MyController_());

    });
  }
}</code><button class="clipboard" data-clipboard-target="#x228a785d5c8f4419"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb6a6e0fe8e34d8f">import io.jooby.annotation.*;

class MyController {

  @GET
  fun sayHi() : String {
    return "Hello Jooby!"
  }
}

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    use(MyController_())

  }
}</code><button class="clipboard" data-clipboard-target="#xb6a6e0fe8e34d8f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Read more about MVC and JAX-RS support in the <a href="#mvc-api">MVC API</a> chapter.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a><a class="link" href="#getting-started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The best way of getting started is using the <code>jooby console</code>. It is a small application that generates
Jooby projects very quickly.</p>
</div>
<div class="paragraph">
<p><strong>Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven or Gradle build</p>
</li>
<li>
<p>Java or Kotlin application</p>
</li>
<li>
<p>Script or MVC routes</p>
</li>
<li>
<p>Jetty, Netty or Undertow application</p>
</li>
<li>
<p>Uber/Fat jar or <a href="https://github.com/fizzed/stork" target="_blank">Stork native launcher</a></p>
</li>
<li>
<p>Dockerfile</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To install the console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download <a href="https://repo1.maven.org/maven2/io/jooby/jooby-cli/4.0.12/jooby-cli-4.0.12.zip" target="_blank">jooby-cli.zip</a></p>
</li>
<li>
<p>Unzip <code>jooby-cli.zip</code> in your user home directory (or any other directory you prefer)</p>
</li>
<li>
<p>Find the native launchers in the <code>bin</code> directory</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might want to add the native launcher <code>bin/jooby</code> or <code>bin/jooby.bat</code> to your system path variable,
to make it globally accessible from any location.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To simplify documentation we use <code>jooby</code> as command, it requires Java 17 as minimum. Windows users must use <code>jooby.bat</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Setting workspace:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x871757db30c74a56">jooby set -w ~/Source</code><button class="clipboard" data-clipboard-target="#x871757db30c74a56"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>All code will be saved inside the <code>~/Source</code> directory.</p>
</div>
<div class="paragraph">
<p>Workspace directory is ready!</p>
</div>
<div class="paragraph">
<p>Now type <code>jooby</code> and hit ENTER.</p>
</div>
<div class="paragraph">
<p>After prompt, type <code>help create</code>:</p>
</div>
<div class="listingblock">
<div class="title">jooby</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x3f6acd7ef0f74397">jooby&gt; help create
Missing required parameter: &lt;name&gt;
Usage: jooby create [-dgikms] [--server=&lt;server&gt;] &lt;name&gt;
Creates a new application
      &lt;name&gt;              Application name or coordinates (groupId:artifactId:
                            version)
  -d, --docker            Generates a Dockerfile
  -g, --gradle            Generates a Gradle project
  -i                      Start interactive mode
  -k, --kotlin            Generates a Kotlin application
  -m, --mvc               Generates a MVC application
  -s, --stork             Add Stork Maven plugin to build (Maven only)
      --server=&lt;server&gt;   Choose one of the available servers: jetty, netty or
                            undertow
jooby&gt;</code><button class="clipboard" data-clipboard-target="#x3f6acd7ef0f74397"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>create</code> command generates a Jooby application. Some examples:</p>
</div>
<div class="listingblock">
<div class="title">Creates a Maven Java project:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xc3e7e46abf9f4a2d">jooby&gt; create myapp</code><button class="clipboard" data-clipboard-target="#xc3e7e46abf9f4a2d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creates a Maven Kotlin project:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x3b8cbaddd509438f">jooby&gt; create myapp --kotlin</code><button class="clipboard" data-clipboard-target="#x3b8cbaddd509438f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Since 3.x</div>
<div class="paragraph">
<p>Kotlin was removed from core, you need to the <code>jooby-kotlin</code> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x5b091df436754adb">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-kotlin&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x5b091df436754adb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x6ea7619f30034259">implementation 'io.jooby:jooby-kotlin:4.0.12'</code><button class="clipboard" data-clipboard-target="#x6ea7619f30034259"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Creates a Gradle Java project:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xfd423f7f2b4445dc">jooby&gt; create myapp --gradle</code><button class="clipboard" data-clipboard-target="#xfd423f7f2b4445dc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creates a Gradle Kotlin project:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x7ede0755819d4e6c">jooby&gt; create myapp --gradle --kotlin</code><button class="clipboard" data-clipboard-target="#x7ede0755819d4e6c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Maven and Java are the default options but you can easily override these with <code>-g -k</code> or <code>-gk</code> (order doesnâ€™t matter).
Along with the build and language, the <code>create</code> command adds two test classes: <code>UnitTest</code> and <code>IntegrationTest</code>.</p>
</div>
<div class="paragraph">
<p>Passing the <code>-m</code> or <code>--mvc</code> generates an MVC application:</p>
</div>
<div class="listingblock">
<div class="title">Creates a Maven Java Mvc project:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xb431628b22a44fea">jooby&gt; create myapp --mvc</code><button class="clipboard" data-clipboard-target="#xb431628b22a44fea"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--server</code> option, allow you to choose between: (J)etty, (N)etty or (U)ndertow:</p>
</div>
<div class="listingblock">
<div class="title">Creates a Maven Java Project using Undertow:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x7db67be92fa1414d">jooby&gt; create myapp --server undertow</code><button class="clipboard" data-clipboard-target="#x7db67be92fa1414d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Maven/Gradle configuration generates an <code>uber/fat</code> jar at package time. Maven builds supports
generation of <a href="https://github.com/fizzed/stork" target="_blank">Stork launchers</a>.</p>
</div>
<div class="listingblock">
<div class="title">Creates a Maven Java Project with stork launchers:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x67aa5b45676f4e37">jooby&gt; create myapp --stork</code><button class="clipboard" data-clipboard-target="#x67aa5b45676f4e37"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>There is a <code>-d</code> or <code>--docker</code> option which generates a <code>Dockerfile</code></p>
</div>
<div class="listingblock">
<div class="title">Creates a docker file:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x3471cca5039249f1">jooby&gt; create myapp --docker</code><button class="clipboard" data-clipboard-target="#x3471cca5039249f1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The default package in all these examples is set to <code>app</code>. To get full control of groupId, package, version, etc., use the interactive mode:</p>
</div>
<div class="listingblock">
<div class="title">Interactive mode:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xbca1bddb4bd744a1">jooby&gt; create myapp -i</code><button class="clipboard" data-clipboard-target="#xbca1bddb4bd744a1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-code-snippets"><a class="anchor" href="#getting-started-code-snippets"></a><a class="link" href="#getting-started-code-snippets">2.1. Code Snippets</a></h3>
<div class="paragraph">
<p>For simplicity and brevity we are going to skip the <code>runApp</code> function and extending <code>Jooby</code>.
Code example will look like:</p>
</div>
<div class="listingblock primary">
<div class="title">Snippet</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x6dc693cb45ad4f19">{
  get("/", ctx -&gt; "Snippet");
}</code><button class="clipboard" data-clipboard-target="#x6dc693cb45ad4f19"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xdff0a63c6b334c86">{
  get("/") { "Snippet" }
}</code><button class="clipboard" data-clipboard-target="#xdff0a63c6b334c86"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The use of <code>application class</code> or <code>runApp function</code> will be included when strictly necessary.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="router"><a class="anchor" href="#router"></a><a class="link" href="#router">3. Router</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html" target="_blank">Router</a> is the heart of Jooby and consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Routing algorithm (radix tree)</p>
</li>
<li>
<p>One or more <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.html" target="_blank">routes</a></p>
</li>
<li>
<p>Collection of operator over <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.html" target="_blank">routes</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="router-route"><a class="anchor" href="#router-route"></a><a class="link" href="#router-route">3.1. Route</a></h3>
<div class="paragraph">
<p>A <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.html" target="_blank">Route</a> consists of three part:</p>
</div>
<div class="listingblock primary">
<div class="title">Routes:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7f554ff795f74b57">{

  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  get("/foo", ctx -&gt; {
    return "foo"; <i class="conum" data-value="3"></i><b>(3)</b>
  });

  // Get example with path variable
  get("/foo/{id}", ctx -&gt; {
    return ctx.path("id").value();
  });

  // Post example
  post("/", ctx -&gt; {
    return ctx.body().value();
  });
}</code><button class="clipboard" data-clipboard-target="#x7f554ff795f74b57"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x412df4dbc1754bbd">{

  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  get("/foo") {
    "foo" <i class="conum" data-value="3"></i><b>(3)</b>
  }

  // Get example with path variable
  get("/foo/{id}") {
    ctx.path("id").value()
  }

  // Post example
  post("/") {
    ctx.body().value()
  }
}</code><button class="clipboard" data-clipboard-target="#x412df4dbc1754bbd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP method/verb, like: <code>GET</code>, <code>POST</code>, etcâ€¦â€‹</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path pattern, like: <code>/foo</code>, <code>/foo/{id}</code>, etcâ€¦â€‹</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Handler function</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Handler.html" target="_blank">handler</a> function always produces a result, which is send it back
to the client.</p>
</div>
<div class="sect3">
<h4 id="router-route-attributes"><a class="anchor" href="#router-route-attributes"></a><a class="link" href="#router-route-attributes">3.1.1. Attributes</a></h4>
<div class="paragraph">
<p>Attributes let you annotate a route at application bootstrap time. It functions like static metadata available at runtime:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x5e81afb51ec84479">{
  get("/foo", ctx -&gt; "Foo")
    .setAttribute("foo", "bar");
}</code><button class="clipboard" data-clipboard-target="#x5e81afb51ec84479"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8750d004085b4678">{
  get("/foo") {
    "Foo"
  }.setAttribute("foo", "bar")
}</code><button class="clipboard" data-clipboard-target="#x8750d004085b4678"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>An attribute consist of a name and value. Values can be any object.
Attributes can be accessed at runtime in a request/response cycle. For example, a security module might check for a role attribute.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1f8579bab8a4803">{
  use(next -&gt; ctx -&gt; {
    User user = ...;
    String role = ctx.getRoute().getAttribute("Role");

    if (user.hasRole(role)) {
        return next.apply(ctx);
    }

    throw new StatusCodeException(StatusCode.FORBIDDEN);
  });
}</code><button class="clipboard" data-clipboard-target="#x1f8579bab8a4803"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3f522099993f4056">{
use(
  val user = ...
  val role = ctx.route.getAttribute("Role")

  if (user.hasRole(role)) {
    return next.apply(ctx)
  } else {
    throw StatusCodeException(StatusCode.FORBIDDEN)
  }
}</code><button class="clipboard" data-clipboard-target="#x3f522099993f4056"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>In MVC routes you can set attributes via annotations:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1214c3461a8640e8">@Target({ElementType.METHOD, ElementType.TYPE, ElementType.ANNOTATION_TYPE })
@Retention(RetentionPolicy.RUNTIME)
public @interface Role {
  String value();
}

@Path("/path")
public class AdminResource {

  @Role("admin")
  public Object doSomething() {
    ...
  }

}

{
  use(next -&gt; ctx -&gt; {
    System.out.println(ctx.getRoute().getAttribute("Role"));
  });
}</code><button class="clipboard" data-clipboard-target="#x1214c3461a8640e8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3ca94dd7210c4547">@Target(AnnotationTarget.CLASS, AnnotationTarget.FUNCTION)
@Retention(AnnotationRetention.RUNTIME)
annotation class Role (val value: String)

@Path("/path")
class AdminResource {

  @Role("admin")
  fun doSomething() : Any {
    ...
  }

}

{
  use {
    println(ctx.route.getAttribute("Role"))
  }
}</code><button class="clipboard" data-clipboard-target="#x3ca94dd7210c4547"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The previous example will print: admin.
You can retrieve all the attributes of the route by calling <code>ctx.getRoute().getAttributes()</code>.</p>
</div>
<div class="paragraph">
<p>Any runtime annotation is automatically added as route attributes following these rules:
- If the annotation has a value method, then we use the annotationâ€™s name as the attribute name.
- Otherwise, we use the method name as the attribute name.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-path-pattern"><a class="anchor" href="#router-path-pattern"></a><a class="link" href="#router-path-pattern">3.2. Path Pattern</a></h3>
<div class="sect3">
<h4 id="router-path-pattern-static"><a class="anchor" href="#router-path-pattern-static"></a><a class="link" href="#router-path-pattern-static">3.2.1. Static</a></h4>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Koltin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9d16f6c4e37a432c">{
  get("/foo", ctx -&gt; "Foo");
}</code><button class="clipboard" data-clipboard-target="#x9d16f6c4e37a432c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x936476d1ccf54dcb">{
  get("/foo") { "Foo" }
}</code><button class="clipboard" data-clipboard-target="#x936476d1ccf54dcb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="router-path-pattern-variable"><a class="anchor" href="#router-path-pattern-variable"></a><a class="link" href="#router-path-pattern-variable">3.2.2. Variable</a></h4>
<div class="listingblock primary">
<div class="title">Single path variable:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1977a863764a45c1">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id}", ctx -&gt; {
    int id = ctx.path("id").intValue(); <i class="conum" data-value="2"></i><b>(2)</b>
    return id;
  });
}</code><button class="clipboard" data-clipboard-target="#x1977a863764a45c1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbdb62165957849a6">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id}") {
    val id = ctx.path("id").intValue() <i class="conum" data-value="2"></i><b>(2)</b>
    id
  }
}</code><button class="clipboard" data-clipboard-target="#xbdb62165957849a6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a path variable <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve the variable <code>id</code> as <code>int</code></td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Multiple path variables:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa974ed944c71429e">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/file/{file}.{ext}", ctx -&gt; {
    String filename = ctx.path("file").value(); <i class="conum" data-value="2"></i><b>(2)</b>
    String ext = ctx.path("ext").value();   <i class="conum" data-value="3"></i><b>(3)</b>
    return filename + "." + ext;
  });
}</code><button class="clipboard" data-clipboard-target="#xa974ed944c71429e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x98bf718b8b4e49c8">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/file/{file}.{ext}") {
    val filename = ctx.path("file").value() <i class="conum" data-value="2"></i><b>(2)</b>
    val ext = ctx.path("ext").value()       <i class="conum" data-value="3"></i><b>(3)</b>
    filename + "." + ext
  }
}</code><button class="clipboard" data-clipboard-target="#x98bf718b8b4e49c8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines two path variables: <code>file</code> and <code>ext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve string variable: <code>file</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve string variable: <code>ext</code></td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Optional path variable:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf0d557d72a754324">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/profile/{id}?", ctx -&gt; {
    String id = ctx.path("id").value("self"); <i class="conum" data-value="2"></i><b>(2)</b>
    return id;
  });
}</code><button class="clipboard" data-clipboard-target="#xf0d557d72a754324"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xeaa1b99e60a64ae4">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/profile/{id}?") {
    val id = ctx.path("id").value("self") <i class="conum" data-value="2"></i><b>(2)</b>
    id
  }
}</code><button class="clipboard" data-clipboard-target="#xeaa1b99e60a64ae4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines an optional path variable <code>id</code>. The trailing <code>?</code> make it optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve the variable <code>id</code> as <code>String</code> when present or use a default value: <code>self</code>.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The trailing <code>?</code> makes the path variable optional. The route matches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/profile</code></p>
</li>
<li>
<p><code>/profile/eespina</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="router-path-pattern-regex"><a class="anchor" href="#router-path-pattern-regex"></a><a class="link" href="#router-path-pattern-regex">3.2.3. Regex</a></h4>
<div class="listingblock primary">
<div class="title">Regex path variable:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x902c7a511b194bf8">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id:[0-9]+}", ctx -&gt; {
    int id = ctx.path("id").intValue(); <i class="conum" data-value="2"></i><b>(2)</b>
    return id;
  });
}</code><button class="clipboard" data-clipboard-target="#x902c7a511b194bf8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf75dcace505a4f27">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id:[0-9]+}") {
    val id = ctx.path("id").intValue() <i class="conum" data-value="2"></i><b>(2)</b>
    id
  }
}`</code><button class="clipboard" data-clipboard-target="#xf75dcace505a4f27"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a path variable: <code>id</code>. Regex expression is everything after the first <code>:</code>, like: <code>[0-9]+</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve an int value</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Optional syntax is also supported for regex path variable: <code>/user/{id:[0-9]+}?</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>matches  <code>/user</code></p>
</li>
<li>
<p>matches <code>/user/123</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="router-path-pattern-catchall"><a class="anchor" href="#router-path-pattern-catchall"></a><a class="link" href="#router-path-pattern-catchall">3.2.4. * Catchall</a></h4>
<div class="listingblock primary">
<div class="title">catchall</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdca71e2277e74394">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/articles/*", ctx -&gt; {
    String catchall = ctx.path("*").value(); <i class="conum" data-value="2"></i><b>(2)</b>
    return catchall;
  });

  get("/articles/*path", ctx -&gt; {
    String path = ctx.path("path").value(); <i class="conum" data-value="3"></i><b>(3)</b>
    return path;
  });
}</code><button class="clipboard" data-clipboard-target="#xdca71e2277e74394"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xebe66be1cc6e4ca3">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/articles/*") {
    val catchall = ctx.path("*").value() <i class="conum" data-value="2"></i><b>(2)</b>
    catchall
  }

  get("/articles/*path") {
    val path = ctx.path("path").value()  <i class="conum" data-value="3"></i><b>(3)</b>
    path
  }
}</code><button class="clipboard" data-clipboard-target="#xebe66be1cc6e4ca3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The trailing <code>*</code> defines a <code>catchall</code> pattern</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We access to the <code>catchall</code> value using the <code>*</code> character</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Same example, but this time we named the <code>catchall</code> pattern and we access to it using <code>path</code>
variable name.</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>catchall</code> pattern must be defined at the end of the path pattern.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-handler"><a class="anchor" href="#router-handler"></a><a class="link" href="#router-handler">3.3. Handler</a></h3>
<div class="paragraph">
<p>Application logic goes inside a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Handler.html" target="_blank">handler</a>. A
<a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Handler.html" target="_blank">handler</a> is a function that accepts a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">context</a>
object and produces a <code>result</code>.</p>
</div>
<div class="paragraph">
<p>A <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">context</a> allows you to interact with the <code>HTTP Request</code> and manipulate the
<code>HTTP Response</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Incoming request matches exactly <strong>ONE</strong> route handler. If there is no handler, produces a <code>404</code>
response.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3b4876c0de9b430b">{
  get("/user/{id}", ctx -&gt; ctx.path("id").value());  <i class="conum" data-value="1"></i><b>(1)</b>

  get("/user/me", ctx -&gt; "my profile");              <i class="conum" data-value="2"></i><b>(2)</b>

  get("/users", ctx -&gt; "users");                     <i class="conum" data-value="3"></i><b>(3)</b>

  get("/users", ctx -&gt; "new users");                 <i class="conum" data-value="4"></i><b>(4)</b>
}</code><button class="clipboard" data-clipboard-target="#x3b4876c0de9b430b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x22cb67fa2fba4e3d">{
  get("/user/{id}") { ctx.path("id").value() }  <i class="conum" data-value="1"></i><b>(1)</b>

  get("/user/me") { "my profile" }              <i class="conum" data-value="2"></i><b>(2)</b>

  get("/users") { "users" }                     <i class="conum" data-value="3"></i><b>(3)</b>

  get("/users") { "new users" }                 <i class="conum" data-value="4"></i><b>(4)</b>
}</code><button class="clipboard" data-clipboard-target="#x22cb67fa2fba4e3d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>GET /user/ppicapiedra</code> â‡’ <code>ppicapiedra</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>GET /user/me</code> â‡’ <code>my profile</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Unreachable â‡’ override it by next route</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>GET /users</code> â‡’ <code>new users</code> not <code>users</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Routes with most specific path pattern (<code>2</code> vs <code>1</code>) has more precedence. Also, is one or more routes
result in the same path pattern, like <code>3</code> and <code>4</code>, last registered route hides/overrides previous route.</p>
</div>
<div class="sect3">
<h4 id="router-handler-filter"><a class="anchor" href="#router-handler-filter"></a><a class="link" href="#router-handler-filter">3.3.1. Filter</a></h4>
<div class="paragraph">
<p>Cross cutting concerns such as response modification, verification, security, tracing, etc. is available
via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Filter.html" target="_blank">Route.Filter</a>.</p>
</div>
<div class="paragraph">
<p>A <code>filter</code> takes the <code>next</code> handler in the pipeline and produces a <code>new</code> handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8b8cb3b83dbe4030">interface Filter {
  Handler apply(Handler next);
}</code><button class="clipboard" data-clipboard-target="#x8b8cb3b83dbe4030"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Timing filter example:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x75fe6b942c074877">{
  use(next -&gt; ctx -&gt; {
    long start = System.currentTimeMillis();       <i class="conum" data-value="1"></i><b>(1)</b>

    Object response = next.apply(ctx);             <i class="conum" data-value="2"></i><b>(2)</b>

    long end = System.currentTimeMillis();
    long took = end - start;

    System.out.println("Took: " + took + "ms");   <i class="conum" data-value="3"></i><b>(3)</b>

    return response;                              <i class="conum" data-value="4"></i><b>(4)</b>
  });

  get("/", ctx -&gt; {
    return "filter";
  });
}</code><button class="clipboard" data-clipboard-target="#x75fe6b942c074877"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xabf9339f708c4858">{
  /** Kotlin uses implicit variables: `ctx` and `next` */
  use {
    val start = System.currentTimeMillis()  <i class="conum" data-value="1"></i><b>(1)</b>

    val response = next.apply(ctx)          <i class="conum" data-value="2"></i><b>(2)</b>

    val end = System.currentTimeMillis()
    val took = end - start

    println("Took: " + took + "ms")         <i class="conum" data-value="3"></i><b>(3)</b>

    response                                <i class="conum" data-value="4"></i><b>(4)</b>
  }

  get("/") {
    "filter"
  }
}</code><button class="clipboard" data-clipboard-target="#xabf9339f708c4858"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Saves start time</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Proceed with execution (pipeline)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Compute and print latency</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns a response</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One or more filter on top of a handler produces a new handler.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-handler-before"><a class="anchor" href="#router-handler-before"></a><a class="link" href="#router-handler-before">3.3.2. Before</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Before.html" target="_blank">before</a> filter runs before a <code>handler</code>.</p>
</div>
<div class="paragraph">
<p>A <code>before</code> filter takes a <code>context</code> as argument and donâ€™t produces a response. It expected to operates
via side effects (usually modifying the HTTP response).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf3a8b625a1084465">interface Before {
  void apply(Context ctx);
}</code><button class="clipboard" data-clipboard-target="#xf3a8b625a1084465"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa038cb439a6e4b2b">{
  before(ctx -&gt; {
    ctx.setResponseHeader("Server", "Jooby");
  });

  get("/", ctx -&gt; {
    return "...";
  });
}</code><button class="clipboard" data-clipboard-target="#xa038cb439a6e4b2b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf99c088668ea497d">{
  before {
    ctx.setResponseHeader("Server", "Jooby")
  }

  get("/") {
    "..."
  }
}</code><button class="clipboard" data-clipboard-target="#xf99c088668ea497d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="router-handler-after"><a class="anchor" href="#router-handler-after"></a><a class="link" href="#router-handler-after">3.3.3. After</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.After.html" target="_blank">after</a> filter runs after a <code>handler</code>.</p>
</div>
<div class="paragraph">
<p>An <code>after</code> filter takes three arguments. The first argument is the <code>HTTP context</code>, the second
argument is the result/response from a <strong>functional handler</strong> or <code>null</code> for <strong>side-effects</strong> handler,
the third and last argument is an exception generates from handler.</p>
</div>
<div class="paragraph">
<p>It expected to operates via side effects, usually modifying the HTTP response (if possible) or
for cleaning/trace execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xebd6456ac8f940c0">interface After {
  void apply(Context ctx, Object result, Throwable failure);
}</code><button class="clipboard" data-clipboard-target="#xebd6456ac8f940c0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Functional Handler:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4e322a938fe54b22">{
  after((ctx, result, failure) -&gt; {
    System.out.println(result);          <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.setResponseHeader("foo", "bar"); <i class="conum" data-value="2"></i><b>(2)</b>
  });

  get("/", ctx -&gt; {
    return "Jooby";
  });
}</code><button class="clipboard" data-clipboard-target="#x4e322a938fe54b22"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x998d08fa7a1b4266">{
  after {
    println("Hello $result")             <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.setResponseHeader("foo", "bar")  <i class="conum" data-value="2"></i><b>(2)</b>
  }

  get("/") {
    "Jooby"
  }
}</code><button class="clipboard" data-clipboard-target="#x998d08fa7a1b4266"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prints <code>Jooby</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add a response header (modifies the HTTP response)</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If the target handler is a <strong>functional</strong> handler modification of HTTP response is allowed it.</p>
</div>
<div class="paragraph">
<p>For <strong>side effects</strong> handler the after filter is invoked with a <code>null</code> value and isnâ€™t allowed to modify the HTTP response.</p>
</div>
<div class="listingblock primary">
<div class="title">Side-Effect Handler:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x40c1d9994aad4fd5">{
  after((ctx, result, failure) -&gt; {
    System.out.println(result);          <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.setResponseHeader("foo", "bar"); <i class="conum" data-value="2"></i><b>(2)</b>
  });

  get("/", ctx -&gt; {
    return ctx.send("Jooby");
  });
}</code><button class="clipboard" data-clipboard-target="#x40c1d9994aad4fd5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8bb910d0b4084830">{
  after {
    println("Hello $result")             <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.setResponseHeader("foo", "bar")  <i class="conum" data-value="2"></i><b>(2)</b>
  }

  get("/") {
    ctx.send("Jooby")
  }
}</code><button class="clipboard" data-clipboard-target="#x8bb910d0b4084830"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prints <code>null</code> (no value)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Produces an error/exception</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Exception occurs because response was already started and its impossible to alter/modify it.</p>
</div>
<div class="paragraph">
<p>Side-effects handler are all that make use of family of send methods, responseOutputStream and responseWriter.</p>
</div>
<div class="paragraph">
<p>You can check whenever you can modify the response by checking the state of <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#isResponseStarted()" target="_blank">isResponseStarted()</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">Safe After:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x676481261c634c73">{
  after((ctx, result, failure) -&gt; {
    if (ctx.isResponseStarted()) {
      // Don't modify response
    } else {
      // Safe to modify response
    }
  });
}</code><button class="clipboard" data-clipboard-target="#x676481261c634c73"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x2f853ce97cfd4f80">{
  after {
    if (ctx.responseStarted) {
      // Don't modify response
    } else {
      // Safe to modify response
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x2f853ce97cfd4f80"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An after handler is always invoked.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The next examples demonstrate some use cases for dealing with errored responses, but keep in mind
that an after handler is not a mechanism for handling and reporting exceptions thatâ€™s is a task
for an <a href="#error-handler">Error Handler</a>.</p>
</div>
<div class="listingblock primary">
<div class="title">Run code depending of success or failure responses:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x23184a86b4ce4dcc">{
  after((ctx, result, failure) -&gt; {
    if (failure == null) {
      db.commit();                   <i class="conum" data-value="1"></i><b>(1)</b>
    } else {
      db.rollback();                 <i class="conum" data-value="2"></i><b>(2)</b>
    }
  });
}</code><button class="clipboard" data-clipboard-target="#x23184a86b4ce4dcc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf30d243fd9d04b69">{
  after {
    if (failure == null) {
      db.commit()                    <i class="conum" data-value="1"></i><b>(1)</b>
    } else {
      db.rollback()                  <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xf30d243fd9d04b69"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Here the exception is still propagated given the chance to the <a href="#error-handler">Error Handler</a> to jump in.</p>
</div>
<div class="listingblock primary">
<div class="title">Recover fom exception and produces an alternative output:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xaf1c92be1cd2466f">{
  after((ctx, result, failure) -&gt; {
    if (failure instanceOf MyBusinessException) {
      ctx.send("Recovering from something");        <i class="conum" data-value="1"></i><b>(1)</b>
    }
  });
}</code><button class="clipboard" data-clipboard-target="#xaf1c92be1cd2466f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x738624a7b86241c3">{
  after {
    if (failure is MyBusinessException) {
      ctx.send("Recovering from something")         <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x738624a7b86241c3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recover and produces an alternative output</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here the exception wont be propagated due we produces a response, so error handler wonâ€™t be execute it.</p>
</div>
<div class="paragraph">
<p>In case where the after handler produces a new exception, that exception will be add to the original exception as suppressed exception.</p>
</div>
<div class="listingblock primary">
<div class="title">Suppressed exceptions:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x61785f916e274df3">{
  after((ctx, result, failure) -&gt; {
    ...
    throw new AnotherException();
  });

  get("/", ctx -&gt; {
    ...
    throw new OriginalException();
  });

  error((ctx, failure, code) -&gt; {
    Throwable originalException = failure;                       <i class="conum" data-value="1"></i><b>(1)</b>
    Throwable anotherException  = failure.getSuppressed()[0];    <i class="conum" data-value="2"></i><b>(2)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x61785f916e274df3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x57e76cb2d65d48b7">{
  after {
    ...
    throw AnotherException();
  }

  get("/") { ctx -&gt;
    ...
    throw OriginalException()
  }

  error { ctx, failure, code) -&gt;
    val originalException = failure                              <i class="conum" data-value="1"></i><b>(1)</b>
    val anotherException  = failure.getSuppressed()[0]           <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x57e76cb2d65d48b7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Will be <code>OriginalException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Will be <code>AnotherException</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-handler-complete"><a class="anchor" href="#router-handler-complete"></a><a class="link" href="#router-handler-complete">3.3.4. Complete</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Complete.html" target="_blank">complete</a> listener run at the completion of a request/response cycle
(i.e. when the request has been completely read, and the response has been fully written).</p>
</div>
<div class="paragraph">
<p>At this point it is too late to modify the exchange further. They are attached to a running context
(not like a filter/before/after filters).</p>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd56da45cd9654d61">{
   use(next -&gt; ctx -&gt; {
     long start = System.currentTimeInMillis();
     ctx.onComplete(context -&gt; {                      <i class="conum" data-value="1"></i><b>(1)</b>
       long end = System.currentTimeInMillis();       <i class="conum" data-value="2"></i><b>(2)</b>
       System.out.println("Took: " + (end - start));
     });
   });
}</code><button class="clipboard" data-clipboard-target="#xd56da45cd9654d61"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5e8e3d2195e9452c">{
   use {
     val start = System.currentTimeMillis()
     ctx.onComplete {                                 <i class="conum" data-value="1"></i><b>(1)</b>
       val end = System.currentTimeMillis()           <i class="conum" data-value="2"></i><b>(2)</b>
       println("Took: " + (end - start))
     }
   }
}</code><button class="clipboard" data-clipboard-target="#x5e8e3d2195e9452c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Attach a completion listener</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run after response has been fully written</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Completion listeners are invoked in reverse order.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-pipeline"><a class="anchor" href="#router-pipeline"></a><a class="link" href="#router-pipeline">3.4. Pipeline</a></h3>
<div class="paragraph">
<p>Route pipeline (a.k.a route stack) is a composition of one or more use(s) tied to a single <code>handler</code>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4a953f1da1f140e3">{
  // Increment +1
  use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  // Increment +1
  use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/1", ctx -&gt; 1); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/2", ctx -&gt; 2); <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x4a953f1da1f140e3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbc695589a72a40ca">{
  // Increment +1
  use {
    val n = next.apply(ctx) as Int
    1 + n
  }

  // Increment +1
  use {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/1") { 1 } <i class="conum" data-value="1"></i><b>(1)</b>

  get("/2") { 2 } <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#xbc695589a72a40ca"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/1</code> â‡’ <code>3</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/2</code> â‡’ <code>4</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Behind the scene, Jooby builds something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc107614ca9e54c81">{
  // Increment +1
  var increment = use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  Handler one = ctx -&gt; 1;

  Handler two = ctx -&gt; 2;

  Handler handler1 = increment.then(increment).then(one);
  Handler handler2 = increment.then(increment).then(two);

  get("/1", handler1);

  get("/2", handler2);
}</code><button class="clipboard" data-clipboard-target="#xc107614ca9e54c81"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Any <code>filter</code> defined on top of the handler will be stacked/chained into a new handler.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Filter without path pattern</div>
<div class="paragraph">
<p>This was a hard decision to make, but we know is the right one. Jooby 1.x uses a path pattern to
define <code>filter</code>.</p>
</div>
<div class="paragraph">
<p>The <code>pipeline</code> in Jooby 1.x consists of multiple filters and handlers. They are match
sequentially one by one. The following <code>filter</code> is always executed in Jooby 1.x</p>
</div>
<div class="listingblock">
<div class="title">Jooby 1.x</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x898a2f75991945b6">{
   use("/*", (req, rsp, chain) -&gt; {
     // remote call, db call
   });

   // ...
}</code><button class="clipboard" data-clipboard-target="#x898a2f75991945b6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose there is a bot trying to access and causing lot of <code>404</code> responses (path doesnâ€™t exist).
In Jooby 1.x the <code>filter</code> is executed for every single request sent by the bot just to realize
there is NO matching route and all we need is a <code>404</code>.</p>
</div>
<div class="paragraph">
<p>In Jooby 2.x this wonâ€™t happen anymore. If there is a matching handler, the <code>pipeline</code> will be
executed. Otherwise, nothing will do!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="router-pipeline-order"><a class="anchor" href="#router-pipeline-order"></a><a class="link" href="#router-pipeline-order">3.4.1. Order</a></h4>
<div class="paragraph">
<p>Order follows the <strong>what you see is what you get</strong> approach. Routes are stacked in the way they were added/defined.</p>
</div>
<div class="listingblock primary">
<div class="title">Order example:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xfd6263630e0847e0">{
  // Increment +1
  use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/1", ctx -&gt; 1);                <i class="conum" data-value="1"></i><b>(1)</b>

  // Increment +1
  use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/2", ctx -&gt; 2);               <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#xfd6263630e0847e0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xfe2d1a69afb04a89">{
  // Increment +1
  use {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/1") { 1 }                <i class="conum" data-value="1"></i><b>(1)</b>

  // Increment +1
  use {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/2") { 2 }                <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#xfe2d1a69afb04a89"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/1</code> â‡’ <code>2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/2</code> â‡’ <code>4</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-pipeline-scoped-filter"><a class="anchor" href="#router-pipeline-scoped-filter"></a><a class="link" href="#router-pipeline-scoped-filter">3.4.2. Scoped Filter</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#routes(java.lang.Runnable)" target="_blank">routes(Runnable)</a> and <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#path(java.lang.String,java.lang.Runnable)" target="_blank">path(String,Runnable)</a> operators
are used to group one or more routes.</p>
</div>
<div class="paragraph">
<p>A <code>scoped filter</code> looks like:</p>
</div>
<div class="listingblock primary">
<div class="title">Scoped filter:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xbdd0ac64844b404e">{
  // Increment +1
  use(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  routes(() -&gt; {                          <i class="conum" data-value="1"></i><b>(1)</b>
    // Multiply by 2
    use(next -&gt; ctx -&gt; {
      Number n = (Number) next.apply(ctx);
      return 2 * n.intValue();
    });

    get("/4", ctx -&gt; 4);                 <i class="conum" data-value="2"></i><b>(2)</b>
  });

  get("/1", ctx -&gt; 1);                   <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#xbdd0ac64844b404e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xcc16fb075f648be">{
  // Increment +1
  use {
    val n = next.apply(ctx) as Int
    return 1 + n
  }

  routes {                                <i class="conum" data-value="1"></i><b>(1)</b>
    // Multiply by 2
    use {
      val n = next.apply(ctx) as Int
      2 * n
    }

    get("/4") { 4 }               <i class="conum" data-value="2"></i><b>(2)</b>
  }

  get("/1") { 1 }                 <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#xcc16fb075f648be"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Introduce a new scope via <code>routes</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/4</code>  â‡’ <code>9</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>/1</code>  â‡’ <code>2</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is a normal <code>filter</code> inside of one of the group operators.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-grouping-routes"><a class="anchor" href="#router-grouping-routes"></a><a class="link" href="#router-grouping-routes">3.5. Grouping routes</a></h3>
<div class="paragraph">
<p>As showed previously, the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#routes(java.lang.Runnable)" target="_blank">routes(Runnable)</a> operator push a new route <code>scope</code>
and allows you to selectively apply one or more routes.</p>
</div>
<div class="listingblock primary">
<div class="title">Route operator</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe03b6f6fe6da42a6">{
  routes(() -&gt; {

    get("/", ctx -&gt; "Hello");

  });
}</code><button class="clipboard" data-clipboard-target="#xe03b6f6fe6da42a6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xaa88bb3319174e39">{
  routes {

    get("/") {
      "Hello"
    }

  }
}</code><button class="clipboard" data-clipboard-target="#xaa88bb3319174e39"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Route operator is for grouping one or more routes and apply cross cutting concerns to all them.</p>
</div>
<div class="paragraph">
<p>In similar fashion the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#path(java.lang.String,java.lang.Runnable)" target="_blank">path(String,Runnable)</a> operator groups
one or more routes under a common path pattern.</p>
</div>
<div class="listingblock primary">
<div class="title">Routes with path prefix:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x29182f7dc44b4a8d">{
   path("/api/user", () -&gt; {    <i class="conum" data-value="1"></i><b>(1)</b>

     get("/{id}", ctx -&gt; ...);  <i class="conum" data-value="2"></i><b>(2)</b>

     get("/", ctx -&gt; ...);      <i class="conum" data-value="3"></i><b>(3)</b>

     post("/", ctx -&gt; ...);     <i class="conum" data-value="4"></i><b>(4)</b>

     ...
   });
}</code><button class="clipboard" data-clipboard-target="#x29182f7dc44b4a8d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x11d27bad6e2c4872">{
   path("/api/user") {     <i class="conum" data-value="1"></i><b>(1)</b>

     get("/{id}") { ...}   <i class="conum" data-value="2"></i><b>(2)</b>

     get("/") { ...}       <i class="conum" data-value="3"></i><b>(3)</b>

     post("/") { ...}      <i class="conum" data-value="4"></i><b>(4)</b>

     ...
   });
}</code><button class="clipboard" data-clipboard-target="#x11d27bad6e2c4872"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set common prefix <code>/api/user</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>GET /api/user/{id}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>GET /api/user</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>POST /api/user</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="router-composing"><a class="anchor" href="#router-composing"></a><a class="link" href="#router-composing">3.6. Composing</a></h3>
<div class="sect3">
<h4 id="router-composing-mount"><a class="anchor" href="#router-composing-mount"></a><a class="link" href="#router-composing-mount">3.6.1. Mount</a></h4>
<div class="paragraph">
<p>Composition is a technique for building modular applications. You can compose one or more
router into a new one.</p>
</div>
<div class="paragraph">
<p>Composition is available through the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#mount(io.jooby.Router)" target="_blank">mount(Router)</a> operator:</p>
</div>
<div class="listingblock primary">
<div class="title">Composing</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x73dfb590388c42a5">public class Foo extends Jooby {
  {
    get("/foo", Context::getRequestPath);
  }
}

public class Bar extends Jooby {
  {
    get("/bar", Context::getRequestPath);
  }
}

public class App extends Jooby {
  {
    mount(new Foo());                       <i class="conum" data-value="1"></i><b>(1)</b>

    mount(new Bar());                       <i class="conum" data-value="2"></i><b>(2)</b>

    get("/app", Context::getRequestPath);   <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x73dfb590388c42a5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xafa0edf714564f6b">class Foo: Kooby({

  get("/foo") { ctx.getRequestPath() }

})

class Bar: Kooby({

  get("/bar") { ctx.getRequestPath() }

})

class App: Kooby({
  mount(Foo())                         <i class="conum" data-value="1"></i><b>(1)</b>

  mount(Bar())                         <i class="conum" data-value="2"></i><b>(2)</b>

  get("/app") { ctx.getRequestPath() } <i class="conum" data-value="3"></i><b>(3)</b>
})</code><button class="clipboard" data-clipboard-target="#xafa0edf714564f6b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imports all routes from <code>Foo</code>. Output: <code>/foo</code> â‡’ <code>/foo</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Imports all routes from <code>Bar</code>. Output: <code>/bar</code> â‡’ <code>/bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add more routes . Output <code>/app</code> â‡’ <code>/app</code></td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Composing with path prefix</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x76d3438c047d4f2d">public class Foo extends Jooby {
  {
    get("/foo", Context::getRequestPath);
  }
}

public class App extends Jooby {
  {
    mount("/prefix", new Foo());  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x76d3438c047d4f2d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9579443d7aa64185">class Foo: Kooby({

  get("/foo") { ctx.getRequestPath() }

})

class App: Kooby({

  mount("/prefix", Foo())  <i class="conum" data-value="1"></i><b>(1)</b>

})</code><button class="clipboard" data-clipboard-target="#x9579443d7aa64185"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Now all routes from <code>Foo</code> will be prefixed with <code>/prefix</code>. Output: <code>/prefix/foo</code> â‡’ <code>/prefix/foo</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The mount operator only import routes. Services, callbacks, etcâ€¦â€‹ are not imported. Main application
is responsible for assembly all the resources and services required by imported applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="router-composing-install"><a class="anchor" href="#router-composing-install"></a><a class="link" href="#router-composing-install">3.6.2. Install</a></h4>
<div class="paragraph">
<p>Alternatively, you can install a standalone application into another one using the
<a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#install(io.jooby.SneakyThrows.Supplier)" target="_blank">install(Supplier)</a> operator:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x837214b023cb41ed">public class Foo extends Jooby {
  {
    get("/foo", ctx -&gt; ...);
  }
}

public class Bar extends Jooby {
  {
    get("/bar", ctx -&gt; ...);
  }
}

public class App extends Jooby {
  {
    install(Foo::new);                       <i class="conum" data-value="1"></i><b>(1)</b>

    install(Bar::new);                       <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x837214b023cb41ed"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1b31c5af23764e40">class Foo: Kooby({

  get("/foo") { ... }

})

class Bar: Kooby({

  get("/bar") { ... }

})

class App: Kooby({
  install(::Foo)                         <i class="conum" data-value="1"></i><b>(1)</b>

  install(::Bar)                         <i class="conum" data-value="2"></i><b>(2)</b>
})</code><button class="clipboard" data-clipboard-target="#x1b31c5af23764e40"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imports all routes, services, callbacks, etcâ€¦â€‹ from <code>Foo</code>. Output: <code>/foo</code> â‡’ <code>/foo</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Imports all routes, services, callbacks, etcâ€¦â€‹ from <code>Bar</code>. Output: <code>/bar</code> â‡’ <code>/bar</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This operator lets you for example to deploy <code>Foo</code> as a standalone application or integrate it into a main one called <code>App3508</code>.
The install operator shares the state of the main application, so lazy initialization (and therefore <em>instantiation</em>) of
any child applications is <strong>mandatory</strong>.</p>
</div>
<div class="paragraph">
<p>For example, this wonâ€™t work:</p>
</div>
<div class="listingblock">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1b662aee84514b47">{
  Foo foo = new Foo();
  install(() -&gt; foo);        // Won't work
}</code><button class="clipboard" data-clipboard-target="#x1b662aee84514b47"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Foo</code> application must be lazy initialized:</p>
</div>
<div class="listingblock">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x75448dc5334550">{
  install(() -&gt; new Foo());  // Works!
}</code><button class="clipboard" data-clipboard-target="#x75448dc5334550"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-dynamic-routing"><a class="anchor" href="#router-dynamic-routing"></a><a class="link" href="#router-dynamic-routing">3.7. Dynamic Routing</a></h3>
<div class="paragraph">
<p>Dynamic routing looks similar to <a href="#router-composing">composition</a> but enables/disables routes at runtime
using a <code>predicate</code>.</p>
</div>
<div class="paragraph">
<p>Suppose you own two versions of an <code>API</code> and for some time you need to support both the <code>old</code> and <code>new</code> APIs:</p>
</div>
<div class="listingblock primary">
<div class="title">Dynamic Routing</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd14744d8d3c1452b">public class V1 extends Jooby {
  {
    get("/api", ctx -&gt; "v1");
  }
}

public class V2 extends Jooby {
  {
    get("/api", ctx -&gt; "v2");
  }
}

public class App extends Jooby {
  {
    mount(ctx -&gt; ctx.header("version").value().equals("v1"), new V1()); <i class="conum" data-value="1"></i><b>(1)</b>

    mount(ctx -&gt; ctx.header("version").value().equals("v2"), new V2()); <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xd14744d8d3c1452b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe44a2275f2764101">class V1: Kooby({

  get("/api") { "v1" }

})

class V2: Kooby({

  get("/api") { "v2" }

})

class App: Kooby({

  mount(ctx -&gt; ctx.header("version").value().equals("v1"), V1()); <i class="conum" data-value="1"></i><b>(1)</b>

  mount(ctx -&gt; ctx.header("version").value().equals("v2"), V2()); <i class="conum" data-value="2"></i><b>(2)</b>

})</code><button class="clipboard" data-clipboard-target="#xe44a2275f2764101"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/api</code> â‡’ <code>v1</code>; when <code>version</code> header is <code>v1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/api</code> â‡’ <code>v2</code>; when <code>version</code> header is <code>v2</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Done â™¡!</p>
</div>
</div>
<div class="sect2">
<h3 id="router-multiple-routers"><a class="anchor" href="#router-multiple-routers"></a><a class="link" href="#router-multiple-routers">3.8. Multiple routers</a></h3>
<div class="paragraph">
<p>This model let you <code>run</code> multiple applications on single server instance. Each application
works like a standalone application, they donâ€™t share any kind of services.</p>
</div>
<div class="listingblock primary">
<div class="title">Multiple routers</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xbd087ff67134f09">public class Foo extends Jooby {
  {
    setContextPath("/foo");
    get("/hello", ctx -&gt; ...);
  }
}

public class Bar extends Jooby {
  {
    setContextPath("/bar");
    get("/hello", ctx -&gt; ...);
  }
}

import static io.jooby.Jooby.runApp;

public class MultiApp {
  public static void main(String[] args) {
    runApp(args, List.of(Foo::new, Bar::new));
  }
}</code><button class="clipboard" data-clipboard-target="#xbd087ff67134f09"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1634c25e3a541ce">import io.jooby.kt.Kooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, ::Foo, ::Bar)
}</code><button class="clipboard" data-clipboard-target="#x1634c25e3a541ce"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>You write your application as always and them you deploy them using the <code>runApp</code> method.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to nature of logging framework (static loading and initialization) the logging bootstrap
might not work as you expected. It is recommend to use just the <code>logback.xml</code> or <code>log4j.xml</code> file.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="router-options"><a class="anchor" href="#router-options"></a><a class="link" href="#router-options">3.9. Options</a></h3>
<div class="sect3">
<h4 id="router-options-routing"><a class="anchor" href="#router-options-routing"></a><a class="link" href="#router-options-routing">3.9.1. Routing</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#setRouterOptions(io.jooby.RouterOptions)" target="_blank">setRouterOptions(RouterOptions)</a> control routing options.</p>
</div>
<div class="listingblock primary">
<div class="title">Usage</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xfc373f8cdd2a4c86">import io.jooby.Jooby;
...
{

  setRouterOptions(new RouterOptions()
        .setIgnoreCase(true)
        .setFailOnDuplicateRoutes(true)
        .setIgnoreTrailingSlash(true)
        .setNormalizeSlash(true)
        .setResetHeadersOnError(false)
        .setTrustProxy(true)
        .setContextAsService(true)
  );
}</code><button class="clipboard" data-clipboard-target="#xfc373f8cdd2a4c86"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x4ba90d73fb3946cc">import io.jooby.Jooby
...
{
  routerOptions = RouterOptions().apply {
    ignoreCase = true
    ignoreTrailingSlash = true
    failOnDuplicateRoutes = true
    normalizeSlash = true
    resetHeadersOnError = false
    trustProxy = true
    contextAsService = true
  }
}</code><button class="clipboard" data-clipboard-target="#x4ba90d73fb3946cc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextAsService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, allows to retrieve the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a> object associated with the current request via the service registry while the request is being processed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whenever routing algorithm does case-sensitive matching on an incoming request path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreTrailingSlash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whenever a trailing slash is ignored on an incoming request path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failOnDuplicateRoutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whenever a trailing slash is ignored on an incoming request path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">normalizeSlash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize an incoming request path by removing multiple slash sequences.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resetHeadersOnError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whenever response headers are clear/reset in case of exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustProxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true handles <code>X-Forwarded-*</code> headers by updating the values on the current context to match what was sent in the header(s).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>trustProxy: This should only be installed behind a reverse proxy that has been configured to send the
<code>X-Forwarded-*</code> header, otherwise a remote user can spoof their address by sending a header with
bogus values.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-options-hidden-method"><a class="anchor" href="#router-options-hidden-method"></a><a class="link" href="#router-options-hidden-method">3.9.2. Hidden Method</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#setHiddenMethod(java.lang.String)" target="_blank">setHiddenMethod(String)</a> option allow clients to override the HTTP
method using a hidden form field.</p>
</div>
<div class="listingblock">
<div class="title">Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html" id="xf0de43e967424d11">&lt;form method="post" action="/form"&gt;
  &lt;input type="hidden" name="_method" value="put"&gt;
&lt;/form&gt;</code><button class="clipboard" data-clipboard-target="#xf0de43e967424d11"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Server</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x99a5492cf391402b">import io.jooby.Jooby;
...
{

  setHiddenMethod("_method");                         <i class="conum" data-value="1"></i><b>(1)</b>

  put("/form", ctx -&gt; {                               <i class="conum" data-value="2"></i><b>(2)</b>

  });
}</code><button class="clipboard" data-clipboard-target="#x99a5492cf391402b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x27216985cd864c08">import io.jooby.Jooby
...
{
  setHiddenMethod("_method")                          <i class="conum" data-value="1"></i><b>(1)</b>

  put("/form", ctx -&gt; {                               <i class="conum" data-value="2"></i><b>(2)</b>

  });
}</code><button class="clipboard" data-clipboard-target="#x27216985cd864c08"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure hidden method property to read the form field: <code>_method</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Execute the put version of <code>/form</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The default implementation looks for a form field from POST form/multipart request. You can provide
a different strategy.</p>
</div>
<div class="listingblock primary">
<div class="title">HTTP Header</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa76f0d52b4824cf6">import io.jooby.Jooby;
...
{

  setHiddenMethod(ctx -&gt; ctx.header("X-HTTP-Method-Override").toOptional());  <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#xa76f0d52b4824cf6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc9ef1056850f49e7">import io.jooby.Jooby
...
{
  setHiddenMethod {ctx -&gt; ctx.header("X-HTTP-Method-Override").toOptional()}  <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#xc9ef1056850f49e7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Look for a request header: <code>X-HTTP-Method-Override</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="context"><a class="anchor" href="#context"></a><a class="link" href="#context">4. Context</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a> allows you to interact with the HTTP Request and manipulate the HTTP Response.</p>
</div>
<div class="paragraph">
<p>In most of the cases you can access the context object as a parameter of your route handler:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdccd169a4d7a4776">{
  get("/", ctx -&gt; { /* do important stuff with variable 'ctx'. */ });
}</code><button class="clipboard" data-clipboard-target="#xdccd169a4d7a4776"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xed6f0405d594f02">{
  get("/") { /* variable 'it' holds the context now. */ }
}</code><button class="clipboard" data-clipboard-target="#xed6f0405d594f02"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a> also provides derived information about the current request such as a
matching locale (or locales) based on the <code>Accept-Language</code> header (if presents). You may use
the result of <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#locale()" target="_blank">locale()</a> or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#locales()" target="_blank">locales()</a> to present content matching to
the userâ€™s language preference.</p>
</div>
<div class="paragraph">
<p>The above methods use <code>Locale.lookup(â€¦â€‹)</code> and <code>Locale.filter(â€¦â€‹)</code> respectively to perform the
language tag matching. See their overloads if you need to plug in your own matching strategy.</p>
</div>
<div class="paragraph">
<p>To leverage language matching however, you need to tell Jooby which languages your application
supports. This can be done by either setting the <code>application.lang</code> configuration property
to a value compatible with the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language" target="_blank">Accept-Language</a>
header:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="x28e71a6f0da047ce">application.lang = en, en-GB, de</code><button class="clipboard" data-clipboard-target="#x28e71a6f0da047ce"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>or calling the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#setLocales(java.util.List)" target="_blank">setLocales(List)</a>
or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#setLocales(java.util.Locale...)" target="_blank">setLocales(Localeâ€¦â€‹)</a> method at runtime:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9fd3e7725b194cbe">{
  setLocales(Locale.GERMAN, new Locale("hu", "HU"));
}</code><button class="clipboard" data-clipboard-target="#x9fd3e7725b194cbe"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x7af55b3d7019444d">{
  setLocales(Locale.GERMAN, Locale("hu", "HU"))
}</code><button class="clipboard" data-clipboard-target="#x7af55b3d7019444d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>If you donâ€™t set the supported locales explicitly, Jooby uses a single locale provided by
<code>Locale.getDefault()</code>.</p>
</div>
<div class="sect2">
<h3 id="context-parameters"><a class="anchor" href="#context-parameters"></a><a class="link" href="#context-parameters">4.1. Parameters</a></h3>
<div class="paragraph">
<p>There are several parameter types: <code>header</code>, <code>cookie</code>, <code>path</code>, <code>query</code>, <code>form</code>, <code>multipart</code>,
<code>session</code> and <code>flash</code>. All them share a unified/type-safe API for accessing and manipulating their values.</p>
</div>
<div class="paragraph">
<p>We are going to describe them briefly in the next sections, then go into specific features of the
<a href="#context-value-api">Value API</a>.</p>
</div>
<div class="paragraph">
<p>There is also a <a href="#context-parameters-parameter-lookup">parameter lookup</a> feature by which you can access a parameter from any combination
of the above types with well-defined priority.</p>
</div>
<div class="sect3">
<h4 id="context-parameters-header"><a class="anchor" href="#context-parameters-header"></a><a class="link" href="#context-parameters-header">4.1.1. Header</a></h4>
<div class="paragraph">
<p>HTTP headers allow the client and the server to pass additional information with the request or the
response.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x745b06243fe64548">{
  get("/", ctx -&gt; {
    String token = ctx.header("token").value();      <i class="conum" data-value="1"></i><b>(1)</b>

    Value headers = ctx.headers();                   <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, String&gt; headerMap = ctx.headerMap(); <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  });

}</code><button class="clipboard" data-clipboard-target="#x745b06243fe64548"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xccb56fed42944c1f">{
  get("/") { ctx -&gt;
    val token = ctx.header("token").value() <i class="conum" data-value="1"></i><b>(1)</b>

    val headers = ctx.headers()             <i class="conum" data-value="2"></i><b>(2)</b>

    val headerMap = ctx.headerMap();        <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  }

}</code><button class="clipboard" data-clipboard-target="#xccb56fed42944c1f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Header variable <code>token</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All headers as <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html" target="_blank">Value</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All headers as map</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-cookie"><a class="anchor" href="#context-parameters-cookie"></a><a class="link" href="#context-parameters-cookie">4.1.2. Cookie</a></h4>
<div class="paragraph">
<p>Request cookies are send to the server using the <code>Cookie</code> header, but we do provide a simple
<code>key/value</code> access to them:</p>
</div>
<div class="listingblock primary">
<div class="title">Cookies</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4c91cc62108f4212">{
  get("/", ctx -&gt; {
    String token = ctx.cookie("token").value();      <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, String&gt; cookieMap = ctx.cookieMap(); <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });

}</code><button class="clipboard" data-clipboard-target="#x4c91cc62108f4212"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x93322c5b68247cf">{
  get("/") { ctx -&gt;
    val token = ctx.cookie("token").value() <i class="conum" data-value="1"></i><b>(1)</b>

    val cookieMap = ctx.cookieMap()         <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }

}</code><button class="clipboard" data-clipboard-target="#x93322c5b68247cf"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cookie variable <code>token</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All cookies as map</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-path"><a class="anchor" href="#context-parameters-path"></a><a class="link" href="#context-parameters-path">4.1.3. Path</a></h4>
<div class="paragraph">
<p>Path parameter are part of the <code>URI</code>. To define a path variable you need to use the <code>{identifier}</code> notation.</p>
</div>
<div class="listingblock primary">
<div class="title">Syntax:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa26ec8c0ca9d44b6">{
  get("/{id}" ctx -&gt; ctx.path("id").value());                                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/@{id}" ctx -&gt; ctx.path("id").value());                                <i class="conum" data-value="2"></i><b>(2)</b>

  get("/file/{name}.{ext}", ctx -&gt; cxt.path("name") + "." + ctx.path("ext")); <i class="conum" data-value="3"></i><b>(3)</b>

  get("/file/*", ctx -&gt; ctx.path("*"))                                        <i class="conum" data-value="4"></i><b>(4)</b>

  get("/{id:[0-9]+}", ctx -&gt; ctx.path("id))                                   <i class="conum" data-value="5"></i><b>(5)</b>
}</code><button class="clipboard" data-clipboard-target="#xa26ec8c0ca9d44b6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa45b230abe8045d6">{
  get("/{id}") { ctx -&gt; ctx.path("id").value() }                                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/@{id}") { ctx -&gt; ctx.path("id").value() }                                <i class="conum" data-value="2"></i><b>(2)</b>

  get("/file/{name}.{ext}") { ctx -&gt; cxt.path("name") + "." + ctx.path("ext") }  <i class="conum" data-value="3"></i><b>(3)</b>

  get("/file/*") { ctx -&gt; ctx.path("*") }                                        <i class="conum" data-value="4"></i><b>(4)</b>

  get("/{id:[0-9]+}") { ctx -&gt; ctx.path("id) }                                   <i class="conum" data-value="5"></i><b>(5)</b>
}</code><button class="clipboard" data-clipboard-target="#xa45b230abe8045d6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Path variable <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path variable <code>id</code> prefixed with <code>@</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Multiple variables <code>name</code> and <code>ext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Unnamed catchall path variable</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Path variable with a regular expression</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x800a2437f6b14f6c">{
  get("/{name}", ctx -&gt; {
    String pathString = ctx.getRequestPath();     <i class="conum" data-value="1"></i><b>(1)</b>

    Value path = ctx.path();                      <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, String&gt; pathMap = ctx.pathMap();  <i class="conum" data-value="3"></i><b>(3)</b>

    String name = ctx.path("name").value();       <i class="conum" data-value="4"></i><b>(4)</b>

    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x800a2437f6b14f6c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe78684b0e404fc7">{
  get("/{name}") { ctx -&gt;
    val pathString = ctx.getRequestPath()  <i class="conum" data-value="1"></i><b>(1)</b>

    val path = ctx.path()                 <i class="conum" data-value="2"></i><b>(2)</b>

    val pathMap = ctx.pathMap()           <i class="conum" data-value="3"></i><b>(3)</b>

    val name = ctx.path("name").value()   <i class="conum" data-value="4"></i><b>(4)</b>

    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xe78684b0e404fc7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to the <code>raw</code> path string:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    â‡’ <code>/a+b</code></p>
</li>
<li>
<p><code>/a b</code>    â‡’ <code>/a%20b</code>  (not decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> â‡’ <code>/%2F%2B</code> (not decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path as <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html" target="_blank">Value</a> object:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    â‡’ <code>{name=a+b}</code></p>
</li>
<li>
<p><code>/a b</code>    â‡’ <code>{name=a b}</code> (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> â‡’ <code>{name=/+}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Path as <code>Map&lt;String, String&gt;</code> object:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    â‡’ <code>{name=a+b}</code></p>
</li>
<li>
<p><code>/a b</code>    â‡’ <code>{name=a b}</code> (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> â‡’ <code>{name=/+}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Path variable <code>name</code> as <code>String</code>:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    â‡’ <code>a+b</code></p>
</li>
<li>
<p><code>/a b</code>    â‡’ <code>a b</code>  (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> â‡’ <code>/+</code>   (decoded)</p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-query"><a class="anchor" href="#context-parameters-query"></a><a class="link" href="#context-parameters-query">4.1.4. Query</a></h4>
<div class="paragraph">
<p>Query String is part of the <code>URI</code> that start after the <code>?</code> character.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x6789b140efe54c17">{
  get("/search", ctx -&gt; {
    String queryString = ctx.queryString();                    <i class="conum" data-value="1"></i><b>(1)</b>

    QueryString query = ctx.query();                           <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, List&lt;String&gt;&gt; queryMap = ctx.queryMultimap();  <i class="conum" data-value="3"></i><b>(3)</b>

    String q = ctx.query("q").value();                         <i class="conum" data-value="4"></i><b>(4)</b>

    SearchQuery searchQuery = ctx.query(SearchQuery.class);    <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

class SearchQuery {

   public final String q;

   public SearchQuery(String q) {
     this.q = q;
   }
}</code><button class="clipboard" data-clipboard-target="#x6789b140efe54c17"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xcd6b3250fb284049">{
  get("/search") { ctx -&gt;
    val queryString = ctx.queryString()         <i class="conum" data-value="1"></i><b>(1)</b>

    val query = ctx.query()                     <i class="conum" data-value="2"></i><b>(2)</b>

    val queryMap = ctx.queryMultimap()          <i class="conum" data-value="3"></i><b>(3)</b>

    val q = ctx.query("q").value()              <i class="conum" data-value="4"></i><b>(4)</b>

    val searchQuery = ctx.query&lt;SearchQuery&gt;()  <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  }
}

data class SearchQuery (val q: String)</code><button class="clipboard" data-clipboard-target="#xcd6b3250fb284049"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to <code>raw</code> queryString:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       â‡’ <code>""</code> (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> â‡’ <code>?q=a+b</code></p>
</li>
<li>
<p><code>/search?q=a b</code> â‡’ <code>?q=a%20b</code> (not decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Query String as <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/QueryString.html" target="_blank">QueryString</a> object:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       â‡’ <code>{}</code>      (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> â‡’ <code>{q=a+b}</code></p>
</li>
<li>
<p><code>/search?q=a b</code> â‡’ <code>{q=a b}</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Query string as <code>multi-value map</code>
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       â‡’ <code>{}</code>       (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> â‡’ <code>{q=[a+b]}</code></p>
</li>
<li>
<p><code>/search?q=a b</code> â‡’ <code>{q=[a b]}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access to decoded variable <code>q</code>:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       â‡’ <code>Bad Request (400). Missing value: "q"</code></p>
</li>
<li>
<p><code>/search?q=a+b</code> â‡’ <code>a+b</code></p>
</li>
<li>
<p><code>/search?q=a b</code> â‡’ <code>a b</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query string as <code>SearchQuery</code>
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       â‡’ <code>Bad Request (400). Missing value: "q"</code></p>
</li>
<li>
<p><code>/search?q=a+b</code> â‡’ <code>SearchQuery(q="a+b")</code></p>
</li>
<li>
<p><code>/search?q=a b</code> â‡’ <code>SearchQuery(q="a b")</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-formdata"><a class="anchor" href="#context-parameters-formdata"></a><a class="link" href="#context-parameters-formdata">4.1.5. Formdata</a></h4>
<div class="paragraph">
<p>Formdata is expected to be in HTTP body, or for as part of the <code>URI</code> for <code>GET</code> requests.</p>
</div>
<div class="paragraph">
<p>Data is expected to be encoded as <code>application/x-www-form-urlencoded</code>.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x906cd36b57ee4b08">{
  post("/user", ctx -&gt; {
    Formdata form = ctx.form();                             <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, List&lt;String&gt;&gt; formMap = ctx.formMultimap(); <i class="conum" data-value="2"></i><b>(2)</b>

    String userId = ctx.form("id").value();                 <i class="conum" data-value="3"></i><b>(3)</b>

    String pass = ctx.form("pass").value();                 <i class="conum" data-value="4"></i><b>(4)</b>

    User user = ctx.form(User.class);                       <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

class User {

   public final String id;

   public final String pass;

   public User(String id, String pass) {
     this.id = id;
     this.pass = pass;
   }
}</code><button class="clipboard" data-clipboard-target="#x906cd36b57ee4b08"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5295af86fc634d45">{
  post("/user") { ctx -&gt;
    val form = ctx.form()               <i class="conum" data-value="1"></i><b>(1)</b>

    val formMap = ctx.formMultimap()    <i class="conum" data-value="2"></i><b>(2)</b>

    val userId = ctx.form("id").value() <i class="conum" data-value="3"></i><b>(3)</b>

    val pass = ctx.form("pass").value() <i class="conum" data-value="4"></i><b>(4)</b>

    val user = ctx.form&lt;User&gt;()         <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  }
}

data class User (val id: String, val pass: String)</code><button class="clipboard" data-clipboard-target="#x5295af86fc634d45"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="content">
<pre>curl -d "id=root&amp;pass=pwd" -X POST http://localhost:8080/user</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Form as <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Formdata.html" target="_blank">Formdata</a> â‡’ <code>{id=root, pass=pwd}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Form as <code>multi-value map</code>  â‡’ <code>{id=root, pass=[pwd]}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Form variable <code>id</code>         â‡’ <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Form variable <code>pass</code>       â‡’ <code>pwd</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Form as <code>User</code> object      â‡’ <code>User(id=root, pass=pwd)</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-multipart"><a class="anchor" href="#context-parameters-multipart"></a><a class="link" href="#context-parameters-multipart">4.1.6. Multipart</a></h4>
<div class="paragraph">
<p>Form-data must be present in the HTTP body and encoded as <code>multipart/form-data</code>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3a7fd739051a4b6f">{
  post("/user", ctx -&gt; {
    Multipart multipart = ctx.multipart();                            <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, List&lt;String&gt; multipartMap = ctx.multipartMultimap();  <i class="conum" data-value="2"></i><b>(2)</b>

    String userId = ctx.multipart("id").value();                      <i class="conum" data-value="3"></i><b>(3)</b>

    String pass = ctx.multipart("pass").value();                      <i class="conum" data-value="4"></i><b>(4)</b>

    FileUpload pic = ctx.file("pic");                                 <i class="conum" data-value="5"></i><b>(5)</b>

    User user = ctx.multipart(User.class);                            <i class="conum" data-value="6"></i><b>(6)</b>

    ...
  });
}

class User {

   public final String id;

   public final String pass;

   public final FileUpload pic;

   public User(String id, String pass, FileUpload pic) {
     this.id = id;
     this.pass = pass;
     this.pic = pic;
   }
}</code><button class="clipboard" data-clipboard-target="#x3a7fd739051a4b6f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xaf6c473cfe204c91">{
  post("/user") { ctx -&gt;
    val multipart = ctx.multipart()              <i class="conum" data-value="1"></i><b>(1)</b>

    val multipartMap = ctx.multipartMultimap()   <i class="conum" data-value="2"></i><b>(2)</b>

    val userId = ctx.multipart("id").value()     <i class="conum" data-value="3"></i><b>(3)</b>

    val pass = ctx.multipart("pass").value()     <i class="conum" data-value="4"></i><b>(4)</b>

    val pic = ctx.file("pic")                    <i class="conum" data-value="5"></i><b>(5)</b>

    val user = ctx.multipart&lt;User&gt;()             <i class="conum" data-value="6"></i><b>(6)</b>

    ...
  }
}

data class User (val id: String, val pass: String, val pic: FileUpload)</code><button class="clipboard" data-clipboard-target="#xaf6c473cfe204c91"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="content">
<pre>curl -F id=root -F pass=root -F pic=@/path/to/local/file/profile.png http://localhost:8080/user</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Form as <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Multipart.html" target="_blank">Multipart</a> â‡’ <code>{id=root, pass=pwd, pic=profile.png}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Form as <code>multi-value map</code>   â‡’ <code>{id=root, pass=[pwd]}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Form variable <code>id</code>          â‡’ <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Form variable <code>pass</code>        â‡’ <code>pwd</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/FileUpload.html" target="_blank">FileUpload</a> variable <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Form as <code>User</code> object       â‡’ <code>User(id=root, pass=pwd, pic=profile.png)</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">File Upload</div>
<div class="paragraph">
<p>File upload are available ONLY for multipart requests.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x92e096a8c6a54b3a">  FileUpload pic = ctx.file("pic");         <i class="conum" data-value="1"></i><b>(1)</b>

  List&lt;FileUpload&gt; pic = ctx.files("pic");  <i class="conum" data-value="2"></i><b>(2)</b>

  List&lt;FileUpload&gt; files = ctx.files();     <i class="conum" data-value="3"></i><b>(3)</b></code><button class="clipboard" data-clipboard-target="#x92e096a8c6a54b3a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x259039babc0d4ea0">  val pic = ctx.file("pic")   <i class="conum" data-value="1"></i><b>(1)</b>

  val pic = ctx.files("pic")  <i class="conum" data-value="2"></i><b>(2)</b>

  val files = ctx.files()     <i class="conum" data-value="3"></i><b>(3)</b></code><button class="clipboard" data-clipboard-target="#x259039babc0d4ea0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Single file upload named <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Multiple file uploads named <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All file uploads</td>
</tr>
</tbody></table>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-session"><a class="anchor" href="#context-parameters-session"></a><a class="link" href="#context-parameters-session">4.1.7. Session</a></h4>
<div class="paragraph">
<p>Session parameters are available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#session()" target="_blank">session()</a> or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#sessionOrNull()" target="_blank">sessionOrNull()</a>
methods. HTTP Session is covered in his own <a href="#session">chapter</a>, but here is a quick look:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb0c6f385b368450d">  Session session = ctx.session();                      <i class="conum" data-value="1"></i><b>(1)</b>

  String attribute = ctx.session("attribute").value();  <i class="conum" data-value="2"></i><b>(2)</b></code><button class="clipboard" data-clipboard-target="#xb0c6f385b368450d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xeb666de6ac664407">  val session = ctx.session()                             <i class="conum" data-value="1"></i><b>(1)</b>

  val attribute = session.attribute("attribute").value()  <i class="conum" data-value="2"></i><b>(2)</b></code><button class="clipboard" data-clipboard-target="#xeb666de6ac664407"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Find an existing Session or create one</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get a session attribute</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-flash"><a class="anchor" href="#context-parameters-flash"></a><a class="link" href="#context-parameters-flash">4.1.8. Flash</a></h4>
<div class="paragraph">
<p>Flash parameters are designed to transport success/error messages between requests. It is similar to
a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Session.html" target="_blank">Session</a> but the lifecycle is shorter: <strong>data is kept for only one request</strong>.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf758bd367c614748">  get("/", ctx -&gt; {
    return ctx.flash("success").value("Welcome!"); <i class="conum" data-value="3"></i><b>(3)</b>
  });

  post("/save", ctx -&gt; {
    ctx.flash().put("success", "Item created");    <i class="conum" data-value="1"></i><b>(1)</b>
    return ctx.sendRedirect("/");                  <i class="conum" data-value="2"></i><b>(2)</b>
  });</code><button class="clipboard" data-clipboard-target="#xf758bd367c614748"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3b4cb299749e4a31">  get("/") { ctx -&gt;
    ctx.flash("success").value("Welcome!")         <i class="conum" data-value="3"></i><b>(3)</b>
  }

  post("/save") { ctx -&gt;
    ctx.flash().put("success", "Item created")     <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.sendRedirect("/")                          <i class="conum" data-value="2"></i><b>(2)</b>
  }</code><button class="clipboard" data-clipboard-target="#x3b4cb299749e4a31"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a flash attribute: <code>success</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Redirect to home page</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Display an existing flash attribute <code>success</code> or shows <code>Welcome!</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Flash attributes are implemented using an <code>HTTP Cookie</code>. To customize the cookie
(its name defaults to <code>jooby.flash</code>) use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#setFlashCookie(io.jooby.Cookie)" target="_blank">setFlashCookie(Cookie)</a> method:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb644e12cdff64cae">{
  setFlashCookie(new Cookie("myflash").setHttpOnly(true));

  // or if you're fine with the default name
  getFlashCookie().setHttpOnly(true);
}</code><button class="clipboard" data-clipboard-target="#xb644e12cdff64cae"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbdfec06b9d554db7">{
  flashCookie = Cookie("myflash").setHttpOnly(true)

  // or if you're fine with the default name
  flashCookie.isHttpOnly = true
}</code><button class="clipboard" data-clipboard-target="#xbdfec06b9d554db7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="context-parameters-parameter-lookup"><a class="anchor" href="#context-parameters-parameter-lookup"></a><a class="link" href="#context-parameters-parameter-lookup">4.1.9. Parameter Lookup</a></h4>
<div class="paragraph">
<p>You can search for parameters in multiple sources with an explicitly defined priority using the
<a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#lookup()" target="_blank">lookup()</a> or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#lookup(java.lang.String,io.jooby.ParamSource...)" target="_blank">lookup(String,ParamSourceâ€¦â€‹)</a> method:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3b00bd6916834af3">get("/{foo}", ctx -&gt; {
  String foo = ctx.lookup("foo", ParamSource.QUERY, ParamSource.PATH).value();
  return "foo is: " + foo;
});

get("/{foo}", ctx -&gt; {
  String foo = ctx.lookup().inQuery().inPath().get("foo").value();
  return "foo is: " + foo;
});</code><button class="clipboard" data-clipboard-target="#x3b00bd6916834af3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3d955bb6619d492e">get("/{foo}") { ctx -&gt;
  val foo = ctx.lookup("foo", ParamSource.QUERY, ParamSource.PATH).value()
  "foo is: $foo"
}

get("/{foo}") { ctx -&gt;
  val foo = ctx.lookup().inQuery().inPath()["foo"].value()
  "foo is: $foo"
}</code><button class="clipboard" data-clipboard-target="#x3d955bb6619d492e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>In case of a request like <code>/bar?foo=baz</code>, <code>foo is: baz</code> will be returned since the query parameter
takes precedence over the path parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-client-certificates"><a class="anchor" href="#context-parameters-client-certificates"></a><a class="link" href="#context-parameters-client-certificates">4.1.10. Client Certificates</a></h4>
<div class="paragraph">
<p>If mutual TLS is enabled, you can access the clientâ€™s certificates from the context. The first
certificate in the list is the peer certificate, followed by the ca certificates in the chain
(the order is preserved).</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa32b40a3532646e2">get("/{foo}", ctx -&gt; {
  List&lt;Certificate&gt; certificates = ctx.getClientCertificates(); <i class="conum" data-value="1"></i><b>(1)</b>
  Certificate peerCertificate = certificates.get(0);            <i class="conum" data-value="2"></i><b>(2)</b>
});</code><button class="clipboard" data-clipboard-target="#xa32b40a3532646e2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8bd555f97cb748db">get("/{foo}") { ctx -&gt;
  val certificates = ctx.clientCertificates                     <i class="conum" data-value="1"></i><b>(1)</b>
  val peerCertificate = certificates.first()                    <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x8bd555f97cb748db"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get all of the certificates presented by the client during the SSL handshake.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get only the peer certificate.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-value-api"><a class="anchor" href="#context-value-api"></a><a class="link" href="#context-value-api">4.2. Value API</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html" target="_blank">Value</a> is an unified and type-safe API across all parameter types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Header</p>
</li>
<li>
<p>Path</p>
</li>
<li>
<p>Query</p>
</li>
<li>
<p>Formdata/Multipart</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For learning purpose we are going to show all the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html" target="_blank">Value</a> features using query
parameters, but keep in mind these features apply to all the parameter types.</p>
</div>
<div class="sect3">
<h4 id="context-value-api-single-value"><a class="anchor" href="#context-value-api-single-value"></a><a class="link" href="#context-value-api-single-value">4.2.1. Single value</a></h4>
<div class="paragraph">
<p>Single value is available via <code>value()</code> or <code>[type]Value()</code> functions:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4ccf9e94de2848e6">{
  get("/", ctx -&gt; {
    String name = ctx.query("name").value();                          <i class="conum" data-value="1"></i><b>(1)</b>

    float score = ctx.query("score").floatValue();                    <i class="conum" data-value="2"></i><b>(2)</b>

    boolean enabled = ctx.query("enabled").booleanValue();            <i class="conum" data-value="3"></i><b>(3)</b>

    BigDecimal decimal = ctx.query("decimal").value(BigDecimal::new); <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x4ccf9e94de2848e6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb5ce8434a8294229">{
  get("/") {
    val name = ctx.query("name").value()                     <i class="conum" data-value="1"></i><b>(1)</b>

    val score = ctx.query("score").floatValue()              <i class="conum" data-value="2"></i><b>(2)</b>

    val enabled = ctx.query("enabled").booleanValue()        <i class="conum" data-value="3"></i><b>(3)</b>

    val decimal = ctx.query("decimal").value(::BigDecimal)   <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xb5ce8434a8294229"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The <code>value()</code> family methods always retrieve a <code>value</code>. If there is no value, a
<code>BadRequest(400)</code> response is generated. So single value parameters <strong>are required</strong>:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to query parameter <code>q</code> and convert to <code>String</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?name=foo</code> â‡’ <code>foo</code></p>
</li>
<li>
<p><code>/</code>          â‡’ <code>Bad Request(400): Missing value: "q"</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to query parameter <code>score</code> and convert to <code>float</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?score=1</code>      â‡’ <code>1.0</code></p>
</li>
<li>
<p><code>/?score=string</code> â‡’ <code>Bad Request(400)</code> (Type mismatch: cannot convert to number)</p>
</li>
<li>
<p><code>/</code>              â‡’ <code>Bad Request(400)</code> (Required parameter <code>score</code> is not present)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Access to query parameter <code>enabled</code> and convert to <code>boolean</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?enabled=true</code>   â‡’ <code>true</code></p>
</li>
<li>
<p><code>/?enabled=string</code> â‡’ <code>Bad Request(400)</code> (Type mismatch: cannot convert to boolean)</p>
</li>
<li>
<p><code>/</code>                â‡’ <code>Bad Request(400): Missing value: "enabled"</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access to query parameter <code>decimal</code> and convert to <code>BigDecimal</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?decimal=2.3</code>    â‡’ <code>2.3</code></p>
</li>
<li>
<p><code>/?decimal=string</code> â‡’ <code>Bad Request(400)</code> (Type mismatch: cannot convert to BigDecimal)</p>
</li>
<li>
<p><code>/</code>                â‡’ <code>Bad Request(400): Missing value: "decimal"</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-default-and-optional-value"><a class="anchor" href="#context-value-api-default-and-optional-value"></a><a class="link" href="#context-value-api-default-and-optional-value">4.2.2. Default and Optional value</a></h4>
<div class="paragraph">
<p>Default and optional value are available in two different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Providing a default value</p>
</li>
<li>
<p>Requesting an <code>java.util.Optional</code> object</p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xfe8044a1692d4396">{
  get("/search", ctx -&gt; {
    String q = ctx.query("q").value("*:*");             <i class="conum" data-value="1"></i><b>(1)</b>
    return q;
  });

  get("/search", ctx -&gt; {
    Optional&lt;String&gt; q = ctx.query("q").toOptional();   <i class="conum" data-value="2"></i><b>(2)</b>
    return q;
  });
}</code><button class="clipboard" data-clipboard-target="#xfe8044a1692d4396"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x82f607fc68c8406f">{
  get("/search") {
    val q = ctx.query("q").value("*:*")    <i class="conum" data-value="1"></i><b>(1)</b>
    q
  });

  get("/search") {
    val q = ctx.query("q").toOptional();   <i class="conum" data-value="2"></i><b>(2)</b>
    q
  });
}</code><button class="clipboard" data-clipboard-target="#x82f607fc68c8406f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to query variable <code>q</code> and convert to <code>String</code> with a default value of <code><strong>:</strong></code>.
<div class="ulist">
<ul>
<li>
<p><code>/search?q=foo</code> â‡’ <code>foo</code></p>
</li>
<li>
<p><code>/search</code>       â‡’ <code><strong>:</strong></code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to query variable <code>q</code> and convert to <code>Optional&lt;String&gt;</code>:
<div class="ulist">
<ul>
<li>
<p><code>/search?q=foo</code> â‡’ <code>Optional[foo]</code></p>
</li>
<li>
<p><code>/search</code>       â‡’ <code>Optional.empty</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-multiple-values"><a class="anchor" href="#context-value-api-multiple-values"></a><a class="link" href="#context-value-api-multiple-values">4.2.3. Multiple values</a></h4>
<div class="paragraph">
<p>Multiple values are available via functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html#toList()" target="_blank">toList()</a>: Returns a <code>java.util.List</code> of values</p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html#toSet()" target="_blank">toSet()</a>: Returns a <code>java.util.Set</code> of values</p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa0947a49f05f473a">{
  get("/", ctx -&gt; {
    List&lt;String&gt; q = ctx.query("q").toList();                            <i class="conum" data-value="1"></i><b>(1)</b>

    List&lt;Integer&gt; n = ctx.query("n").toList(Integer.class);              <i class="conum" data-value="2"></i><b>(2)</b>

    List&lt;BigDecimal&gt; decimals = ctx.query("d").toList(BigDecimal::new);  <i class="conum" data-value="3"></i><b>(3)</b>

    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xa0947a49f05f473a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xac3dcc5f8774143">{
  get("/") {
    val q = ctx.query("q").toList()                     <i class="conum" data-value="1"></i><b>(1)</b>

    val n = ctx.query("n").toList(Integer.class)        <i class="conum" data-value="2"></i><b>(2)</b>

    val decimals = ctx.query("d").toList(::BigDecimal)  <i class="conum" data-value="3"></i><b>(3)</b>

    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xac3dcc5f8774143"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Multi-value query parameter <code>q</code> as <code>List&lt;String&gt;</code>:
<div class="ulist">
<ul>
<li>
<p><code>/</code>             â‡’ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?q=foo</code>       â‡’ <code>[foo]</code></p>
</li>
<li>
<p><code>/?q=foo&amp;q=bar</code> â‡’ <code>[foo, bar]</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Multi-value query parameter as <code>List&lt;Integer&gt;</code>
<div class="ulist">
<ul>
<li>
<p><code>/</code>         â‡’ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?n=1</code>     â‡’ <code>[1]</code></p>
</li>
<li>
<p><code>/?n=1&amp;n=2</code> â‡’ <code>[1, 2]</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Multi-value query parameter as <code>List&lt;BigDecimal&gt;</code>
<div class="ulist">
<ul>
<li>
<p><code>/</code>         â‡’ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?d=1</code>     â‡’ <code>[1]</code></p>
</li>
<li>
<p><code>/?d=1&amp;n=2</code> â‡’ <code>[1, 2]</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-structured-data"><a class="anchor" href="#context-value-api-structured-data"></a><a class="link" href="#context-value-api-structured-data">4.2.4. Structured data</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html" target="_blank">Value API</a> provides a way to traverse and parse structured data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/?user.name=root&amp;user.pass=pass</pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Traversal</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4fe631f6c94434d">{
  get("/", ctx -&gt; {
    Value user = ctx.query("user");                  <i class="conum" data-value="1"></i><b>(1)</b>
    String name  = user.get("name").value();         <i class="conum" data-value="2"></i><b>(2)</b>
    String pass  = user.get("pass").value();         <i class="conum" data-value="3"></i><b>(3)</b>
    String email = user.get("email").value("none");  <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  }}
}</code><button class="clipboard" data-clipboard-target="#x4fe631f6c94434d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5d8b392f131a4dbc">{
  get("/") {
    val user = ctx.query("user")              <i class="conum" data-value="1"></i><b>(1)</b>
    val name  = user["name"].value()          <i class="conum" data-value="2"></i><b>(2)</b>
    val pass  = user["pass"].value()          <i class="conum" data-value="3"></i><b>(3)</b>
    val email = user["email"].value("none")   <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  }}
}</code><button class="clipboard" data-clipboard-target="#x5d8b392f131a4dbc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>name</code> value from <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the <code>pass</code> value from <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get the <code>mail</code> value from <code>user</code> node. This is an optional value.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/Value.html#get(java.lang.String)" target="_blank">get(String)</a> takes a <code>path</code> and returns another value. The returning
value may or may not exists.</p>
</div>
<div class="sect4">
<h5 id="context-value-api-structured-data-syntax"><a class="anchor" href="#context-value-api-structured-data-syntax"></a><a class="link" href="#context-value-api-structured-data-syntax">Syntax</a></h5>
<div class="paragraph">
<p>Structured data decoder supports <code>dot</code> and <code>bracket</code> notation:</p>
</div>
<div class="listingblock">
<div class="title">Dot notation</div>
<div class="content">
<pre>?member.firstname=Pedro&amp;member.lastname=Picapiedra</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bracket object notation</div>
<div class="content">
<pre>?member[firstname]=Pedro&amp;member[lastname]=Picapiedra</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bracket array notation for tabular data</div>
<div class="content">
<pre>?members[0]firstname=Pedro&amp;members[0]lastname=Picapiedra</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-value-api-structured-data-pojo"><a class="anchor" href="#context-value-api-structured-data-pojo"></a><a class="link" href="#context-value-api-structured-data-pojo">POJO</a></h5>
<div class="paragraph">
<p>Structured data decoder is able to reconstruct a POJO (Plain Old Java Object) from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#context-parameters-query">Query</a> encoded as <a href="https://tools.ietf.org/html/rfc3986#section-2" target="_blank">RFC 3986</a></p>
</li>
<li>
<p><a href="#context-parameters-formdata">Formdata</a> encoded as <code>application/x-www-form-urlencoded</code></p>
</li>
<li>
<p><a href="#context-parameters-multipart">Multipart</a> encoded as <code>multipart/form-data</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are going to use a <code>Group</code> and <code>Member</code> objects to demonstrate how the decoder works:</p>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x502d693a0463497f">class Member {
  public final String firstname;
  public final String lastName;

  public Member(String firstname, String lastname) {
    this.firstname = firstname;
    this.lastname = lastname;
  }
}

class Group {
  public final String id;
  public final List&lt;Member&gt; members;

  public Member(String id, List&lt;Member&gt; members) {
    this.id = id;
    this.members = members;
  }
}</code><button class="clipboard" data-clipboard-target="#x502d693a0463497f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8fc2cca439304579">class Member (val firstname: String, lastName: String)

class Group (val id: String, val members: List&lt;Member&gt;)</code><button class="clipboard" data-clipboard-target="#x8fc2cca439304579"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="title">Member parsing example:</div>
<div class="content">
<pre>/?firstname=Pedro&amp;lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7aa5752e30e942ca">{
  get("/", ctx -&gt; {
    Member member = ctx.query(Member.class);
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x7aa5752e30e942ca"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xdf628e3ee95434e">{
  get("/") {
    val member = ctx.query&lt;Member&gt;()
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xdf628e3ee95434e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="title">Member parsing example from base node:</div>
<div class="content">
<pre>/?member.firstname=Pedro&amp;member.lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x565d1a9637854c7d">{
  get("/", ctx -&gt; {
    Member member = ctx.query("member").to(Member.class);
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x565d1a9637854c7d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb52335220ac549e2">{
  get("/") {
    val member = ctx.query("member").to&lt;Member&gt;()
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xb52335220ac549e2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Tabular data uses the bracket array notation:</p>
</div>
<div class="listingblock">
<div class="title">Member as tabular data:</div>
<div class="content">
<pre>/?[0]firstname=Pedro&amp;[0]lastName=Picapiedra&amp;[1]firstname=Pablo&amp;[2]lastname=Marmol</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xde5774cef28146e4">{
  get("/", ctx -&gt; {
    List&lt;Member&gt; members = ctx.query().toList(Member.class);
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xde5774cef28146e4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x233d4129b8bb42d9">{
  get("/") {
    val members = ctx.query&lt;List&lt;Member&gt;&gt;()
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x233d4129b8bb42d9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="title">Group with members as tabular data:</div>
<div class="content">
<pre>/?id=flintstones&amp;members[0]firstname=Pedro&amp;members[0]lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe8305c71c87042d3">{
  get("/", ctx -&gt; {
    Group group = ctx.query(Group.class);
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xe8305c71c87042d3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf60cb8c4bcdf44fb">{
  get("/") {
    val group = ctx.query&lt;Group&gt;()
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xf60cb8c4bcdf44fb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The target <code>POJO</code> must follow one of these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Has a zero argguments/default constructor, or</p>
</li>
<li>
<p>Has only one constructor</p>
</li>
<li>
<p>Has multiple constructors, but only one is annotated with <a href="https://javadoc.io/doc/jakarta.inject/jakarta.inject-api/2.0.1/jakarta.inject/jakarta/inject/Inject.html" target="_blank">Inject</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The decoder matches HTTP parameters in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As constructor arguments</p>
</li>
<li>
<p>As setter method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP parameter name which are not a valid Java identifier must be annotated with <a href="https://javadoc.io/doc/jakarta.inject/jakarta.inject-api/2.0.1/jakarta.inject/jakarta/inject/Named.html" target="_blank">Named</a>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x6429c6749684f7b">class Member {
  public final String firstname;

  public final String lastname;

  public Member(@Named("first-name") String firstname, @Named("last-name") String lastname) {
    ....
  }
}</code><button class="clipboard" data-clipboard-target="#x6429c6749684f7b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf3f2c361298d49ef">class Member (@Named("first-name") val firstname: String, @Named("last-name") val lastName: String)</code><button class="clipboard" data-clipboard-target="#xf3f2c361298d49ef"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
</div>
<div class="sect3">
<h4 id="context-value-api-value-factory"><a class="anchor" href="#context-value-api-value-factory"></a><a class="link" href="#context-value-api-value-factory">4.2.5. Value Factory</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/value/ValueFactory.html" target="_blank">ValueFactory</a> class allow you to register new types for conversion (or even override).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x98484488effa4dd6">{
    var valueFactory = getValueFactory();
    valueFactory.put(MyBean.class, new MyBeanConverter());
}

import io.jooby.value.ValueConverter;

class MyBeanConverter implements ValueConverter {
  public Object convert(Type type, Value node, ConversionHint hint) {
    // convert node to MyBean.class
  }
}</code><button class="clipboard" data-clipboard-target="#x98484488effa4dd6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-request-body"><a class="anchor" href="#context-request-body"></a><a class="link" href="#context-request-body">4.3. Request Body</a></h3>
<div class="paragraph">
<p>Raw <code>request body</code> is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#body()" target="_blank">body()</a> method:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1de910abd1a748ba">{
  post("/string", ctx -&gt; {
    String body = ctx.body().value();        <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  });

  post("/bytes", ctx -&gt; {
    byte[] body = ctx.body().bytes();        <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });

  post("/stream", ctx -&gt; {
    InputStream body = ctx.body().stream();  <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x1de910abd1a748ba"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x530b75a1c24d4bab">{
  post("/string") {
    val body = ctx.body().value()   <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }

  post("/bytes") {
    val body = ctx.body().bytes()   <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }

  post("/stream") {
    val body = ctx.body().stream()  <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x530b75a1c24d4bab"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>HTTP Body</code> as <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>HTTP Body</code> as <code>byte array</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>HTTP Body</code> as <code>InputStream</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This gives us the <code>raw body</code>.</p>
</div>
<div class="sect3">
<h4 id="context-request-body-message-decoder"><a class="anchor" href="#context-request-body-message-decoder"></a><a class="link" href="#context-request-body-message-decoder">4.3.1. Message Decoder</a></h4>
<div class="paragraph">
<p>Request body parsing is achieved using the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageDecoder.html" target="_blank">MessageDecoder</a> functional interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8c22b8729de14520">public interface MessageDecoder {

  &lt;T&gt; T decode(Context ctx, Type type) throws Exception;
}</code><button class="clipboard" data-clipboard-target="#x8c22b8729de14520"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageDecoder.html" target="_blank">MessageDecoder</a> has a single <code>decode</code> method that takes two input arguments: <code>(context, type)</code>
and returns a single result of the given type.</p>
</div>
<div class="listingblock primary">
<div class="title">JSON example:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8e207ab4a3974b68">{
  FavoriteJson lib = new FavoriteJson();           <i class="conum" data-value="1"></i><b>(1)</b>

  decoder(MediaType.json, (ctx, type) -&gt; {          <i class="conum" data-value="2"></i><b>(2)</b>

    byte[] body = ctx.body().bytes();              <i class="conum" data-value="3"></i><b>(3)</b>

    return lib.fromJson(body, type);               <i class="conum" data-value="4"></i><b>(4)</b>
  });

  post("/", ctx -&gt; {
    MyObject myObject = ctx.body(MyObject.class);  <i class="conum" data-value="5"></i><b>(5)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x8e207ab4a3974b68"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x656257675e8b417c">{
  val lib = FavoriteJson()                 <i class="conum" data-value="1"></i><b>(1)</b>

  decoder(MediaType.json) { ctx, type -&gt;    <i class="conum" data-value="2"></i><b>(2)</b>

    val body = ctx.body().bytes()          <i class="conum" data-value="3"></i><b>(3)</b>

    lib.fromJson(body, type)               <i class="conum" data-value="4"></i><b>(4)</b>
  }

  post("/") {
    val myObject = ctx.body&lt;MyObject&gt;()    <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x656257675e8b417c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose your favorite <code>json</code> library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check if the <code>Content-Type</code> header matches <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Read the body as <code>byte[]</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Parse the <code>body</code> and use the requested type</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Route handler now call the <code>body(Type)</code> function to trigger the decoder function</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-response-body"><a class="anchor" href="#context-response-body"></a><a class="link" href="#context-response-body">4.4. Response Body</a></h3>
<div class="paragraph">
<p>Response body is generated from <code>handler</code> function:</p>
</div>
<div class="listingblock primary">
<div class="title">Response body</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xaf1ddb7cf2484787">{
  get("/", ctx -&gt; {
    ctx.setResponseCode(200);                  <i class="conum" data-value="1"></i><b>(1)</b>

    ctx.setResponseType(MediaType.text);        <i class="conum" data-value="2"></i><b>(2)</b>

    ctx.setResponseHeader("Date", new Date());  <i class="conum" data-value="3"></i><b>(3)</b>

    return "Response";                          <i class="conum" data-value="4"></i><b>(4)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#xaf1ddb7cf2484787"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb2e0349cb7ad4315">{
  get("/") {
    ctx.responseCode = 200                 <i class="conum" data-value="1"></i><b>(1)</b>

    ctx.responseType = MediaType.text      <i class="conum" data-value="2"></i><b>(2)</b>

    ctx.setResponseHeader("Date", Date())  <i class="conum" data-value="3"></i><b>(3)</b>

    "Response"                             <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xb2e0349cb7ad4315"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>status code</code> to <code>OK(200)</code>. This is the default <code>status code</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set <code>content-type</code> to <code>text/plain</code>. This is the default <code>content-type</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the <code>date</code> header</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send a <code>Response</code> string to the client</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="context-response-body-message-encoder"><a class="anchor" href="#context-response-body-message-encoder"></a><a class="link" href="#context-response-body-message-encoder">4.4.1. Message Encoder</a></h4>
<div class="paragraph">
<p>Response encoding is achieved using the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageEncoder.html" target="_blank">MessageEncoder</a> functional interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x806cae3c10f4455e">public interface MessageEncoder {

  Output encode(@NonNull Context ctx, @NonNull Object value) throws Exception;
}</code><button class="clipboard" data-clipboard-target="#x806cae3c10f4455e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>MessageEncoder has a single <code>encode</code> method that accepts two input arguments: <code>(context, value)</code> and
produces a result.</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/output/Output.html" target="_blank">Output</a> works like <code>java.nio.ByteBuffer</code> and it is used internally
for performance reason.</p>
</div>
<div class="listingblock primary">
<div class="title">JSON example:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x57c1114f8d634a5b">{
  FavoriteJson lib = new FavoriteJson();           <i class="conum" data-value="1"></i><b>(1)</b>

  encoder(MediaType.json, (ctx, result) -&gt; {      <i class="conum" data-value="2"></i><b>(2)</b>

    String json = lib.toJson(result);              <i class="conum" data-value="3"></i><b>(3)</b>

    ctx.setDefaultResponseType(MediaType.json);    <i class="conum" data-value="4"></i><b>(4)</b>

    return json;                                   <i class="conum" data-value="5"></i><b>(5)</b>
  });

  get("/item", ctx -&gt; {
    MyObject myObject = ...;
    return myObject;                               <i class="conum" data-value="6"></i><b>(6)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x57c1114f8d634a5b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3ace940e41af4637">{
  val lib = FavoriteJson()                         <i class="conum" data-value="1"></i><b>(1)</b>

  encoder(MediaType.json) { ctx, result -&gt;        <i class="conum" data-value="2"></i><b>(2)</b>

    val json = lib.toJson(result)                  <i class="conum" data-value="3"></i><b>(3)</b>

    ctx.defaultResponseType = MediaType.json       <i class="conum" data-value="4"></i><b>(4)</b>

    json                                           <i class="conum" data-value="5"></i><b>(5)</b>
  }

  get("/item") {
    val myObject = ...;
    myObject                                       <i class="conum" data-value="6"></i><b>(6)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x3ace940e41af4637"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose your favorite <code>json</code> library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check if the <code>Accept</code> header matches <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Convert <code>result</code> to <code>JSON</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set default <code>Content-Type</code> to <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Produces JSON response</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Route handler returns a user defined type</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mvc-api"><a class="anchor" href="#mvc-api"></a><a class="link" href="#mvc-api">5. MVC API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>MVC API is an alternative way to define routes in Jooby. It generates source code to define and execute routes. The generated class are suffixed with <code>_</code> (underscore).</p>
</div>
<div class="paragraph">
<p>If you use Gradle 6.0 or a later version, you can leverage incremental annotation processing support,
which means that Gradle only compiles classes that changed since the last compilation, and only runs
annotation processing on those changed classes.</p>
</div>
<div class="paragraph">
<p>The annotation processor has two options allowing you to control incremental processing behavior:</p>
</div>
<div class="listingblock primary">
<div class="title">build.gradle</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy" id="xef4a5bbbf8a94a90">tasks.withType(JavaCompile) {
    options.compilerArgs += [
        '-parameters',
        '-Ajooby.incremental=true'
    ]
}</code><button class="clipboard" data-clipboard-target="#xef4a5bbbf8a94a90"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy" id="x5c4776ca97fd4e19">kapt {
  arguments {
    arg('jooby.incremental', true)
  }
}</code><button class="clipboard" data-clipboard-target="#x5c4776ca97fd4e19"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>By setting <code>jooby.incremental</code> to <code>false</code> you can disable incremental processing entirely, which means
the regardless whatâ€™s changed, the whole project is recompiled each time. Defaults to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The package <code>annotation</code> contains all the annotations available for MVC routes.</p>
</div>
<div class="listingblock primary">
<div class="title">MVC API:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x38a5e2315ed34384">import io.jooby.annotation.*;

@Path("/mvc")                  <i class="conum" data-value="1"></i><b>(1)</b>
public class Controller {

  @GET                         <i class="conum" data-value="2"></i><b>(2)</b>
  public String sayHi() {
    return "Hello Mvc!";
  }
}

public class App extends Jooby {

  {
    mvc(new Controller_());   <i class="conum" data-value="3"></i><b>(3)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x38a5e2315ed34384"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd4bd73ced6d44eae">import io.jooby.annotation.*;

@Path("/mvc")                  <i class="conum" data-value="1"></i><b>(1)</b>
class Controller {

  @GET                         <i class="conum" data-value="2"></i><b>(2)</b>
  fun sayHi() : String {
    return "Hello Mvc!"
  }
}

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    mvc(Controller_())        <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xd4bd73ced6d44eae"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a path pattern. The <code>@Path</code> annotation is enable at class or method level</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add a HTTP method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register/install the generated controller in the main application</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="mvc-api-getting-started"><a class="anchor" href="#mvc-api-getting-started"></a><a class="link" href="#mvc-api-getting-started">5.1. Getting Started</a></h3>
<div class="paragraph">
<p>To create a new MVC project open the <code>jooby</code> console and type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>jooby create myapp --mvc</pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#getting-started">jooby console</a> takes care of all configuration steps required by the
annotation processing tool.</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-registration"><a class="anchor" href="#mvc-api-registration"></a><a class="link" href="#mvc-api-registration">5.2. Registration</a></h3>
<div class="paragraph">
<p>Mvc routes need to be registered (no classpath scanning). Registration is done from your application
class:</p>
</div>
<div class="listingblock primary">
<div class="title">Simple MVC route registration</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc8f5eb7db7984ce6">public class App extends Jooby {
  {
    mvc(new MyController_());
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xc8f5eb7db7984ce6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x32e16ed61f9c435e">import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    mvc(MyController_())
  }
}</code><button class="clipboard" data-clipboard-target="#x32e16ed61f9c435e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#mvc(io.jooby.MvcExtension)" target="_blank">mvc(MvcExtension)</a> install the mvc route. The generated controller instantiate the controller
or <code>requires</code> it when an <code>jakarta.inject.Inject</code> annotated controller is present.</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-parameters"><a class="anchor" href="#mvc-api-parameters"></a><a class="link" href="#mvc-api-parameters">5.3. Parameters</a></h3>
<div class="paragraph">
<p>HTTP parameter provision is available via <code>*Param</code> annotations.</p>
</div>
<div class="paragraph">
<p>There is also a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/Param.html" target="_blank">Param</a> annotation which allows to retrieve parameters from
<a href="#mvc-api-parameters-multiple-sources">multiple sources</a>.</p>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-header"><a class="anchor" href="#mvc-api-parameters-header"></a><a class="link" href="#mvc-api-parameters-header">5.3.1. Header</a></h4>
<div class="paragraph">
<p>Provisioning of headers is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/HeaderParam.html" target="_blank">HeaderParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Headers</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x798623d656ce4d53">public class MyController {

  @GET
  public Object provisioning(@HeaderParam String token) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x798623d656ce4d53"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x884488b139974693">class MyController {

  @GET
  fun provisioning(@HeaderParam token: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x884488b139974693"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to HTTP header named <code>token</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Compared to JAX-RS the parameter name on <code>@*Param</code> annotation is completely optional, but required for
non valid Java names:</p>
</div>
<div class="listingblock primary">
<div class="title">Non valid Java name</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xde8d161ed3d04911">public class MyController {

  @GET
  public Object provisioning(@HeaderParam("Last-Modified-Since") long lastModifiedSince) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xde8d161ed3d04911"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1eac7078f34e4bf6">class MyController {

  @GET
  fun provisioning(@HeaderParam("Last-Modified-Since") lastModifiedSince: Long) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x1eac7078f34e4bf6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-cookie"><a class="anchor" href="#mvc-api-parameters-cookie"></a><a class="link" href="#mvc-api-parameters-cookie">5.3.2. Cookie</a></h4>
<div class="paragraph">
<p>Provisioning of cookies is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/CookieParam.html" target="_blank">CookieParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Cookies</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xfcb43656939e49e1">public class MyController {

  @GET
  public Object provisioning(@CookieParam String token) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xfcb43656939e49e1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc225796a8ad04154">class MyController {

  @GET
  fun provisioning(@CookieParam token: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xc225796a8ad04154"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to cookie named <code>token</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Compared to JAX-RS the parameter name on <code>@*Param</code> annotation is completely optional, but required for
non valid Java names:</p>
</div>
<div class="listingblock primary">
<div class="title">Non valid Java name</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9bf707d1dda347ad">public class MyController {

  @GET
  public Object provisioning(@CookieParam("token-id") String tokenId) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x9bf707d1dda347ad"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1c6e8f30131a4272">class MyController {

  @GET
  fun provisioning(@CookieParam("token-id") tokenId: String) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x1c6e8f30131a4272"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-path"><a class="anchor" href="#mvc-api-parameters-path"></a><a class="link" href="#mvc-api-parameters-path">5.3.3. Path</a></h4>
<div class="paragraph">
<p>For path parameters the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/PathParam.html" target="_blank">PathParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">PathParam</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x78b49651e6094c60">public class MyController {

  @Path("/{id}")
  public Object provisioning(@PathParam String id) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x78b49651e6094c60"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1b780f47c9a441af">class MyController {

  @Path("/{id}")
  fun provisioning(@PathParam id: String) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x1b780f47c9a441af"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-query"><a class="anchor" href="#mvc-api-parameters-query"></a><a class="link" href="#mvc-api-parameters-query">5.3.4. Query</a></h4>
<div class="paragraph">
<p>For query parameters the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/QueryParam.html" target="_blank">QueryParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">QueryParam</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xea1332440b4a4e8f">public class MyController {

  @Path("/")
  public Object provisioning(@QueryParam String q) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xea1332440b4a4e8f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x670e1651bb41d7">class MyController {

  @Path("/")
  fun provisioning(@QueryParam q: String) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x670e1651bb41d7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-formdatamultipart"><a class="anchor" href="#mvc-api-parameters-formdatamultipart"></a><a class="link" href="#mvc-api-parameters-formdatamultipart">5.3.5. Formdata/Multipart</a></h4>
<div class="paragraph">
<p>For formdata/multipart parameters the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/FormParam.html" target="_blank">FormParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">QueryParam</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x6189f2f8344a4668">public class MyController {

  @Path("/")
  @POST
  public Object provisioning(@FormParam String username) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x6189f2f8344a4668"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf600a37d79c34b6b">class MyController {

  @Path("/")
  @POST
  fun provisioning(@FormParam username: String) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xf600a37d79c34b6b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-body"><a class="anchor" href="#mvc-api-parameters-body"></a><a class="link" href="#mvc-api-parameters-body">5.3.6. Body</a></h4>
<div class="paragraph">
<p>Body parameter doesnâ€™t require an annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">HTTP Body</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9bcd20fd261f4272">public class MyController {

  @Path("/")
  @POST
  public Object provisioning(MyObject body) {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x9bcd20fd261f4272"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd6d4a184f4644e8d">class MyController {

  @Path("/")
  @POST
  fun provisioning(body: MyObject) : Any {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xd6d4a184f4644e8d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-bind"><a class="anchor" href="#mvc-api-parameters-bind"></a><a class="link" href="#mvc-api-parameters-bind">5.3.7. Bind</a></h4>
<div class="paragraph">
<p>You can use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/BindParam.html" target="_blank">BindParam</a> annotation which allow custom mapping from HTTP request.</p>
</div>
<div class="listingblock primary">
<div class="title">Use the annotation</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa72314fa80c74432">public class Controller {

  @GET("/{foo}")
  public String bind(@BindParam MyBean bean) {
    return "with custom mapping: " + bean;
  }
}</code><button class="clipboard" data-clipboard-target="#xa72314fa80c74432"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x89fb93e382f74eda">class Controller {

  @GET("/{foo}")
  fun bind(@BindParam bean: MyBean) = "with custom mapping: $bean"
}</code><button class="clipboard" data-clipboard-target="#x89fb93e382f74eda"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">Write the mapping function</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x25126c8fe76e47f4">public record MyBean(String value) {

  public static MyBean of(Context ctx) {
    // build MyBean from HTTP request
  }
}</code><button class="clipboard" data-clipboard-target="#x25126c8fe76e47f4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1f7449b4644e4760">class MyBean constructor(value: String) {

  companion object {
       @JvmStatic
       fun of(ctx: Context) : Person {
          // build MyBean from HTTP request
       }
  }
}</code><button class="clipboard" data-clipboard-target="#x1f7449b4644e4760"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>It works as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/BindParam.html" target="_blank">BindParam</a> allow you to convert HTTP request to an Java Object in the way you wish</p>
</li>
<li>
<p>The annotation looks for public method/function that takes a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a> as parameter and returns the same type required as parameter.</p>
</li>
<li>
<p>It looks in the parameter type or fallback into the controller class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternative you can specify the factory class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   @BindParam(MyFactoryClass.class)</pre>
</div>
</div>
<div class="paragraph">
<p>And/or function name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   @BindParam(value = MyFactoryClass.class, fn = "fromContext")</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-flash"><a class="anchor" href="#mvc-api-parameters-flash"></a><a class="link" href="#mvc-api-parameters-flash">5.3.8. Flash</a></h4>
<div class="paragraph">
<p>Provisioning of flash attribute is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/FlashParam.html" target="_blank">FlashParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Flash</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x365d9b5198664636">public class MyController {

  @GET
  public Object provisioning(@FlashParam String success) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x365d9b5198664636"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3dee969d77bc4c07">class MyController {

  @GET
  fun provisioning(@FlashParam success: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x3dee969d77bc4c07"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to flash named <code>success</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-session"><a class="anchor" href="#mvc-api-parameters-session"></a><a class="link" href="#mvc-api-parameters-session">5.3.9. Session</a></h4>
<div class="paragraph">
<p>Provisioning of session attribute is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/SessionParam.html" target="_blank">SessionParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Session Attribute</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x14862771c8184998">public class MyController {

  @GET
  public Object provisioning(@SessionParam String userId) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x14862771c8184998"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x615a202860154044">class MyController {

  @GET
  fun provisioning(@SessionParam userId: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x615a202860154044"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to session attribute named <code>userId</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Provisioning of <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Session.html" target="_blank">Session</a> is available too:</p>
</div>
<div class="listingblock primary">
<div class="title">Session Attribute</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x72ab787f21644948">public class MyController {

  @GET
  public Object provisioning(Session session) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x72ab787f21644948"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x4b759e47cdb743a6">class MyController {

  @GET
  fun provisioning(session: Session) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x4b759e47cdb743a6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If no session exists yet, new session will be created</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To avoid this, just use <code>java.util.Optional&lt;Session&gt;</code> as type.</p>
</div>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-context"><a class="anchor" href="#mvc-api-parameters-context"></a><a class="link" href="#mvc-api-parameters-context">5.3.10. Context</a></h4>
<div class="paragraph">
<p>Provisioning of context attributes is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/ContextParam.html" target="_blank">ContextParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Context Attribute</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7edb9677660d47bb">public class MyController {

  @GET
  public Object provisioning(@ContextParam String userId) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x7edb9677660d47bb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xadc12ceeec124b3d">class MyController {

  @GET
  fun provisioning(@ContextParam userId: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xadc12ceeec124b3d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to context attribute named <code>userId</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Provisioning of all <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#getAttributes()" target="_blank">attributes</a> is available too:</p>
</div>
<div class="listingblock primary">
<div class="title">Context Attributes</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc294eef7eafc48db">public class MyController {

  @GET
  public Object provisioning(@ContextParam Map&lt;String, Object&gt; attributes) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xc294eef7eafc48db"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x66d2d77106dd4415">class MyController {

  @GET
  fun provisioning(@ContextParam attributes: Map&lt;String, Object&gt;) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x66d2d77106dd4415"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All context attributes must be set as arguments. They must be declared as <code>Map&lt;String, Object&gt;</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-multiple-sources"><a class="anchor" href="#mvc-api-parameters-multiple-sources"></a><a class="link" href="#mvc-api-parameters-multiple-sources">5.3.11. Multiple Sources</a></h4>
<div class="paragraph">
<p>You can use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/Param.html" target="_blank">Param</a> annotation to search for a parameter in multiple sources.
The sources and their precedence can be specified as follows:</p>
</div>
<div class="listingblock primary">
<div class="title">Multiple Sources</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x6198423e784c4413">public class FooController {

  @GET("/{foo}")
  public String multipleSources(@Param({ QUERY, PATH }) String foo) {
    return "foo is: " + foo;
  }
}</code><button class="clipboard" data-clipboard-target="#x6198423e784c4413"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5dfce6dc0cab443a">class FooController {

  @GET("/{foo}")
  fun multipleSources(@Param(QUERY, PATH) foo: String) = "foo is: $foo"
}</code><button class="clipboard" data-clipboard-target="#x5dfce6dc0cab443a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>In case of a request like <code>/bar?foo=baz</code>, <code>foo is: baz</code> will be returned since the query parameter
takes precedence over the path parameter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-responses"><a class="anchor" href="#mvc-api-responses"></a><a class="link" href="#mvc-api-responses">5.4. Responses</a></h3>
<div class="sect3">
<h4 id="mvc-api-responses-status-code"><a class="anchor" href="#mvc-api-responses-status-code"></a><a class="link" href="#mvc-api-responses-status-code">5.4.1. Status Code</a></h4>
<div class="paragraph">
<p>The default status code is <code>Success(200)</code>, except for <code>void</code> methods with the <code>@DELETE</code> annotation which is set to <code>No Content(204)</code>.</p>
</div>
<div class="paragraph">
<p>There are two options if you need a different status code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a> parameter and set the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#setResponseCode(io.jooby.StatusCode)" target="_blank">setResponseCode(StatusCode)</a></p>
</li>
<li>
<p>Returns a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/StatusCode.html" target="_blank">StatusCode</a> instance</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mvc-api-responses-nonblocking"><a class="anchor" href="#mvc-api-responses-nonblocking"></a><a class="link" href="#mvc-api-responses-nonblocking">5.4.2. NonBlocking</a></h4>
<div class="paragraph">
<p>Method returning a <code>CompletableFuture</code>, <code>Single</code>, <code>Maybe</code>, <code>Flowable</code>, <code>Mono</code> or <code>Flux</code> is
considered a non-blocking route.</p>
</div>
<div class="paragraph">
<p>Kotlin suspend functions are supported too:</p>
</div>
<div class="listingblock">
<div class="title">Kotlin Coroutines</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x739f43bd24e4efd">class SuspendMvc {
  @GET
  @Path("/delay")
  suspend fun delayed(ctx: Context): String {
    delay(100)
    return ctx.getRequestPath()
  }
}

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    use(SuspendMvc())
  }
}</code><button class="clipboard" data-clipboard-target="#x739f43bd24e4efd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>A non-blocking route run on the event loop (by default) where <strong>blocking is NOT allowed</strong>. For more
details please checkout the <a href="#responses-nonblocking">non-blocking responses</a> section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-execution-model"><a class="anchor" href="#mvc-api-execution-model"></a><a class="link" href="#mvc-api-execution-model">5.5. Execution model</a></h3>
<div class="paragraph">
<p>The MVC routes follows the execution model described in <a href="#execution-model">Execution Model</a>. To run application
logic in the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">EventLoop MVC route</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa5042df06c0e46bf">public class App extends Jooby {
  {
    mvc(new MyController_());
  }

  public static void main(String[] args) {
    runApp(args, EVENT_LOOP, App::new);  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xa5042df06c0e46bf"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x25daba07dbcb410e">import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args, EVENT_LOOP) {             <i class="conum" data-value="1"></i><b>(1)</b>
    mvc(MyController_())
  }
}</code><button class="clipboard" data-clipboard-target="#x25daba07dbcb410e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the application in the EVENT_LOOP execution mode</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Similarly, if you need to run all mvc routes in the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a> execution mode:</p>
</div>
<div class="listingblock primary">
<div class="title">Worker mode MVC route</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8b417825f89b48ea">public class App extends Jooby {
  {
    dispatch(() -&gt; {
      mvc(new MyBlockingController_());  <i class="conum" data-value="1"></i><b>(1)</b>
    });
  }

  public static void main(String[] args) {
    runApp(args, EVENT_LOOP, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x8b417825f89b48ea"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8c7faed90735469d">import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args, EVENT_LOOP) {
    dispatch {
      mvc(MyBlockingController_())        <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x8c7faed90735469d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Wrap the controller using the dispatch operator</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>One drawback with this approach is that the entire controller is now going to be executed in the worker or custom executor.
For more fine grain control use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/Dispatch.html" target="_blank">Dispatch</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Dispatch annotation</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x735693b8bee649a9">public class MyController {
  @GET("/nonblocking")
  public String nonblocking() {  <i class="conum" data-value="1"></i><b>(1)</b>
    return "I'm nonblocking";
  }

  @GET("/blocking")
  @Dispatch
  public String blocking() {     <i class="conum" data-value="2"></i><b>(2)</b>
    return "I'm blocking";
  }
}</code><button class="clipboard" data-clipboard-target="#x735693b8bee649a9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe8e679b45902466c">import io.jooby.annotation.*

class MyController {

  @GET("/nonblocking")
  fun nonblocking() : String {   <i class="conum" data-value="1"></i><b>(1)</b>
    return "I'm nonblocking";
  }

  @GET("/blocking")
  @Dispatch
  fun blocking() : String {      <i class="conum" data-value="2"></i><b>(2)</b>
    return "I'm blocking";
  }
}</code><button class="clipboard" data-clipboard-target="#xe8e679b45902466c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>MVC route run in EVENT_LOOP mode. Blocking is NOT allowed it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>MVC route run in WORKER mode. Blocking is allowed it.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/annotation/Dispatch.html" target="_blank">Dispatch</a> annotation supports custom executor using an executor name.</p>
</div>
<div class="listingblock primary">
<div class="title">Dispatch to custom executor</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x330a8fdf7aff41df">public class MyController {
  @GET("/blocking")
  @Dispatch("single")         <i class="conum" data-value="1"></i><b>(1)</b>
  public String blocking() {
    return "I'm blocking";
  }
}</code><button class="clipboard" data-clipboard-target="#x330a8fdf7aff41df"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa3c1c4f34f794d81">import io.jooby.annotation.*

class MyController {

  @GET("/blocking")
  @Dispatch("single")          <i class="conum" data-value="1"></i><b>(1)</b>
  fun blocking() : String {
    return "I'm blocking";
  }
}</code><button class="clipboard" data-clipboard-target="#xa3c1c4f34f794d81"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dispatch to an executor named it <code>single</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Executor must be registered using via services or executor utility method:</p>
</div>
<div class="listingblock primary">
<div class="title">Custom executor registration</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9d08b981b2db4eb1">{
  executor("single", Executors.newSingleThreadExecutor());

  mvc(new MyController_());
}</code><button class="clipboard" data-clipboard-target="#x9d08b981b2db4eb1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x7ee1710dd1354377">{
  executor("single", Executors.newSingleThreadExecutor())

  mvc(MyController_())
}</code><button class="clipboard" data-clipboard-target="#x7ee1710dd1354377"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The executor must be registered before the MVC route/controller.</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-jax-rs-annotations"><a class="anchor" href="#mvc-api-jax-rs-annotations"></a><a class="link" href="#mvc-api-jax-rs-annotations">5.6. JAX-RS Annotations</a></h3>
<div class="paragraph">
<p>Alternative you can use JAX-RS annotations to define MVC routes.</p>
</div>
<div class="listingblock primary">
<div class="title">Resource</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1bfde9f7051a4478">import javax.ws.rs.GET;
import javax.ws.rs.Path;

@Path("/jaxrs")
public class Resource {

  @GET
  public String getIt() {
    return "Got it!";
  }
}</code><button class="clipboard" data-clipboard-target="#x1bfde9f7051a4478"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x14d9d533982c4b43">import javax.ws.rs.GET
import javax.ws.rs.Path

@Path("/jaxrs")
class Resource {

  @GET
  fun getIt() : String {
    return "Got it!"
  }
}</code><button class="clipboard" data-clipboard-target="#x14d9d533982c4b43"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Annotations work exactly like the Jooby MVC annotations, but keep in mind we donâ€™t implement the
JAX-RS specification and there is no immediate plan to do it.</p>
</div>
<div class="paragraph">
<p>The main reason to support JAX-RS annotations is to let you plug-in third-party tools that rely
on them (mostly annotations processors).</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-generated-router"><a class="anchor" href="#mvc-api-generated-router"></a><a class="link" href="#mvc-api-generated-router">5.7. Generated router</a></h3>
<div class="paragraph">
<p>For each MVC/controller class a new class is generated. The new class ends with <code>_</code>, this class
mimics the constructors from the source class. If the constructor is annotated with <code>@Inject</code> a
default constructor will exists.</p>
</div>
<div class="paragraph">
<p>Any annotation found on the controller method will be persisted as route attributes, unless
<code>jooby.skipAttributeAnnotations</code> excludes it.</p>
</div>
<div class="paragraph">
<p>Access to generated routes is allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x76b9b82e30b7447d">{
  var routes = mvc(new MyController_());
  routes.forEach(route -&gt; {
    // do something with route
  });
}</code><button class="clipboard" data-clipboard-target="#x76b9b82e30b7447d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-annotation-processor-options"><a class="anchor" href="#mvc-api-annotation-processor-options"></a><a class="link" href="#mvc-api-annotation-processor-options">5.8. Annotation Processor Options</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run processor in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.incremental</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hints maven/gradle to do incremental compilation. Useful for development.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.skipAttributeAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip annotation during byte code generation (i.e. donâ€™t generate them as route attributes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.mvcMethod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the Route.mvcMethod when true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.routerPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix for generated class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby.routerSuffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suffix for generated class</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="mvc-api-annotation-processor-options-setting-options"><a class="anchor" href="#mvc-api-annotation-processor-options-setting-options"></a><a class="link" href="#mvc-api-annotation-processor-options-setting-options">5.8.1. Setting options</a></h4>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xbff366a93412489e">  &lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
      &lt;annotationProcessorPaths&gt;
        &lt;!-- if using lombok, it must be placed before the jooby-apt --&gt;
        &lt;!-- if using avaje-inject, it must be placed after lombok, but before the jooby-apt --&gt;
        &lt;path&gt;
          &lt;groupId&gt;io.jooby&lt;/groupId&gt;
          &lt;artifactId&gt;jooby-apt&lt;/artifactId&gt;
          &lt;version&gt;${jooby.version}&lt;/version&gt;
        &lt;/path&gt;
      &lt;/annotationProcessorPaths&gt;
      &lt;compilerArgs&gt;
        &lt;compilerArg&gt;
          -Ajooby.debug=false
        &lt;/compilerArg&gt;
        &lt;compilerArg&gt;
          -Ajooby.incremental=true
        &lt;/compilerArg&gt;
        &lt;compilerArg&gt;
          -Ajooby.skipAttributeAnnotations=FooAnnotation,BarAnnotation
        &lt;/compilerArg&gt;
      &lt;/compilerArgs&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;</code><button class="clipboard" data-clipboard-target="#xbff366a93412489e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy" id="x662cf3abd1b74e43">tasks.withType(JavaCompile) {
    options.compilerArgs += [
        '-parameters',
        '-Ajooby.debug=false',
        '-Ajooby.incremental=true',
        '-Ajooby.skipAttributeAnnotations=FooAnnotation,BarAnnotation'
    ]
}</code><button class="clipboard" data-clipboard-target="#x662cf3abd1b74e43"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that the order of annotation processors is important. For example, if youâ€™re using <code>lombok</code> and <code>avaje-inject</code>, the correct order should be: <code>lombok</code> â†’ <code>avaje-inject</code> â†’ <code>jooby-apt</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="static-files"><a class="anchor" href="#static-files"></a><a class="link" href="#static-files">6. Static Files</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Static files are available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#assets(java.lang.String,java.nio.file.Path)" target="_blank">assets(String,Path)</a> route. The <code>assets</code> route
supports classpath and file-system resources.</p>
</div>
<div class="listingblock primary">
<div class="title">Classpath resources:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x5c7036c3bec24000">{
  assets("/static/*", "/source"); <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#x5c7036c3bec24000"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbca5f4af72684015">{
  assets("/static/*", "/source")  <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#xbca5f4af72684015"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Map all the incoming request starting with <code>/static/</code> to the <code>/source</code> classpath or file system location.
<div class="ulist">
<ul>
<li>
<p>GET <code>/static/index.html</code>     â‡’ <code>/source/index.html</code></p>
</li>
<li>
<p>GET <code>/static/js/file.js</code>     â‡’ <code>/source/js/file.js</code></p>
</li>
<li>
<p>GET <code>/static/css/styles.css</code> â‡’ <code>/source/css/styles.css</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>/source</code> is resolved against the file system by prepending the <code>user.dir</code> path when exists
it favors the file system source, otherwise the <code>/source</code> directory must be present on classpath.</p>
</div>
<div class="listingblock primary">
<div class="title">File system resources:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4d20364e719442aa">{
  assets("/static/*", Paths.get("www")); <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#x4d20364e719442aa"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xfc856fd433874de2">{
  assets("/static/*", Paths.get("www"))  <i class="conum" data-value="1"></i><b>(1)</b>
}</code><button class="clipboard" data-clipboard-target="#xfc856fd433874de2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Map all the incoming request starting with <code>/static/</code> to a file system directory <code>www</code>
<div class="ulist">
<ul>
<li>
<p>GET <code>/static/index.html</code>     â‡’ <code>www/index.html</code></p>
</li>
<li>
<p>GET <code>/static/js/file.js</code>     â‡’ <code>www/js/file.js</code></p>
</li>
<li>
<p>GET <code>/static/css/styles.css</code> â‡’ <code>www/css/styles.css</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Individual file mapping is supported too:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Classpath:</div><div class="switch--item option-2">File system</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-none hljs" id="x50f8fcd39cb84323">{
  assets("/myfile.js", "/static/myfile.js");
}</code><button class="clipboard" data-clipboard-target="#x50f8fcd39cb84323"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-none hljs" id="x7a6d8f16362c45e0">{
  Path basedir = ...;
  assets("/myfile.js", basedire.resolve("/myfile.js"));
}</code><button class="clipboard" data-clipboard-target="#x7a6d8f16362c45e0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="sect2">
<h3 id="static-files-static-site"><a class="anchor" href="#static-files-static-site"></a><a class="link" href="#static-files-static-site">6.1. Static Site</a></h3>
<div class="paragraph">
<p>The <code>assets</code> route works for static sites too. Just need to use a special path mapping:</p>
</div>
<div class="listingblock primary">
<div class="title">Classpath resources:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8d5d70b5f9c6407b">{
  Path docs = Paths.get("docs"); <i class="conum" data-value="1"></i><b>(1)</b>
  assets("/docs/?*", docs);      <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x8d5d70b5f9c6407b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x781a4629c62b4ac1">{
  val docs = Paths.get("docs")   <i class="conum" data-value="1"></i><b>(1)</b>
  assets("/docs/?*", docs)       <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x781a4629c62b4ac1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Serve from <code>docs</code> directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>/?*</code> mapping</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The key difference is the <code>/?*</code> mapping. This mapping add support for base root mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <code>/docs</code>            â‡’ <code>/docs/index.html</code></p>
</li>
<li>
<p>GET <code>/docs/index.html</code> â‡’ <code>/docs/index.html</code></p>
</li>
<li>
<p>GET <code>/docs/about.html</code> â‡’ <code>/docs/about.html</code></p>
</li>
<li>
<p>GET <code>/docs/note</code>        â‡’ <code>/docs/note/index.html</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="static-files-spas"><a class="anchor" href="#static-files-spas"></a><a class="link" href="#static-files-spas">6.2. SPAs</a></h3>
<div class="paragraph">
<p>The <code>assets</code> route works for single page applications (SPAs) too. Just need to use a special path mapping plus a fallback asset:</p>
</div>
<div class="listingblock primary">
<div class="title">Classpath resources:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1dcb2f5bd6714f3c">{
  AssetSource docs = AssetSource.create(Paths.get("docs")); <i class="conum" data-value="1"></i><b>(1)</b>
  assets("/docs/?*", new AssetHandler("index.html", docs)); <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x1dcb2f5bd6714f3c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc20bcb2d46f14824">{
  val docs = AssetSource.create(Paths.get("docs"))          <i class="conum" data-value="1"></i><b>(1)</b>
  assets("/docs/?*", AssetHandler("index.html", docs))      <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#xc20bcb2d46f14824"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Serve from <code>docs</code> directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>/?*</code> mapping and uses <code>index.html</code> as fallback asset</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>SPAs mode never generates a <code>NOT FOUND (404)</code> response, unresolved assets fallback to <code>index.html</code></p>
</div>
</div>
<div class="sect2">
<h3 id="static-files-options"><a class="anchor" href="#static-files-options"></a><a class="link" href="#static-files-options">6.3. Options</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AssetHandler.html" target="_blank">AssetHandler</a> automatically handles <code>E-Tag</code> and <code>Last-Modified</code> headers. You can
control these headers programmatically:</p>
</div>
<div class="listingblock primary">
<div class="title">Asset handler options:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7e5b8d6f98e841ff">{
  assets("/static/*", Paths.get("www"))
    .setLastModified(false)
    .setEtag(false);
}</code><button class="clipboard" data-clipboard-target="#x7e5b8d6f98e841ff"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x6fb709863c294725">{
  assets("/static/*", Paths.get("www"))
    .setLastModified(false)
    .setEtag(false)
}</code><button class="clipboard" data-clipboard-target="#x6fb709863c294725"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The <code>maxAge</code> option set a <code>Cache-Control</code> header:</p>
</div>
<div class="listingblock primary">
<div class="title">Cache control:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x2d902bef50eb4934">{
  assets("/static/*", Paths.get("www"))
    .setMaxAge(Duration.ofDays(365))
}</code><button class="clipboard" data-clipboard-target="#x2d902bef50eb4934"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xdd4ce068e7814a6a">{
  assets("/static/*", Paths.get("www"))
    .setMaxAge(Duration.ofDays(365))
}</code><button class="clipboard" data-clipboard-target="#xdd4ce068e7814a6a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>There is also a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AssetHandler.html#setNoCache()" target="_blank">setNoCache()</a> method that explicitly forbids web browsers
to cache assets.</p>
</div>
<div class="paragraph">
<p>You can use different cache configurations for different assets based on asset name if you
specify a function via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AssetHandler.html#cacheControl(java.util.Function)" target="_blank">cacheControl(Function)</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">Per-asset cache control:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x96af4adc9cc3437c">{
  assets("/static/*", Paths.get("www"))
      .cacheControl(path -&gt; {
        if (path.endsWith("dont-cache-me.html")) {
          return CacheControl.noCache(); // disable caching
        } else if (path.equals("foo.js")) {
          return CacheControl.defaults()
              .setETag(false)
              .setMaxAge(Duration.ofDays(365));
        } else {
          return CacheControl.defaults(); // AssetHandler defaults
        }
      });
}</code><button class="clipboard" data-clipboard-target="#x96af4adc9cc3437c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb191ae3bdfb34c13">{
  assets("/static/*", Paths.get("www"))
      .cacheControl {
        when {
          it.endsWith("dont-cache-me.html") -&gt; CacheControl.noCache() // disable caching
          it == "foo.js" -&gt; CacheControl.defaults()
              .setETag(false)
              .setMaxAge(Duration.ofDays(365))
          else -&gt; CacheControl.defaults() // AssetHandler defaults
        }
      }
}</code><button class="clipboard" data-clipboard-target="#xb191ae3bdfb34c13"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The asset handler generates a <code>404</code> response code when requested path is not found. You can change this by throwing
an exception or generating any other content you want:</p>
</div>
<div class="listingblock primary">
<div class="title">Custom not found:</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa11c06519ac14673">{
  assets("/static/*", Paths.get("www"))
      .notFound(ctx -&gt; {
        throw new MyAssetException();
      });

  error(MyAssetException.class, (ctx, cause, code) -&gt; {
    // render MyAssetException as you want
  });
}</code><button class="clipboard" data-clipboard-target="#xa11c06519ac14673"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x22fb10a1ee644514">{
  assets("/static/*", Paths.get("www"))
    .notFound { _ -&gt;
        throw MyAssetException()
    }
  error(MyAssetException::class) {
    // render MyAssetException as you want
  }
}</code><button class="clipboard" data-clipboard-target="#x22fb10a1ee644514"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
</div>
</div>
<div class="sect1">
<h2 id="templates"><a class="anchor" href="#templates"></a><a class="link" href="#templates">7. Templates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Templates are available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ModelAndView.html" target="_blank">ModelAndView</a> and requires a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/TemplateEngine.html" target="_blank">TemplateEngine</a> implementation.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xfeeb1da0a80b4cb2">{
  install(new MyTemplateEngineModule());           <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    MyModel model = ...;                           <i class="conum" data-value="2"></i><b>(2)</b>
    return new ModelAndView("index.html", model);  <i class="conum" data-value="3"></i><b>(3)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#xfeeb1da0a80b4cb2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kt hljs" data-lang="kt" id="x8301794c2f7c4e73">{
  install(MyTemplateEngineModule())                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") { ctx -&gt;
    val model = MyModel(...)                        <i class="conum" data-value="2"></i><b>(2)</b>
    ModelAndView("index.html", model)               <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x8301794c2f7c4e73"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install a template engine</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Build the view model</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns a ModelAndView instance</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ModelAndView.html" target="_blank">ModelAndView</a> allows you to specify the desired locale used for template rendering:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x15f0a21113e24a9d">{
  install(new MyTemplateEngineModule());

  get("/", ctx -&gt; {
    MyModel model = ...;
    return new ModelAndView("index.html", model)
        .setLocale(Locale.GERMAN);                <i class="conum" data-value="1"></i><b>(1)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x15f0a21113e24a9d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kt hljs" data-lang="kt" id="x6540434fab784965">{
  install(MyTemplateEngineModule())

  get("/") { ctx -&gt;
    val model = MyModel(...)
    ModelAndView("index.html", model)
        .setLocale(Locale.GERMAN)                <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x6540434fab784965"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the preferred locale</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If no locale is specified explicitly, a locale matched by the <code>Accept-Language</code> header of the current
request is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all template engines support setting and using a specific locale. If you use such a template
engine, the above configuration does not have any effect.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="templates-template-engine"><a class="anchor" href="#templates-template-engine"></a><a class="link" href="#templates-template-engine">7.1. Template Engine</a></h3>
<div class="paragraph">
<p>Template engine does the view rendering/encoding. Template engine extends a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageEncoder.html" target="_blank">MessageEncoder</a>
by accepting a <code>ModelAndView</code> instance and produces a <code>String</code> result.</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/TemplateEngine.html#extensions()" target="_blank">extensions()</a> method list the number of file extension that a template engine
supports. Default file extension is: <code>.html</code>.</p>
</div>
<div class="paragraph">
<p>The file extension is used to locate the template engine, when a file extension isnâ€™t supported
an <code>IllegalArgumentException</code> is thrown.</p>
</div>
<div class="paragraph">
<p>The file extension allow us to use/mix multiple template engines too:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x72027295f8f64437">{
  install(new HandlebarsModule());                 <i class="conum" data-value="1"></i><b>(1)</b>
  install(new FreemarkerModule());                 <i class="conum" data-value="2"></i><b>(2)</b>

  get("/first", ctx -&gt; {
    return new ModelAndView("index.hbs", model);  <i class="conum" data-value="3"></i><b>(3)</b>
  });

  get("/second", ctx -&gt; {
    return new ModelAndView("index.ftl", model);  <i class="conum" data-value="4"></i><b>(4)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x72027295f8f64437"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kt hljs" data-lang="kt" id="xbdb8639d67734770">{
  install(HandlebarsModule())                       <i class="conum" data-value="1"></i><b>(1)</b>
  install(FreemarkerModule())                       <i class="conum" data-value="2"></i><b>(2)</b>

  get("/first") { ctx -&gt;
    ModelAndView("index.hbs", model)               <i class="conum" data-value="3"></i><b>(3)</b>
  }

  get("/second") { ctx -&gt;
    ModelAndView("index.ftl", model)               <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xbdb8639d67734770"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Handlebars</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Install Freemarker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Render using Handlebars, <code>.hbs</code> extension</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Render using Freemarker, <code>.ftl</code> extension</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Checkout all the available <a href="#modules-template-engine">template engines</a> provided by Jooby.</p>
</div>
</div>
<div class="sect2">
<h3 id="templates-view-model"><a class="anchor" href="#templates-view-model"></a><a class="link" href="#templates-view-model">7.2. View Model</a></h3>
<div class="paragraph">
<p>Since Jooby <code>3.1.x</code> the model can be anything object you like, previous version requires to be always <code>map</code>. There
are two implementations of <code>ModelAndView</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ModelAndView(String view, Object model)</p>
</li>
<li>
<p>MapModelAndView(String view, Map&lt;String, Object&gt; model)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session"><a class="anchor" href="#session"></a><a class="link" href="#session">8. Session</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Session is accessible via</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#sessionOrNull()" target="_blank">sessionOrNull()</a>: which find an existing session</p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#session()" target="_blank">session()</a>: which find an existing session or create a new one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sessions have a lot of uses cases but the most commons are: authentication, storing information
about current user, etc.</p>
</div>
<div class="paragraph">
<p>A session attribute must be a String or a primitive. The session doesnâ€™t allow storing of arbitrary
objects. Itâ€™s intended as a simple mechanism to store basic data (not an object graph).</p>
</div>
<div class="paragraph">
<p>Jooby provides the following <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/SessionStore.html" target="_blank">SessionStore</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory sessionsâ€”which you should combine with a sticky sessions proxy if you plan to run multiple instances.</p>
</li>
<li>
<p>Cookie sessions signed with a secret key</p>
</li>
<li>
<p>JSON Web Token sessions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since 4.0.0 no session is configured by default. Attempt to access to a session at runtime results
in exception.</p>
</div>
<div class="sect2">
<h3 id="session-in-memory-session"><a class="anchor" href="#session-in-memory-session"></a><a class="link" href="#session-in-memory-session">8.1. In-Memory Session</a></h3>
<div class="paragraph">
<p>Default session store uses memory to save session data. This store:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses a cookie/header to read/save the session ID</p>
</li>
<li>
<p>Store session data in-memory</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">In-Memory Session</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x86ec313408174812">{
  setSessionStore(SessionStore.memory(Cookie.session("myappid")));

  get("/", ctx -&gt; {
    Session session = ctx.session();   <i class="conum" data-value="1"></i><b>(1)</b>

    session.put("foo", "bar");         <i class="conum" data-value="2"></i><b>(2)</b>

    return session.get("foo").value(); <i class="conum" data-value="3"></i><b>(3)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x86ec313408174812"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x6bbc0f3e283240a8">{
  setSessionStore(SessionStore.memory(Cookie.session("myappid")))

  get("/") {
    val session = ctx.session()        <i class="conum" data-value="1"></i><b>(1)</b>

    session.put("foo", "bar")          <i class="conum" data-value="2"></i><b>(2)</b>

    session.get("foo").value()         <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x6bbc0f3e283240a8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Find an existing session or create a new session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set a session attribute</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get a session attribute</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Session token/ID is retrieved it from request cookie. Default session cookie never expires, it is http only under the <code>/</code> path. To customize cookie details:</p>
</div>
<div class="listingblock primary">
<div class="title">In-Memory Session with Custom Cookie</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x21e929a8dd92475f">{
  setSessionStore(SessionStore.memory(new Cookie("SESSION")));    <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    Session session = ctx.session();

    session.put("foo", "bar");

    return session.get("foo").value();
  });
}</code><button class="clipboard" data-clipboard-target="#x21e929a8dd92475f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x24fd6098f9304d27">{
  sessionStore = SessionStore.memory(Cookie("SESSION"))           <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    val session = ctx.session()

    session.put("foo", "bar")

    session.get("foo").value()
  }
}</code><button class="clipboard" data-clipboard-target="#x24fd6098f9304d27"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set an <code>in-memory</code> session store with a custom cookie named: <code>SESSION</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Alternatively, you can use a request header to retrieve a session token/ID:</p>
</div>
<div class="listingblock primary">
<div class="title">In-Memory Session with HTTP Header</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x2a876fee41914da4">{
  setSessionStore(SessionStore.memory(SessionToken.header("TOKEN")));    <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    Session session = ctx.session();

    session.put("foo", "bar");

    return session.get("foo").value();
  });
}</code><button class="clipboard" data-clipboard-target="#x2a876fee41914da4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbfb75516b5bc4a23">{
  sessionStore = SessionStore.memory(SessionToken.header("TOKEN"))       <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    val session = ctx.session()

    session.put("foo", "bar")

    session.get("foo").value()
  }
}</code><button class="clipboard" data-clipboard-target="#xbfb75516b5bc4a23"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Session Token/ID comes from HTTP header <code>TOKEN</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can mix cookie and header tokens:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xce8adbdea6484efb">{
  setSessionStore(SessionStore.memory(SessionToken.comibe(SessionToken.cookie("SESSION"), SessionToken.header("TOKEN"))));    <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    Session session = ctx.session();

    session.put("foo", "bar");

    return session.get("foo").value();
  });
}</code><button class="clipboard" data-clipboard-target="#xce8adbdea6484efb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3fcf8b9b0c114583">{
  sessionStore = SessionStore.memory(SessionToken.combie(SessionToken.cookie("SESSION"), SessionToken.header("TOKEN")))       <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    val session = ctx.session()

    session.put("foo", "bar")

    session.get("foo").value()
  }
}</code><button class="clipboard" data-clipboard-target="#x3fcf8b9b0c114583"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Session Token/ID comes from HTTP Cookie <code>SESSION</code> or HTTP header <code>TOKEN</code> (in that order)</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="session-signed-session"><a class="anchor" href="#session-signed-session"></a><a class="link" href="#session-signed-session">8.2. Signed Session</a></h3>
<div class="paragraph">
<p>This is a stateless session store that expects to find session token on each request. The server doesnâ€™t keep any state.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session data is retrieve/save from/into HTTP Cookie or Header</p>
</li>
<li>
<p>Session data is (un)signed with <code>HmacSHA256</code>. Key must be 256 bits long (32 bytes)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Data sign/unsign is done using <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Cookie.html#sign(java.lang.String,java.lang.String)" target="_blank">sign(String,String)</a> and <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Cookie.html#unsign(java.lang.String,java.lang.String)" target="_blank">unsign(String,String)</a>.</p>
</div>
<div class="listingblock primary">
<div class="title">Usage</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x39c379ee8baf4ea1">{
  String secret = "super secret key";                                         <i class="conum" data-value="1"></i><b>(1)</b>

  setSessionStore(SessionStore.signed(Cookie.session("myappid"), secret));    <i class="conum" data-value="2"></i><b>(2)</b>

  get("/", ctx -&gt; {
    Session session = ctx.session();

    session.put("foo", "bar");

    return session.get("foo").value();
  });
}</code><button class="clipboard" data-clipboard-target="#x39c379ee8baf4ea1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x96108bd5a2a74845">{
  val secret = "super secret key"                                            <i class="conum" data-value="1"></i><b>(1)</b>

  sessionStore = SessionStore.signed(Cookie.session("myappid"),secret)       <i class="conum" data-value="2"></i><b>(2)</b>

  get("/") {
    val session = ctx.session()

    session.put("foo", "bar")

    session.get("foo").value()
  }
}</code><button class="clipboard" data-clipboard-target="#x96108bd5a2a74845"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A secret key is required to signed the data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a cookie session store using the secret</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Like with <code>memory</code> session store you can use HTTP headers:</p>
</div>
<div class="listingblock primary">
<div class="title">Signed with headers</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8d7a8922349c483e">{
  String secret = "super secret key";                                            <i class="conum" data-value="1"></i><b>(1)</b>

  setSessionStore(SessionStore.signed(SessionToken.header("TOKEN"), secret));    <i class="conum" data-value="2"></i><b>(2)</b>

  get("/", ctx -&gt; {
    Session session = ctx.session();

    session.put("foo", "bar");

    return session.get("foo").value();
  });
}</code><button class="clipboard" data-clipboard-target="#x8d7a8922349c483e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe612a19eb33f471c">{
  val secret = "super secret key"                                                <i class="conum" data-value="1"></i><b>(1)</b>

  sessionStore = SessionStore.signed(SessionToken.header("TOKEN"), secret)       <i class="conum" data-value="2"></i><b>(2)</b>

  get("/") {
    val session = ctx.session()

    session.put("foo", "bar")

    session.get("foo").value()
  }
}</code><button class="clipboard" data-clipboard-target="#xe612a19eb33f471c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="session-stores"><a class="anchor" href="#session-stores"></a><a class="link" href="#session-stores">8.3. Stores</a></h3>
<div class="paragraph">
<p>In addition to built-in memory stores we do provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="modules/caffeine">Caffeine</a>: In-memory session store using Caffeine cache.</p>
</li>
<li>
<p><a href="modules/jwt-session-store">JWT</a>: JSON Web Token session store.</p>
</li>
<li>
<p><a href="modules/redis#redis-http-session">Redis</a>: Redis session store.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="web-sockets"><a class="anchor" href="#web-sockets"></a><a class="link" href="#web-sockets">9. Web Sockets</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adding a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/WebSocket.html" target="_blank">WebSocket</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">WebSocket</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8b820048fc2b4198">{
  ws("/ws", (ctx, configurer) -&gt; {             <i class="conum" data-value="1"></i><b>(1)</b>
    configurer.onConnect(ws -&gt; {
      ws.send("Connected");                    <i class="conum" data-value="2"></i><b>(2)</b>
    });

    configurer.onMessage((ws, message) -&gt; {
      ws.send("Got " + message.value());       <i class="conum" data-value="3"></i><b>(3)</b>
    });

    configurer.onClose((ws, statusCode) -&gt; {
                                               <i class="conum" data-value="4"></i><b>(4)</b>
    });

    configurer.onError((ws, cause) -&gt; {
                                               // 5
    });
  });
}</code><button class="clipboard" data-clipboard-target="#x8b820048fc2b4198"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9a113b6398004de7">{
  ws("/ws") {                                  <i class="conum" data-value="1"></i><b>(1)</b>
    configurer.onConnect { ws -&gt;
      ws.send("Connected")                     <i class="conum" data-value="2"></i><b>(2)</b>
    }

    configurer.onMessage { ws, message -&gt;
      ws.send("Got " + message.value())        <i class="conum" data-value="3"></i><b>(3)</b>
    }

    configurer.onClose { ws, statusCode -&gt;
                                               <i class="conum" data-value="4"></i><b>(4)</b>
    }

    configurer.onError { ws, cause -&gt;
                                               <i class="conum" data-value="5"></i><b>(5)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x9a113b6398004de7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a WebSocket handler. Useful to initialize resources</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>On WebSocket connect/open send a message back to client. Useful to initialize resources</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>On new message send back to client</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>WebSocket is about to close, you must free/release any acquire resources</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>WebSocket found a exception. Useful to log the error and provide an alternative response is
the WebSocket is still open</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You are free to access to HTTP context from WebSocket configurer or callback, but it is disallowed
to modify the HTTP context or produces a response from it:</p>
</div>
<div class="listingblock primary">
<div class="title">Context</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb5a24027e95348c8">{
  ws("/ws/{key}", (ctx, configurer) -&gt; {
    String key = ctx.path("key").value();           <i class="conum" data-value="1"></i><b>(1)</b>
    String foo = ctx.session().get("foo").value();  <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xb5a24027e95348c8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa54b1d32a9984846">{
  ws("/ws/{key}") { ctx, configurer -&gt;
    val key = ctx.path("key").value()               <i class="conum" data-value="1"></i><b>(1)</b>
    val foo = ctx.session().get("foo").value()      <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xa54b1d32a9984846"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to path variable: <code>key</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to session variable: <code>foo</code></td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="web-sockets-structured-data"><a class="anchor" href="#web-sockets-structured-data"></a><a class="link" href="#web-sockets-structured-data">9.1. Structured data</a></h3>
<div class="paragraph">
<p>Structure data is supported using the Value API and the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/WebSocket.html#render(java.lang.Object)" target="_blank">render(Object)</a> method:</p>
</div>
<div class="listingblock primary">
<div class="title">JSON example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf5bd0f6e0ddc4f8c">import io.jooby.jackson.JacksonModule;

{
  install(new JackonModule());                         <i class="conum" data-value="1"></i><b>(1)</b>

  ws("/ws", (ctx, configurer) -&gt; {
    configurer.onMessage((ws, message) -&gt; {
      MyObject myobject = message.to(MyObject.class);  <i class="conum" data-value="2"></i><b>(2)</b>
      ws.render(myobject);                             <i class="conum" data-value="3"></i><b>(3)</b>
    })
  });
}</code><button class="clipboard" data-clipboard-target="#xf5bd0f6e0ddc4f8c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc93b926461df4c5f">{
  install(JacksonModule())                             <i class="conum" data-value="1"></i><b>(1)</b>

  ws("/ws/{key}") { ctx, configurer -&gt;
    configurer.onMessage { ws, message -&gt;
      val myobject = message.to&lt;MyObject&gt;()            <i class="conum" data-value="2"></i><b>(2)</b>
      ws.render(myobject)                              <i class="conum" data-value="3"></i><b>(3)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xc93b926461df4c5f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Jackson module (required for JSON decoding/encoding)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Parse/decode message to <code>MyObject</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Encode myobject as JSON and send to client</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Alternative you explicit tells with decoder/encoder to use consumes/produces attributes:</p>
</div>
<div class="listingblock primary">
<div class="title">Context</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x62baaeb095c84e87">import io.jooby.jackson.JacksonModule;

{
  install(new JackonModule());                         <i class="conum" data-value="1"></i><b>(1)</b>

  ws("/ws", (ctx, configurer) -&gt; {
    configurer.onMessage((ws, message) -&gt; {
      MyObject myobject = message.to(MyObject.class);  <i class="conum" data-value="2"></i><b>(2)</b>
      ws.render(myobject);                             <i class="conum" data-value="3"></i><b>(3)</b>
    })
  })
    .consumes(MediaType.json)
    .produces(MediaType.json);
}</code><button class="clipboard" data-clipboard-target="#x62baaeb095c84e87"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xeae4f300634287">{
  install(JacksonModule())                             <i class="conum" data-value="1"></i><b>(1)</b>

  ws("/ws/{key}") { ctx, configurer -&gt;
    configurer.onMessage { ws, message -&gt;
      val myobject = message.to&lt;MyObject&gt;()            <i class="conum" data-value="2"></i><b>(2)</b>
      ws.render(myobject)                              <i class="conum" data-value="3"></i><b>(3)</b>
    }
  }.consumes(MediaType.json)
   .produces(MediaType.json)
}</code><button class="clipboard" data-clipboard-target="#xeae4f300634287"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Structure messages depends/requires a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageDecoder.html" target="_blank">MessageDecoder</a> and <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageEncoder.html" target="_blank">MessageEncoder</a>. In this
example both are provided by the JacksonModule.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-sockets-options"><a class="anchor" href="#web-sockets-options"></a><a class="link" href="#web-sockets-options">9.2. Options</a></h3>
<div class="sect3">
<h4 id="web-sockets-options-connection-timeouts"><a class="anchor" href="#web-sockets-options-connection-timeouts"></a><a class="link" href="#web-sockets-options-connection-timeouts">9.2.1. Connection Timeouts</a></h4>
<div class="paragraph">
<p>Jooby timeouts idle connections that have no activity after 5 minutes. You can
control this behaviour by setting the <code>websocket.idleTimeout</code> property:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="xa5fd7952b13b4664">websocket.idleTimeout = 1h</code><button class="clipboard" data-clipboard-target="#xa5fd7952b13b4664"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/lightbend/config/blob/master/HOCON.md#duration-format" target="_blank">duration format</a></p>
</div>
</div>
<div class="sect3">
<h4 id="web-sockets-options-max-size"><a class="anchor" href="#web-sockets-options-max-size"></a><a class="link" href="#web-sockets-options-max-size">9.2.2. Max size</a></h4>
<div class="paragraph">
<p>Max size is set to <code>128K</code> you can override it like:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="xaf5bc7ecc1544a03">websocket.maxSize = 128K</code><button class="clipboard" data-clipboard-target="#xaf5bc7ecc1544a03"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/lightbend/config/blob/master/HOCON.md#size-in-bytes-format" target="_blank">sizes in bytes</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-sent-events"><a class="anchor" href="#server-sent-events"></a><a class="link" href="#server-sent-events">10. Server-Sent Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events" target="_blank">Server-sent Events</a> (SSE) is a
mechanism that allows the server to push data to the client once the client-server connection
is established. After the connection has been established by the client, the server can send to
the client whenever a new chunk of data is available. In contrast with websockets, SSE can only
be used to send from the server to the client and not the other way round.</p>
</div>
<div class="listingblock primary">
<div class="title">Server-Sent Events</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd025f0dc107044dc">{
  sse("/sse", sse -&gt; {            <i class="conum" data-value="1"></i><b>(1)</b>
    sse.send("Welcome");          <i class="conum" data-value="2"></i><b>(2)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#xd025f0dc107044dc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xca2805bec29c4e22">{
  sse("/sse") {                   <i class="conum" data-value="1"></i><b>(1)</b>
    sse.send("Welcome")           <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xca2805bec29c4e22"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Connection established</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send a message</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="server-sent-events-message-options"><a class="anchor" href="#server-sent-events-message-options"></a><a class="link" href="#server-sent-events-message-options">10.1. Message Options</a></h3>
<div class="paragraph">
<p>Additional message options are available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ServerSentMessage.html" target="_blank">ServerSentMessage</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">Server-Sent Events</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1b13cab10de44d4a">{
  sse("/sse", sse -&gt; {
    sse.send(
        new ServerSentMessage("...")
            .setEvent("myevent")
            .setId(myId)
            .setRetry(1000)
    );
  });
}</code><button class="clipboard" data-clipboard-target="#x1b13cab10de44d4a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x61497f2297bc45f9">{
  sse("/sse") {
    sse.send(ServerSentMessaage("...").apply {
        event = "myevent"
        id = myId
        retry = 1000
    })
  }
}</code><button class="clipboard" data-clipboard-target="#x61497f2297bc45f9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Options are documented at <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format" target="_blank">Event stream format</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="server-sent-events-connection-lost"><a class="anchor" href="#server-sent-events-connection-lost"></a><a class="link" href="#server-sent-events-connection-lost">10.2. Connection Lost</a></h3>
<div class="paragraph">
<p>The <code>sse.onClose(Runnable)</code> callback allows you to clean and release resources on connection close.
A connection is closed when you call the sse.close() method or when the remote client closes the
connection.</p>
</div>
<div class="listingblock primary">
<div class="title">Connection Lost</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd51b18c873564526">{
  sse("/sse", sse -&gt; {
    sse.onClose(() -&gt; {
      // clean up
    });
  });
}</code><button class="clipboard" data-clipboard-target="#xd51b18c873564526"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9294ac66cbc446e">{
  sse("/sse") {
    sse.onClose {
      // clean up
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x9294ac66cbc446e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="server-sent-events-keep-alive"><a class="anchor" href="#server-sent-events-keep-alive"></a><a class="link" href="#server-sent-events-keep-alive">10.3. Keep Alive</a></h3>
<div class="paragraph">
<p>The keep alive time feature can be used to prevent connections from timing out:</p>
</div>
<div class="listingblock primary">
<div class="title">Keep Alive</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4775ebdd62e44b00">{
  sse("/sse", sse -&gt; {
    sse.keepAlive(15, TimeUnit.SECONDS)
  });
}</code><button class="clipboard" data-clipboard-target="#x4775ebdd62e44b00"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x32f444abeef248e9">{
  sse("/sse") {
    sse.keepAlive(15, TimeUnit.SECONDS)
  }
}</code><button class="clipboard" data-clipboard-target="#x32f444abeef248e9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The previous example will send a ':' message (empty comment) every 15 seconds to keep the
connection alive. If the client drops the connection, then the <code>sse.onClose(Runnable)</code> event will
be fired.</p>
</div>
<div class="paragraph">
<p>This feature is useful when you want to detect close events without waiting for the next time you
send an event. If on the other hand your application already generates events every 15 seconds,
the use of keep alive is unnecessary.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-model"><a class="anchor" href="#execution-model"></a><a class="link" href="#execution-model">11. Execution Model</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby is a flexible performant microframework providing both blocking and non-blocking APIs for
building web applications in Java and Kotlin.</p>
</div>
<div class="paragraph">
<p>In this chapter we are going to learn about Jooby execution model, more specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute code on the <strong>event loop</strong></p>
</li>
<li>
<p>Safely execution of blocking code</p>
</li>
<li>
<p>Working with non-blocking types, like: <code>CompletableFuture</code>, Reactive Streams, Kotlin Coroutines, etc.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="execution-model-mode"><a class="anchor" href="#execution-model-mode"></a><a class="link" href="#execution-model-mode">11.1. Mode</a></h3>
<div class="sect3">
<h4 id="execution-model-mode-event-loop"><a class="anchor" href="#execution-model-mode-event-loop"></a><a class="link" href="#execution-model-mode-event-loop">11.1.1. Event Loop</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode allows us to run a route handler from the
<strong>event loop</strong> (a.k.a as non-blocking mode).</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xeb26953f07e24388">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "I'm non-blocking!" );
  }

  public static void main(String[] args) {
    runApp(args, EVENT_LOOP, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xeb26953f07e24388"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x7f7f765ace9a4954">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, EVENT_LOOP) {
    get("/") { "I'm non-blocking!" }
  }
}</code><button class="clipboard" data-clipboard-target="#x7f7f765ace9a4954"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode is the more advanced execution mode and requires you carefully
design and implement your application due to that <strong>BLOCKING IS NOT ALLOWED</strong></p>
</div>
<div class="paragraph">
<p>What if you need to block?</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#dispatch(java.lang.Runnable)" target="_blank">dispatch(Runnable)</a> operator moves execution to a <strong>worker executor</strong> which
allows to do <strong>blocking calls</strong>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe1faf5b113643fb">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; {
      return "I'm non-blocking!";
    });

    dispatch(() -&gt; {
      // All the routes defined here are allowed to block:

      get("/db-list", ctx -&gt; {
        /** Safe to block! */
        Object result = ...; // Remote service, db call, etc..
        return result;
      });

    });
  }

  public static void main(String[] args) {
    runApp(args, EVENT_LOOP, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xe1faf5b113643fb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x711137c2bb0b4061">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, EVENT_LOOP) {

    get("/") {
      "I'm non-blocking!"
    }

    dispatch {
      // All the routes defined here are allowed to block:

      get("/db-list") {
        /** Safe to block! */
        val result = ...; // Remote service, db call, etc..
        result
      }

    }
  }
}</code><button class="clipboard" data-clipboard-target="#x711137c2bb0b4061"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>By default, the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#dispatch(java.lang.Runnable)" target="_blank">dispatch(Runnable)</a> operator moves execution to the <strong>server
worker executor</strong> (executor provided by web server).</p>
</div>
<div class="paragraph">
<p>You can provide your own <strong>worker executor</strong> at application level or at dispatch level:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf4f53731a2ef4c4d">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    // Application level executor
    worker(Executors.newCachedThreadPool());

    // Dispatch to application level executor which is cached thread pool
    dispatch(() -&gt; {
      ...
    });

    // Dispatch to a explicit executor
    Executor cpuIntensive = Executors.newSingleThreadExecutor();
    dispatch(cpuIntesive, () -&gt; {
      ...
    });
  }

  public static void main(String[] args) {
    runApp(args, EVENT_LOOP, App:new);
  }
}</code><button class="clipboard" data-clipboard-target="#xf4f53731a2ef4c4d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xce860cdeb85f4b58">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, EVENT_LOOP) {

    // Application level executor
    worker(Executors.newCachedThreadPool())

    // Dispatch to application level executor which is cached thread pool
    dispatch {
      ...
    }

    // Dispatch to a explicit executor
    Executor cpuIntensive = Executors.newSingleThreadExecutor()
    dispatch(cpuIntesive) {
      ...
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xce860cdeb85f4b58"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="execution-model-mode-worker"><a class="anchor" href="#execution-model-mode-worker"></a><a class="link" href="#execution-model-mode-worker">11.1.2. Worker</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a> mode allows us to do blocking calls from a route handler (a.k.a blocking mode).
You just write code without worrying about blocking calls.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4889190d141a4abc">import static io.jooby.ExecutionMode.WORKER;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; {
      /** Safe to block! */
      Object result = // Remote service, db call, etc..
      return result;
    });
  }

  public static void main(String[] args) {
    runApp(args, WORKER, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x4889190d141a4abc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8c8fc06ee28147dd">import io.jooby.ExecutionMode.WORKER
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, WORKER) {

    get("/") {
      /** Safe to block! */
      val result = ...;// Remote service, db call, etc..
      result
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x8c8fc06ee28147dd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Like with <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode, you can provide your own worker executor:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x291c0c65451b4f38">import static io.jooby.ExecutionMode.WORKER;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    worker(Executors.newCachedThreadPool());

    get("/", ctx -&gt; {
      /** Safe to block from cached thread pool! */
      Object result = // Remote service, db call, etc..
      return result;
    });
  }

  public static void main(String[] args) {
    runApp(args, WORKER, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x291c0c65451b4f38"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x40dfe133ee84bca">import io.jooby.ExecutionMode.WORKER
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args, WORKER) {

    worker(Executors.newCachedThreadPool())

    get("/") {
      /** Safe to block from cached thread pool! */
      val result = ...;// Remote service, db call, etc..
      result
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x40dfe133ee84bca"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While running in <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a> mode, Jooby internally does the dispatch call to the
worker executor. This is done per route, not globally.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="execution-model-mode-default"><a class="anchor" href="#execution-model-mode-default"></a><a class="link" href="#execution-model-mode-default">11.1.3. Default</a></h4>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#DEFAULT" target="_blank">DEFAULT</a> execution mode is a mix between <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a>
and <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> modes. This (as name implies) is the default execution mode in Jooby.</p>
</div>
<div class="paragraph">
<p>Jooby detects the route response type and determines which execution mode fits better.</p>
</div>
<div class="paragraph">
<p>If the response type is considered non-blocking, then it uses the <strong>event loop</strong>. Otherwise, it uses
the <strong>worker executor</strong>.</p>
</div>
<div class="paragraph">
<p>A response type is considered <strong>non-blocking</strong> when route handler produces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>CompletableFuture</code> type</p>
</li>
<li>
<p>A <a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava type</a></p>
</li>
<li>
<p>A <a href="https://projectreactor.io/" target="_blank">Reactor type</a></p>
</li>
<li>
<p>A <a href="https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html" target="_blank">Kotlin coroutine</a></p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1dfbe2144e0b43bb">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/non-blocking", ctx -&gt; {
      return CompletableFuture
          .supplyAsync(() -&gt; "I'm non-blocking!")  <i class="conum" data-value="1"></i><b>(1)</b>
    });

    get("/blocking", ctx -&gt; {
      return "I'm blocking";                       <i class="conum" data-value="2"></i><b>(2)</b>
    });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x1dfbe2144e0b43bb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9a88c2d1afa146ac">import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    get("/non-blocking") {
      CompletableFuture
          .supplyAsync { "I'm non-blocking!" }  <i class="conum" data-value="1"></i><b>(1)</b>
    }

    get("/blocking") {
      "I'm blocking"                            <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x9a88c2d1afa146ac"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>CompletableFuture</code> is a non-blocking type, run in <strong>event loop</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>String</code> is a blocking type, run in <strong>worker executor</strong></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You are free to use <strong>non-blocking</strong> types in all the other execution mode too. Non-blocking response
types are not specific to the <strong>default mode</strong> execution. All the <strong>default mode</strong> does with them is
to dispatch or not to a <strong>worker executor</strong>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="execution-model-worker-executor"><a class="anchor" href="#execution-model-worker-executor"></a><a class="link" href="#execution-model-worker-executor">11.2. Worker Executor</a></h3>
<div class="paragraph">
<p>This section described some details about the default <strong>worker executor</strong> provided by web server. The
worker executor is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application mode was set to <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a></p>
</li>
<li>
<p>Application mode was set to <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> and there is a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#dispatch(java.lang.Runnable)" target="_blank">dispatch(Runnable)</a> call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each web server provides a default <strong>worker executor</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netty: The <a href="https://www.javadoc.io/doc/io.jooby/jooby-netty/latest/io.jooby.netty/io/jooby/netty/NettyServer.html" target="_blank">Netty server</a> implementation multiply the number of available processors
(with a minimum of 2) by 8.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>workerThreads = Math.max(Runtime.getRuntime().availableProcessors(), 2) * 8</pre>
</div>
</div>
<div class="paragraph">
<p>For example <code>8</code> cores gives us <code>64</code> worker threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Undertow: The <a href="https://www.javadoc.io/doc/io.jooby/jooby-undertow/latest/io.jooby.undertow/io/jooby/undertow/UndertowServer.html" target="_blank">Undertow server</a> implementation multiply the number of available processors
by 8.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>workerThreads = Runtime.getRuntime().availableProcessors() * 8</pre>
</div>
</div>
<div class="paragraph">
<p>For <code>8</code> cores gives us <code>64</code> worker threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jetty: The <a href="https://www.javadoc.io/doc/io.jooby/jooby-jetty/latest/io.jooby.jetty/io/jooby/jetty/JettyServer.html" target="_blank">Jetty server</a> implementation uses the default configuration
with <code>200</code> worker threads.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are sensible defaults suggested by the server implementation. If you need to increase/decrease
worker threads:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9720d4435d4a4311">{
  configureServer(server -&gt; {
    server.workerThreads(Number);
  });
}</code><button class="clipboard" data-clipboard-target="#x9720d4435d4a4311"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x85cae43e177d4500">{
  configureServer { server -&gt;
    server.workerThreads(Number)
  }
}</code><button class="clipboard" data-clipboard-target="#x85cae43e177d4500"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
</div>
</div>
<div class="sect1">
<h2 id="responses"><a class="anchor" href="#responses"></a><a class="link" href="#responses">12. Responses</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers some special response types, like <code>raw responses</code>, <code>streaming</code>, <code>file download</code>, <code>non-blocking</code>, etcâ€¦â€‹</p>
</div>
<div class="sect2">
<h3 id="responses-raw"><a class="anchor" href="#responses-raw"></a><a class="link" href="#responses-raw">12.1. Raw</a></h3>
<div class="paragraph">
<p>Raw responses are NOT processed by a <a href="#context-response-body-message-encoder">message encoder</a>. These response types are considered <code>raw</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String/CharSequence</p>
</li>
<li>
<p>byte[]</p>
</li>
<li>
<p>java.nio.ByteBuffer/io.netty.buffer.ByteBuf</p>
</li>
<li>
<p>java.io.File/java.io.InputStream/java.nio.file.Path/java.nio.channels.FileChannel</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Generate a JSON String from handler</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf88f5c915e1e4240">{
  get("/json", ctx -&gt; {
    ctx.setContentType(MediaType.json);
    return "{\"message\": \"Hello Raw Response\"}";
  });
}</code><button class="clipboard" data-clipboard-target="#xf88f5c915e1e4240"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x6a1a9fa78f564402">{
  get("/json") {
    ctx.contentType = MediaType.json
    """
      "message": "Hello Raw Response"
    """
  }
}</code><button class="clipboard" data-clipboard-target="#x6a1a9fa78f564402"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>No matter if there is a JSON encoder installed, a raw response is always send directly to client.</p>
</div>
</div>
<div class="sect2">
<h3 id="responses-streaming-chunked"><a class="anchor" href="#responses-streaming-chunked"></a><a class="link" href="#responses-streaming-chunked">12.2. Streaming / Chunked</a></h3>
<div class="paragraph">
<p>Streaming/chunked API is available via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#responseStream()" target="_blank">responseStream()</a>: blocking API that provides an <code>OutputStream</code></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#responseWriter()" target="_blank">responseWriter()</a>: blocking API that provides a <code>PrintWriter</code></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#responseSender()" target="_blank">responseSender()</a>: non-blocking API that provides a <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Sender.html" target="_blank">Sender</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of these methods must be call it per request. At the time you call one of these methods Jooby
automatically adds the <code>Transfer-Encoding: chunked</code> header when <code>Content-Length</code> is missing.</p>
</div>
<div class="paragraph">
<p>All the three APIs have a <code>close</code> method. You must call it once you finish.</p>
</div>
<div class="listingblock primary">
<div class="title">Writer example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x287d60dcbe8f4fbd">{
  get("/chunk", ctx -&gt; {
    try(Writer writer = ctx.responseWriter()) { <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1");                   <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN");
    }

    return ctx;                                 <i class="conum" data-value="3"></i><b>(3)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x287d60dcbe8f4fbd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x4c0fa0a1561d4206">{
  get("/chunk") {
    ctx.responseWriter().use {                  <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1")                    <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN")
    }
    ctx                                         <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x4c0fa0a1561d4206"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the <code>Writer</code> inside a try-with-resources statement, so close it automatically.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Write chunks</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return the <code>Context</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There is an overloaded version (for Java mainly) that let you skip the try-with-resources and
automatically close the writer/stream:</p>
</div>
<div class="listingblock primary">
<div class="title">Writer example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x25877d5014434154">{
  get("/chunk", ctx -&gt; {
    return ctx.responseWriter(writer -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1");             <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN");
    });
  });
}</code><button class="clipboard" data-clipboard-target="#x25877d5014434154"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9bfff92e35f44902">{
  get("/chunk") {
    ctx.responseWriter {                  <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1")              <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN")
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x9bfff92e35f44902"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="responses-file-download"><a class="anchor" href="#responses-file-download"></a><a class="link" href="#responses-file-download">12.3. File download</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/FileDownload.html" target="_blank">FileDownload</a> is used to generate file downloads, i.e. responses with
<code>Content-Disposition</code> header. You can use the convenience subclasses <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/AttachedFile.html" target="_blank">AttachedFile</a>
or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/InlineFile.html" target="_blank">InlineFile</a> to set the header value to <code>attachment</code> or <code>inline</code> respectively.</p>
</div>
<div class="listingblock primary">
<div class="title">File download example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb9cc29d0392642d2">{
  get("/download-file", ctx -&gt; {
    Path source = Paths.get("logo.png");
    return new AttachedFile(source);               <i class="conum" data-value="1"></i><b>(1)</b>
  });

  get("/view-stream", ctx -&gt; {
    InputStream source = ...;
    return new InlineFile("myfile.txt", source); <i class="conum" data-value="2"></i><b>(2)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#xb9cc29d0392642d2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x845c4b2005a34f0e">{
  get("/download-file") {
    val source = Paths.get("logo.png")
    AttachedFile(source)                <i class="conum" data-value="1"></i><b>(1)</b>
  }

  get("/view-stream") {
    val source = ...
    InlineFile("myfile.txt", source)  <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x845c4b2005a34f0e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a download from an <code>InputStream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send a download from a <code>File</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Another possibility is to use one of the static builder methods of <code>FileDownload</code> and specify
the download type (attachment or inline) later.</p>
</div>
<div class="listingblock primary">
<div class="title">File download with builder method</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf9dff8c76f3b48b0">FileDownload.Builder produceDownload(Context ctx) {
  return FileDownload.build(...);
}

{
  get("/view", ctx -&gt; produceDownload(ctx).inline());

  get("/download", ctx -&gt; produceDownload(ctx).attachment());
}</code><button class="clipboard" data-clipboard-target="#xf9dff8c76f3b48b0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe3ed26bbdc894530">fun produceDownload(ctx: Context) = FileDownload.build(...)

{
  get("/view") {
    produceDownload(it).inline()
  }

  get("/download") {
    produceDownload(it).attachment()
  }
}</code><button class="clipboard" data-clipboard-target="#xe3ed26bbdc894530"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="responses-nonblocking"><a class="anchor" href="#responses-nonblocking"></a><a class="link" href="#responses-nonblocking">12.4. NonBlocking</a></h3>
<div class="paragraph">
<p>Non-blocking responses are a new feature of Jooby 2.x.</p>
</div>
<div class="paragraph">
<p>From user point of view there is nothing special about them, you just write your route handler as
usually do with blocking types.</p>
</div>
<div class="paragraph">
<p>Before we jump to each of the supported types, we need to learn what occurs in the pipeline when
there is a non-blocking route handler.</p>
</div>
<div class="listingblock primary">
<div class="title">In event loop</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xbc4a5973407e4433">{
  mode(EVENT_LOOP);                  <i class="conum" data-value="1"></i><b>(1)</b>

  use(ReactiveSupport.concurrent()); <i class="conum" data-value="2"></i><b>(2)</b>

  get("/non-blocking", ctx -&gt; {

    return CompletableFuture         <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                        <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard" data-clipboard-target="#xbc4a5973407e4433"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x98a41dce8c2841c0">{
  mode(EVENT_LOOP)                   <i class="conum" data-value="1"></i><b>(1)</b>

  use(ReactiveSupport.concurrent()); <i class="conum" data-value="2"></i><b>(2)</b>

  get("/non-blocking") {

    CompletableFuture                <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                        <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard" data-clipboard-target="#x98a41dce8c2841c0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>event loop</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates we want to go non-blocking and handle CompletableFuture responses.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>event loop</strong>. No blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Running your <code>App3508</code> in <strong>worker</strong> mode works identically, except for we are able to do blocking calls:</p>
</div>
<div class="listingblock primary">
<div class="title">In worker mode</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3fb5a1afa57340c7">{
  mode(WORKER);                      <i class="conum" data-value="1"></i><b>(1)</b>

  use(ReactiveSupport.concurrent()); <i class="conum" data-value="2"></i><b>(2)</b>

  get("/blocking", ctx -&gt; {

    return CompletableFuture         <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                        <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard" data-clipboard-target="#x3fb5a1afa57340c7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x50ded9acafef484d">{
  mode(WORKER)                       <i class="conum" data-value="1"></i><b>(1)</b>

  use(ReactiveSupport.concurrent())  <i class="conum" data-value="2"></i><b>(2)</b>

  get("/blocking") {

    CompletableFuture                <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                        <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard" data-clipboard-target="#x50ded9acafef484d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>worker mode</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates we want to go non-blocking and handle CompletableFuture responses.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>worker mode</strong>. Blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Running your <code>App3508</code> in <strong>default</strong> mode works identically to running in the <strong>event loop</strong> mode:</p>
</div>
<div class="listingblock primary">
<div class="title">In default mode</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4a1a6f1de220411f">{
  mode(DEFAULT);                     <i class="conum" data-value="1"></i><b>(1)</b>

  use(ReactiveSupport.concurrent()); <i class="conum" data-value="2"></i><b>(2)</b>

  get("/non-blocking", ctx -&gt; {

    return CompletableFuture         <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                        <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard" data-clipboard-target="#x4a1a6f1de220411f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe2e02be792dc4b71">{
  mode(DEFAULT)                     <i class="conum" data-value="1"></i><b>(1)</b>

  get("/non-blocking") {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    CompletableFuture               <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard" data-clipboard-target="#xe2e02be792dc4b71"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>worker mode</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates we want to go non-blocking and handle CompletableFuture responses.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>worker mode</strong>. Blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <strong>default</strong> mode mimics the <strong>event loop</strong> mode execution when route produces a <strong>non-blocking</strong> type.</p>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-completablefuture"><a class="anchor" href="#responses-nonblocking-completablefuture"></a><a class="link" href="#responses-nonblocking-completablefuture">12.4.1. CompletableFuture</a></h4>
<div class="paragraph">
<p>CompletableFuture is considered a non-blocking type which is able to produces a single result:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xddd303eba0749c6">{
  use(ReactiveSupport.concurrent());

  get("/non-blocking", ctx -&gt; {
    return CompletableFuture
        .supplyAsync(() -&gt; "Completable Future!")
        .thenApply(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard" data-clipboard-target="#xddd303eba0749c6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xba5de77c5a954d85">{
  use(ReactiveSupport.concurrent())

  get("/non-blocking") {
    CompletableFuture
        .supplyAsync { "Completable Future!" }
        .thenApply { "Hello $it" }
  }
}</code><button class="clipboard" data-clipboard-target="#xba5de77c5a954d85"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Completable future responses require explicit handler setup ONLY in script/lambda routes. For MVC
routes you donâ€™t need to setup any handler. It is done automatically based on route response type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-mutiny"><a class="anchor" href="#responses-nonblocking-mutiny"></a><a class="link" href="#responses-nonblocking-mutiny">12.4.2. Mutiny</a></h4>
<div class="paragraph">
<p>1) Add the <a href="https://smallrye.io/smallrye-mutiny" target="_blank">SmallRye Mutiny</a> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x2df01842b52149b7">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-mutiny&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x2df01842b52149b7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xff8e0fbca36a4ba6">implementation 'io.jooby:jooby-mutiny:4.0.12'</code><button class="clipboard" data-clipboard-target="#xff8e0fbca36a4ba6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="sect4">
<h5 id="responses-nonblocking-mutiny-uni"><a class="anchor" href="#responses-nonblocking-mutiny-uni"></a><a class="link" href="#responses-nonblocking-mutiny-uni">Uni</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa498499c379b482b">import io.jooby.mutiny;
import io.smallrye.mutiny.Uni;

{
  // Add response handler:
  use(Mutiny.mutiny());

  get("/non-blocking", ctx -&gt; {
    return Uni.createFrom()
       .completionStage(supplyAsync(() -&gt; "Uni"))
       .map(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard" data-clipboard-target="#xa498499c379b482b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3f983e08fcab4ec7">import io.jooby.mutiny
import io.smallrye.mutiny.Uni

{
  // Add response handler:
  use(Mutiny.mutiny())

  get("/non-blocking") {
    Uni.createFrom()
      .completionStage{ supplyAsync { "Uni" }}
      .map{"Hello $it"}
  }
}</code><button class="clipboard" data-clipboard-target="#x3f983e08fcab4ec7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="responses-nonblocking-mutiny-multi"><a class="anchor" href="#responses-nonblocking-mutiny-multi"></a><a class="link" href="#responses-nonblocking-mutiny-multi">Multi</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x788416c1e7674148">import io.jooby.mutiny;
import io.smallrye.mutiny.Multi;

{
  // Add response handler:
  use(Mutiny.mutiny());

  get("/non-blocking", ctx -&gt; {
    return Multi.createFrom().range(1, 11)
        .map(it -&gt; it + ", ");
  })
}</code><button class="clipboard" data-clipboard-target="#x788416c1e7674148"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd8597264a9304d63">import io.jooby.mutiny
import io.smallrye.mutiny.Multi

{
  get("/non-blocking") {
    Multi.createFrom().range(1, 11)
        .map{ "$it, " }
  }
}</code><button class="clipboard" data-clipboard-target="#xd8597264a9304d63"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For Multi, Jooby builds a <code>chunked</code> response. That:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>Transfer-Encoding: chunked</code> header</p>
</li>
<li>
<p>Each item means new <code>chunk</code> send it to client</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mutiny responses require explicit handler setup ONLY in script/lambda routes. For MVC
routes you donâ€™t need to setup any handler. It is done automatically based on route response type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-rxjava"><a class="anchor" href="#responses-nonblocking-rxjava"></a><a class="link" href="#responses-nonblocking-rxjava">12.4.3. RxJava</a></h4>
<div class="paragraph">
<p>1) Add the <a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava</a> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x5e9d93881b804bd3">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-rxjava3&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x5e9d93881b804bd3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xdeaa93fc1d634d26">implementation 'io.jooby:jooby-rxjava3:4.0.12'</code><button class="clipboard" data-clipboard-target="#xdeaa93fc1d634d26"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="sect4">
<h5 id="responses-nonblocking-rxjava-single"><a class="anchor" href="#responses-nonblocking-rxjava-single"></a><a class="link" href="#responses-nonblocking-rxjava-single">Single</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x9ae9850572546e8">import io.jooby.rxjava3.Reactivex;

{
  use(Reactivex.rx());

  get("/non-blocking", ctx -&gt; {
    return Single
        .fromCallable(() -&gt; "Single")
        .map(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard" data-clipboard-target="#x9ae9850572546e8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd78f22a0bcf94d8e">import io.jooby.rxjava3.Reactivex

{
  use(Reactivex.rx())

  get("/non-blocking") {
    Single
        .fromCallable { "Single" }
        .map { "Hello $it" }
  }
}</code><button class="clipboard" data-clipboard-target="#xd78f22a0bcf94d8e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="responses-nonblocking-rxjava-flowable"><a class="anchor" href="#responses-nonblocking-rxjava-flowable"></a><a class="link" href="#responses-nonblocking-rxjava-flowable">Flowable</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1a2cc437063d4f28">import io.jooby.rxjava3.Reactivex;

{
  use(Reactivex.rx());

  get("/non-blocking", ctx -&gt; {
    return Flowable.range(1, 10)
        .map(it -&gt; it + ", ");
  })
}</code><button class="clipboard" data-clipboard-target="#x1a2cc437063d4f28"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xce3e6bdedeaa41fe">import io.jooby.rxjava3.Reactivex

{
  use(Reactivex.rx());

  get("/non-blocking") {
    Flowable.range(1, 10)
        .map{ "$it, " }
  }
}</code><button class="clipboard" data-clipboard-target="#xce3e6bdedeaa41fe"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For Flowable, Jooby builds a <code>chunked</code> response. That:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>Transfer-Encoding: chunked</code> header</p>
</li>
<li>
<p>Each item means new <code>chunk</code> send it to client</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rx responses require explicit handler setup ONLY in script/lambda routes. For MVC
routes you donâ€™t need to setup any handler. It is done automatically based on route response type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-reactor"><a class="anchor" href="#responses-nonblocking-reactor"></a><a class="link" href="#responses-nonblocking-reactor">12.4.4. Reactor</a></h4>
<div class="paragraph">
<p>1) Add the <a href="https://projectreactor.io/" target="_blank">Reactor</a> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xee98eecddc234ed6">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-reactor&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#xee98eecddc234ed6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xc8e87075235340eb">implementation 'io.jooby:jooby-reactor:4.0.12'</code><button class="clipboard" data-clipboard-target="#xc8e87075235340eb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="sect4">
<h5 id="responses-nonblocking-reactor-mono"><a class="anchor" href="#responses-nonblocking-reactor-mono"></a><a class="link" href="#responses-nonblocking-reactor-mono">Mono</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x878cb07d308546dc">import io.jooby.Reactor;

{
  use(Reactor.reactor());

  get("/non-blocking", ctx -&gt; {
    return Mono
        .fromCallable(() -&gt; "Mono")
        .map(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard" data-clipboard-target="#x878cb07d308546dc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3e3c6711d89942df">import io.jooby.Reactor

{
  use(Reactor.reactor())

  get("/non-blocking") {
    Mono
        .fromCallable { "Mono" }
        .map { "Hello $it" }
  }
}</code><button class="clipboard" data-clipboard-target="#x3e3c6711d89942df"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="responses-nonblocking-reactor-flux"><a class="anchor" href="#responses-nonblocking-reactor-flux"></a><a class="link" href="#responses-nonblocking-reactor-flux">Flux</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf81b297d29e4ced">import io.jooby.Reactor;

{
  use(Reactor.reactor())

  get("/non-blocking", ctx -&gt; {
    return Flux.range(1, 10)
        .map(it -&gt; it + ", ");
  })
}</code><button class="clipboard" data-clipboard-target="#xf81b297d29e4ced"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5be30b9890454a5a">import io.jooby.Reactor

{
  use(Reactor.reactor())

  get("/non-blocking") {
    Flux.range(1, 10)
        .map{ "$it, " }
  }
}</code><button class="clipboard" data-clipboard-target="#x5be30b9890454a5a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For Flux, Jooby builds a <code>chunked</code> response. That:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>Transfer-Encoding: chunked</code> header</p>
</li>
<li>
<p>Each item means new <code>chunk</code> send it to client</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Reactor responses require explicit handler setup ONLY in script/lambda routes. For MVC
routes you donâ€™t need to setup any handler. It is done automatically based on route response type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-kotlin-coroutines"><a class="anchor" href="#responses-nonblocking-kotlin-coroutines"></a><a class="link" href="#responses-nonblocking-kotlin-coroutines">12.4.5. Kotlin Coroutines</a></h4>
<div class="listingblock">
<div class="title">Coroutine handler:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xf28f9e9fcbde4822">{
  coroutine {
    get("/") {
      delay(100)           <i class="conum" data-value="1"></i><b>(1)</b>
      "Hello Coroutines!"  <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xf28f9e9fcbde4822"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call a suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send response to client</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Here is another example with an extension and suspending function:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa7650ffae31b4480">{
  coroutine {
    get("/") {
      ctx.doSomething()         <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}

suspend fun Context.doSomething(): String {
  delay(100)                  <i class="conum" data-value="2"></i><b>(2)</b>
  return "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#xa7650ffae31b4480"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call extension suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function or do a blocking call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send response to client</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A coroutine works like any of the other non-blocking types. You start Jooby using the <strong>event loop</strong>
or <strong>default mode</strong>, Jooby creates a coroutine context to execute it.</p>
</div>
<div class="paragraph">
<p>Jooby uses the <strong>worker executor</strong> to creates a coroutine context. As described in <a href="#execution-model-worker-executor">worker executor section</a>
this is provided by the web server implementation unless you provided your own.</p>
</div>
<div class="listingblock">
<div class="title">Coroutines with custom executor:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x162df08ddc8d4e72">{
  worker(Executors.newCachedThreadPool())

  coroutine {
    get("/") {
      val n = 5 * 5        <i class="conum" data-value="1"></i><b>(1)</b>
      delay(100)           <i class="conum" data-value="2"></i><b>(2)</b>
      "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x162df08ddc8d4e72"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Statement run in the <strong>worker executor</strong> (cached thread pool)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Produces a response</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Coroutines always run in the <a href="#execution-model-worker-executor">worker executor</a>. There is an experimental API where
coroutines run in the <strong>caller thread</strong>(event loop in this case) until a suspending function is found.</p>
</div>
<div class="paragraph">
<p>Jooby allows you to use this experimental API by setting the <code>coroutineStart</code> option:</p>
</div>
<div class="listingblock">
<div class="title">UNDISPATCHED</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb6f16eed70b545f2">{
  coroutine(CoroutineStart.UNDISPATCHED) {
    get("/") {
      val n = 5 * 5        <i class="conum" data-value="1"></i><b>(1)</b>
      delay(100)           <i class="conum" data-value="2"></i><b>(2)</b>
      "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xb6f16eed70b545f2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Statement run in the <strong>event loop</strong> (caller thread)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function and dispatch to <strong>worker executor</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Produces a response from <strong>worker executor</strong></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also extend the <code>CoroutineContext</code> in which the coroutine routes run:</p>
</div>
<div class="listingblock">
<div class="title">launchContext</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3c2e04595f7d4fd6">{
  coroutine {
    launchContext { MDCContext() } <i class="conum" data-value="1"></i><b>(1)</b>

    get("/") {
      ...
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x3c2e04595f7d4fd6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The lambda is run before launching each coroutine, so it can customize the <code>CoroutineContext</code> for
the request, e.g. store/restore MDC, transaction, or anything else that your handlers need.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>â™¡ â™¡!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="responses-send-methods"><a class="anchor" href="#responses-send-methods"></a><a class="link" href="#responses-send-methods">12.5. Send methods</a></h3>
<div class="paragraph">
<p>Jooby provides a family of <code>send()</code> methods that produces a response via side effects.</p>
</div>
<div class="listingblock primary">
<div class="title">send text</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8e80e845671f41b5">{
  get("/", ctx -&gt; {
    return ctx.send("Hello World!");
  });
}</code><button class="clipboard" data-clipboard-target="#x8e80e845671f41b5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x14bf8438a7f04089">{
  get("/") {
    ctx.send("Hello World!")
  }
}</code><button class="clipboard" data-clipboard-target="#x14bf8438a7f04089"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Beside we operate via side effects, the route still returns something. This is required because a route
handler is a function which always produces a result.</p>
</div>
<div class="paragraph">
<p>All the send methods returns the current <code>Context</code>, this signal Jooby that we want to operate via
side effects ignoring the output of the route handler.</p>
</div>
<div class="paragraph">
<p>Family of send methods include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(byte%5B%5D)" target="_blank">send(byte[])</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(byte%5B%5D...)" target="_blank">send(byte[]â€¦â€‹)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(io.jooby.buffer.DataBuffer)" target="_blank">send(DataBuffer)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(io.jooby.FileDownload)" target="_blank">send(FileDownload)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(io.jooby.StatusCode)" target="_blank">send(StatusCode)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.io.InputStream)" target="_blank">send(InputStream)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.lang.String)" target="_blank">send(String)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.lang.String,java.nio.charset.Charset)" target="_blank">send(String,Charset)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.nio.ByteBuffer)" target="_blank">send(ByteBuffer)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.nio.ByteBuffer%5B%5D)" target="_blank">send(ByteBuffer[])</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.nio.channels.FileChannel)" target="_blank">send(FileChannel)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.nio.channels.ReadableByteChannel)" target="_blank">send(ReadableByteChannel)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(java.nio.file.Path)" target="_blank">send(Path)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="error-handler"><a class="anchor" href="#error-handler"></a><a class="link" href="#error-handler">13. Error Handler</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby catches application exception using the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ErrorHandler.html" target="_blank">ErrorHandler</a> class. The
<a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/DefaultErrorHandler.html" target="_blank">DefaultErrorHandler</a> error handler produces simple HTML page or JSON based on the value
of the <code>ACCEPT</code> header and log the exception.</p>
</div>
<div class="listingblock">
<div class="title">HTML:</div>
<div class="content">
<pre>Not Found
message: Page not found
status code: 404</pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON:</div>
<div class="content">
<pre>{
  "message": "Page not found",
  "status": 404,
  "reason": "Not Found"
}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Log:</div>
<div class="content">
<pre>GET /xx 404 Not Found
io.jooby.StatusCodeException: Not found
	at ...
	at ...
	at ...
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)</pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/exception/StatusCodeException.html" target="_blank">StatusCodeException</a> works as generic exception that let you specify an status code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>throw new StatusCodeException(StatusCode.FORBIDDEN);

throw new StatusCodeException(StatusCode.NOT_FOUND);

...</pre>
</div>
</div>
<div class="paragraph">
<p>These exception types have a default status code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IllegalArgumentException: BAD_REQUEST(400) (or sub-classes of it)</p>
</li>
<li>
<p>NoSuchElementException: BAD_REQUEST(400) (or sub-classes of it)</p>
</li>
<li>
<p>FileNotFound: NOT_FOUND(404) (or sub-classes of it)</p>
</li>
<li>
<p>Exception: SERVER_ERROR(500) (or sub-classes of it)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To set a custom status code, an entry should be added it to the error code map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x73ad85998d35469a">{
  errorCode(MyException.class, StatusCode.XXX);
}</code><button class="clipboard" data-clipboard-target="#x73ad85998d35469a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="sect2">
<h3 id="error-handler-custom-error-handler"><a class="anchor" href="#error-handler-custom-error-handler"></a><a class="link" href="#error-handler-custom-error-handler">13.1. Custom Error Handler</a></h3>
<div class="paragraph">
<p>You can provide your own error handler using the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Router.html#error(io.jooby.ErrorHandler)" target="_blank">error(ErrorHandler)</a> method:</p>
</div>
<div class="listingblock primary">
<div class="title">Error Handler</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc497d5fa4d0b4673">{
  error((ctx, cause, statusCode) -&gt; {                                      <i class="conum" data-value="1"></i><b>(1)</b>
    Router router = ctx.getRouter();
    router.getLog().error("found `{}` error", statusCode.value(), cause);  <i class="conum" data-value="2"></i><b>(2)</b>
    ctx.setResponseCode(statusCode);
    ctx.send("found `" + statusCode.value() + "` error");                  <i class="conum" data-value="3"></i><b>(3)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#xc497d5fa4d0b4673"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xba83209c42c414f">{
  error { ctx, cause, statusCode -&gt;                                        <i class="conum" data-value="1"></i><b>(1)</b>
    val router = ctx.router
    router.log.error("found `{}` error", statusCode.value(), cause)        <i class="conum" data-value="2"></i><b>(2)</b>
    ctx.responseCode = statusCode
    ctx.send("found `${statusCode.value()}` error")                        <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xba83209c42c414f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a global/catch-all exception handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Log the error to logging system</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send an error response to the client</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#render(java.lang.Object)" target="_blank">render(Object)</a> object which looks for a registered
<a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageEncoder.html" target="_blank">MessageEncoder</a> or <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/TemplateEngine.html" target="_blank">TemplateEngine</a>.</p>
</div>
<div class="paragraph">
<p>The next example produces a HTML or JSON response based on the value of the <code>Accept</code> header.</p>
</div>
<div class="listingblock primary">
<div class="title">Error with content negotiation</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa07512a45d414e2c">import static io.jooby.MediaType.json;
import static io.jooby.MediaType.html;

{
  install(new MyTemplateEngineModule());                      <i class="conum" data-value="1"></i><b>(1)</b>

  install(new MyJsonModule());                                <i class="conum" data-value="2"></i><b>(2)</b>

  error((ctx, cause, statusCode) -&gt; {
    Router router = ctx.getRouter();
    router.getLog().error("found `{}` error", statusCode.value(), cause);

    if (ctx.accept(json)) {                                   <i class="conum" data-value="3"></i><b>(3)</b>
      Map error = ...;
      ctx.render(error);                                      <i class="conum" data-value="4"></i><b>(4)</b>
    } else {
      // fallback to html
      Map error = ...;
      ctx.render(new ModelAndView("error.template", error));  <i class="conum" data-value="5"></i><b>(5)</b>
    }
  });
}</code><button class="clipboard" data-clipboard-target="#xa07512a45d414e2c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8c603201e02b4e98">import io.jooby.MediaType.json
import io.jooby.MediaType.html

{
  install(MyTemplateEngineModule())                           <i class="conum" data-value="1"></i><b>(1)</b>

  install(MyJsonModule())                                     <i class="conum" data-value="2"></i><b>(2)</b>

  error {ctx, cause, statusCode -&gt;
    val router = ctx.router
    router.log.error("found `{}` error", statusCode.value(), cause)

    if (ctx.accept(json)) {                                   <i class="conum" data-value="3"></i><b>(3)</b>
      val error = mapOf(...)
      ctx.render(error)                                       <i class="conum" data-value="4"></i><b>(4)</b>
    } else {
        // fallback to html
        val error = mapOf(...)
        ctx.render(ModelAndView("error.template", error))     <i class="conum" data-value="5"></i><b>(5)</b>
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x8c603201e02b4e98"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install one of the available <a href="#modules-template-engine">template engines</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Install one of the available <a href="#modules-json">json modules</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Test if the accept header matches the <code>application/json</code> content type</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Render json if matches</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Render html as fallback</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="error-handler-catch-by-code"><a class="anchor" href="#error-handler-catch-by-code"></a><a class="link" href="#error-handler-catch-by-code">13.2. Catch by Code</a></h3>
<div class="paragraph">
<p>In addition to the generic/global error handler you can catch specific status code:</p>
</div>
<div class="listingblock primary">
<div class="title">Status Code Error Handler</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8bf20391ed894962">import static io.jooby.StatusCode.NOT_FOUND;
{
  error(NOT_FOUND, (ctx, cause, statusCode) -&gt; {
    ctx.send(statusCode);   <i class="conum" data-value="1"></i><b>(1)</b>
  });
}</code><button class="clipboard" data-clipboard-target="#x8bf20391ed894962"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x10148e9073bb4210">import io.jooby.StatusCode.NOT_FOUND
{
  error (NOT_FOUND) { ctx, cause, statusCode -&gt;
    ctx.send(statusCode)    <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x10148e9073bb4210"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send <code>404</code> response to the client</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here we kind of silence all the <code>404</code> response due we donâ€™t log anything and send an empty response.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html#send(io.jooby.StatusCode)" target="_blank">send(StatusCode)</a> method send an empty response to the client</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="error-handler-catch-by-exception"><a class="anchor" href="#error-handler-catch-by-exception"></a><a class="link" href="#error-handler-catch-by-exception">13.3. Catch by Exception</a></h3>
<div class="paragraph">
<p>In addition to the generic/global error handler you can catch specific exception type:</p>
</div>
<div class="listingblock primary">
<div class="title">Exception Handler</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb6d5e04487674928">{
  error(MyException.class, (ctx, cause, statusCode) -&gt; {
    // log and process MyException
  });
}</code><button class="clipboard" data-clipboard-target="#xb6d5e04487674928"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5b6c1867bbfa44e2">{
  error (MyException::class) { ctx, cause, statusCode -&gt;
    // log and process MyException
  }
}</code><button class="clipboard" data-clipboard-target="#x5b6c1867bbfa44e2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="error-handler-problem-details"><a class="anchor" href="#error-handler-problem-details"></a><a class="link" href="#error-handler-problem-details">13.4. Problem Details</a></h3>
<div class="paragraph">
<p>Most APIs have a way to report problems and errors, helping the user understand when something went wrong and what the issue is.
The method used depends on the APIâ€™s style, technology, and design.
Handling error reporting is an important part of the overall API design process.</p>
</div>
<div class="paragraph">
<p>You could create your own error-reporting system, but that takes time and effort, both for the designer and for users who need to learn the custom approach.
Thankfully, thereâ€™s a standard called <a href="https://www.rfc-editor.org/rfc/rfc7807" target="_blank">IETF RFC 7807</a> (later refined in <a href="https://www.rfc-editor.org/rfc/rfc9457" target="_blank">RFC 9457</a>) that can help.</p>
</div>
<div class="paragraph">
<p>By adopting <code>RFC 7807</code>, API designers donâ€™t have to spend time creating a custom solution, and users benefit by recognizing a familiar format across different APIs.
If it suits the APIâ€™s needs, using this standard benefits both designers and users alike.</p>
</div>
<div class="paragraph">
<p><code>Jooby</code> provides built-in support for <code>Problem Details</code>.</p>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-set-up-problemdetails"><a class="anchor" href="#error-handler-problem-details-set-up-problemdetails"></a><a class="link" href="#error-handler-problem-details-set-up-problemdetails">13.4.1. Set up ProblemDetails</a></h4>
<div class="paragraph">
<p>To enable the <code>ProblemDetails</code>, simply add the following line to your configuration:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="x2f1b9528cbb849d3">problem.details.enabled = true</code><button class="clipboard" data-clipboard-target="#x2f1b9528cbb849d3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>This is the bare minimal configuration you need.
It enables a global error handler that catches all exceptions, transforms them into Problem Details compliant format and renders the response based on the Accept header value. It also sets the appropriate content-type in response (e.g. application/problem+json, application/problem+xml)</p>
</div>
<div class="paragraph">
<p>All supported settings include:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="x3bd294ce1ff041b3">problem.details {
  enabled = true
  log4xxErrors = true                                <i class="conum" data-value="1"></i><b>(1)</b>
  muteCodes = [401, 403]                             <i class="conum" data-value="2"></i><b>(2)</b>
  muteTypes = ["com.example.MyMutedException"]       <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#x3bd294ce1ff041b3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, only server errors (5xx) will be logged. You can optionally enable the logging of client errors (4xx). If <code>DEBUG</code> logging level is enabled, the log will contain a stacktrace as well.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can optionally mute some status codes completely.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can optionally mute some exceptions logging completely.</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-creating-problems"><a class="anchor" href="#error-handler-problem-details-creating-problems"></a><a class="link" href="#error-handler-problem-details-creating-problems">13.4.2. Creating problems</a></h4>
<div class="paragraph">
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a> class represents the <code>RFC 7807</code> model. It is the main entity you need to work with to produce the problem.</p>
</div>
<div class="sect4">
<h5 id="error-handler-problem-details-creating-problems-static-helpers"><a class="anchor" href="#error-handler-problem-details-creating-problems-static-helpers"></a><a class="link" href="#error-handler-problem-details-creating-problems-static-helpers">Static helpers</a></h5>
<div class="paragraph">
<p>There are several handy static methods to produce a simple <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#valueOf(io.jooby.StatusCode)" target="_blank">valueOf(StatusCode)</a> - will pick the title by status code.
Donâ€™t overuse it, the problem should have meaningful <code>title</code> and <code>detail</code> when possible.</p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#valueOf(io.jooby.StatusCode,java.lang.String)" target="_blank">valueOf(StatusCode,String)</a> - with custom <code>title</code></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#valueOf(io.jooby.StatusCode,java.lang.String,java.lang.String)" target="_blank">valueOf(StatusCode,String,String)</a> - with <code>title</code> and <code>detail</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and a couple of shorthands for the most common validation codes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#badRequest(java.lang.String,java.lang.String)" target="_blank">badRequest(String,String)</a> - for <em>400 Bad Request</em></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#notFound(java.lang.String,java.lang.String)" target="_blank">notFound(String,String)</a> - for <em>404 Not Found</em></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#unprocessableEntity(java.lang.String,java.lang.String)" target="_blank">unprocessableEntity(String,String)</a> - for <em>422 Unprocessable Entity</em></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html#internalServerError()" target="_blank">internalServerError()</a> - for <em>500 Internal Server Error</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a> extends <code>RuntimeException</code> so you can naturally throw it (as you do with exceptions):</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xbe210b6175024983">import io.jooby.problem.HttpProblem;

get("/users/{userId}", ctx -&gt; {
  var userId = ctx.path("userId").value();
  User user = userRepository.findUser(userId);

  if (user == null) {
    throw HttpProblem.valueOf(StatusCode.NOT_FOUND,
      "User Not Found",
      "User with ID %s was not found in the system.".formatted(userId)
    );
  }
  ...
});</code><button class="clipboard" data-clipboard-target="#xbe210b6175024983"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kt hljs" data-lang="kt" id="xd95de9e5c7844160">import io.jooby.problem.HttpProblem

get("/users/{userId}") { ctx -&gt;
  val userId = ctx.path("userId").value()
  val user = userRepository.findUser(userId)

  if (user == null) {
    throw HttpProblem.valueOf(StatusCode.NOT_FOUND,
      "User Not Found",
      "User with ID $userId was not found in the system."
    )
  }
  ...
})</code><button class="clipboard" data-clipboard-target="#xd95de9e5c7844160"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Resulting response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="xa37c996a9e324d25">{
    "timestamp": "2024-10-05T14:10:41.648933100Z",
    "type": "about:blank",
    "title": "User Not Found",
    "status": 404,
    "detail": "User with ID 123 was not found in the system.",
    "instance": null
}</code><button class="clipboard" data-clipboard-target="#xa37c996a9e324d25"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="error-handler-problem-details-creating-problems-builder"><a class="anchor" href="#error-handler-problem-details-creating-problems-builder"></a><a class="link" href="#error-handler-problem-details-creating-problems-builder">Builder</a></h5>
<div class="paragraph">
<p>Use builder to create a rich problem instance with all properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x952a53cb73974940">throw HttpProblem.builder()
  .type(URI.create("http://example.com/invalid-params"))
  .title("Invalid input parameters")
  .status(StatusCode.UNPROCESSABLE_ENTITY)
  .detail("'Name' may not be empty")
  .instance(URI.create("http://example.com/invalid-params/3325"))
  .build();</code><button class="clipboard" data-clipboard-target="#x952a53cb73974940"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-adding-extra-parameters"><a class="anchor" href="#error-handler-problem-details-adding-extra-parameters"></a><a class="link" href="#error-handler-problem-details-adding-extra-parameters">13.4.3. Adding extra parameters</a></h4>
<div class="paragraph">
<p><code>RFC 7807</code> has a simple extension model: APIs are free to add any other properties to the problem details object, so all properties other than the five ones listed above are extensions.</p>
</div>
<div class="paragraph">
<p>However, variadic root level fields are usually not very convenient for (de)serialization (especially in statically typed languages). Thatâ€™s why <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a> implementation grabs all extensions under a single root field <code>parameters</code>. You can add parameters using builder like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x731fa3fd70a94e71">throw HttpProblem.builder()
  .title("Order not found")
  .status(StatusCode.NOT_FOUND)
  .detail("Order with ID $orderId could not be processed because it is missing or invalid.")
  .param("reason", "Order ID format incorrect or order does not exist.")
  .param("suggestion", "Please check the order ID and try again")
  .param("supportReference", "/support")
  .build();</code><button class="clipboard" data-clipboard-target="#x731fa3fd70a94e71"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="x99e16008e52a45f1">{
  "timestamp": "2024-10-06T07:34:06.643235500Z",
  "type": "about:blank",
  "title": "Order not found",
  "status": 404,
  "detail": "Order with ID $orderId could not be processed because it is missing or invalid.",
  "instance": null,
  "parameters": {
    "reason": "Order ID format incorrect or order does not exist.",
    "suggestion": "Please check the order ID and try again",
    "supportReference": "/support"
  }
}</code><button class="clipboard" data-clipboard-target="#x99e16008e52a45f1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-adding-headers"><a class="anchor" href="#error-handler-problem-details-adding-headers"></a><a class="link" href="#error-handler-problem-details-adding-headers">13.4.4. Adding headers</a></h4>
<div class="paragraph">
<p>Some <code>HTTP</code> codes (like <code>413</code> or <code>426</code>) require additional response headers, or it may be required by third-party system/integration. <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a> support additional headers in response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1e779b25199d4d6d">throw HttpProblem.builder()
  .title("Invalid input parameters")
  .status(StatusCode.UNPROCESSABLE_ENTITY)
  .header("my-string-header", "string")
  .header("my-int-header", 100)
  .build();</code><button class="clipboard" data-clipboard-target="#x1e779b25199d4d6d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-respond-with-errors-details"><a class="anchor" href="#error-handler-problem-details-respond-with-errors-details"></a><a class="link" href="#error-handler-problem-details-respond-with-errors-details">13.4.5. Respond with errors details</a></h4>
<div class="paragraph">
<p><code>RFC 9457</code> finally described how errors should be delivered in HTTP APIs.
It is basically another extension <code>errors</code> on a root level. Adding errors is straight-forward using <code>error()</code> or <code>errors()</code> for bulk addition in builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8bce434e4dc84c24">throw HttpProblem.builder()
  ...
  .error(new HttpProblem.Error("First name cannot be blank", "/firstName"))
  .error(new HttpProblem.Error("Last name is required", "/lastName"))
  .build();</code><button class="clipboard" data-clipboard-target="#x8bce434e4dc84c24"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>In response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="xcd14854bb83946ff">{
  ...
  "errors": [
    {
      "detail": "First name cannot be blank",
      "pointer": "/firstName"
    },
    {
      "detail": "Last name is required",
      "pointer": "/lastName"
    }
  ]
}</code><button class="clipboard" data-clipboard-target="#xcd14854bb83946ff"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you need to enrich errors with more information feel free to extend <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.Error.html" target="_blank">HttpProblem.Error</a> and make your custom errors model.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-custom-exception-to-httpproblem"><a class="anchor" href="#error-handler-problem-details-custom-exception-to-httpproblem"></a><a class="link" href="#error-handler-problem-details-custom-exception-to-httpproblem">13.4.6. Custom <code>Exception</code> to <code>HttpProblem</code></a></h4>
<div class="paragraph">
<p>Apparently, you may already have many custom <code>Exception</code> classes in the codebase, and you want to make them <code>Problem Details</code> compliant without complete re-write. You can achieve this by implementing <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblemMappable.html" target="_blank">HttpProblemMappable</a> interface. It allows you to control how exceptions should be transformed into javadoc:problem.HttpProblem if default behaviour doesnâ€™t suite your needs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x44fea2f0c98b408b">import io.jooby.problem.HttpProblemMappable;

public class MyException implements HttpProblemMappable {

  public HttpProblem toHttpProblem() {
    return HttpProblem.builder()
      ...
      build();
  }

}</code><button class="clipboard" data-clipboard-target="#x44fea2f0c98b408b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-custom-problems"><a class="anchor" href="#error-handler-problem-details-custom-problems"></a><a class="link" href="#error-handler-problem-details-custom-problems">13.4.7. Custom Problems</a></h4>
<div class="paragraph">
<p>Extending <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/problem/HttpProblem.html" target="_blank">HttpProblem</a> and utilizing builder functionality makes it really easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xb6747328f71b4e8b">public class OutOfStockProblem extends HttpProblem {

  private static final URI TYPE = URI.create("https://example.org/out-of-stock");

  public OutOfStockProblem(final String product) {
    super(builder()
      .type(TYPE)
      .title("Out of Stock")
      .status(StatusCode.BAD_REQUEST)
      .detail(String.format("'%s' is no longer available", product))
      .param("suggestions", List.of("Coffee Grinder MX-17", "Coffee Grinder MX-25"))
    );
  }
}</code><button class="clipboard" data-clipboard-target="#xb6747328f71b4e8b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-handler-problem-details-custom-exception-handlers"><a class="anchor" href="#error-handler-problem-details-custom-exception-handlers"></a><a class="link" href="#error-handler-problem-details-custom-exception-handlers">13.4.8. Custom Exception Handlers</a></h4>
<div class="paragraph">
<p>All the features described above should give you ability to rely solely on built-in global error handler. But, in case you still need custom exception handler for some reason, you still can do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4bcae787e5c648be">{
    ...
    error(MyCustomException.class, (ctx, cause, code) -&gt; {
      MyCustomException ex = (MyCustomException) cause;

      HttpProblem problem = ... ;                                      <i class="conum" data-value="1"></i><b>(1)</b>

      ctx.getRouter().getErrorHandler().apply(ctx, problem, code);     <i class="conum" data-value="2"></i><b>(2)</b>
    });
}</code><button class="clipboard" data-clipboard-target="#x4bcae787e5c648be"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Transform exception to <code>HttpProblem</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Propagate the problem to <code>ProblemDetailsHandler</code>. It will handle the rest.</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not attempt to render <code>HttpProblem</code> manually, it is strongly discouraged.
<code>HttpProblem</code> is derived from the <code>RuntimeException</code> to enable ease of <code>HttpProblem</code> throwing.
Thus, thrown <code>HttpProblem</code> will also contain a stacktrace, if you render <code>HttpProblem</code> as is -
it will be rendered together with stacktrace. It is  strongly advised not to expose the stacktrace to the client system. Propagate the problem to global error handler and let him take care of the rest.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">14. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Application configuration is based on <a href="https://github.com/lightbend/config" target="_blank">config</a> library. Configuration
can by default be provided in either Java properties, JSON, and <a href="https://github.com/lightbend/config/blob/master/HOCON.md" target="_blank">HOCON</a> files.</p>
</div>
<div class="paragraph">
<p>Jooby allows overriding any property via system properties or environment variables.</p>
</div>
<div class="sect2">
<h3 id="configuration-environment"><a class="anchor" href="#configuration-environment"></a><a class="link" href="#configuration-environment">14.1. Environment</a></h3>
<div class="paragraph">
<p>The application environment is available via the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Environment.html" target="_blank">Environment</a> class, which allows specifying one
or many unique environment names.</p>
</div>
<div class="paragraph">
<p>The active environment names serve the purpose of allowing loading different configuration files
depending on the environment. Also, <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Extension.html" target="_blank">Extension</a> modules might configure application
services differently depending on the environment too. For example: turn on/off caches, reload files, etc.</p>
</div>
<div class="listingblock primary">
<div class="title">Initializing the Environment</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x1b1f5dc8c7c04df3">{
  Environment env = getEnvironment();
}</code><button class="clipboard" data-clipboard-target="#x1b1f5dc8c7c04df3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8e038cf368ce4398">{
  val env = environment
}</code><button class="clipboard" data-clipboard-target="#x8e038cf368ce4398"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The active environment names property is set in one of this way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As program argument: <code>java -jar myapp.jar application.env=foo,bar</code>; or just <code>java -jar myapp.jar foo,bar</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This method works as long you start the application using one of the <code>runApp</code> methods
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<ul>
<li>
<p>As system property: <code>java -Dapplication.env=foo,bar -jar myapp.jar</code></p>
</li>
<li>
<p>As environment variable: <code>application.env=foo,bar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#getEnvironment()" target="_blank">getEnvironment()</a> loads the default environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-default-environment"><a class="anchor" href="#configuration-default-environment"></a><a class="link" href="#configuration-default-environment">14.2. Default Environment</a></h3>
<div class="paragraph">
<p>The default environment is available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Environment.html#loadEnvironment(io.jooby.EnvironmentOptions)" target="_blank">loadEnvironment(EnvironmentOptions)</a> method.</p>
</div>
<div class="paragraph">
<p>This method search for an <code>application.conf</code> file in three location (first-listed are higher priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${user.dir}/conf</code>. This is a file system location, useful is you want to externalize configuration (outside of jar file)</p>
</li>
<li>
<p><code>${user.dir}</code>. This is a file system location, useful is you want to externalize configuration (outside of jar file)</p>
</li>
<li>
<p><code>classpath://</code> (root of classpath). No external configuration, configuration file lives inside the jar file</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use <code>$user.dir</code> to reference <code>System.getProperty("user.dir")</code>. This system property is set
by the JVM at application startup time. It represent the current directory from where the JVM was
launch it.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">File system loading</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x8e1fa5d233e4012">â””â”€â”€ conf
    â””â”€â”€ application.conf
â””â”€â”€ myapp.jar</code><button class="clipboard" data-clipboard-target="#x8e1fa5d233e4012"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>A call to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" id="x566de1e643be466d">  Environment env = getEnvironment();</code><button class="clipboard" data-clipboard-target="#x566de1e643be466d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Loads the <code>application.conf</code> from <code>conf</code> directory. You get the same thing if you
move the <code>application.conf</code> to <code>myapp.jar</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">Classpath loading</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x879ae33e3cb943a5">â””â”€â”€ myapp.jar
   â””â”€â”€ application.conf (file inside jar)</code><button class="clipboard" data-clipboard-target="#x879ae33e3cb943a5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Jooby favors file system property loading over classpath property loading. So, if there
is a property file either in the current directory or conf directory it hides the same file
available in the classpath.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-overrides"><a class="anchor" href="#configuration-overrides"></a><a class="link" href="#configuration-overrides">14.3. Overrides</a></h3>
<div class="paragraph">
<p>Property overrides is done in multiple ways (first-listed are higher priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Program arguments</p>
</li>
<li>
<p>System properties</p>
</li>
<li>
<p>Environment variables</p>
</li>
<li>
<p>Environment property file</p>
</li>
<li>
<p>Property file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="xf0d0f7f5e8dc48a6">foo = foo</code><button class="clipboard" data-clipboard-target="#xf0d0f7f5e8dc48a6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Property access</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x468bca626fbc47a2">{
  Environment env = getEnvironment();                <i class="conum" data-value="1"></i><b>(1)</b>
  Config conf = env.getConfig();             <i class="conum" data-value="2"></i><b>(2)</b>
  System.out.println(conf.getString("foo")); <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#x468bca626fbc47a2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xaec9da1fbde463b">{
  val env = environment          <i class="conum" data-value="1"></i><b>(1)</b>
  val conf = env.config          <i class="conum" data-value="2"></i><b>(2)</b>
  println(conf.getString("foo")) <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#xaec9da1fbde463b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get environment</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get <code>foo</code> property and prints <code>foo</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At runtime you can override properties using:</p>
</div>
<div class="listingblock">
<div class="title">Program argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xa89101aae9d44fc4">java -jar myapp.jar foo=argument</code><button class="clipboard" data-clipboard-target="#xa89101aae9d44fc4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Example prints: <code>argument</code></p>
</div>
<div class="listingblock">
<div class="title">System property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xfb487cd2f3fa4ac8">java -Dfoo=sysprop -jar myapp.jar</code><button class="clipboard" data-clipboard-target="#xfb487cd2f3fa4ac8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Prints: <code>syspro</code></p>
</div>
<div class="listingblock">
<div class="title">Environment variable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x797d30d9ba50487a">foo=envar java -jar myapp.jar</code><button class="clipboard" data-clipboard-target="#x797d30d9ba50487a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Prints: <code>envar</code></p>
</div>
<div class="paragraph">
<p>If you have multiple properties to override, it is probably better to collect all them into a new file
and use active environment name to select them.</p>
</div>
<div class="listingblock">
<div class="title">Environment property file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xeddebf4428b74cdc">â””â”€â”€ application.conf
â””â”€â”€ application.prod.conf</code><button class="clipboard" data-clipboard-target="#xeddebf4428b74cdc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="x2a1650d4416d4a90">foo = foo
bar = devbar</code><button class="clipboard" data-clipboard-target="#x2a1650d4416d4a90"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.prod.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="x44387eae43824eba">bar = prodbar</code><button class="clipboard" data-clipboard-target="#x44387eae43824eba"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run with <code>prod</code> environment</div>
<div class="content">
<pre>java -jar my.app application.env=prod</pre>
</div>
</div>
<div class="paragraph">
<p>Or just</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java -jar my.app prod</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You only need to override the properties that changes between environment not all the properties.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>application.conf</code> defines two properties : <code>foo</code> and <code>bar</code>, while the environment property file
defines only <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>For Multiple environment activation you need to separate them with <code>,</code> (comma):</p>
</div>
<div class="listingblock">
<div class="title">Run with <code>prod</code> and <code>cloud</code> environment</div>
<div class="content">
<pre> java -jar my.app application.env=prod,cloud</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-custom-environment"><a class="anchor" href="#configuration-custom-environment"></a><a class="link" href="#configuration-custom-environment">14.4. Custom environment</a></h3>
<div class="paragraph">
<p>Custom configuration and environment are available too using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/EnvironmentOptions.html" target="_blank">EnvironmentOptions</a> class, or</p>
</li>
<li>
<p>Direct instantiation of the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Environment.html" target="_blank">Environment</a> class</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Environment options</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x536cb16fd7674d7c">{
  Environment env = setEnvironmentOptions(
    new EnvironmentOptions().setFilename("myapp.conf"));   <i class="conum" data-value="1"></i><b>(1)</b>
  )
}</code><button class="clipboard" data-clipboard-target="#x536cb16fd7674d7c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xeb82199e1f454244">{
  val env = environmentOptions {                   <i class="conum" data-value="1"></i><b>(1)</b>
    filename = "myapp.conf"
  }
}</code><button class="clipboard" data-clipboard-target="#xeb82199e1f454244"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load <code>myapp.conf</code> using the loading and precedence mechanism described before</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#setEnvironmentOptions(io.jooby.EnvironmentOptions)" target="_blank">setEnvironmentOptions(EnvironmentOptions)</a> method loads, set and returns
the environment.</p>
</div>
<div class="paragraph">
<p>To skip/ignore Jooby loading and precedence mechanism, just instantiate and set the environment:</p>
</div>
<div class="listingblock primary">
<div class="title">Direct instantiation</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x21844310478a4bc2">{
  Config conf = ConfigFactory.load("myapp.conf");            <i class="conum" data-value="1"></i><b>(1)</b>
  Environment env = new Environment(getClassLoader(), conf); <i class="conum" data-value="2"></i><b>(2)</b>
  setEnvironment(env);                                       <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#x21844310478a4bc2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa61a2156fb8e4a31">{
  val conf = ConfigFactory.load("myapp.conf")              <i class="conum" data-value="1"></i><b>(1)</b>
  val env = Environment(classLoader, conf)                 <i class="conum" data-value="2"></i><b>(2)</b>
  environment = env                                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard" data-clipboard-target="#xa61a2156fb8e4a31"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loads and parses configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a new environment with configuration and (optionally) active names</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set environment on Jooby instance</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Custom configuration is very flexible. You can reuse Jooby mechanism or provide your own.
The only thing to keep in mind is that environment setting must be done at very early stage, before
starting the application.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-logging"><a class="anchor" href="#configuration-logging"></a><a class="link" href="#configuration-logging">14.5. Logging</a></h3>
<div class="paragraph">
<p>Jooby uses <a href="https://www.slf4j.org" target="_blank">Slf4j</a> for logging which give you some flexibility for choosing
the logging framework.</p>
</div>
<div class="sect3">
<h4 id="configuration-logging-logback"><a class="anchor" href="#configuration-logging-logback"></a><a class="link" href="#configuration-logging-logback">14.5.1. Logback</a></h4>
<div class="paragraph">
<p>The <a href="https://logback.qos.ch/manual/index.html" target="_blank">Logback</a> is probably the first alternative for
<a href="https://www.slf4j.org" target="_blank">Slf4j</a> due its natively implements the SLF4J API. Follow the next steps to use
logback in your project:</p>
</div>
<div class="paragraph">
<p>1) Add dependency</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x2aa08cd09e1b4e51">&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;1.5.21&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x2aa08cd09e1b4e51"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x6112cefe01484dfb">implementation 'ch.qos.logback:logback-classic:1.5.21'</code><button class="clipboard" data-clipboard-target="#x6112cefe01484dfb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x7567284c4064ce0">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;

  &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;root level="INFO"&gt;
    &lt;appender-ref ref="STDOUT" /&gt;
  &lt;/root&gt;
&lt;/configuration&gt;</code><button class="clipboard" data-clipboard-target="#x7567284c4064ce0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Thatâ€™s all! <a href="https://www.slf4j.org" target="_blank">Slf4j</a> is going to redirect log message to logback.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-logging-log4j2"><a class="anchor" href="#configuration-logging-log4j2"></a><a class="link" href="#configuration-logging-log4j2">14.5.2. Log4j2</a></h4>
<div class="paragraph">
<p>The <a href="https://logging.apache.org/log4j" target="_blank">Log4j2</a> project is another good alternative for logging. Follow
the next steps to use logback in your project:</p>
</div>
<div class="paragraph">
<p>1) Add dependencies</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x2a64cc6293ef4809">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
  &lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt;
  &lt;version&gt;2.25.2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
  &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
  &lt;version&gt;2.25.2&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x2a64cc6293ef4809"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x6c31b60b035946ce">implementation 'org.apache.logging.log4j:log4j-slf4j-impl:2.25.2'

implementation 'org.apache.logging.log4j:log4j-core:2.25.2'</code><button class="clipboard" data-clipboard-target="#x6c31b60b035946ce"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock">
<div class="title">log4j.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xf66e9923cb32447c">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
  &lt;Appenders&gt;
    &lt;Console name="stdout"&gt;
      &lt;PatternLayout pattern="%d [%t] %-5level: %msg%n%throwable" /&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Root level="INFO" additivity="true"&gt;
      &lt;AppenderRef ref="stdout" /&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code><button class="clipboard" data-clipboard-target="#xf66e9923cb32447c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>All these extensions are considered valid: <code>.xml</code>, <code>.propertines</code>, <code>.yaml</code> and <code>.json</code>. As well as <code>log4j2</code> for file name.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-logging-environment-logging"><a class="anchor" href="#configuration-logging-environment-logging"></a><a class="link" href="#configuration-logging-environment-logging">14.5.3. Environment logging</a></h4>
<div class="paragraph">
<p>Logging is integrated with the environment names. So it is possible to have a file name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logback[.name].xml</code> (for loggback)</p>
</li>
<li>
<p><code>log4j[.name].xml</code> (for log4j2)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jooby favors the environment specific logging configuration file over regular/normal logging configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xbd2fc3724b6a4659">conf
â””â”€â”€ logback.conf
â””â”€â”€ logback.prod.conf</code><button class="clipboard" data-clipboard-target="#xbd2fc3724b6a4659"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>To use <code>logback.prod.conf</code>, start your application like:</p>
</div>
<div class="paragraph">
<p><code>java -jar myapp.jar application.env=prod</code></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The logging configuration file per environment works as long you donâ€™t use <strong>static</strong> loggers
before application has been start it. The next example wonâ€™t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd15becd0e6c04125">public class App extends Jooby {
  private static final Logger log = ...

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xd15becd0e6c04125"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>runApp</code> method is the one who configures the logging framework. Adding a static logger force
the logging framework to configure without taking care the environment setup.</p>
</div>
<div class="paragraph">
<p>There are a couple of solution is for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use an instance logger</p>
</li>
<li>
<p>use the getLog() method of Jooby</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-application-properties"><a class="anchor" href="#configuration-application-properties"></a><a class="link" href="#configuration-application-properties">14.6. Application Properties</a></h3>
<div class="paragraph">
<p>These are the application properties that Jooby uses:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.charset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset used by your application. Used by template engine, HTTP encoding/decoding, database driver, etc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UTF-8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active <a href="#configuration-environment">environment</a> names. Use to identify <code>dev</code> vs <code>non-dev</code> application deployment. Jooby applies some optimizations for `non-dev`environments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.lang</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The languages your application supports. Used by <code>Context.locale()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A single locale provided by <code>Locale.getDefault()</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.logfile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The logging configuration file your application uses. You donâ€™t need to set this property, see <a href="#configuration-logging">logging configuration</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base package of your application.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JVM process ID.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The native process ID assigned by the operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.startupSummary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The level of information logged during startup.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.tmpdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary directory used by your application.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/AvailableSettings.html" target="_blank">AvailableSettings</a> for more details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extensions-and-services"><a class="anchor" href="#extensions-and-services"></a><a class="link" href="#extensions-and-services">15. Extensions and Services</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby comes with a simple extension mechanism. The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Extension.html" target="_blank">Extension</a> API allows to configure
, extend an application by adding shared/single services, infrastructure/technical concerns like
dependency injection, database connection pools, cron-job, etc.</p>
</div>
<div class="paragraph">
<p>Services are shared/singleton objects, usually with a clear lifecycle for starting and stopping them.</p>
</div>
<div class="sect2">
<h3 id="extensions-and-services-writing-custom-extension"><a class="anchor" href="#extensions-and-services-writing-custom-extension"></a><a class="link" href="#extensions-and-services-writing-custom-extension">15.1. Writing Custom Extension</a></h3>
<div class="paragraph">
<p>We are going to develop a custom extension that configure a <code>DataSource</code> service.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa878c3e5fc964324">import io.jooby.Extension;

public class MyExtension implements Extension {

   public void install(Jooby application) {
      DataSource dataSource = createDataSource();           <i class="conum" data-value="1"></i><b>(1)</b>

      ServiceRegistry registry = application.getServices(); <i class="conum" data-value="2"></i><b>(2)</b>
      registry.put(MyDataSource.class, dataSource);         <i class="conum" data-value="3"></i><b>(3)</b>

      application.onStop(dataSource::close)                 <i class="conum" data-value="4"></i><b>(4)</b>
   }
}</code><button class="clipboard" data-clipboard-target="#xa878c3e5fc964324"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5e1acdd88d5b44e0">import io.jooby.Extension

class MyExtension: Extension {
  override fun install(application: Jooby) {
    val dataSource = createDataSource()                     <i class="conum" data-value="1"></i><b>(1)</b>

    val registry = application.services                     <i class="conum" data-value="2"></i><b>(2)</b>
    registry.put(MyDataSource::class, dataSource)           <i class="conum" data-value="3"></i><b>(3)</b>
    application.onStop(dataSource::close)                   <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x5e1acdd88d5b44e0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the service (DataSource)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to the service registry</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save into the service registry</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Close/release service on application stop</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Letâ€™s install the extension and use the service!!</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x66db40ef9ddb4130">public class App extends Jooby {

   {
     install(new MyExtension());                      <i class="conum" data-value="1"></i><b>(1)</b>

     get("/", ctx -&gt; {
       MyDataSource ds = require(MyDataSource.class); <i class="conum" data-value="2"></i><b>(2)</b>
       // ...
     });
   }
}</code><button class="clipboard" data-clipboard-target="#x66db40ef9ddb4130"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x233a58892e434a08">import io.jooby.Extension

class App: Kooby({

  install(MyExtension())                              <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    val ds = require(MyDataSource::class)             <i class="conum" data-value="2"></i><b>(2)</b>
  }
})</code><button class="clipboard" data-clipboard-target="#x233a58892e434a08"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install the extension</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the service</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="extensions-and-services-collection-of-services"><a class="anchor" href="#extensions-and-services-collection-of-services"></a><a class="link" href="#extensions-and-services-collection-of-services">15.2. Collection of Services</a></h3>
<div class="paragraph">
<p>Adding a collection to the service registry is supported too.</p>
</div>
<div class="listingblock">
<div class="title">List/Set</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe53c189f1aa94fbd">import io.jooby.Extension;import io.jooby.Reified;

public class Cats implements Extension {

   public void install(Jooby application) {
      ServiceRegistry registry = application.getServices();
      // as list
      registry.listOf(Animal.class).add(new Cat());
      // as set
      registry.setOf(Animal.class).add(new Cat());
      // as map
      registry.mapOf(String.class, Animal.class).put("cat", new Cat());
   }
}

public class Dogs implements Extension {

   public void install(Jooby application) {
      ServiceRegistry registry = application.getServices();
      // as list
      registry.listOf(Animal.class).add(new Dog());
      // as set
      registry.setOf(Animal.class).add(new Dog());
      // as map
      registry.mapOf(String.class, Animal.class).put("dog", new Dog());
   }
}

{
  install(new Cats());
  install(new Dogs());
  // as list
  get("/list", ctx -&gt; {
    return ctx.require(Reified.list(Animal.class));
  });
  // as set
  get("/set", ctx -&gt; {
    return ctx.require(Reified.set(Animal.class));
  });
  // as map
  get("/map", ctx -&gt; {
    return ctx.require(Reified.map(String.class, Animal.class));
  });
}</code><button class="clipboard" data-clipboard-target="#xe53c189f1aa94fbd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Services are accessible via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Registry.html#require(java.lang.Class)" target="_blank">require(Class)</a> and integrated with
dependency injection frameworks provided by Jooby like Guice and Avaje Inject. This mean they are
accessible using the <code>jakarta.inject.Inject</code> annotation.</p>
</div>
<div class="paragraph">
<p>In addition to services, an extension module may provides infrastructure routes, body decoder/encoder,
template engines, etc.</p>
</div>
<div class="paragraph">
<p>The extension mechanism is a simple way of reusing code and decoupling technical features from
business logic.</p>
</div>
<div class="paragraph">
<p>More advanced techniques are described in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="extensions-and-services-dependency-injection"><a class="anchor" href="#extensions-and-services-dependency-injection"></a><a class="link" href="#extensions-and-services-dependency-injection">15.3. Dependency Injection</a></h3>
<div class="sect3">
<h4 id="extensions-and-services-dependency-injection-avaje-inject"><a class="anchor" href="#extensions-and-services-dependency-injection-avaje-inject"></a><a class="link" href="#extensions-and-services-dependency-injection-avaje-inject">15.3.1. Avaje Inject</a></h4>
<div class="paragraph">
<p>1) Add Avaje Inject to your project</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x3456bc3def19498f">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-avaje-inject&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x3456bc3def19498f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x94ec277a971e4c60">implementation 'io.jooby:jooby-avaje-inject:4.0.12'</code><button class="clipboard" data-clipboard-target="#x94ec277a971e4c60"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Configure annotation processor</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x2e9781ff4db94f32">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
      &lt;version&gt;...&lt;/version&gt;
      &lt;configuration&gt;
        &lt;annotationProcessorPaths&gt;
          &lt;!-- if using lombok, it must be placed before the avaje-inject-generator --&gt;
          &lt;!-- avaje-inject-generator must be placed before the jooby-apt --&gt;
          &lt;path&gt;
            &lt;groupId&gt;io.avaje&lt;/groupId&gt;
            &lt;artifactId&gt;avaje-inject-generator&lt;/artifactId&gt;
            &lt;version&gt;12.0&lt;/version&gt;
          &lt;/path&gt;
        &lt;/annotationProcessorPaths&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code><button class="clipboard" data-clipboard-target="#x2e9781ff4db94f32"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x46584a82746e4a91">plugins {
  id "org.jetbrains.kotlin.kapt" version "1.9.10"
}

dependencies {
  kapt 'io.avaje:avaje-inject-generator:{avaje.inject.version}'
}</code><button class="clipboard" data-clipboard-target="#x46584a82746e4a91"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that the order of annotation processors is important. For example, if youâ€™re using <code>lombok</code> and <code>avaje-inject</code>, the correct order should be: <code>lombok</code> â†’ <code>avaje-inject</code> â†’ <code>jooby-apt</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>3) Install Avaje Inject:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing Avaje Inject</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc659393fb1344619">public class App extends Jooby {

  {
    install(AvajeInjectModule.of());                     <i class="conum" data-value="1"></i><b>(1)</b>

    get("/", ctx -&gt; {
      MyService service = require(MyService.class); <i class="conum" data-value="2"></i><b>(2)</b>
      return service.doSomething();
    });
}

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xc659393fb1344619"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x14c75b01a158440b">fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(AvajeInjectModule.of())                    <i class="conum" data-value="1"></i><b>(1)</b>

    get ("/") {
      val service = require(MyService::class) <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x14c75b01a158440b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Avaje Inject module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#require(java.lang.Class)" target="_blank">require(Class)</a> call is now resolved by Avaje Inject</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="extensions-and-services-dependency-injection-avaje-inject-property-injection"><a class="anchor" href="#extensions-and-services-dependency-injection-avaje-inject-property-injection"></a><a class="link" href="#extensions-and-services-dependency-injection-avaje-inject-property-injection">Property Injection</a></h5>
<div class="paragraph">
<p>Configuration properties can be injected using the <code>@Named</code> annotation. As Avaje checks beans at compile time, <code>@External</code> is required to prevent false-positive compilation errors:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x823559ae594744c3">currency = USD</code><button class="clipboard" data-clipboard-target="#x823559ae594744c3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x55af30103cbf41dc">@Singleton
public class BillingService {

  @Inject
  public BillingService(@External @Named("currency") String currency) {
    ...
  }

}</code><button class="clipboard" data-clipboard-target="#x55af30103cbf41dc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x7b2d0f6ec4714fee">@Singleton
class BillingService @Inject constructor(@External @Named("currency") currency: String) {
  ...
}</code><button class="clipboard" data-clipboard-target="#x7b2d0f6ec4714fee"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="extensions-and-services-dependency-injection-avaje-inject-mvc-routes"><a class="anchor" href="#extensions-and-services-dependency-injection-avaje-inject-mvc-routes"></a><a class="link" href="#extensions-and-services-dependency-injection-avaje-inject-mvc-routes">MVC routes</a></h5>
<div class="paragraph">
<p>Avaje Inject will also provisioning MVC routes</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Avaje Inject</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdb162140cbba4201">public class App extends Jooby {

  {
    install(AvajeInjectModule.of());  <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController.class);          <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xdb162140cbba4201"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa6eb2fdbe2e44ddb">fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(AvajeInjectModule.of())       <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController::class)              <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xa6eb2fdbe2e44ddb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Avaje Inject module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register a MVC route</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The lifecycle of <code>MyController</code> is now managed by Avaje Inject.</p>
</div>
<div class="paragraph">
<p>In Avaje Inject, the dependency graph is typically validated when the application compiles. As beans provided by Jooby Modules are registered at runtime, you must add <code>@External</code> when injecting these runtime beans into <code>@Singleton</code> classes to inform the avaje processor that these beans are provided at runtime.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extensions-and-services-dependency-injection-dagger"><a class="anchor" href="#extensions-and-services-dependency-injection-dagger"></a><a class="link" href="#extensions-and-services-dependency-injection-dagger">15.3.2. Dagger</a></h4>
<div class="paragraph">
<p>1) Add Dagger to your project</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xec99bbd8097c4d23">&lt;dependency&gt;
  &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
  &lt;artifactId&gt;dagger&lt;/artifactId&gt;
  &lt;version&gt;2.20&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#xec99bbd8097c4d23"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x2db126be6b0a488b">implementation 'com.google.dagger:dagger:2.20'</code><button class="clipboard" data-clipboard-target="#x2db126be6b0a488b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Configure annotation processor</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xc1f6c0bc15fc4fbc">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
      &lt;version&gt;...&lt;/version&gt;
      &lt;configuration&gt;
        &lt;annotationProcessorPaths&gt;
          &lt;path&gt;
            &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
            &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt;
            &lt;version&gt;2.20&lt;/version&gt;
          &lt;/path&gt;
        &lt;/annotationProcessorPaths&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code><button class="clipboard" data-clipboard-target="#xc1f6c0bc15fc4fbc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xddf5cff3a758449f">plugins {
  id "org.jetbrains.kotlin.kapt" version "1.9.10"
}

dependencies {
  kapt 'com.google.dagger:dagger-compiler:2.20'
}</code><button class="clipboard" data-clipboard-target="#xddf5cff3a758449f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>3) Bootstrap Dagger from application:</p>
</div>
<div class="listingblock primary">
<div class="title">Dagger</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x49115877e0d9434b">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
     /** Dagger: */
     AppComponent dagger = DaggerAppComponent.builder()      <i class="conum" data-value="1"></i><b>(1)</b>
         .build();

     get("/", ctx -&gt; {
       MyService service = dagger.getMyService();            <i class="conum" data-value="2"></i><b>(2)</b>
       return service.doSomething();
     });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#x49115877e0d9434b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xdd7ea26fc7fb423c">import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder() <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    get("/") {
      val service = dagger.getMyService()     <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xdd7ea26fc7fb423c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use dagger provided objects</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>DaggerAppComponent</code> in the example above is a generated source.
Check out the <a href="https://dagger.dev/tutorial" target="_blank">Dagger tutorial</a> to learn more.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="extensions-and-services-dependency-injection-dagger-mvc-routes"><a class="anchor" href="#extensions-and-services-dependency-injection-dagger-mvc-routes"></a><a class="link" href="#extensions-and-services-dependency-injection-dagger-mvc-routes">MVC routes</a></h5>
<div class="paragraph">
<p>Integration of MVC routes with Dagger is as simple as:</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Dagger</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xed3ef223f33049bb">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    /** Dagger: */
    AppComponent dagger = DaggerAppComponent.builder()  <i class="conum" data-value="1"></i><b>(1)</b>
        .build();

    mvc(dagger.myController());                         <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xed3ef223f33049bb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x914d4e880e8d4fe8">import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder() <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    mvc(dagger.myController())                <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x914d4e880e8d4fe8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register MVC route provided by Dagger</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Due the static nature of Dagger mvc integration identical to normal usage. For custom scopes/lifecycles
Dagger generate a <code>jakarta.inject.Provider</code> on such use cases you need to switch and use the provider
version of the <code>mvc</code> method:</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Dagger provider</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc2da9c2c882d4a49">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    /** Dagger: */
    AppComponent dagger = DaggerAppComponent.builder()      <i class="conum" data-value="1"></i><b>(1)</b>
        .build();

    mvc(MyController.class, dagger.myController());         <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xc2da9c2c882d4a49"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xb3728f12ea534d8c">import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder()        <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    mvc(MyController::class, dagger.myController())  <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xb3728f12ea534d8c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register MVC route using a Dagger provider</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extensions-and-services-dependency-injection-guice"><a class="anchor" href="#extensions-and-services-dependency-injection-guice"></a><a class="link" href="#extensions-and-services-dependency-injection-guice">15.3.3. Guice</a></h4>
<div class="paragraph">
<p>1) Add Guice dependency to your project:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x2f3fabfc5184aa9">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-guice&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x2f3fabfc5184aa9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xeb2a1d8003ae4363">implementation 'io.jooby:jooby-guice:4.0.12'</code><button class="clipboard" data-clipboard-target="#xeb2a1d8003ae4363"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Install Guice:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing Guice</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xbcd8a8288ecf4112">import io.jooby.guice.GuiceModule;
import io.jooby.kt.runApp;

public class App extends Jooby {

  {
    install(new GuiceModule());                     <i class="conum" data-value="1"></i><b>(1)</b>

    get("/", ctx -&gt; {
      MyService service = require(MyService.class); <i class="conum" data-value="2"></i><b>(2)</b>
      return service.doSomething();
    });
}

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xbcd8a8288ecf4112"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xffe24bae2c8349f4">import io.jooby.di.GuiceModule
import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(GuiceModule())                    <i class="conum" data-value="1"></i><b>(1)</b>

    get ("/") {
      val service = require(MyService::class) <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xffe24bae2c8349f4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Guice module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#require(java.lang.Class)" target="_blank">require(Class)</a> call is now resolved by Guice</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="extensions-and-services-dependency-injection-guice-property-injection"><a class="anchor" href="#extensions-and-services-dependency-injection-guice-property-injection"></a><a class="link" href="#extensions-and-services-dependency-injection-guice-property-injection">Property Injection</a></h5>
<div class="paragraph">
<p>Configuration properties can be injected using the <code>@Named</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x82c64caf138542c9">currency = USD</code><button class="clipboard" data-clipboard-target="#x82c64caf138542c9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe95098b1325a4ce7">import javax.injext.Named;
import javax.injext.Inject;

public class BillingService {

  @Inject
  public BillingService(@Named("currency") String currency) {
    ...
  }

}</code><button class="clipboard" data-clipboard-target="#xe95098b1325a4ce7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x58cecf4aca564a12">class BillingService @Inject constructor(@Named("currency") currency: String) {
  ...
}</code><button class="clipboard" data-clipboard-target="#x58cecf4aca564a12"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="extensions-and-services-dependency-injection-guice-mvc-routes"><a class="anchor" href="#extensions-and-services-dependency-injection-guice-mvc-routes"></a><a class="link" href="#extensions-and-services-dependency-injection-guice-mvc-routes">MVC routes</a></h5>
<div class="paragraph">
<p>Guice will also provisioning MVC routes</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Guice</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdf4ae6847d5a4423">import io.jooby.guice.GuiceModule;
import io.jooby.kt.runApp

public class App extends Jooby {

  {
    install(new GuiceModule());  <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController.class);     <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard" data-clipboard-target="#xdf4ae6847d5a4423"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x1e6f16869c38426b">import io.jooby.di.GuiceModule
import io.jooby.kt.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(GuiceModule())       <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController::class)     <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#x1e6f16869c38426b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Guice module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register a MVC route</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The lifecycle of <code>MyController</code> is now managed by Guice. Also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Guice, the default scope is <code>prototype</code> (creates a new instance per request)</p>
</li>
<li>
<p>If you prefer a single instance add the <code>jakarta.inject.Singleton</code> annotation</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a><a class="link" href="#testing">16. Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will show you how to run unit and integration tests with Jooby.</p>
</div>
<div class="sect2">
<h3 id="testing-unit-testing"><a class="anchor" href="#testing-unit-testing"></a><a class="link" href="#testing-unit-testing">16.1. Unit Testing</a></h3>
<div class="paragraph">
<p>1) Add Jooby test dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x3007dd253e834f65">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-test&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x3007dd253e834f65"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x815f53081a294f4d">implementation 'io.jooby:jooby-test:4.0.12'</code><button class="clipboard" data-clipboard-target="#x815f53081a294f4d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Write your application:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4a54231878874cf3">public class App extends Jooby {
  {
    get("/", ctx -&gt; "Easy unit testing!");
  }
}</code><button class="clipboard" data-clipboard-target="#x4a54231878874cf3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4e00fe87362a422a">class App: Kooby({

  get("/") { ctx -&gt;
    "Easy unit testing!"
  }

})</code><button class="clipboard" data-clipboard-target="#x4e00fe87362a422a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>3) Write your test:</p>
</div>
<div class="listingblock primary">
<div class="title">TestApp</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x676a1c03ff26403e">import io.jooby.test.MockRouter;

public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    assertEquals("OK", router.get("/").value());
  }
}</code><button class="clipboard" data-clipboard-target="#x676a1c03ff26403e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x21451e446ec24342">import io.jooby.test.MockRouter

class TestApp {

  @Test
  fun test() {
    val router = MockRouter(App())
    assertEquals("OK", router.get("/").value())
  }
}</code><button class="clipboard" data-clipboard-target="#x21451e446ec24342"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Simple and easy â™¡!</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockRouter.html" target="_blank">MockRouter</a> returns the value produced by the route handler. It is possible to get
access and check response metadata:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xed64f8c208614fe4">public class App extends Jooby {
  {
    get("/", ctx -&gt; ctx
        .setResponseCode(StatusCode.OK)
        .send("Easy unit testing")
    );
  }
}</code><button class="clipboard" data-clipboard-target="#xed64f8c208614fe4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3a4b9fa4758f4f7d">class App: Kooby({
  get("/") {
      ctx.responseCode = StatusCode.OK

      ctx.send("Easy unit testing")
  })
})</code><button class="clipboard" data-clipboard-target="#x3a4b9fa4758f4f7d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">Checking response metadata</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe12f122ddd5f4e8e">public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    router.get("/", response -&gt; {
      assertEquals(StatusCode.OK, response.getStatusCode());
      assertEquals("Easy unit testing", response.value(String.class));
    });
  }
}</code><button class="clipboard" data-clipboard-target="#xe12f122ddd5f4e8e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x62cdefba62c141a2">class TestApp {

  @Test
  fun test() {
    val router = MockRouter(App())
    router.get("/") { response -&gt;
      assertEquals(StatusCode.OK, response.statusCode)
      assertEquals("Easy unit testing", response.value(String::class))
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x62cdefba62c141a2"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For more complex route context interaction or responses, you can pass in a <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockContext.html" target="_blank">MockContext</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x2d4fed6e37a94a25">public class App extends Jooby {
  {
    post("/", ctx -&gt; {
      String name = ctx.form("name").value();
      return name;
    });
  }
}</code><button class="clipboard" data-clipboard-target="#x2d4fed6e37a94a25"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x7b6a550531da48bc">class App: Kooby({
  get("/") {
    val name = ctx.form("name").value()
    name
  })
})</code><button class="clipboard" data-clipboard-target="#x7b6a550531da48bc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">Using mock context</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf15c45835deb4020">public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    MockContext context = new MockContext();

    context.setForm(Formdata.create(context)
            .put("name", "Test!")
        );
    assertEquals("Test!", router.post("/", context).value());
  }
}</code><button class="clipboard" data-clipboard-target="#xf15c45835deb4020"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xa115e1b48f1d43cf">class TestApp {

  @Test
  fun test() {
    MockRouter router = MockRouter(App())
    MockContext context = MockContext().apply {
      form = Formdata.create(this).apply {
        put("name", "Test!")
      }
    }
    assertEquals("Test!", router.post("/", context).value())
  }
}</code><button class="clipboard" data-clipboard-target="#xa115e1b48f1d43cf"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Alternative you can provide your own mock context:</p>
</div>
<div class="listingblock primary">
<div class="title">Mockito Context</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x819e8788a4d24fa1">import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

public class TestApp {

  @Test
  public void test() {
    Value name = mock(Value.class);
    when(name.value()).thenReturn("Test!");

    Context context = mock(Context.class);
    when(context.form("name")).thenReturn(name);

    MockRouter router = new MockRouter(new App());

    assertEquals("Test!", router.post("/", context).value());
  }
}</code><button class="clipboard" data-clipboard-target="#x819e8788a4d24fa1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xff7f6359a6104637">import org.mockito.Mockito.mock
import org.mockito.Mockito.when

class TestApp {

  @Test
  fun test() {
    val name = mock(Value::class.java)
    when(name.value()).thenReturn("Test!")

    val context = mock(Context::class.java)
    when(context.form("name")).thenReturn(name)

    MockRouter router = MockRouter(App())

    assertEquals("Test!", router.post("/", context).value())
  }
}</code><button class="clipboard" data-clipboard-target="#xff7f6359a6104637"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>â™¡ â™¡!</p>
</div>
<div class="paragraph">
<p>For MVC routes you might prefer to write a unit test using a mock library. No need to use
<code>MockRouter</code>, but it is possible too.</p>
</div>
<div class="sect3">
<h4 id="testing-unit-testing-options"><a class="anchor" href="#testing-unit-testing-options"></a><a class="link" href="#testing-unit-testing-options">16.1.1. Options</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockRouter.html#setFullExecution(boolean)" target="_blank">setFullExecution(boolean)</a>: the <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockRouter.html" target="_blank">MockRouter</a> class ONLY execute the route
handler. For executing the entire pipeline use: <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockRouter.html#setFullExecution(boolean)" target="_blank">setFullExecution(boolean)</a>.</p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#setLateInit(boolean)" target="_blank">setLateInit(boolean)</a>: extension modules usually run at the time they are installed it.
This might not be ideally for unit tests. To delay extension initialization use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Jooby.html#setLateInit(boolean)" target="_blank">setLateInit(boolean)</a> mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unit testing is simple and easy in Jooby. The <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockRouter.html" target="_blank">MockRouter</a> let you execute the route function,
while the <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/MockContext.html" target="_blank">MockContext</a> allows you to create an light-weight and mutable context where
you can set HTTP parameters, body, headers, etc.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-integration-testing"><a class="anchor" href="#testing-integration-testing"></a><a class="link" href="#testing-integration-testing">16.2. Integration Testing</a></h3>
<div class="paragraph">
<p>Integration tests are supported via JUnit 5 extension mechanism.</p>
</div>
<div class="paragraph">
<p>1) Add Jooby test dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x7dddb37d3fac4bd9">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-test&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x7dddb37d3fac4bd9"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x897eb3b2eb4e4339">implementation 'io.jooby:jooby-test:4.0.12'</code><button class="clipboard" data-clipboard-target="#x897eb3b2eb4e4339"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Write your application:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x926da25c9a4c47fb">public class App extends Jooby {
  {
    get("/", ctx -&gt; "Easy testing!");
  }
}</code><button class="clipboard" data-clipboard-target="#x926da25c9a4c47fb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x699d1b7582284da8">class App: Kooby({

  get("/") { ctx -&gt;
    "Easy testing!"
  }

})</code><button class="clipboard" data-clipboard-target="#x699d1b7582284da8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>3) Write your test:</p>
</div>
<div class="listingblock primary">
<div class="title">TestApp</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3aa24c4202d54033">import io.jooby.JoobyTest;

@JoobyTest(App.class)
public class TestApp {

  static OkHttpClient client = new OkHttpClient();

  @Test
  public void test() {
    Request request = new Request.Builder()
        .url("http://localhost:8911")
        .build();

    try (Response response = client.newCall(request).execute()) {
      assertEquals("Easy testing!", response.body().string());
    }
  }
}</code><button class="clipboard" data-clipboard-target="#x3aa24c4202d54033"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xde07e9c3d4a3495a">import io.jooby.test.JoobyTest

@JoobyTest(App::class)
class TestApp {

  companion object {
    val client = OkHttpClient()
  }

  @Test
  fun test() {
    val request = Request.Builder()
        .url("http://localhost:8911")
        .build()

    client.newCall(request).execute().use { response -&gt;
      assertEquals("Easy testing!", response.body?.string())
    }
  }
}</code><button class="clipboard" data-clipboard-target="#xde07e9c3d4a3495a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The example uses <a href="https://square.github.io/okhttp/" target="_blank">OkHttp</a> client, but you are free to use any other HTTP client.</p>
</div>
<div class="paragraph">
<p>Simple and easy â™¡!</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/JoobyTest.html" target="_blank">JoobyTest</a> takes care of start and stop the application.</p>
</div>
<div class="paragraph">
<p>The default port is: <code>8911</code>. Application port can be configured directly using the <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/JoobyTest.html#port()" target="_blank">port()</a> method:</p>
</div>
<div class="paragraph">
<p><code>@JoobyTest(value = App.class, port = 9999)</code></p>
</div>
<div class="paragraph">
<p>If port is set to zero(0) a random port is selected. You can inject the server port in your test like:</p>
</div>
<div class="listingblock">
<div class="title">Server port injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xa9c676258e3f4d1b">@JoobyTest(App.class)
public void test(int serverPort) {

}

@JoobyTest(App.class)
public void anotherTest(int serverPort) {

}</code><button class="clipboard" data-clipboard-target="#xa9c676258e3f4d1b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter name must be <code>serverPort</code> and be of type <code>int</code>. This injection let you access to the
random port used for the method-level application test.</p>
</div>
<div class="paragraph">
<p>There is a <code>serverPath</code> value too, which is the entire path to the server:</p>
</div>
<div class="listingblock">
<div class="title">Server path injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdd47e1e4ea59494a">@JoobyTest(App.class)
public void test(String serverPath) { <i class="conum" data-value="1"></i><b>(1)</b>

}</code><button class="clipboard" data-clipboard-target="#xdd47e1e4ea59494a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>serverPath</code> variable contains the entire path: <code><a href="http://localhost:port/contextPath" class="bare" target="_blank">http://localhost:port/contextPath</a></code>.</p>
</div>
<div class="paragraph">
<p>Here is the list of available injectable values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int serverPort</code>: Give you the port where the application is listening. This is named type injection (name and type are required).</p>
</li>
<li>
<p><code>String serverPath</code>: Give you the entire server path where the application is listening. This is named type injection (name and type are required).</p>
</li>
<li>
<p><code>io.jooby.Environment</code>: Give you access to the application environment. This is a type injection (name no matter).</p>
</li>
<li>
<p><code>com.typesafe.config.Config</code>: Give you access to the application environment. This is a type injection (name no matter).</p>
</li>
<li>
<p><code>io.jooby.Jooby</code>: Give you access to the application. This is a type injection (name no matter).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be injected via parameter or instance fields.</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby-test/latest/io.jooby.test/io/jooby/test/JoobyTest.html" target="_blank">JoobyTest</a> annotation starts the application using the <code>test</code> environment name. You can
creates a <code>conf/application.test.conf</code> file to override any other values for testing purpose.</p>
</div>
<div class="sect3">
<h4 id="testing-integration-testing-arguments"><a class="anchor" href="#testing-integration-testing-arguments"></a><a class="link" href="#testing-integration-testing-arguments">16.2.1. Arguments</a></h4>
<div class="paragraph">
<p>Application arguments are supported using a <code>factory method</code> strategy:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x37d039d79d024728">public class App extends Jooby {
  public App(String argument) {         <i class="conum" data-value="1"></i><b>(1)</b>
    get("/", ctx -&gt; "Easy testing!");
  }
}</code><button class="clipboard" data-clipboard-target="#x37d039d79d024728"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x574a3867a5424653">class App(argument: String): Kooby({    <i class="conum" data-value="1"></i><b>(1)</b>
  get("/") { ctx -&gt;
    "Easy testing!"
  }
})</code><button class="clipboard" data-clipboard-target="#x574a3867a5424653"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Application requires a String argument</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Write a test:</p>
</div>
<div class="listingblock primary">
<div class="title">TestApp</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc0dd7a471e9a483b">import io.jooby.JoobyTest;

public class TestApp {

  @JoobyTest(value = App.class, factoryMethod = "createApp")         <i class="conum" data-value="1"></i><b>(1)</b>
  public void test() {
    Request request = new Request.Builder()
        .url("http://localhost:8911")
        .build();

    try (Response response = client.newCall(request).execute()) {
      assertEquals("Easy testing!", response.body().string());
    }
  }

  public App createApp() {                                           <i class="conum" data-value="2"></i><b>(2)</b>
    return new App("Argument");                                      <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xc0dd7a471e9a483b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd479aa0251534320">import io.jooby.JoobyTest

class TestApp {

  @JoobyTest(value = App.class, factoryMethod = "createApp")         <i class="conum" data-value="1"></i><b>(1)</b>
  fun test() {
    val request = Request.Builder()
        .url("http://localhost:8911")
        .build()

    client.newCall(request).execute().use { response -&gt;
      assertEquals("Easy testing!", response.body().string())
    }
  }

  fun createApp() {                                                  <i class="conum" data-value="2"></i><b>(2)</b>
    return App("Argument")                                           <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard" data-clipboard-target="#xd479aa0251534320"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify a factory method: <code>createApp</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates the method: must be public and without arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates your application</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you prefer the annotation at class level (shared application between tests) the factory method
must be static.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="development"><a class="anchor" href="#development"></a><a class="link" href="#development">17. Development</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>jooby run</code> tool allows to restart your application on code changes without exiting the JVM.</p>
</div>
<div class="paragraph">
<p>This feature is also known as hot reload/swap. Makes you feel like coding against a script
language where you modify your code and changes are visible immediately.</p>
</div>
<div class="paragraph">
<p>The tool uses the <a href="https://jboss-modules.github.io/jboss-modules/manual" target="_blank">JBoss Modules</a> library
that effectively reload application classes.</p>
</div>
<div class="paragraph">
<p>For now <code>jooby run</code> is available as Maven and Gradle plugins.</p>
</div>
<div class="sect2">
<h3 id="development-usage"><a class="anchor" href="#development-usage"></a><a class="link" href="#development-usage">17.1. Usage</a></h3>
<div class="paragraph">
<p>1) Add build plugin:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">pom.xml</div><div class="switch--item option-2">build.gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x6491a5a995b74c00">&lt;plugins&gt;
  ...
  &lt;plugin&gt;
    &lt;groupId&gt;io.jooby&lt;/groupId&gt;
    &lt;artifactId&gt;jooby-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.0.12&lt;/version&gt;
  &lt;/plugin&gt;
  ...
&lt;/plugins&gt;</code><button class="clipboard" data-clipboard-target="#x6491a5a995b74c00"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xbd897a34f3234e0d">buildscript {
  ext {
    joobyVersion = "4.0.12"
  }
}

plugins {
  id "application"
  id "io.jooby.run" version "4.0.12"
}</code><button class="clipboard" data-clipboard-target="#xbd897a34f3234e0d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>2) Set main class</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">pom.xml</div><div class="switch--item option-2">build.gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xa177e1d2b23d4cd4">&lt;properties&gt;
  &lt;application.class&gt;myapp.App&lt;/application.class&gt;
&lt;/properties&gt;</code><button class="clipboard" data-clipboard-target="#xa177e1d2b23d4cd4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xd14eba33d63d40bd">mainClassName = "myapp.App"</code><button class="clipboard" data-clipboard-target="#xd14eba33d63d40bd"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>3) Run application</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x7c1b9836454045ba">mvn jooby:run</code><button class="clipboard" data-clipboard-target="#x7c1b9836454045ba"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="xc5b83d2fce134093">./gradlew joobyRun</code><button class="clipboard" data-clipboard-target="#xc5b83d2fce134093"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="development-compilation-restart"><a class="anchor" href="#development-compilation-restart"></a><a class="link" href="#development-compilation-restart">17.2. Compilation &amp; Restart</a></h3>
<div class="paragraph">
<p>Changing a <code>java</code> or <code>kt</code> file triggers a compilation request. Compilation is executed by
Maven/Gradle using an incremental build process.</p>
</div>
<div class="paragraph">
<p>If compilation succeed, application is restarted.</p>
</div>
<div class="paragraph">
<p>Compilation errors are printed to the console by Maven/Gradle.</p>
</div>
<div class="paragraph">
<p>Changing a <code>.conf</code>, <code>.properties</code> file triggers just an application restart request. They donâ€™t trigger
a compilation request.</p>
</div>
<div class="paragraph">
<p>Compiler is enabled by default, except for Eclipse users. Plugin checks for <code>.classpath</code> file in
project directory, when found plugin compiler is OFF and let Eclipse compiles the code.</p>
</div>
</div>
<div class="sect2">
<h3 id="development-options"><a class="anchor" href="#development-options"></a><a class="link" href="#development-options">17.3. Options</a></h3>
<div class="paragraph">
<p>The next example shows all the available options with their default values:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">pom.xml</div><div class="switch--item option-2">build.gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x3ca07a5254834f20">&lt;plugins&gt;
  ...
  &lt;plugin&gt;
    &lt;groupId&gt;io.jooby&lt;/groupId&gt;
    &lt;artifactId&gt;jooby-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.0.12&lt;/version&gt;
    &lt;configuration&gt;
      &lt;mainClass&gt;${application.class}&lt;/mainClass&gt;                  <i class="conum" data-value="1"></i><b>(1)</b>
      &lt;restartExtensions&gt;conf,properties,class&lt;/restartExtensions&gt; <i class="conum" data-value="2"></i><b>(2)</b>
      &lt;compileExtensions&gt;java,kt&lt;/compileExtensions&gt;               <i class="conum" data-value="3"></i><b>(3)</b>
      &lt;port&gt;8080&lt;/port&gt;                                            <i class="conum" data-value="4"></i><b>(4)</b>
      &lt;waitTimeBeforeRestart&gt;500&lt;/waitTimeBeforeRestart&gt;           <i class="conum" data-value="5"></i><b>(5)</b>
      &lt;useSingleClassLoader&gt;false&lt;/useSingleClassLoader&gt;           <i class="conum" data-value="6"></i><b>(6)</b>
    &lt;/configuration&gt;
  &lt;/plugin&gt;
  ...
&lt;/plugins&gt;</code><button class="clipboard" data-clipboard-target="#x3ca07a5254834f20"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xf00d1aa6f110484b">buildscript {
  ext {
    joobyVersion = "4.0.12"
  }
}

plugins {
  id "application"
  id "io.jooby.run" version "4.0.12"
}

joobyRun {
  mainClassName = "${mainClassName}"                               <i class="conum" data-value="1"></i><b>(1)</b>
  restartExtensions = ["conf", "properties", "class"]              <i class="conum" data-value="2"></i><b>(2)</b>
  compileExtensions = ["java", "kt"]                               <i class="conum" data-value="3"></i><b>(3)</b>
  port = 8080                                                      <i class="conum" data-value="4"></i><b>(4)</b>
  waitTimeBeforeRestart = 500                                      <i class="conum" data-value="5"></i><b>(5)</b>
  useSingleClassLoader = false                                     <i class="conum" data-value="6"></i><b>(6)</b>
}</code><button class="clipboard" data-clipboard-target="#xf00d1aa6f110484b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Application main class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Restart extensions. A change on these files trigger a restart request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Source extensions. A change on these files trigger a compilation request, followed by a restart request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Application port</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>How long to wait after last file change to restart. Default is: <code>500</code> milliseconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use a single/fat class loader to run your application. This is required on complex project classpath where you start seeing weird reflection errors. This was the default mode in Jooby 2.x. The new model since 3.x uses a modular classloader which improves restart times and memory usage making it faster. Default is: <code>false</code>.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For Maven and Gradle there are two variant <code>mvn jooby:testRun</code> and <code>./gradlew joobyTestRun</code> they work
by expanding the classpath to uses the <code>test</code> scope or source set.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handlers"><a class="anchor" href="#handlers"></a><a class="link" href="#handlers">18. Handlers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes some built-in handler provided by Jooby.</p>
</div>
<div class="sect2">
<h3 id="handlers-accessloghandler"><a class="anchor" href="#handlers-accessloghandler"></a><a class="link" href="#handlers-accessloghandler">18.1. AccessLogHandler</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AccessLogHandler.html" target="_blank">AccessLogHandler</a> logs incoming requests using the <a href="https://en.wikipedia.org/wiki/Common_Log_Format" target="_blank">NCSA format</a> (a.k.a common log format).</p>
</div>
<div class="listingblock primary">
<div class="title">Usage</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe70fabba00d344ed">import io.jooby.Jooby;
import io.jooby.handler.AccessLogHandler;
...
{

  use(new AccessLogHandler()); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xe70fabba00d344ed"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xac7bf1b122914351">import io.jooby.handler.AccessLogHandler
...
{
  use(AccessLogHandler())      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xac7bf1b122914351"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install AccessLogHandler</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Prints a message like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>127.0.0.1 - - [04/Oct/2016:17:51:42 +0000] "GET / HTTP/1.1" 200 2 3</pre>
</div>
</div>
<div class="paragraph">
<p>Message is represented by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remote Address.</p>
</li>
<li>
<p>User ID (or dash when missing)</p>
</li>
<li>
<p>Date and time</p>
</li>
<li>
<p>HTTP method, requestPath and protocol</p>
</li>
<li>
<p>Response Status Code</p>
</li>
<li>
<p>Response Content-Length (or dash when missing)</p>
</li>
<li>
<p>Time took to process the request in milliseconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extra request or response headers can be appended at the end using the available methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AccessLogHandler.html#requestHeader(java.lang.String...)" target="_blank">requestHeader(Stringâ€¦â€‹)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/AccessLogHandler.html#responseHeader(java.lang.String...)" target="_blank">responseHeader(Stringâ€¦â€‹)</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run behind a reverse proxy that has been configured to send the X-Forwarded-* header,
please consider to use <a href="#router-options-routing">trust proxy</a> option.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="handlers-corshandler"><a class="anchor" href="#handlers-corshandler"></a><a class="link" href="#handlers-corshandler">18.2. CorsHandler</a></h3>
<div class="paragraph">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank">Cross-Origin Resource Sharing (CORS)</a> is a mechanism that uses additional HTTP headers to tell a
browser to let a web application running at one origin (domain) have permission to access selected
resources from a server at a different origin. A web application executes a cross-origin HTTP
request when it requests a resource that has a different origin (domain, protocol, or port) than
its own origin.</p>
</div>
<div class="paragraph">
<p>Jooby supports CORS out of the box. By default, <strong>CORS requests will be rejected</strong>.
To enable processing of CORS requests, use the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CorsHandler.html" target="_blank">CorsHandler</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">CorsExample</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7b9a4c9ee4154b58">import io.jooby.Jooby;
import io.jooby.handler.CorsHandler;
...
{

  use(new CorsHandler()); <i class="conum" data-value="1"></i><b>(1)</b>

  path("/api", () -&gt; {
    // API methods
  });
}</code><button class="clipboard" data-clipboard-target="#x7b9a4c9ee4154b58"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x8f579ddbb2f94643">import io.jooby.handler.CorsHandler
...
{
  use(CorsHandler())      <i class="conum" data-value="1"></i><b>(1)</b>

  path("/api") {
    // API methods
  }
}</code><button class="clipboard" data-clipboard-target="#x8f579ddbb2f94643"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install CorsHandler with defaults options</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Default options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>origin: <code>*</code></p>
</li>
<li>
<p>credentials: <code>true</code></p>
</li>
<li>
<p>allowed methods: <code>GET</code>, <code>POST</code></p>
</li>
<li>
<p>allowed headers: <code>X-Requested-With</code>, <code>Content-Type</code>, <code>Accept</code> and <code>Origin</code></p>
</li>
<li>
<p>max age: <code>30m</code>;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To customize default options use <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/Cors.html" target="_blank">Cors</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">Cors options</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x2f04e74e3df7437e">import io.jooby.Jooby;
import io.jooby.handler.Cors;
import io.jooby.handler.CorsHandler;
...
{
  Cors cors = new Cors()
     .setMethods("GET", "POST", "PUT");      <i class="conum" data-value="1"></i><b>(1)</b>

  use(new CorsHandler(cors));          <i class="conum" data-value="2"></i><b>(2)</b>

  path("/api", () -&gt; {
    // API methods
  });
}</code><button class="clipboard" data-clipboard-target="#x2f04e74e3df7437e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xbf0b721851544526">import io.jooby.Jooby
import io.jooby.handler.CorsHandler
import io.jooby.cors
...
{
  val cors = cors {
    methods = listOf("GET", "POST", "PUT")   <i class="conum" data-value="1"></i><b>(1)</b>
  }
  use(CorsHandler(cors))               <i class="conum" data-value="2"></i><b>(2)</b>

  path("/api") {
    // API methods
  }
}</code><button class="clipboard" data-clipboard-target="#xbf0b721851544526"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify allowed methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass cors options to cors handler</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Optionally cors options can be specified in the application configuration file:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="x140f088b61e844ce">cors {
  origin: "*"
  credentials: true
  methods: [GET, POST],
  headers: [Content-Type],
  maxAge: 30m
  exposedHeaders: [Custom-Header]
}</code><button class="clipboard" data-clipboard-target="#x140f088b61e844ce"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Loading options</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf73ea7752e314780">import io.jooby.Jooby;
import io.jooby.handler.Cors;
import io.jooby.handler.CorsHandler;
...
{
  Cors cors = Cors.from(getConfig());  <i class="conum" data-value="1"></i><b>(1)</b>

  use(new CorsHandler(cors));

  path("/api", () -&gt; {
    // API methods
  });
}</code><button class="clipboard" data-clipboard-target="#xf73ea7752e314780"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x9928bd29a2764f93">import io.jooby.Jooby
import io.jooby.handler.CorsHandler
...
{
  val cors = Cors.from(config)         <i class="conum" data-value="1"></i><b>(1)</b>
  use(CorsHandler(cors))

  path("/api") {
    // API methods
  }
}</code><button class="clipboard" data-clipboard-target="#x9928bd29a2764f93"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load cors options from application configuration file</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="handlers-csrfhandler"><a class="anchor" href="#handlers-csrfhandler"></a><a class="link" href="#handlers-csrfhandler">18.3. CsrfHandler</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CsrfHandler.html" target="_blank">Cross Site Request Forgery Handler</a> helps to protect from (CSRF)
attacks. Cross-site request forgeries are a type of malicious exploit whereby unauthorized commands
are performed on behalf of an authenticated user.</p>
</div>
<div class="paragraph">
<p>Jooby automatically generates a CSRF "token" for each active user session managed by the
application. This token is used to verify that the authenticated user is the one actually making
the requests to the application.</p>
</div>
<div class="paragraph">
<p>Anytime you define an HTML form in your application, you should include a hidden CSRF token
field in the form so that the CSRF protection middleware can validate the request</p>
</div>
<div class="listingblock">
<div class="title">CSRF</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html" id="x8e4324883269498f">&lt;form method="POST" action="..."&gt;
    &lt;input name="csrf" value="{{csrf}}" type="hidden" /&gt;
    ...
&lt;/form&gt;</code><button class="clipboard" data-clipboard-target="#x8e4324883269498f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>csrf</code> is a request attribute created by the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CsrfHandler.html" target="_blank">CsrfHandler</a> handler and rendered by a
template engine. Here <code>{{csrf}}</code> we use Handlebars template engine (as example).</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CsrfHandler.html" target="_blank">CsrfHandler</a> handler, will automatically verify that the token in the request input
matches the token stored in the session.</p>
</div>
<div class="paragraph">
<p>The token defaults name is <code>csrf</code> and can be provided as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>header</p>
</li>
<li>
<p>cookie</p>
</li>
<li>
<p>form parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CsrfHandler.html#setTokenGenerator(java.util.function.Function)" target="_blank">setTokenGenerator(Function)</a>: Set a custom token generator. Defaults uses a random UUID.</p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/CsrfHandler.html#setRequestFilter(java.util.function.Predicate)" target="_blank">setRequestFilter(Predicate)</a>: Set a custom request filter. Defaults is to process <code>POST</code>, <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="handlers-gracefulshutdown"><a class="anchor" href="#handlers-gracefulshutdown"></a><a class="link" href="#handlers-gracefulshutdown">18.4. GracefulShutdown</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/GracefulShutdown.html" target="_blank">GracefulShutdown</a> extension waits for existing requests to finish.</p>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xffab60a3f1b047ca">import io.jooby.Jooby;
import io.jooby.GracefulShutdown;
...
{

  install(new GracefulShutdown()); <i class="conum" data-value="1"></i><b>(1)</b>

  // other routes go here
}</code><button class="clipboard" data-clipboard-target="#xffab60a3f1b047ca"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x49bb058702a247ff">import io.jooby.GracefulShutdown
...
{
  install(GracefulShutdown())      <i class="conum" data-value="1"></i><b>(1)</b>

  // other routes go here
}</code><button class="clipboard" data-clipboard-target="#x49bb058702a247ff"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install GracefulShutdown.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Incoming request are resolved as <code>Service Unavailable(503)</code>. Optionally you can specify a max
amount of time to wait before shutdown:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>install(new GracefulShutdown(Duration.ofMinutes(1)));</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This extension must be installed at very beginning of your route pipeline.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handlers-headhandler"><a class="anchor" href="#handlers-headhandler"></a><a class="link" href="#handlers-headhandler">18.5. HeadHandler</a></h3>
<div class="paragraph">
<p>Jooby doesnâ€™t support <code>HTTP HEAD</code> requests by default. To support them you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the built-in <code>HeadHandler</code></p>
</li>
<li>
<p>Write your own head handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/HeadHandler.html" target="_blank">HeadHandler</a> supports <code>HEAD</code> requests over existing <code>GET</code> handlers.</p>
</div>
<div class="listingblock primary">
<div class="title">Head Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xdead6948d5ce4143">import io.jooby.Jooby;
import io.jooby.handler.HeadHandler;
...
{

  use(new HeadHandler()); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#xdead6948d5ce4143"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x80801496baba4dd8">import io.jooby.HeadHandler
...
{
  use(HeadHandler())      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x80801496baba4dd8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install HeadHandler</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>HEAD /</code> produces an empty response with a <code>Content-Length</code> header (when possible) and any other
header produce it by the <code>GET</code> handler.</p>
</div>
<div class="paragraph">
<p>The <code>GET</code> handler is executed but produces an empty response.</p>
</div>
</div>
<div class="sect2">
<h3 id="handlers-ratelimithandler"><a class="anchor" href="#handlers-ratelimithandler"></a><a class="link" href="#handlers-ratelimithandler">18.6. RateLimitHandler</a></h3>
<div class="paragraph">
<p>Rate limit handler using <a href="https://github.com/vladimir-bukhtoyarov/bucket4j" target="_blank">Bucket4j</a>.</p>
</div>
<div class="paragraph">
<p>Add the dependency to your project:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x1b1c9c1ed5c94689">&lt;dependency&gt;
  &lt;groupId&gt;com.bucket4j&lt;/groupId&gt;
  &lt;artifactId&gt;bucket4j_jdk17-core&lt;/artifactId&gt;
  &lt;version&gt;8.15.0&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x1b1c9c1ed5c94689"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x62d63c2bdc7e4b9b">implementation 'com.bucket4j:bucket4j_jdk17-core:8.15.0'</code><button class="clipboard" data-clipboard-target="#x62d63c2bdc7e4b9b"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">10 requests per minute</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x995388e923ff4cf3">{
  Bandwidth limit = Bandwidth.simple(10, Duration.ofMinutes(1));
  Bucket bucket = Bucket4j.builder().addLimit(limit).build();     <i class="conum" data-value="1"></i><b>(1)</b>

  before(new RateLimitHandler(bucket));                           <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x995388e923ff4cf3"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x4b7be99cb8094c88">{
  val limit = Bandwidth.simple(10, Duration.ofMinutes(1))
  val bucket = Bucket4j.builder().addLimit(limit).build()         <i class="conum" data-value="1"></i><b>(1)</b>

  before(RateLimitHandler(bucket))                                <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x4b7be99cb8094c88"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Install the RateLimitHandler</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">10 requests per minute per ip/remote address</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xf8ab65dc6a444f56">{
  before(new RateLimitHandler(remoteAddress -&gt; {
    Bandwidth limit = Bandwidth.simple(10, Duration.ofMinutes(1));
    return Bucket4j.builder().addLimit(limit).build();
  }));
}</code><button class="clipboard" data-clipboard-target="#xf8ab65dc6a444f56"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x544e9705066b4f62">{
  before(RateLimitHandler {remoteAddress -&gt;
    val limit = Bandwidth.simple(10, Duration.ofMinutes(1))
    Bucket4j.builder().addLimit(limit).build()
  })
}</code><button class="clipboard" data-clipboard-target="#x544e9705066b4f62"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">10 requests per minute per header value</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xaf38e8a28a1a4fc1">{
  before(new RateLimitHandler(key -&gt; {
    Bandwidth limit = Bandwidth.simple(10, Duration.ofMinutes(1));
    return Bucket4j.builder().addLimit(limit).build();
  }, "ApiKey"));
}</code><button class="clipboard" data-clipboard-target="#xaf38e8a28a1a4fc1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x3086634ecef74fa4">{
  before(RateLimitHandler {key -&gt;
    val limit = Bandwidth.simple(10, Duration.ofMinutes(1))
    Bucket4j.builder().addLimit(limit).build()
  }, "ApiKey")
}</code><button class="clipboard" data-clipboard-target="#x3086634ecef74fa4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">10 requests per minute</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x5eddc47a2b0d48e6">{
  Bandwidth limit = Bandwidth.simple(10, Duration.ofMinutes(1));
  Bucket bucket = Bucket4j.builder().addLimit(limit).build();     <i class="conum" data-value="1"></i><b>(1)</b>

  before(new RateLimitHandler(bucket));                           <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x5eddc47a2b0d48e6"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x2c976c38ca23410a">{
  val limit = Bandwidth.simple(10, Duration.ofMinutes(1))
  val bucket = Bucket4j.builder().addLimit(limit).build()         <i class="conum" data-value="1"></i><b>(1)</b>

  before(RateLimitHandler(bucket))                                <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard" data-clipboard-target="#x2c976c38ca23410a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Install the RateLimitHandler</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Rate limit in a cluster</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3c27ffde78824d54">{
  ProxyManager&lt;String&gt; buckets = ...;
  before(RateLimitHandler.cluster(key -&gt; {
    return buckets.getProxy(key, () -&gt; {
      return ...;
    });
  }));
}</code><button class="clipboard" data-clipboard-target="#x3c27ffde78824d54"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xe2f9add737834acb">{
  val buckets = ...;
  before(RateLimitHandler.cluster {key -&gt;
    buckets.getProxy(key) {
      ....
    }
  })
}</code><button class="clipboard" data-clipboard-target="#xe2f9add737834acb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For using it inside a cluster you need to configure one of the bucket4j options for <a href="https://github.com/vladimir-bukhtoyarov/bucket4j#supported-back-ends" target="_blank">clustering</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="handlers-sslhandler"><a class="anchor" href="#handlers-sslhandler"></a><a class="link" href="#handlers-sslhandler">18.7. SSLHandler</a></h3>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/SSLHandler.html" target="_blank">SSLHandler</a> forces client to use HTTPS by redirecting non-HTTPS calls to the HTTPS version.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#server-https-support">configure ssl</a> to see how to setup SSL in your project.</p>
</div>
<div class="listingblock primary">
<div class="title">Force SSL</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x4879e6218e9743b0">import io.jooby.Jooby;
import io.jooby.handler.SSLHandler;
...
{

  before(new SSLHandler()); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    return ctx.getScheme();
  });
}</code><button class="clipboard" data-clipboard-target="#x4879e6218e9743b0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd77930a0ef11477d">import io.jooby.Jooby
import io.jooby.handler.SSHandler
...
{
  before(SSLHandler())      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#xd77930a0ef11477d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install SSLHandler</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The SSL Handler recreates the HTTPs URL version using the <code>Host</code> header, if you are behind a proxy
you will need to use the <code>X-Forwarded-Host</code> header. To do that set the <a href="#router-options-routing">trust proxy</a> option.</p>
</div>
<div class="paragraph">
<p>Optionally, you can specify the host to use:</p>
</div>
<div class="listingblock primary">
<div class="title">Force SSL</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd6513f9d32d34b89">import io.jooby.Jooby;
import io.jooby.handler.SSLHandler;
...
{

  before(new SSLHandler("myhost.org")); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    return ctx.getScheme();
  });
}</code><button class="clipboard" data-clipboard-target="#xd6513f9d32d34b89"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x74de7c9394734b8c">import io.jooby.Jooby
import io.jooby.handler.SSHandler
...
{

  before(SSLHandler("myhost.org"))      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    ctx.scheme
  }
}</code><button class="clipboard" data-clipboard-target="#x74de7c9394734b8c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>For more information about SSL, please check the <a href="#server-https-support">configure SSL</a> section.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run behind a reverse proxy that has been configured to send the X-Forwarded-* header,
please consider adding the <a href="#router-options-routing">trust proxy</a> to your pipeline.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="handlers-tracehandler"><a class="anchor" href="#handlers-tracehandler"></a><a class="link" href="#handlers-tracehandler">18.8. TraceHandler</a></h3>
<div class="paragraph">
<p>Jooby doesnâ€™t support <code>HTTP Trace</code> requests by default. To support them you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the built-in <code>TraceHandler</code></p>
</li>
<li>
<p>Write your own trace handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/handler/TraceHandler.html" target="_blank">TraceHandler</a> supports <code>TRACE</code> requests over existing handlers.</p>
</div>
<div class="listingblock primary">
<div class="title">Head Example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x425872f626f14ada">import io.jooby.Jooby;
import io.jooby.handler.TraceHandler;
...
{

  use(new TraceHandler()); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/", ctx -&gt; {
    ...
  });
}</code><button class="clipboard" data-clipboard-target="#x425872f626f14ada"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x960a700e411044eb">import io.jooby.Jooby
import io.jooby.handler.TraceHandler
...
{
  use(TraceHandler())      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/") {
    ...
  }
}</code><button class="clipboard" data-clipboard-target="#x960a700e411044eb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install TraceHandler</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>TRACE /</code> performs a message loop-back test along the path to the target resource, providing a
useful debugging mechanism.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging"><a class="anchor" href="#packaging"></a><a class="link" href="#packaging">19. Packaging</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes some packaging and distribution options.</p>
</div>
<div class="sect2">
<h3 id="packaging-single-jar"><a class="anchor" href="#packaging-single-jar"></a><a class="link" href="#packaging-single-jar">19.1. Single jar</a></h3>
<div class="paragraph">
<p>This is the default deployment option where you create a single jar (a.k.a fat/uber jar) for your
application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="/#getting-started">jooby-cli</a> takes care of configures everything for single jar
distribution. Next example shows how to do it in case you created your application manually.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x19847663cecb4b3e">&lt;build&gt;
  &lt;plugins&gt;
    ...
    &lt;plugin&gt;
        &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.6.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;uber-jar&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;shade&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;createDependencyReducedPom&gt;false&lt;/createDependencyReducedPom&gt;
              &lt;transformers&gt;
                &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/&gt;
                &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
                  &lt;mainClass&gt;${application.class}&lt;/mainClass&gt;
                &lt;/transformer&gt;
              &lt;/transformers&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    ...
  &lt;/plugins&gt;
&lt;/build&gt;</code><button class="clipboard" data-clipboard-target="#x19847663cecb4b3e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy" id="x100d6b88c52549ea">plugins {
  ...
  id "com.github.johnrengelman.shadow" version "5.2.0"
  ...
}

...

shadowJar {
  mergeServiceFiles()
}</code><button class="clipboard" data-clipboard-target="#x100d6b88c52549ea"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Maven users:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn clean package</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle users:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./gradlew shadowJar</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packaging-stork"><a class="anchor" href="#packaging-stork"></a><a class="link" href="#packaging-stork">19.2. Stork</a></h3>
<div class="paragraph">
<p><a href="https://github.com/fizzed/stork" target="_blank">Stork</a> is packaging, launch and deploy tool for Java apps.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Stork is only available for Maven projects</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To configure stork:</p>
</div>
<div class="paragraph">
<p>1) Creates a <code>src/etc/stork/stork.yml</code> file (file location is important):</p>
</div>
<div class="listingblock">
<div class="title">stork.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml" id="xc7842bb372ac4c71"># Name of application (make sure it has no spaces)
name: "${project.artifactId}"

# Display name of application (can have spaces)
display_name: "${project.name}"

# Type of launcher (CONSOLE or DAEMON)
type: DAEMON

# Java class to run
main_class: "${application.class}"

domain: "${project.groupId}"

short_description: "${project.artifactId}"

# Platform launchers to generate (WINDOWS, LINUX, MAC_OSX)
# Linux launcher is suitable for Bourne shells (e.g. Linux/BSD)
platforms: [ LINUX ]

# Working directory for app
# RETAIN will not change the working directory
# APP_HOME will change the working directory to the home of the app
# (where it was intalled) before running the main class
working_dir_mode: RETAIN

# Minimum version of java required (system will be searched for acceptable jvm)
min_java_version: "1.8"

# Min/max fixed memory (measured in MB)
min_java_memory: 512
max_java_memory: 512

# Min/max memory by percentage of system
#min_java_memory_pct: 10
#max_java_memory_pct: 20

# Try to create a symbolic link to java executable in &lt;app_home&gt;/run with
# the name of "&lt;app_name&gt;-java" so that commands like "ps" will make it
# easier to find your app
symlink_java: true</code><button class="clipboard" data-clipboard-target="#xc7842bb372ac4c71"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>2) Configure <a href="https://github.com/repaint-io/maven-tiles" target="_blank">Maven Tiles</a> plugin:</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x758485d8405b4a00">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;io.repaint.maven&lt;/groupId&gt;
        &lt;artifactId&gt;tiles-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.41&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;tiles&gt;
            &lt;tile&gt;io.jooby:jooby-stork:4.0.12&lt;/tile&gt;
          &lt;/tiles&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code><button class="clipboard" data-clipboard-target="#x758485d8405b4a00"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>3) Run <code>mvn package</code></p>
</div>
<div class="paragraph">
<p>Stork zip file will be available in the <code>target</code> directory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server"><a class="anchor" href="#server"></a><a class="link" href="#server">20. Server</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three server implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby-jetty/latest/io.jooby.jetty/io/jooby/jetty/JettyServer.html" target="_blank">JettyServer</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby-netty/latest/io.jooby.netty/io/jooby/netty/NettyServer.html" target="_blank">NettyServer</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby-vertx/latest/io.jooby.vertx/io/jooby/vertx/VertxServer.html" target="_blank">VertxServer</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby-undertow/latest/io.jooby.undertow/io/jooby/undertow/UndertowServer.html" target="_blank">UndertowServer</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Servers are automatically registered based on their presence on the project classpath.</p>
</div>
<div class="paragraph">
<p>To use Jetty, add the dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xc18bca6e28224398">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-jetty&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#xc18bca6e28224398"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="xfcda8e3a2a5841ef">implementation 'io.jooby:jooby-jetty:4.0.12'</code><button class="clipboard" data-clipboard-target="#xfcda8e3a2a5841ef"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>To use Netty, add the dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x37b07c0a95054a4c">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-netty&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x37b07c0a95054a4c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x7d050b109859499d">implementation 'io.jooby:jooby-netty:4.0.12'</code><button class="clipboard" data-clipboard-target="#x7d050b109859499d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>To use Undertow, add the dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x1c3bf04b392446a">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-undertow&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x1c3bf04b392446a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x7f163bd5bfc3489d">implementation 'io.jooby:jooby-undertow:4.0.12'</code><button class="clipboard" data-clipboard-target="#x7f163bd5bfc3489d"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>To use Vertx, add the dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xebd6b561c0064ede">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-vertx&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#xebd6b561c0064ede"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x7aed9b49d3d547fb">implementation 'io.jooby:jooby-vertx:4.0.12'</code><button class="clipboard" data-clipboard-target="#x7aed9b49d3d547fb"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/vertx/VertxServer.html" target="_blank">VertxServer</a> setup is fully described <a href="/modules/vertx#vertx-server-advanced">here</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only one server dependency must be available on classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="server-run-multiple-apps"><a class="anchor" href="#server-run-multiple-apps"></a><a class="link" href="#server-run-multiple-apps">20.1. Run multiple apps</a></h3>
<div class="paragraph">
<p>All the code examples show how to run a single application on server. Servers allow running multiple
applications.</p>
</div>
<div class="listingblock primary">
<div class="title">Server</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x18b5c9b128784aa7">import io.jooby.netty.NettyServer;

public static void main(String[] args) {
  runApp(args, new NettyServer(), List.of(FooApp::new, BarApp::new));
}</code><button class="clipboard" data-clipboard-target="#x18b5c9b128784aa7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x65bbd27a2e1a49b1">import io.jooby.netty.NettyServer

fun main(args: Array&lt;String&gt;) {
  runApp(args, NettyServer(), ::FooApp, ::BarApp)
}</code><button class="clipboard" data-clipboard-target="#x65bbd27a2e1a49b1"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Some things to keep in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application configuration file must NOT define server properties more than once. If they do, the
first setup wins.</p>
</li>
<li>
<p>Log configuration file must be provided by command line or system property.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="server-manual-setup"><a class="anchor" href="#server-manual-setup"></a><a class="link" href="#server-manual-setup">20.2. Manual setup</a></h3>
<div class="paragraph">
<p>Servers are automatically loaded using <code>ServiceLoader</code> API:</p>
</div>
<div class="listingblock primary">
<div class="title">Server</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xe3d756a452cb46f5">import io.jooby.netty.NettyServer;

public static void main(String[] args) {
  runApp(args, new NettyServer(), App::new);
}</code><button class="clipboard" data-clipboard-target="#xe3d756a452cb46f5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x5a9b2c6dc1024470">import io.jooby.netty.NettyServer

fun main(args: Array&lt;String&gt;) {
  runApp(args, NettyServer(), ::App)
}</code><button class="clipboard" data-clipboard-target="#x5a9b2c6dc1024470"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Server might or might not provide way to configure it (depends on Server). For example <code>JettyServer</code>
let you customize the <code>ThreadPool</code>, here is an example to setup Jetty with Loom(Virtual Threads):</p>
</div>
<div class="listingblock primary">
<div class="title">Jetty Loom</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xcb3f31b1bfc74034">import io.jooby.jetty.JettyServer;

import java.util.concurrent.Executors;

import org.eclipse.jetty.util.thread.QueuedThreadPool;

public static void main(String[] args) {
  // Use virtual Thread in Java 19 with --enable-preview
  var worker = new QueuedThreadPool();
  worker.setReservedThreads(0);
  worker.setVirtualThreadsExecutor(Executors.newVirtualThreadPerTaskExecutor());

  runApp(args, new JettyServer(worker), App::new);
}</code><button class="clipboard" data-clipboard-target="#xcb3f31b1bfc74034"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x97d5c78afa4a4943">import io.jooby.jetty.JettyServer

import java.util.concurrent.Executors

import org.eclipse.jetty.util.thread.QueuedThreadPool


fun main(args: Array&lt;String&gt;) {
  // Use virtual Thread in Java 19 with --enable-preview
  val worker = QueuedThreadPool()
  worker.reservedThreads = 0
  worker.virtualThreadsExecutor = Executors.newVirtualThreadPerTaskExecutor()

  runApp(args, JettyServer(worker), ::App)
}</code><button class="clipboard" data-clipboard-target="#x97d5c78afa4a4943"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="server-options"><a class="anchor" href="#server-options"></a><a class="link" href="#server-options">20.3. Options</a></h3>
<div class="paragraph">
<p>Server options are available via <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/ServerOptions.html" target="_blank">ServerOptions</a> class:</p>
</div>
<div class="listingblock primary">
<div class="title">Server Options</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xd2efb922865d4088">{
  var options = new ServerOptions()
      .setOutput(OutputOptions.defaults())
      .setCompressionLevel(6)
      .setPort(8080)
      .setIoThreads(16)
      .setWorkerThreads(64)
      .setGzip(false)
      .setSingleLoop(false)
      .setDefaultHeaders(true)
      .setMaxRequestSize(10485760)
      .setSecurePort(8433)
      .setSsl(SslOptions.selfSigned())
      .setHttpsOnly(false)
      .setHttp2(true)
      .setExpectContinue(true);
}</code><button class="clipboard" data-clipboard-target="#xd2efb922865d4088"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x55d86e2bf13e498a">{
  val options = ServerOptions().appy {
    output.size = 16384
    output.useDirectBuffers = true
    compressionLevel = 6
    port = 8080
    ioThreads = 16
    workerThreads = 64
    gzip = false
    singleLoop = false
    defaultHeaders = true
    maxRequestSize = 10485760
    securePort = 8443
    ssl = SslOptions.selfSigned()
    isHttpsOnly = true
    isHttp2 = true
    isExpectContinue = true
  }
}</code><button class="clipboard" data-clipboard-target="#x55d86e2bf13e498a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="ulist">
<ul>
<li>
<p>output.size: Buffer size used by server for reading/writing data. Default is: <code>16k</code>.</p>
</li>
<li>
<p>compressionLevel: Gzip support. Set compression level. Value between: <code>0..9</code>.</p>
</li>
<li>
<p>port: Server HTTP port or <code>0</code> for random port. Default is: <code>8080</code>.</p>
</li>
<li>
<p>ioThreads: Number of IO threads used by the server. Used by Netty and Undertow. Default is: <code>Runtime.getRuntime().availableProcessors() * 2</code></p>
</li>
<li>
<p>workerThreads: Number of worker (a.k.a application) threads. Default is: <code>ioThreads * 8</code>.</p>
</li>
<li>
<p>gzip: Gzip support. Default is: <code>false</code>. Deprecated in favor of <strong>compressionLevel</strong>.</p>
</li>
<li>
<p>singleLoop: Indicates if the web server should use a single loop/group for doing IO or not. <strong>Netty only</strong>.</p>
</li>
<li>
<p>defaultHeaders: Configure server to set the following headers: <code>Date</code>, <code>Content-Type</code> and <code>Server</code> headers.</p>
</li>
<li>
<p>maxRequestSize: Maximum request size in bytes. Request exceeding this value results in 413(REQUEST_ENTITY_TOO_LARGE) response. Default is <code>10mb</code>.</p>
</li>
<li>
<p>securePort: Enable HTTPS. This option is fully covered in next section.</p>
</li>
<li>
<p>ssl: SSL options with certificate details. This option is fully covered in next section.</p>
</li>
<li>
<p>isHttpsOnly: bind only to HTTPS port, not HTTP. This requires SSL options to be configured.</p>
</li>
<li>
<p>isHttp2: Enable HTTP 2.0.</p>
</li>
<li>
<p>isExpectContinue: Whenever 100-Expect and continue requests are handled by the server. This is off
by default, except for Jetty which is always ON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For single application deployment server options are available as application configuration properties too:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties" id="xd50af492a854c71">server.output.size = 16384
server.output.useDirectBuffers = true
server.compressionLevel = 6
server.port = 8080
server.ioThreads = 16
server.workerThreads = 64
server.gzip = false
server.singleLoop = false
server.defaultHeaders = true
server.maxRequestSize = 10485760
server.securePort = 8443
server.ssl.type = self-signed | PKCS12 | X509
server.httpsOnly = false
server.http2 = true
server.expectContinue = false</code><button class="clipboard" data-clipboard-target="#xd50af492a854c71"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-https-support"><a class="anchor" href="#server-https-support"></a><a class="link" href="#server-https-support">20.4. HTTPS Support</a></h3>
<div class="paragraph">
<p>Jooby supports HTTPS out of the box. By default HTTPS is disabled and all requests are served using
HTTP. Jooby supports two certificate formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PKCS12 (this is the default format)</p>
</li>
<li>
<p>X.509</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/SslOptions.html" target="_blank">SslOptions</a> class provides options to configure SSL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cert: A PKCS12 or X.509 certificate chain file in PEM format. Most commonly, a .crt file for X509 and .p12 for PKCS12. It can be an absolute path or a classpath resource. Required.</p>
</li>
<li>
<p>key:  A PKCS#8 private key file in PEM format. Most commonly a .key file. It can be an absolute path or a classpath resource. Required when using X.509 certificates.</p>
</li>
<li>
<p>password: Password to use. Required when using PKCS12 certificates.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Hello HTTPS</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3862cbbe7c9f4085">public static void main(String[] args) {
  var options = new ServerOptions().setSecurePort(8443); <i class="conum" data-value="1"></i><b>(1)</b>
  runApp(args, new NettyServer(options), App::new);
}</code><button class="clipboard" data-clipboard-target="#x3862cbbe7c9f4085"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x71711b1772544d51">fun main(args: Array&lt;String&gt;) {
  var options = ServerOptions().setSecurePort(8443)      <i class="conum" data-value="1"></i><b>(1)</b>
  runApp(args, NettyServer(options), ::App)
}</code><button class="clipboard" data-clipboard-target="#x71711b1772544d51"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set secure port and use a self-signed certificate</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once SSL is enabled application logs print something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>listening on:
  http://localhost:8080/
  https://localhost:8443/</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>self-signed</code> certificate is useful for development but keep in mind it will generate a warning on the browser.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/self-signed-not-secure.png" alt="Not Secure">
</div>
</div>
<div class="paragraph">
<p>A better option for development is the <a href="https://mkcert.dev" target="_blank">mkcert</a> tool:</p>
</div>
<div class="listingblock " primary>
<div class="title">Generates a PKCS12 certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x2584542522fd461e">mkcert -pkcs12 localhost</code><button class="clipboard" data-clipboard-target="#x2584542522fd461e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Generates a X.509 certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash" id="x80c560a195bc4e14">mkcert localhost</code><button class="clipboard" data-clipboard-target="#x80c560a195bc4e14"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="sect3">
<h4 id="server-https-support-using-x"><a class="anchor" href="#server-https-support-using-x"></a><a class="link" href="#server-https-support-using-x">20.4.1. Using X.509</a></h4>
<div class="paragraph">
<p>To use a valid X.509 certificate, for example one created with <a href="https://letsencrypt.org/" target="_blank">Letâ€™s Encrypt</a>. You will need the <code><strong>.crt</strong></code><strong> and <code></code></strong><code>.key</code> files:</p>
</div>
<div class="listingblock primary">
<div class="title">X509</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xad4cf375864a4b8e">import io.jooby.netty.NettyServer;

public static void main(String[] args) {
  var ssl = SslOptions.x509("path/to/server.crt", "path/to/server.key");
  var options = new ServerOptions().setSsl(ssl);
  runApp(args, new NettyServer(options), App::new);
}</code><button class="clipboard" data-clipboard-target="#xad4cf375864a4b8e"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x65738210589149a4">import io.jooby.netty.NettyServer

fun main(args: Array&lt;String&gt;) {
  val ssl = SslOptions.x509("path/to/server.crt", "path/to/server.key")
  val options = ServerOptions().setSsl(ssl)
  runApp(args, NettyServer(options), ::App)
}</code><button class="clipboard" data-clipboard-target="#x65738210589149a4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a SslOptions using X509 certificates path</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Certificate (.crt) and private key (.key) location can be file system or class path locations.</p>
</div>
<div class="paragraph">
<p>Optionally you can define the SSL options in your application configuration file:</p>
</div>
<div class="listingblock">
<div class="title">Ssl options:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="x7b1380ff01704e38">server {
  ssl {
    type: X509,
    cert: "path/to/server.crt",
    key: "path/to/server.key"
  }
}</code><button class="clipboard" data-clipboard-target="#x7b1380ff01704e38"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">X509 from configuration</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x90c0aee0ba5c419a">{
  var options = new ServerOptions()
      .setSsl(SslOptions.from(getConfig()).get());
}</code><button class="clipboard" data-clipboard-target="#x90c0aee0ba5c419a"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd643d2e9bbf34d7f">{
  val options = ServerOptions()
      .setSsl(SslOptions.from(config).get())
}</code><button class="clipboard" data-clipboard-target="#xd643d2e9bbf34d7f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="server-https-support-using-pkcs12"><a class="anchor" href="#server-https-support-using-pkcs12"></a><a class="link" href="#server-https-support-using-pkcs12">20.4.2. Using PKCS12</a></h4>
<div class="paragraph">
<p>To use a valid PKCS12 certificate:</p>
</div>
<div class="listingblock primary">
<div class="title">PKCS12</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7e9e8f03c8424df7">{
  var ssl = SslOptions.pkcs12("path/to/server.p12", "password"); <i class="conum" data-value="1"></i><b>(1)</b>
  var options = new ServerOptions().setSsl(ssl);
}</code><button class="clipboard" data-clipboard-target="#x7e9e8f03c8424df7"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x106c84dbe6124ce5">{
  val ssl = SslOptions.pkcs12("path/to/server.p12", "password")      <i class="conum" data-value="1"></i><b>(1)</b>
  val options = ServerOptions().setSsl(ssl)
}</code><button class="clipboard" data-clipboard-target="#x106c84dbe6124ce5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates SslOptions using PKCS12 certificates path</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Certificate (.p12) location can be file system or class path locations.</p>
</div>
<div class="paragraph">
<p>Optionally you can define the SSL options in your application configuration file:</p>
</div>
<div class="listingblock">
<div class="title">Ssl options:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="x74ff5a5fcb844d08">server {
  ssl {
    type: PKCS12,
    cert: "path/to/server.p12",
    password: "password"
  }
}</code><button class="clipboard" data-clipboard-target="#x74ff5a5fcb844d08"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">PKCS12 from configuration</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x38a7075599d44317">{
  var options = new ServerOptions()
      .setSsl(SslOptions.from(getConfig()).get());
}</code><button class="clipboard" data-clipboard-target="#x38a7075599d44317"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xd99ed4b917944343">{
  val options = ServerOptions()
      .setSsl(SslOptions.from(config).get())
}</code><button class="clipboard" data-clipboard-target="#xd99ed4b917944343"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="server-https-support-client-authentication-mutual-tls"><a class="anchor" href="#server-https-support-client-authentication-mutual-tls"></a><a class="link" href="#server-https-support-client-authentication-mutual-tls">20.4.3. Client Authentication (Mutual TLS)</a></h4>
<div class="paragraph">
<p>To enable 2-way TLS (Mutual TLS), set the trust certificate and client authentication. Setting the trust certificate is required if using self-signed or custom generated certificates so that the server will trust the clientâ€™s certificate signing authority.</p>
</div>
<div class="listingblock primary">
<div class="title">Client Authentication</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x3c19a602d3f549ce">{
  var ssl = SslOptions.pkcs12("path/to/server.p12", "password")
    .setTrustCert(Files.newInputStream("path/to/trustCert")) <i class="conum" data-value="1"></i><b>(1)</b>
    .setTrustPassword("password") <i class="conum" data-value="2"></i><b>(2)</b>
    .setClientAuth(SslOptions.ClientAuth.REQUIRED); <i class="conum" data-value="3"></i><b>(3)</b>

  var options = new ServerOptions().setSsl(ssl);
}</code><button class="clipboard" data-clipboard-target="#x3c19a602d3f549ce"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x88d0a14d96e4819">{
  val ssl = SslOptions.pkcs12("path/to/server.p12", "password")
      .trustCert(Files.newInputStream("path/to/trustCert")) <i class="conum" data-value="1"></i><b>(1)</b>
      .trustPassword("password") <i class="conum" data-value="2"></i><b>(2)</b>
      .clientAuth(SslOptions.ClientAuth.REQUIRED) <i class="conum" data-value="3"></i><b>(3)</b>

  val options = ServerOptions().setSsl(ssl)
}</code><button class="clipboard" data-clipboard-target="#x88d0a14d96e4819"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the trust certificate path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the trust certificate password.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the client authentication mode. Possible values are REQUIRED, REQUESTED, or NONE. Default is NONE.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Optionally you can define these SSL options in your application configuration file:</p>
</div>
<div class="listingblock">
<div class="title">Ssl options:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" id="xe659f6143684453f">server {
  ssl {
    type: PKCS12,
    cert: "path/to/server.p12",
    password: "password",
    trust {
      cert: "path/to/trustCert",
      password: "password"
    }
    clientAuth: REQUIRED
  }
}</code><button class="clipboard" data-clipboard-target="#xe659f6143684453f"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Mutual TLS from configuration</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x8461c17a430c46e0">{
  var options = new ServerOptions()
      .setSsl(SslOptions.from(config).get());
}</code><button class="clipboard" data-clipboard-target="#x8461c17a430c46e0"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="x93b680741f654edc">{
  val options = ServerOptions()
      .setSsl(SslOptions.from(config).get())
}</code><button class="clipboard" data-clipboard-target="#x93b680741f654edc"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="server-https-support-tls-protocol"><a class="anchor" href="#server-https-support-tls-protocol"></a><a class="link" href="#server-https-support-tls-protocol">20.4.4. TLS protocol</a></h4>
<div class="paragraph">
<p>Default protocol is <code>TLSv1.3, TLSv1.2</code>. To override, just do:</p>
</div>
<div class="listingblock primary">
<div class="title">TLS example</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x47ad968550474e72">{
  var options = new ServerOptions()
      .setSsl(new SslOptions().setProtocol("TLSv1.3", "TLSv1.2"));
}</code><button class="clipboard" data-clipboard-target="#x47ad968550474e72"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xc4f7ad6d4b68442c">{
  val options = ServerOptions()
    .setSsl(SslOptions().apply {
      protocol = listOf("TLSv1.3", "TLSv1.2")
    })
}</code><button class="clipboard" data-clipboard-target="#xc4f7ad6d4b68442c"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>If a listed protocol is not supported, it is ignored; however, if you specify a list of protocols,
none of which are supported, an exception will be thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TLSv1.3 protocol is available in</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open SSL via Conscrypt (see next section)</p>
</li>
<li>
<p>Java 11.0.3 or higher.</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="server-https-support-openssl"><a class="anchor" href="#server-https-support-openssl"></a><a class="link" href="#server-https-support-openssl">20.4.5. OpenSSL</a></h4>
<div class="paragraph">
<p>SSL support is provided using built-in JDK capabilities. Jooby offers an OpenSSL support using
<a href="https://github.com/google/conscrypt" target="_blank">Conscrypt</a>.</p>
</div>
<div class="paragraph">
<p>To enable, add the required dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="x603b0aee27aa4d56">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-conscrypt&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#x603b0aee27aa4d56"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x4e4bd7debc0447f8">implementation 'io.jooby:jooby-conscrypt:4.0.12'</code><button class="clipboard" data-clipboard-target="#x4e4bd7debc0447f8"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="paragraph">
<p>Conscrypt is a Java Security Provider (JSP) that implements parts of the Java Cryptography Extension
(JCE) and Java Secure Socket Extension (JSSE). It uses <a href="https://boringssl.googlesource.com/boringssl" target="_blank">BoringSSL</a> to provide cryptographic
primitives and Transport Layer Security (TLS) for Java applications on Android and OpenJDK.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-http2-support"><a class="anchor" href="#server-http2-support"></a><a class="link" href="#server-http2-support">20.5. HTTP/2 Support</a></h3>
<div class="paragraph">
<p>HTTP2 support is provided across web server implementation. You need to enabled <code>http2</code> option
programmatically or via <code>application.conf</code> properties.</p>
</div>
<div class="listingblock primary">
<div class="title">HTTP/2</div>

<div class="switch"><div class="switch--item option-1 selected">Java</div><div class="switch--item option-2">Kotlin</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="xc76ca0b869ae4bda">{
  var options =new ServerOptions()
      .setHttp2(true)
      .setSecurePort(8433);

  get("/", ctx -&gt;
    ctx.getProtocol()
  )
}</code><button class="clipboard" data-clipboard-target="#xc76ca0b869ae4bda"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" id="xdf36d6630a664bb5">{
  val options = ServerOptions().apply {
    http2 = true
    securePort = 8433
  }

  get("/") {
    ctx.protocol
  }
}</code><button class="clipboard" data-clipboard-target="#xdf36d6630a664bb5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use HTTP/2 from browsers, you need TLS (the h2 protocol) please refer to
<a href="#server-https-support">HTTPS support</a> to configure TLS.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is no support for HTTP/2 Push.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules"><a class="anchor" href="#modules"></a><a class="link" href="#modules">21. Modules</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modules are a key concept for building reusable and configurable pieces of software.</p>
</div>
<div class="paragraph">
<p>Modules (unlike in other frameworks) are thin and do a lot of work to bootstrap and configure an
external library, but they DO NOT provide a new level of abstraction nor [do] they provide a custom
API to access functionality in that library. Instead they expose the library components as they are.</p>
</div>
<div class="paragraph">
<p>Modules are distributed as separated jar/dependency and usually implement the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Extension.html" target="_blank">Extension</a> API.</p>
</div>
<div class="paragraph">
<p>In general they provide a <code>builder</code> class to create the and configure the external library from
configuration properties.</p>
</div>
<div class="paragraph">
<p>Available modules are listed next.</p>
</div>
<div class="sect2">
<h3 id="modules-cloud"><a class="anchor" href="#modules-cloud"></a><a class="link" href="#modules-cloud">21.1. Cloud</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/awssdkv2">AWS-SDK v2</a>: Amazon Web Service module SDK 2.</p>
</li>
<li>
<p><a href="/modules/aws">AWS SDK v1</a>: Amazon Web Service module SDK 1.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-data"><a class="anchor" href="#modules-data"></a><a class="link" href="#modules-data">21.2. Data</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/ebean">Ebean</a>: Ebean ORM module.</p>
</li>
<li>
<p><a href="/modules/flyway">Flyway</a>: Flyway migration module.</p>
</li>
<li>
<p><a href="/modules/graphql">GraphQL</a>: GraphQL Java module.</p>
</li>
<li>
<p><a href="/modules/hikari">HikariCP</a>: A high-performance JDBC connection pool.</p>
</li>
<li>
<p><a href="/modules/hibernate">Hibernate</a>: Hibernate ORM module.</p>
</li>
<li>
<p><a href="/modules/jdbi">Jdbi</a>: Jdbi module.</p>
</li>
<li>
<p><a href="/modules/kafka">Kafka</a>: Kafka module.</p>
</li>
<li>
<p><a href="/modules/redis">Redis</a>: Redis module.</p>
</li>
<li>
<p><a href="/modules/vertx-mysql-client">Vertx mySQL client</a>: Vertx reactive mySQL client module.</p>
</li>
<li>
<p><a href="/modules/vertx-pg-client">Vertx Postgres client</a>: Vertx reactive Postgres client module.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-validation"><a class="anchor" href="#modules-validation"></a><a class="link" href="#modules-validation">21.3. Validation</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/avaje-validator">Avaje Validator</a>: Avaje Validator module.</p>
</li>
<li>
<p><a href="/modules/hibernate-validator">Hibernate Validator</a>: Hibernate Validator module.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-development-tools"><a class="anchor" href="#modules-development-tools"></a><a class="link" href="#modules-development-tools">21.4. Development Tools</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/#development">Jooby Run</a>: Run and hot reload your application.</p>
</li>
<li>
<p><a href="/modules/whoops">Whoops</a>: Pretty page stacktrace reporter.</p>
</li>
<li>
<p><a href="/modules/metrics">Metrics</a>: Application metrics from the excellent metrics library.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-event-bus"><a class="anchor" href="#modules-event-bus"></a><a class="link" href="#modules-event-bus">21.5. Event Bus</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/camel">Camel</a>: Camel module for Jooby.</p>
</li>
<li>
<p><a href="/modules/vertx">Vertx</a>: Vertx module for Jooby.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-json"><a class="anchor" href="#modules-json"></a><a class="link" href="#modules-json">21.6. JSON</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/gson">Gson</a>: Gson module for Jooby.</p>
</li>
<li>
<p><a href="/modules/jackson">Jackson</a>: Jackson module for Jooby.</p>
</li>
<li>
<p><a href="/modules/yasson">JSON-B</a>: JSON-B module for Jooby.</p>
</li>
<li>
<p><a href="/modules/avaje-jsonb">Avaje-JsonB</a>: Avaje-JsonB module for Jooby.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-openapi"><a class="anchor" href="#modules-openapi"></a><a class="link" href="#modules-openapi">21.7. OpenAPI</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/openapi">OpenAPI</a>: OpenAPI supports.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-template-engine"><a class="anchor" href="#modules-template-engine"></a><a class="link" href="#modules-template-engine">21.8. Template Engine</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/handlebars">Handlebars</a>: Handlebars template engine.</p>
</li>
<li>
<p><a href="/modules/jstachio">JStachio</a>: JStachio template engine.</p>
</li>
<li>
<p><a href="/modules/jte">jte</a>: jte template engine.</p>
</li>
<li>
<p><a href="/modules/freemarker">Freemarker</a>: Freemarker template engine.</p>
</li>
<li>
<p><a href="/modules/pebble">Pebble</a>: Pebble template engine.</p>
</li>
<li>
<p><a href="/modules/rocker">Rocker</a>: Rocker template engine.</p>
</li>
<li>
<p><a href="/modules/thymeleaf">Thymeleaf</a>: Thymeleaf template engine.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-security"><a class="anchor" href="#modules-security"></a><a class="link" href="#modules-security">21.9. Security</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/jasypt">Jasypt</a>: Encrypted configuration files.</p>
</li>
<li>
<p><a href="/modules/pac4j">Pac4j</a>: Security engine module.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-session-store"><a class="anchor" href="#modules-session-store"></a><a class="link" href="#modules-session-store">21.10. Session Store</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/caffeine">Caffeine</a>: In-memory session store using Caffeine cache.</p>
</li>
<li>
<p><a href="/modules/jwt-session-store">JWT</a>: JSON Web Token session store.</p>
</li>
<li>
<p><a href="/modules/redis#redis-http-session">Redis</a>: Save session data on redis.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modules-scheduler"><a class="anchor" href="#modules-scheduler"></a><a class="link" href="#modules-scheduler">21.11. Scheduler</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="/modules/db-scheduler">DbScheduler</a>: Db scheduler module.</p>
</li>
<li>
<p><a href="/modules/quartz">Quartz</a>: Quartz scheduler module.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a><a class="link" href="#appendix">22. Appendix</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix-upgrading-from-3-x-to-4-x"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x">22.1. Upgrading from 3.x to 4.x</a></h3>
<div class="paragraph">
<p>You will find here notes/tips about how to migrate from 3.x to 4.x.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a <strong>work in progress</strong> document, if something is wrong or missing please <a href="https://github.com/jooby-project/jooby/issues/new" target="_blank">report to Github</a> or better <a href="https://github.com/jooby-project/jooby/edit/3.x/docs/asciidoc/migration/4.x.adoc" target="_blank">edit this file and fix it</a></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-requirements"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-requirements"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-requirements">22.1.1. Requirements</a></h4>
<div class="ulist">
<ul>
<li>
<p>Java 21 as minimum</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-buffer-api"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-buffer-api"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-buffer-api">22.1.2. Buffer API</a></h4>
<div class="paragraph">
<p>The package <code>io.jooby.buffer</code> is gone. It was replaced by <code>io.jooby.output</code> these classes
are used mainly by the <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/MessageEncoder.html" target="_blank">MessageEncoder</a> API, the new API is easier to use and has better
performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-value-api"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-value-api"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-value-api">22.1.3. Value API</a></h4>
<div class="paragraph">
<p>The new package is now <code>io.jooby.value</code>. The API is now decoupled from <a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Context.html" target="_blank">Context</a>
in future release will be the basis of a new configuration system.</p>
</div>
<div class="paragraph">
<p>Also, the <code>io.jooby.ValueNode</code> and <code>io.jooby.ValueNodeConverter</code> are gone.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-session-api"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-session-api"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-session-api">22.1.4. Session API</a></h4>
<div class="paragraph">
<p>For security reasons, the default HTTP session was removed. You need to configure the session
explicitly and provide a cookie session name. The <code>jooby.sid</code> cookie name was removed from project.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-server-configuration"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-server-configuration"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-server-configuration">22.1.5. Server configuration</a></h4>
<div class="paragraph">
<p>The <code>install(Server)</code>, <code>setServerOptions</code>, <code>start()</code> method are gone. With the new support for
multiple applications in a single server, these methods are useless.</p>
</div>
<div class="paragraph">
<p>The new way:</p>
</div>
<div class="listingblock">
<div class="title">New way to boot</div>
<div class="content">
<pre>runApp(args, new NettyServer(new ServerOptions()), App::new);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-packages"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-packages"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-packages">22.1.6. Packages</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.buffer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replacement jooby (core)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-classes"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-classes"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-classes">22.1.7. Classes</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.buffer.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.output.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new output API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.MvcFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">was deprecated and now removed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.annotation.ResultType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.ValueNode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.value.Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replaced/merged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.ValueNodeConverter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.value.ValueConverter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replaced/merged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.RouteSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Route.Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moved into Route and renamed to Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-3-x-to-4-x-method"><a class="anchor" href="#appendix-upgrading-from-3-x-to-4-x-method"></a><a class="link" href="#appendix-upgrading-from-3-x-to-4-x-method">22.1.8. Method</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Jooby.setServerOptions()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server.setOptions()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed in favor of <code>Server.setOptions()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.mvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">it was deprecated and now removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.decorator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">it was deprecated and now removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.getConverters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.getValueFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replaced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.getBeanConverters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.getValueFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replaced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.attribute(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Router.getAttribute(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renamed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.RouteOption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.RouterOptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved to <code>RouterOptions</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Router.setTrustProxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RouterOptions.setTrustProxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved to <code>RouterOptions</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="appendix-upgrading-from-2-x-to-3-x"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x">22.2. Upgrading from 2.x to 3.x</a></h3>
<div class="paragraph">
<p>You will find here notes/tips about how to migrate from 2.x to 3.x.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a <strong>work in progress</strong> document, if something is wrong or missing please <a href="https://github.com/jooby-project/jooby/issues/new" target="_blank">report to Github</a> or better <a href="https://github.com/jooby-project/jooby/edit/3.x/docs/asciidoc/migration.adoc" target="_blank">edit this file and fix it</a></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-requirements"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-requirements"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-requirements">22.2.1. Requirements</a></h4>
<div class="ulist">
<ul>
<li>
<p>Java 17 as minimum</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-module-info-java"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-module-info-java"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-module-info-java">22.2.2. module-info.java</a></h4>
<div class="paragraph">
<p>Jooby is now compatible with Java Module system.</p>
</div>
<div class="paragraph">
<p>Almost all Jooby components are now Java Modules, but not all them. For those where wasnâ€™t
possible the Jooby module contains the <code>Automatic-Module-Name</code> manifest entry.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-kotlin"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-kotlin"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-kotlin">22.2.3. Kotlin</a></h4>
<div class="paragraph">
<p>Kotlin was removed from core, you need to the <code>jooby-kotlin</code> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item option-1 selected">Maven</div><div class="switch--item option-2">Gradle</div></div><div class="content option-1">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml" id="xd8676d87a7714068">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-kotlin&lt;/artifactId&gt;
  &lt;version&gt;4.0.12&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard" data-clipboard-target="#xd8676d87a7714068"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div><div class="content hidden option-2">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle" id="x39fb4875de1a48c5">implementation 'io.jooby:jooby-kotlin:4.0.12'</code><button class="clipboard" data-clipboard-target="#x39fb4875de1a48c5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-jakarta"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-jakarta"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-jakarta">22.2.4. jakarta</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.servlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jakarta.servlet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.inject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jakarta.inject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jakarta.persistence</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-modules"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-modules"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-modules">22.2.5. Modules</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-kotlin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-weld</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-archetype</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-utow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renamed: jooby-undertow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-commons-email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renamed: jooby-commons-mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-http2-jetty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merged into: jooby-netty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-http2-netty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merged into: jooby-netty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-http2-undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merged into: jooby-undertow</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-package-renames"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-package-renames"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-package-renames">22.2.6. Package renames</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.annotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.annotation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby (Kotlin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.kt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed from jooby, now in jooby-kotlin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.graphql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.graphiql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-graphiql</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.graphql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.graphql.playground</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-graphql-playground</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.gson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-gson</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.jackson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-jackson</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.di</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.guice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-guice</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.di</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-spring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.aws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.awssdkv1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-awssdk-v1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.commons.mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-commons-mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.utow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-undertow</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-class-renames"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-class-renames"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-class-renames">22.2.7. Class renames</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Route.Decorator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Route.Filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Kooby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.kt.Kooby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-kotlin (new module)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.jetty.Jetty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.jetty.JettyServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-jetty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.netty.Netty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.netty.NettyServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-netty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.utow.Utow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.undertow.UndertowServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-undertow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.AccessLogHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.AccessLogHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Cors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.Cors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.CorsHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.CorsHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.CsrfHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.CsrfHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.HeadHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.HeadHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.RateLimitHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.RateLimitHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.SSLHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.SSLHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.TraceHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.TraceHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.WebVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.WebVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Asset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.Asset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.AssetHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.AssetHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.AssetSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.AssetSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.CacheControl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.handler.CacheControl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-method-renames"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-method-renames"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-method-renames">22.2.8. Method renames</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Router.decorator(Decorator)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Router.use(Filter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>decorator</code> has been deprecated in favor of <code>use</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setCert(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setCert(InputStream)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced the string argument with <code>InputStream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setTrustCert(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setTrustCert(InputStream)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced the string argument with <code>InputStream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setPrivateKey(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SslOptions.setPrivateKey(InputStream)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced the string argument with <code>InputStream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FileUpload.destroy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FileUpload.close</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destroy</code> has been replaced by <code>close</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.attribute(String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.getAttribute(String)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.attribute(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.setAttribute(String, Object)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.multipart*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.form*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Context.multipart related methods where merged into Context.form</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.query&lt;Type&gt;()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.query(Type::class)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.form&lt;Type&gt;()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.form(Type::class)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.body&lt;Type&gt;()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context.body(Type::class)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-dependencies"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-dependencies"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-dependencies">22.2.9. Dependencies</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slf4j 1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slf4j 2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby (core)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty 9.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty 11.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-jetty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guice 5.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guice 7.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-guice</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-2-x-to-3-x-reactive-support"><a class="anchor" href="#appendix-upgrading-from-2-x-to-3-x-reactive-support"></a><a class="link" href="#appendix-upgrading-from-2-x-to-3-x-reactive-support">22.2.10. Reactive support</a></h4>
<div class="paragraph">
<p>Reactive libraries has been removed from core to his own module.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rxjava</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-rxjava3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-reactor</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All reactive libraries requires explicit handler while using script/lambda routes. More details on <a href="/#responses-nonblocking">NonBlocking</a> responses.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="appendix-upgrading-from-1-x-to-2-x"><a class="anchor" href="#appendix-upgrading-from-1-x-to-2-x"></a><a class="link" href="#appendix-upgrading-from-1-x-to-2-x">22.3. Upgrading from 1.x to 2.x</a></h3>
<div class="paragraph">
<p>You will find here notes/tips about how to migrate from 1.x to 2.x.</p>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-1-x-to-2-x-maven-coordinates"><a class="anchor" href="#appendix-upgrading-from-1-x-to-2-x-maven-coordinates"></a><a class="link" href="#appendix-upgrading-from-1-x-to-2-x-maven-coordinates">22.3.1. Maven coordinates</a></h4>
<div class="paragraph">
<p><code>org.jooby</code> became <code>io.jooby</code>. Hence, use <code>&lt;groupId&gt;org.jooby&lt;/groupId&gt;</code> for all dependencies.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-1-x-to-2-x-modules"><a class="anchor" href="#appendix-upgrading-from-1-x-to-2-x-modules"></a><a class="link" href="#appendix-upgrading-from-1-x-to-2-x-modules">22.3.2. Modules</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-apitool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no real equivalent, use a combination of <a href="https://jooby.io/modules/openapi/" target="_blank">jooby-maven-plugin</a> and <a href="https://jooby.io/modules/openapi/#openapi-swagger-ui" target="_blank">jooby-swagger-ui</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-hbv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-lang-kotlin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not needed anymore, part of core now</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jooby-servlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-1-x-to-2-x-api"><a class="anchor" href="#appendix-upgrading-from-1-x-to-2-x-api"></a><a class="link" href="#appendix-upgrading-from-1-x-to-2-x-api">22.3.3. API</a></h4>
<div class="paragraph">
<p>API still similar/equivalent in 2.x. Except for the one listed below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Mutant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Render</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.MessageEncoder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Parser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.MessageDecoder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Err</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.jooby.StatusCodeException</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- (removed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jooby.Result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- (removed)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="appendix-upgrading-from-1-x-to-2-x-route-pipeline"><a class="anchor" href="#appendix-upgrading-from-1-x-to-2-x-route-pipeline"></a><a class="link" href="#appendix-upgrading-from-1-x-to-2-x-route-pipeline">22.3.4. Route Pipeline</a></h4>
<div class="paragraph">
<p>The concept of route pipeline still applies for 2.x but works different.</p>
</div>
<div class="paragraph">
<p>In 1.x there is no difference between handler and filter (including before and after). The way to
chain multiple handler/filter was like:</p>
</div>
<div class="listingblock">
<div class="title">Pipeline in 1.x</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x80e056aec6544be5">{
  use("*", (req, rsp, chain) -&gt; {
    System.out.println("first");
    // Moves execution to next handler: second
    chain.next(req, rsp);
  });

  use("*", (req, rsp, chain) -&gt; {
    System.out.println("second");
    // Moves execution to next handler: third
    chain.next(req, rsp);
  });

  get("/handler", req -&gt; {
    return "third";
  });
}</code><button class="clipboard" data-clipboard-target="#x80e056aec6544be5"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>A filter in 1.x requires a path pattern, here we use a wide matcher <code>*</code> for <code>first</code> and <code>second</code> filters.
Both of this filters are going to be executed before the real <code>handler</code>.</p>
</div>
<div class="listingblock">
<div class="title">Pipeline in 2.x</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" id="x7dc9b44d1a9b47e4">{
   use(next -&gt; ctx -&gt; {
     System.out.println("first");
     // Moves execution to next handler: second
     return next.apply(ctx);
   });

   use(next -&gt; ctx -&gt; {
     System.out.println("second");
     // Moves execution to next handler: third
     return next.apply(ctx);
   });

   get("/handler", ctx -&gt; {
     return "third";
   });
}</code><button class="clipboard" data-clipboard-target="#x7dc9b44d1a9b47e4"><img src="/images/clippy.svg" class="clippy" width="13" alt="Copy to clipboard"></button></pre>
</div>
</div>
<div class="paragraph">
<p>Execution is identical to 1.x. The <code>first</code> and <code>second</code> decorators are executed before the handler.
Differences with 1.x are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/io.jooby/jooby/latest/io.jooby/io/jooby/Route.Decorator.html" target="_blank">Route.Decorator</a> doesnâ€™t support a path pattern. In 1.x the path pattern is required for a filter.</p>
</li>
<li>
<p>Only the handler supports a path pattern and HTTP-method.</p>
</li>
<li>
<p>A handler might have zero or more decorator.</p>
</li>
<li>
<p>In 2.x we chain all the decorator defined before the handler.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The routing matching algorithm in 2.x is more efficient and fast, because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Matches a single path pattern (due decorator lacks of path pattern)</p>
</li>
<li>
<p>Uses a radix tree, not regular expression like in 1.x</p>
</li>
<li>
<p>It never executes a decorator if there isnâ€™t a matching handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More detailed explanation of route pipeline is available in the <a href="#router-pipeline">router pipeline documentation</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="js/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.configure({ignoreUnescapedHTML: true});hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightElement(el) })
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script>
  $(function () {
    /** Tabs: */
    $('.primary .switch .switch--item').on('click', function () {
      const option = $(this)[0].className.match(/option-\d+/)[0].split('option-')[1];
      $('.primary .switch .switch--item').removeClass('selected');
      $(`.primary .content`).addClass('hidden');

      $(`.primary .switch .switch--item.option-${option}`).addClass('selected');
      $(`.primary .content.option-${option}`).removeClass('hidden');
    });
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/3.0.2/tocbot.min.js"></script>
<script>
  $(function() {
    var oldtoc = document.getElementById('toctitle').nextElementSibling;
    var newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({
      contentSelector: '#content',
      headingSelector: 'h1, h2, h3, h4, h5',
      ignoreSelector: '.discrete',
      smoothScroll: false
    });
    var handleTocOnResize = function () {
      var width = window.innerWidth
          || document.documentElement.clientWidth
          || document.body.clientWidth;
      if (width < 768) {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          collapseDepth: 6,
          ignoreSelector: '.discrete',
          throttleTimeout: 1000,
          smoothScroll: false
        });
      } else {
        tocbot.refresh();
      }
    };
    window.addEventListener('resize', handleTocOnResize);
    handleTocOnResize();
  });
</script>

<script src="/js/clipboard.min.js"></script>
<script>
  $(function() {
    new ClipboardJS('.clipboard')
    .on('success', function(e) {
      e.clearSelection();
    });
  });
</script>
</body>
</html>