<!doctype html><html lang="en"><head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="description" content="The modular micro web framework for Java">
<meta name="keywords" content="Java, Modern, Micro, Web, Framework, Reactive, Lightweight, Microservices">
<link rel="icon" type="image/png" href="images/favicon96.png">
<title>jooby: do more! more easily!!</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  /** ToC */
  #tocbot a.toc-link.node-name--H1{ font-style: italic }
  @media screen{
    #tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
    #tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
      padding-left: 0 }
    #tocbot a.toc-link{ height:100% }
    .is-collapsible{ max-height:3000px; overflow:hidden; }
    .is-collapsed{ max-height:0 }
    .is-active-link{ font-weight:700 }
  }
  @media print{
    #tocbot a.toc-link.node-name--H4{ display:none }
  }

  /** Tabs */
  .hidden {
    display: none;
  }

  .switch {
    display: inline-block;
  }

  .switch--item {
    padding: 5px 10px;
    color: #fff;
    display: inline-block;
    cursor: pointer;
    background-color: #333;
    border-left: 1px solid #ffa;
  }

  .switch--item:not(:first-child) {
  }

  .switch--item:last-child {
    border-radius: 0 5px 0 0;
  }

  .switch--item.selected {
    color: #ffa;
    border-bottom: 1px solid #ffa;
  }

  /** Copy */
  .listingblock:hover .clipboard {
    display: block;
  }

  .clipboard {
    border: 0;
    font-size: .75em;
    text-transform: uppercase;
    font-weight: 500;
    padding: 6px;
    color: #999;
    position: absolute;
    top: .425rem;
    right: .5rem;
    background: transparent;
  }

  .clipboard:hover, .clipboard:focus, .clipboard:active {
    outline: 0;
    background-color: #eee9e6;
  }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Welcome to Jooby!</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#introduction-status">1.1. Status</a></li>
<li><a href="#introduction-key-features">1.2. Key Features</a></li>
<li><a href="#introduction-script-api">1.3. Script API</a></li>
<li><a href="#introduction-mvc-api">1.4. MVC API</a></li>
</ul>
</li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#getting-started-getting-started-java">2.1. Java</a></li>
<li><a href="#getting-started-getting-started-kotlin">2.2. Kotlin</a></li>
<li><a href="#getting-started-code-snippets">2.3. Code snippets</a></li>
</ul>
</li>
<li><a href="#router">3. Router</a>
<ul class="sectlevel2">
<li><a href="#router-route">3.1. Route</a></li>
<li><a href="#router-path-pattern">3.2. Path Pattern</a>
<ul class="sectlevel3">
<li><a href="#router-path-pattern-static">3.2.1. Static</a></li>
<li><a href="#router-path-pattern-variable">3.2.2. Variable</a></li>
<li><a href="#router-path-pattern-regex">3.2.3. Regex</a></li>
<li><a href="#router-path-pattern-catchall">3.2.4. * Catchall</a></li>
</ul>
</li>
<li><a href="#router-handler">3.3. Handler</a>
<ul class="sectlevel3">
<li><a href="#router-handler-decorator">3.3.1. Decorator</a></li>
<li><a href="#router-handler-before-decorator">3.3.2. Before Decorator</a></li>
<li><a href="#router-handler-after-decorator">3.3.3. After Decorator</a></li>
</ul>
</li>
<li><a href="#router-pipeline">3.4. Pipeline</a>
<ul class="sectlevel3">
<li><a href="#router-pipeline-order">3.4.1. Order</a></li>
<li><a href="#router-pipeline-scoped-decorator">3.4.2. Scoped Decorator</a></li>
</ul>
</li>
<li><a href="#router-grouping-routes">3.5. Grouping routes</a></li>
<li><a href="#router-composing-routes">3.6. Composing routes</a></li>
<li><a href="#router-dynamic-routing">3.7. Dynamic Routing</a></li>
</ul>
</li>
<li><a href="#context">4. Context</a>
<ul class="sectlevel2">
<li><a href="#context-parameters">4.1. Parameters</a>
<ul class="sectlevel3">
<li><a href="#context-parameters-header">4.1.1. Header</a></li>
<li><a href="#context-parameters-cookie">4.1.2. Cookie</a></li>
<li><a href="#context-parameters-path">4.1.3. Path</a></li>
<li><a href="#context-parameters-query">4.1.4. Query</a></li>
<li><a href="#context-parameters-formdata">4.1.5. Formdata</a></li>
<li><a href="#context-parameters-multipart">4.1.6. Multipart</a></li>
</ul>
</li>
<li><a href="#context-value-api">4.2. Value API</a>
<ul class="sectlevel3">
<li><a href="#context-value-api-single-value">4.2.1. Single value</a></li>
<li><a href="#context-value-api-default-and-optional-value">4.2.2. Default and Optional value</a></li>
<li><a href="#context-value-api-multiple-values">4.2.3. Multiple values</a></li>
<li><a href="#context-value-api-structured-data">4.2.4. Structured data</a></li>
</ul>
</li>
<li><a href="#context-request-body">4.3. Request Body</a>
<ul class="sectlevel3">
<li><a href="#context-request-body-parser">4.3.1. Parser</a></li>
</ul>
</li>
<li><a href="#context-response-body">4.4. Response Body</a>
<ul class="sectlevel3">
<li><a href="#context-response-body-renderer">4.4.1. Renderer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#execution-model">5. Execution Model</a>
<ul class="sectlevel2">
<li><a href="#execution-model-mode">5.1. Mode</a>
<ul class="sectlevel3">
<li><a href="#execution-model-mode-event-loop">5.1.1. Event Loop</a></li>
<li><a href="#execution-model-mode-worker">5.1.2. Worker</a></li>
<li><a href="#execution-model-mode-default">5.1.3. Default</a></li>
</ul>
</li>
<li><a href="#execution-model-worker-executor">5.2. Worker Executor</a></li>
</ul>
</li>
<li><a href="#responses">6. Responses</a>
<ul class="sectlevel2">
<li><a href="#responses-raw">6.1. Raw</a></li>
<li><a href="#responses-streaming-chunked">6.2. Streaming / Chunked</a></li>
<li><a href="#responses-file-download">6.3. File download</a></li>
<li><a href="#responses-nonblocking">6.4. NonBlocking</a>
<ul class="sectlevel3">
<li><a href="#responses-nonblocking-limitations">6.4.1. Limitations</a></li>
<li><a href="#responses-nonblocking-completablefuture">6.4.2. CompletableFuture</a></li>
<li><a href="#responses-nonblocking-rxjava">6.4.3. RxJava</a></li>
<li><a href="#responses-nonblocking-reactor">6.4.4. Reactor</a></li>
<li><a href="#responses-nonblocking-kotlin-coroutines">6.4.5. Kotlin Coroutines</a></li>
</ul>
</li>
<li><a href="#responses-send-methods">6.5. Send methods</a></li>
</ul>
</li>
<li><a href="#introduction-mvc-api">7. MVC API</a>
<ul class="sectlevel2">
<li><a href="#mvc-api-parameters">7.1. Parameters</a>
<ul class="sectlevel3">
<li><a href="#mvc-api-parameters-header">7.1.1. Header</a></li>
<li><a href="#mvc-api-parameters-cookie">7.1.2. Cookie</a></li>
<li><a href="#mvc-api-parameters-path">7.1.3. Path</a></li>
<li><a href="#mvc-api-parameters-query">7.1.4. Query</a></li>
<li><a href="#mvc-api-parameters-formdatamultipart">7.1.5. Formdata/Multipart</a></li>
<li><a href="#mvc-api-parameters-body">7.1.6. Body</a></li>
</ul>
</li>
<li><a href="#mvc-api-registration">7.2. Registration</a></li>
<li><a href="#mvc-api-suspend-functions">7.3. Suspend functions</a></li>
<li><a href="#mvc-api-jax-rs-annotations">7.4. JAX-RS Annotations</a></li>
</ul>
</li>
<li><a href="#configuration">8. Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuration-environment">8.1. Environment</a></li>
<li><a href="#configuration-default-environment">8.2. Default Environment</a></li>
<li><a href="#configuration-overrides">8.3. Overrides</a></li>
<li><a href="#configuration-custom-environment">8.4. Custom environment</a></li>
<li><a href="#configuration-logging">8.5. Logging</a>
<ul class="sectlevel3">
<li><a href="#configuration-logging-logback">8.5.1. Logback</a></li>
<li><a href="#configuration-logging-log4j2">8.5.2. Log4j2</a></li>
<li><a href="#configuration-logging-environment-logging">8.5.3. Environment logging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dependency-injection">9. Dependency Injection</a>
<ul class="sectlevel2">
<li><a href="#dependency-injection-dagger">9.1. Dagger</a></li>
<li><a href="#dependency-injection-guice">9.2. Guice</a>
<ul class="sectlevel3">
<li><a href="#dependency-injection-guice-property-injection">9.2.1. Property Injection</a></li>
<li><a href="#dependency-injection-guice-mvc-routes">9.2.2. MVC routes</a></li>
</ul>
</li>
<li><a href="#dependency-injection-spring">9.3. Spring</a>
<ul class="sectlevel3">
<li><a href="#dependency-injection-spring-property-injection">9.3.1. Property Injection</a></li>
<li><a href="#dependency-injection-spring-mvc-routes">9.3.2. MVC routes</a></li>
</ul>
</li>
<li><a href="#dependency-injection-weld">9.4. Weld</a>
<ul class="sectlevel3">
<li><a href="#dependency-injection-weld-property-injection">9.4.1. Property Injection</a></li>
<li><a href="#dependency-injection-weld-mvc-routes">9.4.2. MVC routes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#testing">10. Testing</a>
<ul class="sectlevel2">
<li><a href="#testing-unit-testing">10.1. Unit Testing</a></li>
<li><a href="#testing-integration-testing">10.2. Integration Testing</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h2 id="do-more-more-easily" class="discrete">∞ do more, more easily</h2>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby is a modern, performant and easy to use web framework for Java and Kotlin built on top of your
favorite web server.</p>
</div>
<div class="listingblock primary">
<div class="title">Welcome!!</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.Jooby;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "Welcome to Jooby!");
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    get ("/") { ctx -&gt; "Welcome to Jooby!" }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="sect2">
<h3 id="introduction-status"><a class="anchor" href="#introduction-status"></a><a class="link" href="#introduction-status">1.1. Status</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is no stable release yet for <code>2.0.0</code>. API may change between milestone releases without warning.</p>
</div>
<div class="paragraph">
<p>This is a <strong>work-in-progress</strong> document and contains documentation and examples of what is ready to use. If it is not documented here, it is not implemented.</p>
</div>
<div class="paragraph">
<p>Not ready yet? Try <a href="https://jooby.org" target="_blank">Jooby 1.x</a></p>
</div>
<div class="paragraph">
<p>Thank you ♡</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="introduction-key-features"><a class="anchor" href="#introduction-key-features"></a><a class="link" href="#introduction-key-features">1.2. Key Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Script/Lambda routes. Reflection and annotation free</p>
</li>
<li>
<p>MVC routes. Annotation and byte code generation. Similar to Spring and JAX-RS</p>
</li>
<li>
<p>Reactive responses: Completable futures, RxJava, Reactor and Kotlin coroutines</p>
</li>
<li>
<p>Configuration using <a href="https://github.com/lightbend/config" target="_blank">config</a> library</p>
</li>
<li>
<p><a href="https://www.slf4j.org" target="_blank">Slf4j</a> logging</p>
</li>
<li>
<p>Multi Server: <a href="https://https://www.eclipse.org/jetty" target="_blank">Jetty</a>, <a href="https://netty.io" target="_blank">Netty</a>, <a href="http://undertow.io" target="_blank">Undertow</a></p>
</li>
<li>
<p>Extension system for commons technical tasks: connection pool, json, template engine, etc…​</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="introduction-script-api"><a class="anchor" href="#introduction-script-api"></a><a class="link" href="#introduction-script-api">1.3. Script API</a></h3>
<div class="paragraph">
<p>Script API (a.k.a script routes) provides a fluent DSL, reflection and annotation free based on <code>lambda</code> functions.</p>
</div>
<div class="paragraph">
<p>We usually extends <code>Jooby</code> and define routes in the instance initializer:</p>
</div>
<div class="listingblock primary">
<div class="title">Script with sub-class:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.Jooby;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "Hello Jooby!");
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.Kooby;
import io.jooby.runApp;

class App : Kooby({

  get("/") { ctx -&gt; "Hello Jooby!" }

})

fun main(args: Array&lt;String&gt;) {
  runApp(args, ::App)
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>For Java applications we favor extending <code>Jooby</code> because DSL looks better. For example, no need
prefix the <code>get</code> method with a variable.</p>
</div>
<div class="paragraph">
<p>This is not strictly necessary (of course), you may prefer to do it without extending <code>Jooby</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">Script without subclass:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.Jooby;

public class App {

  public static void main(String[] args) {
    runApp(app -&gt; {

      app.get("/", ctx -&gt; "Hello Jooby!");

    }, args);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    get("/") { ctx -&gt; "Hello Jooby!" }

  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>In case of Kotlin, it doesn’t matter which one you choose. DSL looks great with or without extending
<code>Kooby</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-mvc-api"><a class="anchor" href="#introduction-mvc-api"></a><a class="link" href="#introduction-mvc-api">1.4. MVC API</a></h3>
<div class="paragraph">
<p>The MVC API (a.k.a mvc routes) uses annotation to define routes and byte code generation to execute
them.</p>
</div>
<div class="listingblock primary">
<div class="title">MVC API:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.annotations.*;

public class MyController {

  @GET
  public String sayHi() {
    return "Hello Jooby!";
  }
}

public class App {

  public static void main(String[] args) {
    runApp(args, app -&gt; {

      app.use(new MyController());

    });
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.annotations.*;

class MyController {

  @GET
  fun sayHi() : String {
    return "Hello Jooby!"
  }
}

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    use(MyController())

  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a><a class="link" href="#getting-started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="getting-started-getting-started-java"><a class="anchor" href="#getting-started-getting-started-java"></a><a class="link" href="#getting-started-getting-started-java">2.1. Java</a></h3>
<div class="paragraph">
<p>1) Add the dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-netty&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-netty:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jooby is a multi-server web framework. You are free to choose between: Jetty, Netty and Undertow.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="listingblock">
<div class="title">App.java:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.Jooby;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "Hello World!");
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-getting-started-kotlin"><a class="anchor" href="#getting-started-getting-started-kotlin"></a><a class="link" href="#getting-started-getting-started-kotlin">2.2. Kotlin</a></h3>
<div class="paragraph">
<p>1) Add Kotlin dependencies:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
  &lt;artifactId&gt;kotlin-stdlib-jdk8&lt;/artifactId&gt;
  &lt;version&gt;1.3.30&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Optional. Only for MVC routes--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
  &lt;artifactId&gt;kotlin-reflect&lt;/artifactId&gt;
  &lt;version&gt;1.3.30&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Optional. Only for suspend handlers--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jetbrains.kotlinx&lt;/groupId&gt;
  &lt;artifactId&gt;kotlinx-coroutines-core&lt;/artifactId&gt;
  &lt;version&gt;1.2.0&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.3.30'

// Optional. Only for MVC routes
compile 'org.jetbrains.kotlin:kotlin-reflect:1.3.30'

// Optional. Only for suspend handlers
compile 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.2.0'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="listingblock">
<div class="title">App.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    get("/") { ctx -&gt; "Hello World!" }

  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>App</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO App started with:
INFO     PID: 21661
INFO     port: 8080
INFO     server: netty
INFO routes:

  GET /

listening on:
  http://localhost:8080/</pre>
</div>
</div>
<div class="paragraph">
<p>Ready ♡!</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-code-snippets"><a class="anchor" href="#getting-started-code-snippets"></a><a class="link" href="#getting-started-code-snippets">2.3. Code snippets</a></h3>
<div class="paragraph">
<p>For simplicity and brevity we are going to skip the <code>runApp</code> function and extending <code>Jooby</code>.
A code example will looks like:</p>
</div>
<div class="listingblock primary">
<div class="title">Snippet</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; "Snippet");
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt; "Snippet" }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The use of <code>runApp</code> will be included only when is strictly necessary.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="router"><a class="anchor" href="#router"></a><a class="link" href="#router">3. Router</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html" target="_blank">Router</a> is the heart of Jooby and consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Routing algorithm (radix tree)</p>
</li>
<li>
<p>One or more <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.html" target="_blank">routes</a></p>
</li>
<li>
<p>Collection of operator over <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.html" target="_blank">routes</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="router-route"><a class="anchor" href="#router-route"></a><a class="link" href="#router-route">3.1. Route</a></h3>
<div class="paragraph">
<p>A <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.html" target="_blank">Route</a> consists of three part:</p>
</div>
<div class="listingblock primary">
<div class="title">Routes:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{

  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  get("/foo", ctx -&gt; {
    return "foo"; <i class="conum" data-value="3"></i><b>(3)</b>
  });

  // Get example with path variable
  get("/foo/{id}", ctx -&gt; {
    return ctx.path("id").value();
  });

  // Post example
  post("/", ctx -&gt; {
    return ctx.body().value();
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{

  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  get("/foo") { ctx -&gt;
    "foo" <i class="conum" data-value="3"></i><b>(3)</b>
  }

  // Get example with path variable
  get("/foo/{id}") { ctx -&gt;
    ctx.path("id").value()
  }

  // Post example
  post("/") { ctx -&gt;
    ctx.body().value()
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP method/verb, like: <code>GET</code>, <code>POST</code>, etc…​</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path pattern, like: <code>/foo</code>, <code>/foo/{id}</code>, etc…​</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Handler function</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.Handler.html" target="_blank">handler</a> function always produces a result, which is send it back
to the client.</p>
</div>
</div>
<div class="sect2">
<h3 id="router-path-pattern"><a class="anchor" href="#router-path-pattern"></a><a class="link" href="#router-path-pattern">3.2. Path Pattern</a></h3>
<div class="sect3">
<h4 id="router-path-pattern-static"><a class="anchor" href="#router-path-pattern-static"></a><a class="link" href="#router-path-pattern-static">3.2.1. Static</a></h4>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Koltin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/foo", ctx -&gt; "Foo");
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/foo") { ctx -&gt; "Foo" }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="router-path-pattern-variable"><a class="anchor" href="#router-path-pattern-variable"></a><a class="link" href="#router-path-pattern-variable">3.2.2. Variable</a></h4>
<div class="listingblock primary">
<div class="title">Single path variable:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id}", ctx -&gt; {
    int id = ctx.path("id").intValue(); <i class="conum" data-value="2"></i><b>(2)</b>
    return id;
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id}") { ctx -&gt;
    val id = ctx.path("id").intValue() <i class="conum" data-value="2"></i><b>(2)</b>
    id
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a path variable <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve the variable <code>id</code> as <code>int</code></td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Multiple path variables:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/file/{file}.{ext}", ctx -&gt; {
    String filename = ctx.path("file").value(); <i class="conum" data-value="2"></i><b>(2)</b>
    String ext = ctx.path("ext").value();   <i class="conum" data-value="3"></i><b>(3)</b>
    return filename + "." + ext;
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/file/{file}.{ext}") { ctx -&gt;
    val filename = ctx.path("file").value() <i class="conum" data-value="2"></i><b>(2)</b>
    val ext = ctx.path("ext").value()       <i class="conum" data-value="3"></i><b>(3)</b>
    filename + "." + ext
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines two path variables: <code>file</code> and <code>ext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve string variable: <code>file</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve string variable: <code>ext</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-path-pattern-regex"><a class="anchor" href="#router-path-pattern-regex"></a><a class="link" href="#router-path-pattern-regex">3.2.3. Regex</a></h4>
<div class="listingblock primary">
<div class="title">Regex path variable:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id:[0-9]+}", ctx -&gt; {
    int id = ctx.path("id").intValue(); <i class="conum" data-value="2"></i><b>(2)</b>
    return id;
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/user/{id:[0-9]+}") { ctx -&gt;
    val id = ctx.path("id").intValue() <i class="conum" data-value="2"></i><b>(2)</b>
    id
  }
}`</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a path variable: <code>id</code>. Regex expression is everything after the first <code>:</code>, like: <code>[0-9]+</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve an int value</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-path-pattern-catchall"><a class="anchor" href="#router-path-pattern-catchall"></a><a class="link" href="#router-path-pattern-catchall">3.2.4. * Catchall</a></h4>
<div class="listingblock primary">
<div class="title">catchall</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/articles/*", ctx -&gt; {
    String catchall = ctx.path("*").value(); <i class="conum" data-value="2"></i><b>(2)</b>
    return catchall;
  });

  get("/articles/*path", ctx -&gt; {
    String path = ctx.path("path").value(); <i class="conum" data-value="3"></i><b>(3)</b>
    return path;
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  <i class="conum" data-value="1"></i><b>(1)</b>
  get("/articles/*") { ctx -&gt;
    val catchall = ctx.path("*").value() <i class="conum" data-value="2"></i><b>(2)</b>
    catchall
  }

  get("/articles/*path") { ctx -&gt;
    val path = ctx.path("path").value()  <i class="conum" data-value="3"></i><b>(3)</b>
    path
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The trailing <code>*</code> defines a <code>catchall</code> pattern</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We access to the <code>catchall</code> value using the <code>*</code> character</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Same example, but this time we named the <code>catchall</code> pattern and we access to it using <code>path</code>
variable name.</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>catchall</code> pattern must be defined at the end of the path pattern.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-handler"><a class="anchor" href="#router-handler"></a><a class="link" href="#router-handler">3.3. Handler</a></h3>
<div class="paragraph">
<p>Application logic goes inside a <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.Handler.html" target="_blank">handler</a>. A
<a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.Handler.html" target="_blank">handler</a> is a function that accepts a <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html" target="_blank">context</a>
object and produces a <code>result</code>.</p>
</div>
<div class="paragraph">
<p>A <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html" target="_blank">context</a> allows you to interact with the <code>HTTP Request</code> and manipulate the
<code>HTTP Response</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Incoming request matches exactly <strong>ONE</strong> route handler. If there is no handler, produces a <code>404</code>
response.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/user/{id}", ctx -&gt; ctx.path("id").value());  <i class="conum" data-value="1"></i><b>(1)</b>

  get("/user/me", ctx -&gt; "my profile");              <i class="conum" data-value="2"></i><b>(2)</b>

  get("/users", ctx -&gt; "users");                     <i class="conum" data-value="3"></i><b>(3)</b>

  get("/users", ctx -&gt; "new users");                 <i class="conum" data-value="4"></i><b>(4)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/user/{id}") { ctx -&gt; ctx.path("id").value() }  <i class="conum" data-value="1"></i><b>(1)</b>

  get("/user/me") { ctx -&gt; "my profile" }              <i class="conum" data-value="2"></i><b>(2)</b>

  get("/users") { ctx -&gt; "users" }                     <i class="conum" data-value="3"></i><b>(3)</b>

  get("/users") { ctx -&gt; "new users" }                 <i class="conum" data-value="4"></i><b>(4)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>GET /user/ppicapiedra</code> ⇒ <code>ppicapiedra</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>GET /user/me</code> ⇒ <code>my profile</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Unreachable ⇒ override it by next route</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>GET /users</code> ⇒ <code>new users</code> not <code>users</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Routes with most specific path pattern (<code>2</code> vs <code>1</code>) has more precedence. Also, is one or more routes
result in the same path pattern, like <code>3</code> and <code>4</code>, last registered route hides/overrides previous route.</p>
</div>
<div class="sect3">
<h4 id="router-handler-decorator"><a class="anchor" href="#router-handler-decorator"></a><a class="link" href="#router-handler-decorator">3.3.1. Decorator</a></h4>
<div class="paragraph">
<p>Cross cutting concerns such as response modification, verification, security, tracing, etc. is available
via <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.Decorator.html" target="_blank">Route.Decorator</a> (a.k.a filter)</p>
</div>
<div class="paragraph">
<p>A <code>decorator</code> takes the <code>next</code> handler in the pipeline and returns a <code>new</code> handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">interface Decorator {
  Handler apply(Handler next);
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Timing decorator example:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  decorator(next -&gt; ctx -&gt; {
    long start = System.currentTimeMillis();       <i class="conum" data-value="1"></i><b>(1)</b>

    Object response = next.apply(ctx);             <i class="conum" data-value="2"></i><b>(2)</b>

    long end = System.currentTimeMillis();
    long took = end - start;

    System.out.println("Took: " + took + "ms");   <i class="conum" data-value="3"></i><b>(3)</b>

    return response;                              <i class="conum" data-value="4"></i><b>(4)</b>
  });

  get("/", ctx -&gt; {
    return "decorator";
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  /** Kotlin uses implicit variables: `ctx` and `next` */
  decorator {
    val start = System.currentTimeMillis()  <i class="conum" data-value="1"></i><b>(1)</b>

    val response = next.apply(ctx)          <i class="conum" data-value="2"></i><b>(2)</b>

    val end = System.currentTimeMillis()
    val took = end - start

    println("Took: " + took + "ms")         <i class="conum" data-value="3"></i><b>(3)</b>

    response                                <i class="conum" data-value="4"></i><b>(4)</b>
  }

  get("/") { ctx -&gt;
    "decorator"
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Saves start time</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Proceed with execution (pipeline)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Compute and print latency</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns a response</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>decorator</code> lacks of a <code>path pattern</code>. Sound strange? It is explained in the <a href="#router-pipeline">pipeline</a> section.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-handler-before-decorator"><a class="anchor" href="#router-handler-before-decorator"></a><a class="link" href="#router-handler-before-decorator">3.3.2. Before Decorator</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.Before.html" target="_blank">before</a> decorator is a specialized decorator that runs before a
<code>handler</code>.</p>
</div>
<div class="paragraph">
<p>A <code>before</code> decorator takes a <code>context</code> as argument and don’t produces a response. It expected to operate
via side effects (usually modifying the HTTP response).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">interface Before {
  void apply(Context ctx);
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  before(ctx -&gt; {
    ctx.setHeader("Server", "Jooby");
  });

  get("/", ctx -&gt; {
    return "...";
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  before {
    ctx.setHeader("Server", "Jooby")
  }

  get("/") { ctx -&gt;
    "..."
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="router-handler-after-decorator"><a class="anchor" href="#router-handler-after-decorator"></a><a class="link" href="#router-handler-after-decorator">3.3.3. After Decorator</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Route.After.html" target="_blank">after</a> decorator is a specialized decorator that runs after a
<code>handler</code>.</p>
</div>
<div class="paragraph">
<p>An <code>after</code> decorator takes two arguments. The first argument is the <code>HTTP context</code>, while the second
argument is the result/response from a <code>handler</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">interface After {
  Object apply(Context ctx, Object result);
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Example:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  after((ctx, result) -&gt; {
    return "Hello " + result;
  });

  get("/", ctx -&gt; {
    return "Jooby";
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  after {
    "Hello $result"
  }

  get("/") { ctx -&gt;
    "Jooby"
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
<div class="sect2">
<h3 id="router-pipeline"><a class="anchor" href="#router-pipeline"></a><a class="link" href="#router-pipeline">3.4. Pipeline</a></h3>
<div class="paragraph">
<p>Route pipeline (a.k.a route stack) is a composition of one or more decorator(s) tied to a single <code>handler</code>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  // Increment +1
  decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  // Increment +1
  decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/1", ctx -&gt; 1); <i class="conum" data-value="1"></i><b>(1)</b>

  get("/2", ctx -&gt; 2); <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  // Increment +1
  decorator {
    val n = next.apply(ctx) as Int
    1 + n
  }

  // Increment +1
  decorator {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/1") { ctx -&gt; 1 } <i class="conum" data-value="1"></i><b>(1)</b>

  get("/2") { ctx -&gt; 2 } <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/1</code> ⇒ <code>3</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/2</code> ⇒ <code>5</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Behind the scene, Jooby builds something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  // Increment +1
  var increment = decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  Handler one = ctx -&gt; 1;

  Handler two = ctx -&gt; 2;

  Handler handler1 = increment.then(increment).then(one);
  Handler handler2 = increment.then(increment).then(two);

  get("/1", handler1);

  get("/2", handler2);
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Any <code>decorator</code> defined on top of the handler will be stacked/chained into a new handler.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Decorator without path pattern</div>
<div class="paragraph">
<p>This was a hard decision to make, but we know is the right one. Jooby 1.x uses a path pattern to
define <code>filter</code>/<code>decorator</code>.</p>
</div>
<div class="paragraph">
<p>The <code>pipeline</code> in Jooby 1.x consists of multiple filters and handlers. They are match
sequentially one by one. The following <code>filter</code> is always executed in Jooby 1.x</p>
</div>
<div class="listingblock">
<div class="title">Jooby 1.x</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
   use("/*", (req, rsp, chain) -&gt; {
     // remote call, db call
   });

   // ...
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose there is bot trying to access and causing lot of <code>404</code> responses (path doesn’t exist).
In Jooby 1.x the <code>filter</code> is executed for every single request sent by the bot just to realize
there is NO matching route and all we need is a <code>404</code>.</p>
</div>
<div class="paragraph">
<p>In Jooby 2.x this won’t happen anymore. If there is a matching handler, the <code>pipeline</code> will be
executed. Otherwise, nothing will do!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="router-pipeline-order"><a class="anchor" href="#router-pipeline-order"></a><a class="link" href="#router-pipeline-order">3.4.1. Order</a></h4>
<div class="paragraph">
<p>Order follows the <strong>what you see is what you get</strong> approach. Routes are stacked in the way they were added/defined.</p>
</div>
<div class="listingblock primary">
<div class="title">Order example:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  // Increment +1
  decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/1", ctx -&gt; 1);                <i class="conum" data-value="1"></i><b>(1)</b>

  // Increment +1
  decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  get("/2", ctx -&gt; 2);               <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  // Increment +1
  decorator {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/1") { 1 }                <i class="conum" data-value="1"></i><b>(1)</b>

  // Increment +1
  decorator {
    val n = next.apply(ctx) as Int
    1 + n
  }

  get("/2") { ctx -&gt; 2 }                <i class="conum" data-value="2"></i><b>(2)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/1</code> ⇒ <code>2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/2</code> ⇒ <code>4</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="router-pipeline-scoped-decorator"><a class="anchor" href="#router-pipeline-scoped-decorator"></a><a class="link" href="#router-pipeline-scoped-decorator">3.4.2. Scoped Decorator</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#route-java.lang.Runnable-" target="_blank">route(Runnable)</a> and <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#path-java.lang.Runnable-" target="_blank">path(Runnable)</a> operators
are used to group one or more routes.</p>
</div>
<div class="paragraph">
<p>A <code>scoped decorator</code> looks like:</p>
</div>
<div class="listingblock primary">
<div class="title">Scoped decorator:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  // Increment +1
  decorator(next -&gt; ctx -&gt; {
    Number n = (Number) next.apply(ctx);
    return 1 + n.intValue();
  });

  route(() -&gt; {                          <i class="conum" data-value="1"></i><b>(1)</b>
    // Multiply by 2
    decorator(next -&gt; ctx -&gt; {
      Number n = (Number) next.apply(ctx);
      return 2 * n.intValue();
    });

    get("/4", ctx -&gt; 4);                 <i class="conum" data-value="2"></i><b>(2)</b>
  });

  get("/1", ctx -&gt; 1);                   <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  // Increment +1
  decorator {
    val n = next.apply(ctx) as Int
    return 1 + n
  }

  route {                                <i class="conum" data-value="1"></i><b>(1)</b>
    // Multiply by 2
    decorator {
      val n = next.apply(ctx) as Int
      1 + n
    }

    get("/4") { ctx -&gt; 4 }               <i class="conum" data-value="2"></i><b>(2)</b>
  });

  get("/3") { ctx -&gt; 3 }                 <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Introduce a new scope via <code>route</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/4</code>  ⇒ <code>9</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>/1</code>  ⇒ <code>2</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is a normal <code>decorator</code> inside of one of the group operators.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="router-grouping-routes"><a class="anchor" href="#router-grouping-routes"></a><a class="link" href="#router-grouping-routes">3.5. Grouping routes</a></h3>
<div class="paragraph">
<p>As showed previously, the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#route-java.lang.Runnable-" target="_blank">route(Runnable)</a> operator push a new route <code>scope</code>
and allows you to selectively apply one or more routes.</p>
</div>
<div class="listingblock primary">
<div class="title">Route operator</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  route(() -&gt; {

    get("/", ctx -&gt; "Hello");

  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  route {

    get("/") { ctx -&gt;
      "Hello"
    }

  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Route operator is for grouping one or more routes and apply cross cutting concerns to all them.</p>
</div>
<div class="paragraph">
<p>In similar fashin the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#path-java.lang.String,java.lang.Runnable-" target="_blank">path(String,Runnable)</a> operator groups
one or more routes under a common path pattern.</p>
</div>
<div class="listingblock primary">
<div class="title">Routes with path prefix:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
   path("/api/user", () -&gt; {    <i class="conum" data-value="1"></i><b>(1)</b>

     get("/{id}", ctx -&gt; ...);  <i class="conum" data-value="2"></i><b>(2)</b>

     get("/", ctx -&gt; ...);      <i class="conum" data-value="3"></i><b>(3)</b>

     post("/", ctx -&gt; ...);     <i class="conum" data-value="4"></i><b>(4)</b>

     ...
   });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
   path("/api/user") {            <i class="conum" data-value="1"></i><b>(1)</b>

     get("/{id}") { ctx -&gt; ...}   <i class="conum" data-value="2"></i><b>(2)</b>

     get("/") { ctx -&gt; ...}       <i class="conum" data-value="3"></i><b>(3)</b>

     post("/") { ctx -&gt; ...}      <i class="conum" data-value="4"></i><b>(4)</b>

     ...
   });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set common prefix <code>/api/user</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>GET /api/user/{id}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>GET /api/user</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>POST /api/user</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="router-composing-routes"><a class="anchor" href="#router-composing-routes"></a><a class="link" href="#router-composing-routes">3.6. Composing routes</a></h3>
<div class="paragraph">
<p>Composition is a technique for building modular applications. You can compose one or more
router/application into a new one.</p>
</div>
<div class="paragraph">
<p>Composition is available through the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#use-io.jooby.Router-" target="_blank">use(Router)</a> operator:</p>
</div>
<div class="listingblock primary">
<div class="title">Composing</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class Foo extends Jooby {
  {
    get("/foo", Context::pathString);
  }
}

public class Bar extends Jooby {
  {
    get("/bar", Context::pathString);
  }
}

public class App extends Jooby {
  {
    use(new Foo());                     <i class="conum" data-value="1"></i><b>(1)</b>

    use(new Bar());                     <i class="conum" data-value="2"></i><b>(2)</b>

    get("/app", Context::pathString);   <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class Foo: Kooby({

  get("/foo") { ctx -&gt; ctx.pathString() }

})

class Bar: Kooby({

  get("/bar") { ctx -&gt; ctx.pathString() }

})

class Bar: Kooby({
  use(Foo())                       <i class="conum" data-value="1"></i><b>(1)</b>

  use(Bar())                       <i class="conum" data-value="2"></i><b>(2)</b>

  get("/app") { ctx -&gt; ctx.pathString() } <i class="conum" data-value="3"></i><b>(3)</b>
})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imports all routes from <code>Foo</code>. Output: <code>/foo</code> ⇒ <code>/foo</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Imports all routes from <code>Bar</code>. Output: <code>/bar</code> ⇒ <code>/bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add more routes . Output <code>/app</code> ⇒ <code>/app</code></td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Composing with path prefix</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class Foo extends Jooby {
  {
    get("/foo", Context::pathString);
  }
}

public class App extends Jooby {
  {
    use("/prefix", new Foo());  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class Foo: Kooby({

  get("/foo") { ctx -&gt; ctx.pathString() }

})

class App: Kooby({

  use("/prefix", Foo())  <i class="conum" data-value="1"></i><b>(1)</b>

})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Now all routes from <code>Foo</code> will be prefixed with <code>/prefix</code>. Output: <code>/prefix/foo</code> ⇒ <code>/prefix/foo</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Composition is a great option for modularization. You can easily develop/test/deploy each
application indendepently and compose them all in another application.</p>
</div>
<div class="paragraph">
<p>We do provide <a href="#introduction-mvc-api">MVC API</a> as another alternative for modularization.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="router-dynamic-routing"><a class="anchor" href="#router-dynamic-routing"></a><a class="link" href="#router-dynamic-routing">3.7. Dynamic Routing</a></h3>
<div class="paragraph">
<p>Dynamic routing is looks similar to <a href="#composition">composition</a> but enabled/disabled routes at runtime
using a <code>predicate</code>.</p>
</div>
<div class="paragraph">
<p>Suppose you own two version of an <code>API</code> and for some time you need to support both: <code>old</code> and <code>new</code> API:</p>
</div>
<div class="listingblock primary">
<div class="title">Dynamic Routing</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class V1 extends Jooby {
  {
    get("/api", ctx -&gt; "v1");
  }
}

public class V2 extends Jooby {
  {
    get("/api", ctx -&gt; "v2");
  }
}

public class App extends Jooby {
  {
    use(ctx -&gt; ctx.header("version").value().equals("v1"), new V1()); <i class="conum" data-value="1"></i><b>(1)</b>

    use(ctx -&gt; ctx.header("version").value().equals("v2"), new V2()); <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class V1: Kooby({

  get("/api") { ctx -&gt; "v1" }

})

class V2: Kooby({

  get("/api") { ctx -&gt; "v2" }

})

class App: Kooby({

  use(ctx -&gt; ctx.header("version").value().equals("v1"), V1()); <i class="conum" data-value="1"></i><b>(1)</b>

  use(ctx -&gt; ctx.header("version").value().equals("v2"), V2()); <i class="conum" data-value="2"></i><b>(2)</b>

})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Output:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/api</code> ⇒ <code>v1</code>; when <code>version</code> header is <code>v1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/api</code> ⇒ <code>v2</code>; when <code>version</code> header is <code>v2</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Done ♡!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="context"><a class="anchor" href="#context"></a><a class="link" href="#context">4. Context</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html" target="_blank">Context</a> allows you to interact with the HTTP Request and manipulate the HTTP Response</p>
</div>
<div class="sect2">
<h3 id="context-parameters"><a class="anchor" href="#context-parameters"></a><a class="link" href="#context-parameters">4.1. Parameters</a></h3>
<div class="paragraph">
<p>There are several parameter types: <code>header</code>, <code>cookie</code>, <code>path</code>, <code>query</code>, <code>form</code> and <code>multipart</code>.
All them share an unified/type-safe API for accessing and manipulating their values.</p>
</div>
<div class="paragraph">
<p>We are going to describe them briefly in the next sections, then go into specific features of the
<a href="#context-value-api">Value API</a>.</p>
</div>
<div class="sect3">
<h4 id="context-parameters-header"><a class="anchor" href="#context-parameters-header"></a><a class="link" href="#context-parameters-header">4.1.1. Header</a></h4>
<div class="paragraph">
<p>HTTP headers allow the client and the server to pass additional information with the request or the
response.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    String token = ctx.header("token").value();      <i class="conum" data-value="1"></i><b>(1)</b>

    Value headers = ctx.headers();                   <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, String&gt; headerMap = ctx.headerMap(); <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  });

}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val token = ctx.header("token").value() <i class="conum" data-value="1"></i><b>(1)</b>

    val headers = ctx.headers()             <i class="conum" data-value="2"></i><b>(2)</b>

    val = ctx.headerMap();                  <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  });

}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Header variable <code>token</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All headers as <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html" target="_blank">Value</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All headers as map</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-cookie"><a class="anchor" href="#context-parameters-cookie"></a><a class="link" href="#context-parameters-cookie">4.1.2. Cookie</a></h4>
<div class="paragraph">
<p>Request cookies are send to the server using the <code>Cookie</code> header, but we do provide a simple
<code>key/value</code> access to them:</p>
</div>
<div class="listingblock primary">
<div class="title">Cookies</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    String token = ctx.cookie("token").value();      <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, String&gt; cookieMap = ctx.cookieMap(); <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });

}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val token = ctx.cookie("token").value() <i class="conum" data-value="1"></i><b>(1)</b>

    val = ctx.cookieMap();                  <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });

}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cookie variable <code>token</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All cookies as map</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-path"><a class="anchor" href="#context-parameters-path"></a><a class="link" href="#context-parameters-path">4.1.3. Path</a></h4>
<div class="paragraph">
<p>Path parameter are part of the <code>URI</code>. To define a path variable you need to use the <code>{identifier}</code> notation.</p>
</div>
<div class="listingblock primary">
<div class="title">Syntax:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/{id}" ctx -&gt; ctx.path("id").value());                                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/@{id}" ctx -&gt; ctx.path("id").value());                                <i class="conum" data-value="2"></i><b>(2)</b>

  get("/file/{name}.{ext}", ctx -&gt; cxt.path("name") + "." + ctx.path("ext")); <i class="conum" data-value="3"></i><b>(3)</b>

  get("/file/*", ctx -&gt; ctx.path("*"))                                        <i class="conum" data-value="4"></i><b>(4)</b>

  get("/{id:[0-9]+}", ctx -&gt; ctx.path("id))                                   <i class="conum" data-value="5"></i><b>(5)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/{id}") { ctx -&gt; ctx.path("id").value() }                                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/@{id}") { ctx -&gt; ctx.path("id").value() }                                <i class="conum" data-value="2"></i><b>(2)</b>

  get("/file/{name}.{ext}") { ctx -&gt; cxt.path("name") + "." + ctx.path("ext") }  <i class="conum" data-value="3"></i><b>(3)</b>

  get("/file/*") { ctx -&gt; ctx.path("*") }                                        <i class="conum" data-value="4"></i><b>(4)</b>

  get("/{id:[0-9]+}") { ctx -&gt; ctx.path("id) }                                   <i class="conum" data-value="5"></i><b>(5)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Path variable <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path variable <code>id</code> prefixed with <code>@</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Multiple variables <code>name</code> and <code>ext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Unnamed catchall path variable</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Path variable with a regular expression</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/{name}", ctx -&gt; {
    String pathString = ctx.pathString();         <i class="conum" data-value="1"></i><b>(1)</b>

    Value path = ctx.path();                      <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, String&gt; pathMap = ctx.pathMap();  <i class="conum" data-value="3"></i><b>(3)</b>

    String name = ctx.path("name").value();       <i class="conum" data-value="4"></i><b>(4)</b>

    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/{name}") { ctx -&gt;
    val pathString = ctx.pathString()     <i class="conum" data-value="1"></i><b>(1)</b>

    val path = ctx.path()                 <i class="conum" data-value="2"></i><b>(2)</b>

    val pathMap = ctx.pathMap()           <i class="conum" data-value="3"></i><b>(3)</b>

    val name = ctx.path("name").value()   <i class="conum" data-value="4"></i><b>(4)</b>

    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to the <code>raw</code> path string:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    ⇒ <code>/a+b</code></p>
</li>
<li>
<p><code>/a b</code>    ⇒ <code>/a%20b</code>  (not decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> ⇒ <code>/%2F%2B</code> (not decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path as <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html" target="_blank">Value</a> object:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    ⇒ <code>{name=a+b}</code></p>
</li>
<li>
<p><code>/a b</code>    ⇒ <code>{name=a b}</code> (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> ⇒ <code>{name=/+}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Path as <code>Map&lt;String, String&gt;</code> object:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    ⇒ <code>{name=a+b}</code></p>
</li>
<li>
<p><code>/a b</code>    ⇒ <code>{name=a b}</code> (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> ⇒ <code>{name=/+}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Path variable <code>name</code> as <code>String</code>:
<div class="ulist">
<ul>
<li>
<p><code>/a+b</code>    ⇒ <code>a+b</code></p>
</li>
<li>
<p><code>/a b</code>    ⇒ <code>a b</code>  (decoded)</p>
</li>
<li>
<p><code>/%2F%2B</code> ⇒ <code>/+</code>   (decoded)</p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-query"><a class="anchor" href="#context-parameters-query"></a><a class="link" href="#context-parameters-query">4.1.4. Query</a></h4>
<div class="paragraph">
<p>Query String is part of the <code>URI</code> that start after the <code>?</code> character.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/search", ctx -&gt; {
    String queryString = ctx.queryString();                    <i class="conum" data-value="1"></i><b>(1)</b>

    QueryString query = ctx.query();                           <i class="conum" data-value="2"></i><b>(2)</b>

    Map&lt;String, List&lt;String&gt;&gt; queryMap = ctx.queryMultimap();  <i class="conum" data-value="3"></i><b>(3)</b>

    String q = ctx.query("q").value();                         <i class="conum" data-value="4"></i><b>(4)</b>

    SearchQuery searchQuery = ctx.query(SearchQuery.class);    <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

class SearchQuery {

   public final String q;

   public SearchQuery(String q) {
     this.q = q;
   }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/search") { ctx -&gt;
    val queryString = ctx.queryString()         <i class="conum" data-value="1"></i><b>(1)</b>

    val query = ctx.query()                     <i class="conum" data-value="2"></i><b>(2)</b>

    val queryMap = ctx.queryMultimap()          <i class="conum" data-value="3"></i><b>(3)</b>

    val q = ctx.query("q").value()              <i class="conum" data-value="4"></i><b>(4)</b>

    val searchQuery = ctx.query&lt;SearchQuery&gt;()  <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

data class SearchQuery (val q: String)</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to <code>raw</code> queryString:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       ⇒ <code>""</code> (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> ⇒ <code>?q=a+b</code></p>
</li>
<li>
<p><code>/search?q=a b</code> ⇒ <code>?q=a%20b</code> (not decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Query String as <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/QueryString.html" target="_blank">QueryString</a> object:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       ⇒ <code>{}</code>      (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> ⇒ <code>{q=a+b}</code></p>
</li>
<li>
<p><code>/search?q=a b</code> ⇒ <code>{q=a b}</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Query string as <code>multi-value map</code>
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       ⇒ <code>{}</code>       (empty)</p>
</li>
<li>
<p><code>/search?q=a+b</code> ⇒ <code>{q=[a+b]}</code></p>
</li>
<li>
<p><code>/search?q=a b</code> ⇒ <code>{q=[a b]}</code>  (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access to decoded variable <code>q</code>:
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       ⇒ <code>Bad Request (400). Missing value: "q"</code></p>
</li>
<li>
<p><code>/search?q=a+b</code> ⇒ <code>a+b</code></p>
</li>
<li>
<p><code>/search?q=a b</code> ⇒ <code>a b</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query string as <code>SearchQuery</code>
<div class="ulist">
<ul>
<li>
<p><code>/search</code>       ⇒ <code>Bad Request (400). Missing value: "q"</code></p>
</li>
<li>
<p><code>/search?q=a+b</code> ⇒ <code>SearchQuery(q="a+b")</code></p>
</li>
<li>
<p><code>/search?q=a b</code> ⇒ <code>SearchQuery(q="a b")</code> (decoded)</p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-formdata"><a class="anchor" href="#context-parameters-formdata"></a><a class="link" href="#context-parameters-formdata">4.1.5. Formdata</a></h4>
<div class="paragraph">
<p>Formdata is expected to be in HTTP body, or for as part of the <code>URI</code> for <code>GET</code> requests.</p>
</div>
<div class="paragraph">
<p>Data is expected to be encoded as <code>application/x-www-form-urlencoded</code>.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  post("/user", ctx -&gt; {
    Formdata form = ctx.form();                             <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, List&lt;String&gt;&gt; formMap = ctx.formMultimap(); <i class="conum" data-value="2"></i><b>(2)</b>

    String userId = ctx.form("id").value();                 <i class="conum" data-value="3"></i><b>(3)</b>

    String pass = ctx.form("pass").value();                 <i class="conum" data-value="4"></i><b>(4)</b>

    User user = ctx.form(User.class);                       <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

class User {

   public final String id;

   public final String pass;

   public User(String id, String pass) {
     this.id = id;
     this.pass = pass;
   }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  post("/user") { ctx -&gt;
    val form = ctx.form()               <i class="conum" data-value="1"></i><b>(1)</b>

    val formMap = ctx.formMultimap()    <i class="conum" data-value="2"></i><b>(2)</b>

    val userId = ctx.form("id").value() <i class="conum" data-value="3"></i><b>(3)</b>

    val pass = ctx.form("pass").value() <i class="conum" data-value="4"></i><b>(4)</b>

    val user = ctx.form&lt;User&gt;()         <i class="conum" data-value="5"></i><b>(5)</b>

    ...
  });
}

data class User (val id: String, val pass: String)</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="content">
<pre>curl -d "id=root&amp;pass=pwd" -X POST http://localhost:8080/user</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Form as <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Formdata.html" target="_blank">Formdata</a> ⇒ <code>{id=root, pass=pwd}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Form as <code>multi-value map</code>  ⇒ <code>{id=root, pass=[pwd]}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Form variable <code>id</code>         ⇒ <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Form variable <code>pass</code>       ⇒ <code>pwd</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Form as <code>User</code> object      ⇒ <code>User(id=root, pass=pwd)</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-parameters-multipart"><a class="anchor" href="#context-parameters-multipart"></a><a class="link" href="#context-parameters-multipart">4.1.6. Multipart</a></h4>
<div class="paragraph">
<p>Form-data must be present in the HTTP body and encoded as <code>multipart/form-data</code>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  post("/user", ctx -&gt; {
    Multipart multipart = ctx.multipart();                            <i class="conum" data-value="1"></i><b>(1)</b>

    Map&lt;String, List&lt;String&gt; multipartMap = ctx.multipartMultimap();  <i class="conum" data-value="2"></i><b>(2)</b>

    String userId = ctx.multipart("id").value();                      <i class="conum" data-value="3"></i><b>(3)</b>

    String pass = ctx.multipart("pass").value();                      <i class="conum" data-value="4"></i><b>(4)</b>

    FileUpload pic = ctx.multipart("pic").fileUpload();               <i class="conum" data-value="5"></i><b>(5)</b>

    User user = ctx.multipart(User.class);                            <i class="conum" data-value="6"></i><b>(6)</b>

    ...
  });
}

class User {

   public final String id;

   public final String pass;

   public final FileUpload pic;

   public User(String id, String pass, FileUpload pic) {
     this.id = id;
     this.pass = pass;
     this.pic = pic;
   }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  post("/user") { ctx -&gt;
    val multipart = ctx.multipart()              <i class="conum" data-value="1"></i><b>(1)</b>

    val multipartMap = ctx.multipartMultimap()   <i class="conum" data-value="2"></i><b>(2)</b>

    val userId = ctx.multipart("id").value()     <i class="conum" data-value="3"></i><b>(3)</b>

    val pass = ctx.multipart("pass").value()     <i class="conum" data-value="4"></i><b>(4)</b>

    val pic = ctx.multipart("pic").fileUpload()  <i class="conum" data-value="5"></i><b>(5)</b>

    val user = ctx.multipart&lt;User&gt;()             <i class="conum" data-value="6"></i><b>(6)</b>

    ...
  });
}

data class User (val id: String, val pass: String, val pic: FileUpload)</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="content">
<pre>curl -F id=root -F pass=root -F pic=@/path/to/local/file/profile.png http://localhost:8080/user</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Form as <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Multipart.html" target="_blank">Multipart</a> ⇒ <code>{id=root, pass=pwd, pic=profile.png}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Form as <code>multi-value map</code>   ⇒ <code>{id=root, pass=[pwd]}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Form variable <code>id</code>          ⇒ <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Form variable <code>pass</code>        ⇒ <code>pwd</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/FileUpload.html" target="_blank">FileUpload</a> variable <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Form as <code>User</code> object       ⇒ <code>User(id=root, pass=pwd, pic=profile.png)</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">File Upload</div>
<div class="paragraph">
<p>You may prefer to use one of the utility methods:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">  FileUpload pic = ctx.file("pic");         <i class="conum" data-value="1"></i><b>(1)</b>

  List&lt;FileUpload&gt; pic = ctx.files("pic");  <i class="conum" data-value="2"></i><b>(2)</b>

  List&lt;FileUpload&gt; files = ctx.files();     <i class="conum" data-value="3"></i><b>(3)</b></code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">  val pic = ctx.file("pic")   <i class="conum" data-value="1"></i><b>(1)</b>

  val pic = ctx.files("pic")  <i class="conum" data-value="2"></i><b>(2)</b>

  val files = ctx.files()     <i class="conum" data-value="3"></i><b>(3)</b></code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Single file upload named <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Multiple file uploads named <code>pic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All file uploads</td>
</tr>
</tbody></table>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-value-api"><a class="anchor" href="#context-value-api"></a><a class="link" href="#context-value-api">4.2. Value API</a></h3>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html" target="_blank">Value</a> is an unified and type-safe API across all parameter types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-header">Header</a></p>
</li>
<li>
<p><a href="#context-parameters-path">Path</a></p>
</li>
<li>
<p><a href="#context-parameters-query">Query</a></p>
</li>
<li>
<p><a href="#context-parameters-formdata">Formdata</a></p>
</li>
<li>
<p><a href="#context-parameters-multipart">Multipart</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For learning purpose we are going to show all the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html" target="_blank">Value</a> features using query
parameters, but keep in mind these features apply to all the parameter types.</p>
</div>
<div class="sect3">
<h4 id="context-value-api-single-value"><a class="anchor" href="#context-value-api-single-value"></a><a class="link" href="#context-value-api-single-value">4.2.1. Single value</a></h4>
<div class="paragraph">
<p>Single value is available via <code>value()</code> or <code>[type]Value()</code> functions:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    String name = ctx.query("name").value();                          <i class="conum" data-value="1"></i><b>(1)</b>

    float score = ctx.query("score").floatValue();                    <i class="conum" data-value="2"></i><b>(2)</b>

    boolean enabled = ctx.query("enabled").booleanValue();            <i class="conum" data-value="3"></i><b>(3)</b>

    BigDecimal decimal = ctx.query("decimal").value(BigDecimal::new); <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val name = ctx.query("name").value()                     <i class="conum" data-value="1"></i><b>(1)</b>

    val score = ctx.query("score").floatValue()              <i class="conum" data-value="2"></i><b>(2)</b>

    val enabled = ctx.query("enabled").booleanValue()        <i class="conum" data-value="3"></i><b>(3)</b>

    val decimal = ctx.query("decimal").value(::BigDecimal)   <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The <code>value()</code> family methods always retrieve a <code>value</code>. If there is no value, a
<code>BadRequest(400)</code> response is generated. So single value parameters <strong>are required</strong>:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to query parameter <code>q</code> and convert to <code>String</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?name=foo</code> ⇒ <code>foo</code></p>
</li>
<li>
<p><code>/</code>          ⇒ <code>Bad Request(400): Missing value: "q"</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to query parameter <code>score</code> and convert to <code>float</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?score=1</code>      ⇒ <code>1.0</code></p>
</li>
<li>
<p><code>/?score=string</code> ⇒ <code>Bad Request(400)</code> (Type mismatch: cannot convert to number)</p>
</li>
<li>
<p><code>/</code>              ⇒ <code>Bad Request(400)</code> (Required parameter <code>score</code> is not present)</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Access to query parameter <code>enabled</code> and convert to <code>boolean</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?enabled=true</code>   ⇒ <code>true</code></p>
</li>
<li>
<p><code>/?enabled=string</code> ⇒ <code>Bad Request(400)</code> (Type mismatch: cannot convert to boolean)</p>
</li>
<li>
<p><code>/</code>                ⇒ <code>Bad Request(400): Missing value: "enabled"</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access to query parameter <code>decimal</code> and convert to <code>BigDecimal</code>:
<div class="ulist">
<ul>
<li>
<p><code>/?decimal=2.3</code>    ⇒ <code>2.3</code></p>
</li>
<li>
<p><code>/?decimal=string</code> ⇒ <code>Bad Request(400)</code> (Type mismatch: cannot convert to BigDecimal)</p>
</li>
<li>
<p><code>/</code>                ⇒ <code>Bad Request(400): Missing value: "decimal"</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-default-and-optional-value"><a class="anchor" href="#context-value-api-default-and-optional-value"></a><a class="link" href="#context-value-api-default-and-optional-value">4.2.2. Default and Optional value</a></h4>
<div class="paragraph">
<p>Default and optional value are available in two different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Providing a default value</p>
</li>
<li>
<p>Requesting an <code>java.uti.Optional</code> object</p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/search", ctx -&gt; {
    String q = ctx.query("q").value("*:*");             <i class="conum" data-value="1"></i><b>(1)</b>
    return q;
  });

  get("/search", ctx -&gt; {
    Optional&lt;String&gt; q = ctx.query("q").toOptional();   <i class="conum" data-value="2"></i><b>(2)</b>
    return q;
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/search") { ctx -&gt;
    val q = ctx.query("q").value("*:*")    <i class="conum" data-value="1"></i><b>(1)</b>
    q
  });

  get("/search") { ctx -&gt;
    val q = ctx.query("q").toOptional();   <i class="conum" data-value="2"></i><b>(2)</b>
    q
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to query variable <code>q</code> and convert to <code>String</code> with a default value of <code><strong>:</strong></code>.
<div class="ulist">
<ul>
<li>
<p><code>/search?q=foo</code> ⇒ <code>foo</code></p>
</li>
<li>
<p><code>/search</code>       ⇒ <code><strong>:</strong></code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access to query variable <code>q</code> and convert to <code>Optional&lt;String&gt;</code>:
<div class="ulist">
<ul>
<li>
<p><code>/search?q=foo</code> ⇒ <code>Optional[foo]</code></p>
</li>
<li>
<p><code>/search</code>       ⇒ <code>Optional.empty</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-multiple-values"><a class="anchor" href="#context-value-api-multiple-values"></a><a class="link" href="#context-value-api-multiple-values">4.2.3. Multiple values</a></h4>
<div class="paragraph">
<p>Multiple values are available via functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html#toList--" target="_blank">toList()</a>: Returns a <code>java.util.List</code> of values</p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html#toSet--" target="_blank">toSet()</a>: Returns a <code>java.util.Set</code> of values</p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    List&lt;String&gt; q = ctx.query("q").toList();                            <i class="conum" data-value="1"></i><b>(1)</b>

    List&lt;Integer&gt; n = ctx.query("n").toList(Integer.class);              <i class="conum" data-value="2"></i><b>(2)</b>

    List&lt;BigDecimal&gt; decimals = ctx.query("d").toList(BigDecimal::new);  <i class="conum" data-value="3"></i><b>(3)</b>

    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val q = ctx.query("q").toList()                     <i class="conum" data-value="1"></i><b>(1)</b>

    val n = ctx.query("n").toList(Integer.class)        <i class="conum" data-value="2"></i><b>(2)</b>

    val decimals = ctx.query("d").toList(::BigDecimal)  <i class="conum" data-value="3"></i><b>(3)</b>

    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Multi-value query parameter <code>q</code> as <code>List&lt;String&gt;</code>:
<div class="ulist">
<ul>
<li>
<p><code>/</code>             ⇒ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?q=foo</code>       ⇒ <code>[foo]</code></p>
</li>
<li>
<p><code>/?q=foo&amp;q=bar</code> ⇒ <code>[foo, bar]</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Multi-value query parameter as <code>List&lt;Integer&gt;</code>
<div class="ulist">
<ul>
<li>
<p><code>/</code>         ⇒ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?n=1</code>     ⇒ <code>[1]</code></p>
</li>
<li>
<p><code>/?n=1&amp;n=2</code> ⇒ <code>[1, 2]</code></p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Multi-value query parameter as <code>List&lt;BigDecimal&gt;</code>
<div class="ulist">
<ul>
<li>
<p><code>/</code>         ⇒ <code>[]</code> (empty list)</p>
</li>
<li>
<p><code>/?d=1</code>     ⇒ <code>[1]</code></p>
</li>
<li>
<p><code>/?d=1&amp;n=2</code> ⇒ <code>[1, 2]</code></p>
</li>
</ul>
</div></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="context-value-api-structured-data"><a class="anchor" href="#context-value-api-structured-data"></a><a class="link" href="#context-value-api-structured-data">4.2.4. Structured data</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html" target="_blank">Value API</a> provides a way to traverse and parse structured data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/?user.name=root&amp;user.pass=pass</pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Traversal</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    Value user = ctx.query("user");                  <i class="conum" data-value="1"></i><b>(1)</b>
    String name  = user.get("name").value();         <i class="conum" data-value="2"></i><b>(2)</b>
    String pass  = user.get("pass").value();         <i class="conum" data-value="3"></i><b>(3)</b>
    String email = user.get("email").value("none");  <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  }}
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val user = ctx.query("user")              <i class="conum" data-value="1"></i><b>(1)</b>
    val name  = user["name"].value()          <i class="conum" data-value="2"></i><b>(2)</b>
    val pass  = user["pass"].value()          <i class="conum" data-value="3"></i><b>(3)</b>
    val email = user["email"].value("none")   <i class="conum" data-value="4"></i><b>(4)</b>
    ...
  }}
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>name</code> value from <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the <code>pass</code> value from <code>user</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get the <code>email</code> value from <code>user</code> node. This is an optional value.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Value.html#get-java.lang.String-" target="_blank">get(String)</a> takes a <code>path</code> and returns another value. The returning
value may or may not exists.</p>
</div>
<div class="sect4">
<h5 id="syntax"><a class="anchor" href="#syntax"></a><a class="link" href="#syntax">Syntax</a></h5>
<div class="paragraph">
<p>Structured data parser supports <code>dot</code> and <code>bracket</code> notation:</p>
</div>
<div class="listingblock">
<div class="title">Dot notation</div>
<div class="content">
<pre>?member.firstname=Pedro&amp;member.lastname=Picapiedra</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bracket object notation</div>
<div class="content">
<pre>?member[firstname]=Pedro&amp;member[lastname]=Picapiedra</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bracket array notation for tabular data</div>
<div class="content">
<pre>?members[0]firstname=Pedro&amp;members[0]lastname=Picapiedra</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pojo"><a class="anchor" href="#pojo"></a><a class="link" href="#pojo">POJO</a></h5>
<div class="paragraph">
<p>Structured data parser is able to reconstruct a POJO (Plain Old Java Object) from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#context-parameters-query">Query</a> encoded as <a href="https://tools.ietf.org/html/rfc3986#section-2" target="_blank">RFC 3986</a></p>
</li>
<li>
<p><a href="#context-parameters-formdata">Formdata</a> encoded as <code>application/x-www-form-urlencoded</code></p>
</li>
<li>
<p><a href="#context-parameters-multipart">Multipart</a> encoded as <code>multipart/form-data</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are going to use a <code>Group</code> and <code>Member</code> objects to demonstrate how the parser works:</p>
</div>
<div class="listingblock primary">
<div class="title">Example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">class Member {
  public final String firstname;
  public final String lastName;

  public Member(String firstname, String lastname) {
    this.firstname = firstname;
    this.lastname = lastname;
  }
}

class Group {
  public final String id;
  public final List&lt;Member&gt; members;

  public Member(String id, List&lt;Member&gt; members) {
    this.id = id;
    this.members = members;
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class Member (val firstname: String, lastName: String)

class Group (val id: String, val members: List&lt;Member&gt;)</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="title">Member parsing example:</div>
<div class="content">
<pre>/?firstname=Pedro&amp;lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    Member member = ctx.query(Member.class);
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val member = ctx.query&lt;Member&gt;()
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="title">Member parsing example from base node:</div>
<div class="content">
<pre>/?member.firstname=Pedro&amp;member.lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    Member member = ctx.query("member").to(Member.class);
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val member = ctx.query("member").to&lt;Member&gt;()
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Tabular data uses the bracket array notation:</p>
</div>
<div class="listingblock">
<div class="title">Member as tabular data:</div>
<div class="content">
<pre>/?[0]firstname=Pedro&amp;[0]lastName=Picapiedra&amp;[1]firstname=Pablo&amp;[2]lastname=Marmol</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    List&lt;Member&gt; members = ctx.query().toList(Member.class);
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val members = ctx.query&lt;List&lt;Member&gt;&gt;()
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="title">Group with members as tabular data:</div>
<div class="content">
<pre>/?id=flintstones&amp;members[0]firstname=Pedro&amp;members[0]lastName=Picapiedra</pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    Group group = ctx.query(Group.class);
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    val group = ctx.query&lt;Group&gt;()
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The target <code>POJO</code> must follow one of these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Has a zero argguments/default constructor, or</p>
</li>
<li>
<p>Has only one constructor</p>
</li>
<li>
<p>Has multiple constructors, but only one is annotated with
<a href="https://static.javadoc.io/javax.inject/javax.inject/1/javax/inject/Inject.html" target="_blank">Inject</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parser matches HTTP parameters in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As constructor arguments</p>
</li>
<li>
<p>As setter method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP parameter name which are not a valid Java identifier must be annotated with <a href="https://static.javadoc.io/javax.inject/javax.inject/1/javax/inject/Named.html" target="_blank">Named</a>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">class Member {
  public final String firstname;

  public final String lastname;

  public Member(@Named("first-name") String firstname, @Named("last-name") String lastname) {
    ....
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class Member (@Named("first-name") val firstname: String, @Named("last-name") val lastName: String)</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>♡♡</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-request-body"><a class="anchor" href="#context-request-body"></a><a class="link" href="#context-request-body">4.3. Request Body</a></h3>
<div class="paragraph">
<p>Raw <code>request body</code> is available via <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#body--" target="_blank">body()</a> method:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  post("/string", ctx -&gt; {
    String body = ctx.body().value();        <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  });

  post("/bytes", ctx -&gt; {
    byte[] body = ctx.body().bytes();        <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  });

  post("/stream", ctx -&gt; {
    InputStream body = ctx.body().stream();  <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  post("/string") { ctx -&gt;
    val body = ctx.body().value()   <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }

  post("/bytes") ctx -&gt; {
    val body = ctx.body().bytes()   <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }

  post("/stream") { ctx -&gt;
    val body = ctx.body().stream()  <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>HTTP Body</code> as <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>HTTP Body</code> as <code>byte array</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>HTTP Body</code> as <code>InputStream</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This give us the <code>raw body</code>.</p>
</div>
<div class="sect3">
<h4 id="context-request-body-parser"><a class="anchor" href="#context-request-body-parser"></a><a class="link" href="#context-request-body-parser">4.3.1. Parser</a></h4>
<div class="paragraph">
<p>Request body parsing is achieved using the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Parser.html" target="_blank">Parser</a> functional interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public interface Parser {

  &lt;T&gt; T parse(Context ctx, Type type) throws Exception;
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Parser.html" target="_blank">Parser</a> has a single <code>parse</code> method that takes two input arguments: <code>(context, type)</code>
and returns a single result of the given type.</p>
</div>
<div class="listingblock primary">
<div class="title">JSON example:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  FavoriteJson lib = new FavoriteJson();           <i class="conum" data-value="1"></i><b>(1)</b>

  parser(MediaType.json, (ctx, type) -&gt; {          <i class="conum" data-value="2"></i><b>(2)</b>

    byte[] body = ctx.body().bytes();              <i class="conum" data-value="3"></i><b>(3)</b>

    return lib.fromJson(body, type);               <i class="conum" data-value="4"></i><b>(4)</b>
  });

  post("/", ctx -&gt; {
    MyObject myObject = ctx.body(MyObject.class);  <i class="conum" data-value="5"></i><b>(5)</b>
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val lib = FavoriteJson()                 <i class="conum" data-value="1"></i><b>(1)</b>

  parser(MediaType.json, { ctx, type -&gt;    <i class="conum" data-value="2"></i><b>(2)</b>

    val body = ctx.body().bytes()          <i class="conum" data-value="3"></i><b>(3)</b>

    lib.fromJson(body, type)               <i class="conum" data-value="4"></i><b>(4)</b>
  }

  post("/") { ctx -&gt;
    val myObject = ctx.body&lt;MyObject&gt;()    <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose your favorite <code>json</code> library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check if the <code>Content-Type</code> header matches <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Ready the body as <code>byte[]</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Parse the <code>body</code> and use the requested type</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Route handler now call the <code>body(Type)</code> function to trigger the parser function</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jooby comes with a <code>json</code> parser built on top of <a href="https://github.com/FasterXML/jackson-databind" target="_blank">Jackson</a>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-jackson&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-jackson:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-response-body"><a class="anchor" href="#context-response-body"></a><a class="link" href="#context-response-body">4.4. Response Body</a></h3>
<div class="paragraph">
<p>Response body is generated from <code>handler</code> function:</p>
</div>
<div class="listingblock primary">
<div class="title">Response body</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    ctx.setResponseConde(200);                  <i class="conum" data-value="1"></i><b>(1)</b>

    ctx.setResponseType(MediaType.text);        <i class="conum" data-value="2"></i><b>(2)</b>

    ctx.setResponseHeader("Date", new Date());  <i class="conum" data-value="3"></i><b>(3)</b>

    return "Response";                          <i class="conum" data-value="4"></i><b>(4)</b>
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    ctx.responseCode = 200                 <i class="conum" data-value="1"></i><b>(1)</b>

    ctx.responseType = MediaType.text      <i class="conum" data-value="2"></i><b>(2)</b>

    ctx.setResponseHeader("Date", Date())  <i class="conum" data-value="3"></i><b>(3)</b>

    "Response"                             <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>status code</code> to <code>OK(200)</code>. This is the default <code>status code</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set <code>content-type</code> to <code>text/plain</code>. This is the default <code>content-type</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the <code>date</code> header</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send a <code>Response</code> string to the client</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="context-response-body-renderer"><a class="anchor" href="#context-response-body-renderer"></a><a class="link" href="#context-response-body-renderer">4.4.1. Renderer</a></h4>
<div class="paragraph">
<p>Response rendering is achieved using the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Renderer.html" target="_blank">Renderer</a> functional interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public interface Renderer {

  byte[] render(@Nonnull Context ctx, @Nonnull Object value) throws Exception;
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Renderer has a single <code>render</code> method that accepts two input arguments: <code>(context, result)</code> and
produces a result.</p>
</div>
<div class="listingblock primary">
<div class="title">JSON example:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  FavoriteJson lib = new FavoriteJson();           <i class="conum" data-value="1"></i><b>(1)</b>

  renderer(MediaType.json, (ctx, result) -&gt; {      <i class="conum" data-value="2"></i><b>(2)</b>

    String json = lib.toJson(result);              <i class="conum" data-value="3"></i><b>(3)</b>

    ctx.setDefaultResponseType(MediaType.json);    <i class="conum" data-value="4"></i><b>(4)</b>

    return json;                                   <i class="conum" data-value="5"></i><b>(5)</b>
  });

  get("/item", ctx -&gt; {
    MyObject myObject = ...;
    return myObject;                               <i class="conum" data-value="6"></i><b>(6)</b>
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val lib = FavoriteJson()                         <i class="conum" data-value="1"></i><b>(1)</b>

  renderer(MediaType.json, { ctx, result -&gt;        <i class="conum" data-value="2"></i><b>(2)</b>

    val json = lib.toJson(result)                  <i class="conum" data-value="3"></i><b>(3)</b>

    ctx.defaultResponseType = MediaType.json       <i class="conum" data-value="4"></i><b>(4)</b>

    json                                           <i class="conum" data-value="5"></i><b>(5)</b>
  }

  get("/item") { ctx -&gt;
    val myObject = ...;
    myObject                                       <i class="conum" data-value="6"></i><b>(6)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose your favorite <code>json</code> library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check if the <code>Accept</code> header matches <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Convert <code>result</code> to <code>JSON</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set default <code>Content-Type</code> to <code>application/json</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Produces JSON response</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Route handler returns a user defined type</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jooby comes with a <code>json</code> renderer built on top of <a href="https://github.com/FasterXML/jackson-databind" target="_blank">Jackson</a>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-jackson&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-jackson:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-model"><a class="anchor" href="#execution-model"></a><a class="link" href="#execution-model">5. Execution Model</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jooby is a flexible performant microframework providing both blocking and non-blocking APIs for
building web applications in Java and Kotlin.</p>
</div>
<div class="paragraph">
<p>In this chapter we are going to learn about Jooby execution model, more specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute code on the <strong>event loop</strong></p>
</li>
<li>
<p>Safely execution of blocking code</p>
</li>
<li>
<p>Working with non-blocking types, like: <code>CompletableFuture</code>, Reactive Streams, Kotlin Coroutines, etc.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="execution-model-mode"><a class="anchor" href="#execution-model-mode"></a><a class="link" href="#execution-model-mode">5.1. Mode</a></h3>
<div class="sect3">
<h4 id="execution-model-mode-event-loop"><a class="anchor" href="#execution-model-mode-event-loop"></a><a class="link" href="#execution-model-mode-event-loop">5.1.1. Event Loop</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode allows us to run a route handler from the
<strong>event loop</strong> (a.k.a as non-blocking mode).</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; "I'm non-blocking!" );
  }

  public static void main(String[] args) {
    runApp(EVENT_LOOP, args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(EVENT_LOOP, args) {
    get("/") { ctx -&gt; "I'm non-blocking!" }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode is the more advanced execution mode and requires you carefully
design and implement your application due to that <strong>BLOCKING IS NOT ALLOWED</strong></p>
</div>
<div class="paragraph">
<p>What if you need to block?</p>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#dispatch-java.lang.Runnable-" target="_blank">dispatch(Runnable)</a> operator moves execution to a <strong>worker executor</strong> which
allows to do <strong>blocking calls</strong>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; {
      return "I'm non-blocking!";
    });

    dispatch(() -&gt; {
      // All the routes defined here are allowed to block:

      get("/db-list", ctx -&gt; {
        /** Safe to block! */
        Object result = ...; // Remote service, db call, etc..
        return result;
      });

    });
  }

  public static void main(String[] args) {
    runApp(EVENT_LOOP, args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(EVENT_LOOP, args) {

    get("/") { ctx -&gt;
      "I'm non-blocking!"
    }

    dispatch {
      // All the routes defined here are allowed to block:

      get("/db-list") { ctx -&gt;
        /** Safe to block! */
        val result = ...; // Remote service, db call, etc..
        result
      }

    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>By default, the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#dispatch-java.lang.Runnable-" target="_blank">dispatch(Runnable)</a> operator moves execution to the <strong>server
worker executor</strong> (executor provided by web server).</p>
</div>
<div class="paragraph">
<p>You can provide your own <strong>worker executor</strong> at application level or at dispatch level:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.ExecutionMode.EVENT_LOOP;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    // Application level executor
    worker(Executors.newCachedThreadPool());

    // Dispatch to application level executor which is cached thread pool
    dispatch(() -&gt; {
      ...
    });

    // Dispatch to a explicit executor
    Executor cpuIntensive = Executors.newSingleThreadExecutor();
    dispatch(cpuIntesive, () -&gt; {
      ...
    });
  }

  public static void main(String[] args) {
    runApp(EVENT_LOOP, args, App:new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.ExecutionMode.EVENT_LOOP
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(EVENT_LOOP, args) {

    // Application level executor
    worker(Executors.newCachedThreadPool())

    // Dispatch to application level executor which is cached thread pool
    dispatch {
      ...
    }

    // Dispatch to a explicit executor
    Executor cpuIntensive = Executors.newSingleThreadExecutor()
    dispatch(cpuIntesive) {
      ...
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="execution-model-mode-worker"><a class="anchor" href="#execution-model-mode-worker"></a><a class="link" href="#execution-model-mode-worker">5.1.2. Worker</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a> mode allows us to do blocking calls from a route handler (a.k.a blocking mode).
You just write code without worrying about blocking calls.</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.ExecutionMode.WORKER;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/", ctx -&gt; {
      /** Safe to block! */
      Object result = // Remote service, db call, etc..
      return result;
    });
  }

  public static void main(String[] args) {
    runApp(WORKER, args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.ExecutionMode.WORKER
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(WORKER, args) {

    get("/") { ctx -&gt;
      /** Safe to block! */
      val result = ...;// Remote service, db call, etc..
      result
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Like with <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> mode, you can provide your own worker executor:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.ExecutionMode.WORKER;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    worker(Executors.newCachedThreadPool());

    get("/", ctx -&gt; {
      /** Safe to block from cached thread pool! */
      Object result = // Remote service, db call, etc..
      return result;
    });
  }

  public static void main(String[] args) {
    runApp(WORKER, args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.ExecutionMode.WORKER
import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(WORKER, args) {

    worker(Executors.newCachedThreadPool())

    get("/") { ctx -&gt;
      /** Safe to block from cached thread pool! */
      val result = ...;// Remote service, db call, etc..
      result
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While running in <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a> mode, Jooby internally does the dispatch call to the
worker executor. This is done per route, not globally.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="execution-model-mode-default"><a class="anchor" href="#execution-model-mode-default"></a><a class="link" href="#execution-model-mode-default">5.1.3. Default</a></h4>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#DEFAULT" target="_blank">DEFAULT</a> execution mode is a mix between <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a>
and <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> modes. This (as name implies) is the default execution mode in Jooby.</p>
</div>
<div class="paragraph">
<p>Jooby detects the route response type and determines which execution mode fits better.</p>
</div>
<div class="paragraph">
<p>If the response type is considered non-blocking, then it uses the <strong>event loop</strong>. Otherwise, it uses
the <strong>worker executor</strong>.</p>
</div>
<div class="paragraph">
<p>A response type is considered <strong>non-blocking</strong> when route handler produces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>CompletableFuture</code> type</p>
</li>
<li>
<p>A <a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava type</a></p>
</li>
<li>
<p>A <a href="https://projectreactor.io/" target="_blank">Reactor type</a></p>
</li>
<li>
<p>A <a href="https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html" target="_blank">Kotlin coroutine</a></p>
</li>
</ul>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    get("/non-blocking", ctx -&gt; {
      return CompletableFuture
          .supplyAsync(() -&gt; "I'm non-blocking!")  <i class="conum" data-value="1"></i><b>(1)</b>
    });

    get("/blocking", ctx -&gt; {
      return "I'm blocking";                       <i class="conum" data-value="2"></i><b>(2)</b>
    });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.Jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    get("/non-blocking") { ctx -&gt;
      CompletableFuture
          .supplyAsync { "I'm non-blocking!" }  <i class="conum" data-value="1"></i><b>(1)</b>
    }

    get("/blocking") { ctx -&gt;
      "I'm blocking"                            <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>CompletableFuture</code> is a non-blocking type, run in <strong>event loop</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>String</code> is a blocking type, run in <strong>worker executor</strong></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You are free to use <strong>non-blocking</strong> types in all the other execution mode too. Non-blocking response
types are not specific to the <strong>default mode</strong> execution. All the <strong>default mode</strong> does with them is
to dispatch or not to a <strong>worker executor</strong>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="execution-model-worker-executor"><a class="anchor" href="#execution-model-worker-executor"></a><a class="link" href="#execution-model-worker-executor">5.2. Worker Executor</a></h3>
<div class="paragraph">
<p>This section described some details about the default <strong>worker executor</strong> provided by web server. The
worker executor is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application mode was set to <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#WORKER" target="_blank">WORKER</a></p>
</li>
<li>
<p>Application mode was set to <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/ExecutionMode.html#EVENT_LOOP" target="_blank">EVENT_LOOP</a> and there is a <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Router.html#dispatch-java.lang.Runnable-" target="_blank">dispatch(Runnable)</a> call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each web server provides a default <strong>worker executor</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netty: The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/netty/Netty.html" target="_blank">Netty server</a> implementation multiply the number of available processors
(with a minimum of 2) by 8.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>workerThreads = Math.max(Runtime.getRuntime().availableProcessors(), 2) * 8</pre>
</div>
</div>
<div class="paragraph">
<p>For example <code>8</code> cores gives us <code>64</code> worker threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Undertow: The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/utow/Utow.html" target="_blank">Undertow server</a> implementation multiply the number of available processors
(with a minimum of 2) by 8.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>workerThreads = Math.max(Runtime.getRuntime().availableProcessors(), 2) * 8</pre>
</div>
</div>
<div class="paragraph">
<p>For example <code>8</code> cores gives us <code>64</code> worker threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jetty: The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/jetty/Jetty.html" target="_blank">Jetty server</a> implementation uses the default configuration
with <code>200</code> worker threads.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are sensible defaults suggested by the server implementation. If you need to increase/decrease
worker threads:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  configureServer(server -&gt; {
    server.workerThreads(Number);
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  configureServer { server -&gt;
    server.workerThreads(Number)
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
</div>
<div class="sect1">
<h2 id="responses"><a class="anchor" href="#responses"></a><a class="link" href="#responses">6. Responses</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers some special response types, like <code>raw responses</code>, <code>streaming</code>, <code>file download</code>, <code>non-blocking</code>, etc…​</p>
</div>
<div class="sect2">
<h3 id="responses-raw"><a class="anchor" href="#responses-raw"></a><a class="link" href="#responses-raw">6.1. Raw</a></h3>
<div class="paragraph">
<p>Raw responses are NOT processed by a <a href="#context-response-body-renderer">Renderer</a>. These response types are considered <code>raw</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String/CharSequence</p>
</li>
<li>
<p>byte[]</p>
</li>
<li>
<p>java.nio.ByteBuffer/io.netty.buffer.ByteBuf</p>
</li>
<li>
<p>java.io.File/java.io.InputStream/java.nio.file.Path/java.nio.channels.FileChannel</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Generate a JSON String from handler</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/json", ctx -&gt; {
    ctx.setContentType(MediaType.json);
    return "{\"message\": \"Hello Raw Response\"}";
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/json") { ctx -&gt;
    ctx.contentType = MediaType.json
    """
      "message": "Hello Raw Response"
    """
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>No matter if there is a JSON renderer installed, a raw response is always send directly to client.</p>
</div>
</div>
<div class="sect2">
<h3 id="responses-streaming-chunked"><a class="anchor" href="#responses-streaming-chunked"></a><a class="link" href="#responses-streaming-chunked">6.2. Streaming / Chunked</a></h3>
<div class="paragraph">
<p>Streaming/chunked API is available via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#responseStream--" target="_blank">responseStream()</a>: blocking API that provides an <code>OutputStream</code></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#responseWriter--" target="_blank">responseWriter()</a>: blocking API that provides a <code>PrintWriter</code></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#responseSender--" target="_blank">responseSender()</a>: non-blocking API that provides a <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Sender.html" target="_blank">Sender</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of these methods must be call it per request. At the time you call one of these methods Jooby
automatically adds the <code>Transfer-Encoding: chunked</code> header when <code>Content-Length</code> is missing.</p>
</div>
<div class="paragraph">
<p>All the three APIs have a <code>close</code> method. You must call it once you finish.</p>
</div>
<div class="listingblock primary">
<div class="title">Writer example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/chunk", ctx -&gt; {
    try(Writer writer = ctx.responseWriter()) { <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1");                   <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN");
    }

    return ctx;                                 <i class="conum" data-value="3"></i><b>(3)</b>
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/chunk") { ctx -&gt;
    ctx.responseWriter().use {                  <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1")                    <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN")
    }
    ctx                                         <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the <code>Writer</code> inside a try-with-resources statement, so close it automatically.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Write chunks</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return the <code>Context</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There is an overloaded version (for Java mainly) that let you skip the try-with-resources and
automatically close the writer/stream:</p>
</div>
<div class="listingblock primary">
<div class="title">Writer example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/chunk", ctx -&gt; {
    return ctx.responseWriter(writer -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1");             <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN");
    });
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/chunk") { ctx -&gt;
    ctx.responseWriter {                  <i class="conum" data-value="1"></i><b>(1)</b>
      writer.write("chunk1")              <i class="conum" data-value="2"></i><b>(2)</b>
      ...
      writer.write("chunkN")
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect2">
<h3 id="responses-file-download"><a class="anchor" href="#responses-file-download"></a><a class="link" href="#responses-file-download">6.3. File download</a></h3>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/AttachedFile.html" target="_blank">AttachedFile</a> is used to generate file downloads, i.e. responses with
<code>Content-Disposition</code> header.</p>
</div>
<div class="listingblock primary">
<div class="title">File download example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/download-file", ctx -&gt; {
    Path source = Paths.get("logo.png");
    return new AttachedFile(source);               <i class="conum" data-value="1"></i><b>(1)</b>
  });

  get("/download-stream", ctx -&gt; {
    InputStream source = ...;
    return new AttachedFile("myfile.txt", source); <i class="conum" data-value="2"></i><b>(2)</b>
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/download-file") { ctx -&gt;
    val source = Paths.get("logo.png")
    AttachedFile(source)                <i class="conum" data-value="1"></i><b>(1)</b>
  }

  get("/download-stream") { ctx -&gt;
    val source = ...
    AttachedFile("myfile.txt", source)  <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a download from an <code>InputStream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send a download from a <code>File</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="responses-nonblocking"><a class="anchor" href="#responses-nonblocking"></a><a class="link" href="#responses-nonblocking">6.4. NonBlocking</a></h3>
<div class="paragraph">
<p>Non-blocking responses are a new feature of Jooby 2.x.</p>
</div>
<div class="paragraph">
<p>From user point of view there is nothing special about them, you just write your route handler as
usually due with blocking types.</p>
</div>
<div class="paragraph">
<p>In Jooby 1.x we are force to produces directly/indirectly a <code>Deferred</code> result. All that is gone now,
we don’t need a custom type to do the integration.</p>
</div>
<div class="paragraph">
<p>Before we jump to each of the supported types, we need to learn what occurs in the pipeline when
there is a non-blocking route handler.</p>
</div>
<div class="listingblock primary">
<div class="title">In event loop</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  mode(EVENT_LOOP);                 <i class="conum" data-value="1"></i><b>(1)</b>

  get("/non-blocking", ctx -&gt; {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    return CompletableFuture        <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  mode(EVENT_LOOP)                  <i class="conum" data-value="1"></i><b>(1)</b>

  get("/non-blocking") {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    CompletableFuture               <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>event loop</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Route block run in <strong>event loop</strong>. No blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>event loop</strong>. No blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Running your <code>App</code> in <strong>worker</strong> mode works identically, except for we are able to do blocking calls:</p>
</div>
<div class="listingblock primary">
<div class="title">In worker mode</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  mode(WORKER);                     <i class="conum" data-value="1"></i><b>(1)</b>

  get("/blocking", ctx -&gt; {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    return CompletableFuture        <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  mode(WORKER)                      <i class="conum" data-value="1"></i><b>(1)</b>

  get("/blocking") {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    CompletableFuture               <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>worker mode</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Route block run in <strong>worker mode</strong>. Blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>worker mode</strong>. Blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Running your <code>App</code> in <strong>default</strong> mode works identically to running in the <strong>event loop</strong> mode:</p>
</div>
<div class="listingblock primary">
<div class="title">In default mode</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  mode(DEFAULT);                    <i class="conum" data-value="1"></i><b>(1)</b>

  get("/non-blocking", ctx -&gt; {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    return CompletableFuture        <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync(() -&gt; {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        });
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  mode(DEFAULT)                     <i class="conum" data-value="1"></i><b>(1)</b>

  get("/non-blocking") {

    ...                             <i class="conum" data-value="2"></i><b>(2)</b>

    CompletableFuture               <i class="conum" data-value="3"></i><b>(3)</b>
        .supplyAsync {
          ...                       <i class="conum" data-value="4"></i><b>(4)</b>
        }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>App run in <strong>event loop</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Route block run in <strong>event loop</strong>. No blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value is provided from <strong>event loop</strong>. No blocking code is permitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value is computed/produces from completable future context</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <strong>default</strong> mode mimics the <strong>event loop</strong> mode execution when route produces a <strong>non-blocking</strong> type.</p>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-limitations"><a class="anchor" href="#responses-nonblocking-limitations"></a><a class="link" href="#responses-nonblocking-limitations">6.4.1. Limitations</a></h4>
<div class="paragraph">
<p>While writing non-blocking/reactive responses we should <strong>avoid the use of Jooby filters</strong>: <a href="#router-handler-decorator">decorator</a>, <a href="#before">before</a> and <a href="#after">after</a>.</p>
</div>
<div class="paragraph">
<p>In most use cases they won’t work, so it is preferred to avoid them while programming
non-blocking/reactive responses.</p>
</div>
<div class="paragraph">
<p>On non-blocking/reactive responses there is always a "dispatch call". This call moves execution to
somewhere else (usually a different thread). Because of this is almost impossible to ensure the
execution of pipeline.</p>
</div>
<div class="quoteblock">
<blockquote>
If you have a non-blocking route handler, it is better to not have any type of filter in the pipeline
</blockquote>
</div>
<div class="paragraph">
<p>The alternative options is to write cross-cutting concerns we usually put inside a filter using the
non-blocking API.</p>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-completablefuture"><a class="anchor" href="#responses-nonblocking-completablefuture"></a><a class="link" href="#responses-nonblocking-completablefuture">6.4.2. CompletableFuture</a></h4>
<div class="paragraph">
<p>CompletableFuture is considered a non-blocking type which is able to produces a single result:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/non-blocking", ctx -&gt; {
    return CompletableFuture
        .supplyAsync(() -&gt; "Completable Future!")
        .thenApply(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/non-blocking") {
    CompletableFuture
        .supplyAsync { "Completable Future!" }
        .thenApply { "Hello $it" }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="responses-nonblocking-rxjava"><a class="anchor" href="#responses-nonblocking-rxjava"></a><a class="link" href="#responses-nonblocking-rxjava">6.4.3. RxJava</a></h4>
<div class="paragraph">
<p>1) Add the <a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava</a> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.reactivex.rxjava2&lt;/groupId&gt;
  &lt;artifactId&gt;rxjava&lt;/artifactId&gt;
  &lt;version&gt;2.2.8&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.reactivex.rxjava2:rxjava:2.2.8'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="sect4">
<h5 id="single"><a class="anchor" href="#single"></a><a class="link" href="#single">Single</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/non-blocking", ctx -&gt; {
    return Single
        .fromCallable(() -&gt; "Single")
        .map(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/non-blocking") {
    Single
        .fromCallable { "Single" }
        .map { "Hello $it" }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="flowable"><a class="anchor" href="#flowable"></a><a class="link" href="#flowable">Flowable</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/non-blocking", ctx -&gt; {
    return Flowable.range(1, 10)
        .map(it -&gt; it + ", ");
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/non-blocking") {
    Flowable.range(1, 10)
        .map{ "$it, " }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>For Flowable, Jooby builds a <code>chunked</code> response. That:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>Transfer-Encoding: chunked</code> header</p>
</li>
<li>
<p>Each item means new <code>chunk</code> send it to client</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-reactor"><a class="anchor" href="#responses-nonblocking-reactor"></a><a class="link" href="#responses-nonblocking-reactor">6.4.4. Reactor</a></h4>
<div class="paragraph">
<p>1) Add the <a href="https://projectreactor.io/" target="_blank">Reactor</a> dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
  &lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
  &lt;version&gt;3.2.8.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.projectreactor:reactor-core:3.2.8.RELEASE'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Write code:</p>
</div>
<div class="sect4">
<h5 id="mono"><a class="anchor" href="#mono"></a><a class="link" href="#mono">Mono</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/non-blocking", ctx -&gt; {
    return Mono
        .fromCallable(() -&gt; "Mono")
        .map(it -&gt; "Hello " + it);
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/non-blocking") {
    Mono
        .fromCallable { "Mono" }
        .map { "Hello $it" }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect4">
<h5 id="flux"><a class="anchor" href="#flux"></a><a class="link" href="#flux">Flux</a></h5>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/non-blocking", ctx -&gt; {
    return Flux.range(1, 10)
        .map(it -&gt; it + ", ");
  })
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/non-blocking") {
    Flux.range(1, 10)
        .map{ "$it, " }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>For Flux, Jooby builds a <code>chunked</code> response. That:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>Transfer-Encoding: chunked</code> header</p>
</li>
<li>
<p>Each item means new <code>chunk</code> send it to client</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="responses-nonblocking-kotlin-coroutines"><a class="anchor" href="#responses-nonblocking-kotlin-coroutines"></a><a class="link" href="#responses-nonblocking-kotlin-coroutines">6.4.5. Kotlin Coroutines</a></h4>
<div class="paragraph">
<p>Probably one of most exciting new features of Jooby 2.x is the builtin integration with <a href="https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html" target="_blank">Kotlin Coroutines</a>:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Coroutine handler:</div><div class="switch--item">Normal handler:</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") {         <i class="conum" data-value="1"></i><b>(1)</b>
    ctx.pathString()
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;  <i class="conum" data-value="2"></i><b>(2)</b>
    ctx.pathString()
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Coroutine handler uses a implicit <code>Context</code> parameter: <code>ctx</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Normal handler has an explicit 'Context' parameter</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Also, if you try to call a suspending function from normal handler, Kotlin complains about:</p>
</div>
<div class="listingblock">
<div class="title">Not allowed it:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    delay(100)      <i class="conum" data-value="1"></i><b>(1)</b>
    "..."
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suspend function 'delay' should be called only from a coroutine or another suspend function</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now, if we remove the explicit parameter we have our first coroutine handler:</p>
</div>
<div class="listingblock">
<div class="title">Hello Coroutines</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") {
    delay(100)           <i class="conum" data-value="1"></i><b>(1)</b>
    "Hello Coroutines!"  <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call a suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send response to client</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Normal vs Coroutine handler</div>
<div class="paragraph">
<p>The difference between them is really small, just the presences/abscense of the <code>Context</code> parameter.
We realize this might be confusion at first, but the reason why was done like this was to keep
<strong>DSL simple and natural</strong>.</p>
</div>
<div class="paragraph">
<p>For example we don’t need an extra keyword or route names to write a
coroutine handler.</p>
</div>
<div class="paragraph">
<p>The existing <code>get</code>, <code>post</code>, …​, etc. DSL methods just works.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Here is another example with an extension and suspending function:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") {
    ctx.doSomething()         <i class="conum" data-value="1"></i><b>(1)</b>
  }
}

suspend fun Context.doSomething(): String {
  delay(100)                  <i class="conum" data-value="2"></i><b>(2)</b>
  return "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call extension suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function or do a blocking call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send response to client</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A coroutine works like any of the other non-blocking types. You start Jooby using the <strong>event loop</strong>
or <strong>default mode</strong>, Jooby detects we produce a coroutine and creates a coroutine context to execute
it.</p>
</div>
<div class="paragraph">
<p>Jooby uses the <strong>worker executor</strong> to creates a coroutine context. As described in <a href="#execution-model-worker-executor">worker executor section</a>
this is provided by the web server implementation unless you provided your own.</p>
</div>
<div class="listingblock">
<div class="title">Coroutines with custom executor:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  worker(Executors.newCachedThreadPool())

  get("/") {
    val n = 5 * 5        <i class="conum" data-value="1"></i><b>(1)</b>
    delay(100)           <i class="conum" data-value="2"></i><b>(2)</b>
    "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Statement run in the <strong>worker executor</strong> (cached thread pool)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Produces a response</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Coroutines always run in the <a href="#execution-model-worker-executor">worker executor</a>. There is an experimental API where
coroutines run in the <strong>caller thread</strong>(event loop in this case) until a suspending function is found.</p>
</div>
<div class="paragraph">
<p>Jooby allows you to use this experimental API by setting the <code>coroutineStart</code> option:</p>
</div>
<div class="listingblock">
<div class="title">UNDISPATCHED</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  coroutineStart = CoroutineStart.UNDISPATCHED

  get("/") {
    val n = 5 * 5        <i class="conum" data-value="1"></i><b>(1)</b>
    delay(100)           <i class="conum" data-value="2"></i><b>(2)</b>
    "Hello Coroutines!"  <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Statement run in the <strong>event loop</strong> (caller thread)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call a suspending function and dispatch to <strong>worker executor</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Produces a response from <strong>worker executor</strong></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>♡ ♡!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="responses-send-methods"><a class="anchor" href="#responses-send-methods"></a><a class="link" href="#responses-send-methods">6.5. Send methods</a></h3>
<div class="paragraph">
<p>Jooby provides a family of <code>sendXXX()</code> methods that produces a response via side effects.</p>
</div>
<div class="listingblock primary">
<div class="title">sendString example</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  get("/", ctx -&gt; {
    return ctx.send("Hello World!");
  });
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  get("/") { ctx -&gt;
    ctx.send("Hello World!")
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Beside we operate via side effects, the route still returns something. This is required because a route
handler is a function which always produces a result.</p>
</div>
<div class="paragraph">
<p>All the send methods returns the current <code>Context</code>, this signal Jooby that we want to operate via
side effects ignoring the output of the route handler.</p>
</div>
<div class="paragraph">
<p>Family of send methods include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-byte[-" target="_blank">send(byte[)</a>]</p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-java.nio.Buffer-" target="_blank">send(Buffer)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-java.lang.String-" target="_blank">send(String)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-java.nio.file.Path-" target="_blank">send(Path)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-java.io.File-" target="_blank">send(File)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-java.nio.channels.FileChannel-" target="_blank">send(FileChannel)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-io.jooby.AttachedFile-" target="_blank">send(AttachedFile)</a></p>
</li>
<li>
<p><a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Context.html#send-io.jooby.StatusCode-" target="_blank">send(StatusCode)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mvc-api"><a class="anchor" href="#introduction-mvc-api"></a><a class="link" href="#introduction-mvc-api">7. MVC API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>MVC API is an alternative way to define routes in Jooby. It uses annotations and byte code generation
to define and execute routes.</p>
</div>
<div class="paragraph">
<p>The package <code>io.jooby.annotations</code> contains the annotations available for MVC routes.</p>
</div>
<div class="listingblock primary">
<div class="title">MVC API:</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.annotations.*;

@Path("/mvc")                  <i class="conum" data-value="1"></i><b>(1)</b>
public class MyController {

  @GET                         <i class="conum" data-value="2"></i><b>(2)</b>
  public String sayHi() {
    return "Hello Mvc!";
  }
}

public class App extends Jooby {

  {
    use(new MyController());   <i class="conum" data-value="3"></i><b>(3)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.annotations.*;

@Path("/mvc")                  <i class="conum" data-value="1"></i><b>(1)</b>
class MyController {

  @GET                         <i class="conum" data-value="2"></i><b>(2)</b>
  fun sayHi() : String {
    return "Hello Mvc!"
  }
}


fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    use(MyController())        <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a path pattern. The <code>@Path</code> annotation is enable at class or method level</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add a HTTP method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register/install the controller in the main application</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="mvc-api-parameters"><a class="anchor" href="#mvc-api-parameters"></a><a class="link" href="#mvc-api-parameters">7.1. Parameters</a></h3>
<div class="paragraph">
<p>HTTP parameter provision is available via <code>*Param</code> annotations.</p>
</div>
<div class="sect3">
<h4 id="mvc-api-parameters-header"><a class="anchor" href="#mvc-api-parameters-header"></a><a class="link" href="#mvc-api-parameters-header">7.1.1. Header</a></h4>
<div class="paragraph">
<p>Provision of headers is available via <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/annotations/HeaderParam.html" target="_blank">HeaderParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Headers</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @GET
  public Object provisioning(@HeaderParam String token) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @GET
  fun provisioning(@HeaderParam token: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to HTTP header named <code>token</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Compared to JAX-RS the parameter name on <code>@*Param</code> annotation is completely optional, but required for
non valid Java names:</p>
</div>
<div class="listingblock primary">
<div class="title">Non valid Java name</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @GET
  public Object provisioning(@HeaderParam("Last-Modified-Since") long lastModifiedSince) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @GET
  fun provisioning(@HeaderParam("Last-Modified-Since") lastModifiedSince: Long) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-cookie"><a class="anchor" href="#mvc-api-parameters-cookie"></a><a class="link" href="#mvc-api-parameters-cookie">7.1.2. Cookie</a></h4>
<div class="paragraph">
<p>Provision of cookies is available via <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/annotations/CookieParam.html" target="_blank">CookieParam</a> annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">Cookies</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @GET
  public Object provisioning(@CookieParam String token) {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @GET
  fun provisioning(@CookieParam token: String) : Any {  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to cookie named <code>token</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Compared to JAX-RS the parameter name on <code>@*Param</code> annotation is completely optional, but required for
non valid Java names:</p>
</div>
<div class="listingblock primary">
<div class="title">Non valid Java name</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @GET
  public Object provisioning(@HeaderParam("token-id") String tokenId) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @GET
  fun provisioning(@HeaderParam("token-id") tokenId: String) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-path"><a class="anchor" href="#mvc-api-parameters-path"></a><a class="link" href="#mvc-api-parameters-path">7.1.3. Path</a></h4>
<div class="paragraph">
<p>For path parameters the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/annotations/PathParam.html" target="_blank">PathParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">PathParam</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @Path("/{id}")
  public Object provisioning(@PathParam String id) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @Path("/{id}")
  fun provisioning(@PathParam id: String) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-query"><a class="anchor" href="#mvc-api-parameters-query"></a><a class="link" href="#mvc-api-parameters-query">7.1.4. Query</a></h4>
<div class="paragraph">
<p>For query parameters the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/annotations/QueryParam.html" target="_blank">QueryParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">QueryParam</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @Path("/")
  public Object provisioning(@QueryParam String q) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @Path("/")
  fun provisioning(@QueryParam q: String) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-formdatamultipart"><a class="anchor" href="#mvc-api-parameters-formdatamultipart"></a><a class="link" href="#mvc-api-parameters-formdatamultipart">7.1.5. Formdata/Multipart</a></h4>
<div class="paragraph">
<p>For formdata/multipart parameters the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/annotations/FormParam.html" target="_blank">FormParam</a> annotation is required:</p>
</div>
<div class="listingblock primary">
<div class="title">QueryParam</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @Path("/")
  @POST
  public Object provisioning(@FormParam String username) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @Path("/")
  @POST
  fun provisioning(@FormParam username: String) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="mvc-api-parameters-body"><a class="anchor" href="#mvc-api-parameters-body"></a><a class="link" href="#mvc-api-parameters-body">7.1.6. Body</a></h4>
<div class="paragraph">
<p>Body parameter doesn’t require an annotation:</p>
</div>
<div class="listingblock primary">
<div class="title">HTTP Body</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class MyController {

  @Path("/")
  @POST
  public Object provisioning(MyObject body) {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class MyController {

  @Path("/")
  @POST
  fun provisioning(body: MyObject) : Any {
    ...
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
<div class="sect2">
<h3 id="mvc-api-registration"><a class="anchor" href="#mvc-api-registration"></a><a class="link" href="#mvc-api-registration">7.2. Registration</a></h3>
<div class="paragraph">
<p>Mvc routes need to be registered (no classpath scanning). Registration is done from your application
class:</p>
</div>
<div class="listingblock primary">
<div class="title">Simple MVC route registration</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    mvc(new MyController());
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    mvc(MyController())
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#mvc-java.lang.Object-" target="_blank">mvc(Object)</a> install the mvc route. As showed in the example there is
no dependency injection involved, you just instantiate a MVC route and register.</p>
</div>
<div class="listingblock primary">
<div class="title">Class MVC route registration</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    mvc(MyController.class);
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    mvc(MyController::class)
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#mvc-java.lang.Class-" target="_blank">mvc(Class)</a> does the same job, but delegates route instantiation to a
dependency injection framework of your choice.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jooby 1.x was built around Guice, this is not the case for 2.x. The entire project was built
without dependency injection. This make DI optional and at same time give you freedom to choose the
one you like most.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock primary">
<div class="title">Provider MVC route registration</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import javax.inject.Provider;

public class App extends Jooby {
  {
    Provider&lt;MyController&gt; provider = ...;

    mvc(MyController.class, provider);
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import javax.inject.Provider
import io.jooby.*

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val provider = ...
    mvc(MyController::class, provider)
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#mvc-javax.inject.Provider-" target="_blank">mvc(Provider)</a> does the same job, might or might not delegate
instantiation to a dependency injection framework but most important let you control lifecycle of
MVC routes (Singleton vs Non-Singleton routes).</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-suspend-functions"><a class="anchor" href="#mvc-api-suspend-functions"></a><a class="link" href="#mvc-api-suspend-functions">7.3. Suspend functions</a></h3>
<div class="paragraph">
<p>For Kotlin users MVC routes are allowed to use suspend functions</p>
</div>
<div class="listingblock">
<div class="title">Kotlin Coroutines</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class SuspendMvc {
  @GET
  @Path("/delay")
  suspend fun delayed(ctx: Context): String {
    delay(100)
    return ctx.pathString()
  }
}

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    use(SuspendMvc())
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>♡</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc-api-jax-rs-annotations"><a class="anchor" href="#mvc-api-jax-rs-annotations"></a><a class="link" href="#mvc-api-jax-rs-annotations">7.4. JAX-RS Annotations</a></h3>
<div class="paragraph">
<p>Alternative you can use JAX-RS annotations to define MVC routes.</p>
</div>
<div class="listingblock primary">
<div class="title">Resource</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import javax.ws.rs.GET;
import javax.ws.rs.Path;

@Path("/jaxrs")
public class Resource {

  @GET
  public String getIt() {
    return "Got it!";
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import javax.ws.rs.GET
import javax.ws.rs.Path

@Path("/jaxrs")
class Resource {

  @GET
  fun getIt() : String {
    return "Got it!"
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Annotations work exactly like the Jooby MVC annotations, but keep in mind we don’t implement the
JAX-RS specification and there is no immediate plan to do it.</p>
</div>
<div class="paragraph">
<p>The main reason to support JAX-RS annotations is to let you plug-in third-party tools that rely
on them (mostly annotations processors).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">8. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Application configuration is based on <a href="https://github.com/lightbend/config" target="_blank">config</a> library. Configuration
can by default be provided in either Java properties, JSON, and <a href="https://github.com/lightbend/config/blob/master/HOCON.md" target="_blank">HOCON</a> files.</p>
</div>
<div class="paragraph">
<p>Jooby allows overriding any property via system properties or environment variables.</p>
</div>
<div class="sect2">
<h3 id="configuration-environment"><a class="anchor" href="#configuration-environment"></a><a class="link" href="#configuration-environment">8.1. Environment</a></h3>
<div class="paragraph">
<p>The application environment is available via the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Env.html" target="_blank">Env</a> class, which allows specifying one
or many unique environment names.</p>
</div>
<div class="paragraph">
<p>The active environment names serve the purpose of allowing loading different configuration files
depending on the environment. Also, <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Extension.html" target="_blank">Extension</a> modules might configure application
services differently depending on the environment too. For example: turn on/off caches, reload files, etc.</p>
</div>
<div class="listingblock primary">
<div class="title">Initializing the Environment</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  Environment env = getEnvironment();
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val env = environment
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The active environment names property is set in one of this way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As program argument: <code>java -jar myapp.jar application.env=foo,bar</code>; or just <code>java -jar myapp.jar foo,bar</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This method works as long you start the application using one of the <code>runApp</code> methods
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<ul>
<li>
<p>As system property: <code>java -Dapplication.env=foo,bar -jar myapp.jar</code></p>
</li>
<li>
<p>As environment variable: <code>application.env=foo,bar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#getEnvironment--" target="_blank">getEnvironment()</a> loads the default environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-default-environment"><a class="anchor" href="#configuration-default-environment"></a><a class="link" href="#configuration-default-environment">8.2. Default Environment</a></h3>
<div class="paragraph">
<p>The default environment is available via <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Env.html#loadEnvironment-java.lang.ClassLoader-" target="_blank">loadEnvironment(ClassLoader)</a> method.</p>
</div>
<div class="paragraph">
<p>This method search for an <code>application.conf</code> file in three location (first-listed are higher priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${user.dir}/conf</code>. This is a file system location, useful is you want to externalize configuration (outside of jar file)</p>
</li>
<li>
<p><code>${user.dir}</code>. This is a file system location, useful is you want to externalize configuration (outside of jar file)</p>
</li>
<li>
<p><code>classpath://</code> (root of classpath). No external configuration, configuration file lives inside the jar file</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use <code>$user.dir</code> to reference <code>System.getProperty("user.dir")</code>. This system property is set
by the JVM at application startup time. It represent the current directory from where the JVM was
launch it.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">File system loading</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">└── conf
    └── application.conf
└── myapp.jar</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>A call to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  Environment env = getEnvironment();</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Loads the <code>application.conf</code> from <code>conf</code> directory. You get the same thing if you
move the <code>application.conf</code> to <code>myapp.jar</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">Classpath loading</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">└── myapp.jar
   └── application.conf (file inside jar)</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Jooby favors file system property loading over classpath property loading. So, if there
is a property file either in the current directory or conf directory it hides the same file
available in the classpath.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-overrides"><a class="anchor" href="#configuration-overrides"></a><a class="link" href="#configuration-overrides">8.3. Overrides</a></h3>
<div class="paragraph">
<p>Property overrides is done in multiple ways (first-listed are higher priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Program arguments</p>
</li>
<li>
<p>System properties</p>
</li>
<li>
<p>Environment variables</p>
</li>
<li>
<p>Environment property file</p>
</li>
<li>
<p>Property file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs">foo = foo</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">
<div class="title">Property access</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  Environment env = getEnvironment();                <i class="conum" data-value="1"></i><b>(1)</b>
  Config conf = env.getConfig();             <i class="conum" data-value="2"></i><b>(2)</b>
  System.out.println(conf.getString("foo")); <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val env = environment          <i class="conum" data-value="1"></i><b>(1)</b>
  val conf = env.config          <i class="conum" data-value="2"></i><b>(2)</b>
  println(conf.getString("foo")) <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get environment</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get <code>foo</code> property and prints <code>foo</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At runtime you can override properties using:</p>
</div>
<div class="listingblock">
<div class="title">Program argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">java -jar myapp.jar foo=argument</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Example prints: <code>argument</code></p>
</div>
<div class="listingblock">
<div class="title">System property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">java -Dfoo=sysprop -jar myapp.jar</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Prints: <code>syspro</code></p>
</div>
<div class="listingblock">
<div class="title">Environment variable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">foo=envar java -jar myapp.jar</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Prints: <code>envar</code></p>
</div>
<div class="paragraph">
<p>If you have multiple properties to override, it is probably better to collect all them into a new file
and use active environment name to select them.</p>
</div>
<div class="listingblock">
<div class="title">Environment property file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">└── application.conf
└── application.prod.conf</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs">foo = foo
bar = devbar</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.prod.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs">bar = prodbar</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run with <code>prod</code> environment</div>
<div class="content">
<pre>java -jar my.app application.env=prod</pre>
</div>
</div>
<div class="paragraph">
<p>Or just</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java -jar my.app prod</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You only need to override the properties that changes between environment not all the properties.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>application.conf</code> defines two properties : <code>foo</code> and <code>bar</code>, while the environment property file
defines only <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>For Multiple environment activation you need to separate them with <code>,</code> (comma):</p>
</div>
<div class="listingblock">
<div class="title">Run with <code>prod</code> and <code>cloud</code> environment</div>
<div class="content">
<pre> java -jar my.app application.env=prod,cloud</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-custom-environment"><a class="anchor" href="#configuration-custom-environment"></a><a class="link" href="#configuration-custom-environment">8.4. Custom environment</a></h3>
<div class="paragraph">
<p>Custom configuration and environment are available too using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/EnvironmentOptions.html" target="_blank">EnvironmentOptions</a> class, or</p>
</li>
<li>
<p>Direct instantiation of the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Environment.html" target="_blank">Environment</a> class</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Environment options</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  Environment env = setEnvironmentOptions(new EnvOptions() <i class="conum" data-value="1"></i><b>(1)</b>
    .setFilename("myapp.conf")
  )
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val env = environmentOptions {                   <i class="conum" data-value="1"></i><b>(1)</b>
    filename = "myapp.conf"
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load <code>myapp.conf</code> using the loading and precedence mechanism described before</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#setEnvironmentOptions-io.jooby.EnvironmentOptions-" target="_blank">setEnvironmentOptions(EnvironmentOptions)</a> method loads, set and returns
the environment.</p>
</div>
<div class="paragraph">
<p>To skip/ignore Jooby loading and precedence mechanism, just instantiate and set the environment:</p>
</div>
<div class="listingblock primary">
<div class="title">Direct instantiation</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">{
  Config conf = ConfigFatory.load("/path/to/myapp.conf");  <i class="conum" data-value="1"></i><b>(1)</b>
  Environment env = new Env(customConfig, "prod");         <i class="conum" data-value="2"></i><b>(2)</b>
  setEnvironment(env);                                     <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">{
  val conf = ConfigFatory.load("/path/to/myapp.conf")      <i class="conum" data-value="1"></i><b>(1)</b>
  val env = new Env(conf, "prod")                          <i class="conum" data-value="2"></i><b>(2)</b>
  environment = env                                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loads and parses configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a new environment with configuration and (<a href="http://optionally" target="_blank">optionally</a>) active names</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set environment on Jooby instance</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Custom configuration is very flexible. You can reuse Jooby mechanism or provide your own.
The only thing to keep in mind is that environment setting must be done at very early stage, before
starting the application.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-logging"><a class="anchor" href="#configuration-logging"></a><a class="link" href="#configuration-logging">8.5. Logging</a></h3>
<div class="paragraph">
<p>Jooby uses <a href="https://www.slf4j.org" target="_blank">Slf4j</a> for logging which give you some flexibility for choosing
the logging framework.</p>
</div>
<div class="sect3">
<h4 id="configuration-logging-logback"><a class="anchor" href="#configuration-logging-logback"></a><a class="link" href="#configuration-logging-logback">8.5.1. Logback</a></h4>
<div class="paragraph">
<p>The <a href="https://logback.qos.ch/manual/index.html" target="_blank">Logback</a> is probably the first alternative for
<a href="https://www.slf4j.org" target="_blank">Slf4j</a> due its natively implements the SLF4J API. Follow the next steps to use
logback in your project:</p>
</div>
<div class="paragraph">
<p>1) Add dependency</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;1.2.3&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'ch.qos.logback:logback-classic:1.2.3'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;

  &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;root level="INFO"&gt;
    &lt;appender-ref ref="STDOUT" /&gt;
  &lt;/root&gt;
&lt;/configuration&gt;</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all! <a href="https://www.slf4j.org" target="_blank">Slf4j</a> is going to redirect log message to logback.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-logging-log4j2"><a class="anchor" href="#configuration-logging-log4j2"></a><a class="link" href="#configuration-logging-log4j2">8.5.2. Log4j2</a></h4>
<div class="paragraph">
<p>The <a href="https://logging.apache.org/log4j" target="_blank">Log4j2</a> project is another good alternative for logging. Follow
the next steps to use logback in your project:</p>
</div>
<div class="paragraph">
<p>1) Add dependencies</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
  &lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt;
  &lt;version&gt;2.11.2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
  &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
  &lt;version&gt;2.11.2&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'org.apache.logging.log4j:log4j-slf4j-impl:2.11.2'

compile 'org.apache.logging.log4j:log4j-core:2.11.2'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock">
<div class="title">log4j.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
  &lt;Appenders&gt;
    &lt;Console name="stdout"&gt;
      &lt;PatternLayout pattern="%d [%t] %-5level: %msg%n%throwable" /&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Root level="INFO" additivity="true"&gt;
      &lt;AppenderRef ref="stdout" /&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>All these extensions are considered valid: <code>.xml</code>, <code>.propertines</code>, <code>.yaml</code> and <code>.json</code>. As well as <code>log4j2</code> for file name.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-logging-environment-logging"><a class="anchor" href="#configuration-logging-environment-logging"></a><a class="link" href="#configuration-logging-environment-logging">8.5.3. Environment logging</a></h4>
<div class="paragraph">
<p>Logging is integrated with the environment names. So it is possible to have a file name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logback[.name].xml</code> (for loggback)</p>
</li>
<li>
<p><code>log4j[.name].xml</code> (for log4j2)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jooby favors the environment specific logging configuration file over regular/normal logging configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">conf
└── logback.conf
└── logback.prod.conf</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>To use <code>logback.prod.conf</code>, start your application like:</p>
</div>
<div class="paragraph">
<p><code>java -jar myapp.jar application.env=prod</code></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The logging configuration file per environment works as long you don’t use <strong>static</strong> loggers
before application has been start it. The next example won’t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  private static final Logger log = ...

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>runApp</code> method is the one who configures the logging framework. Adding a static logger force
the logging framework to configure without taking care the environment setup.</p>
</div>
<div class="paragraph">
<p>There are a couple of solution is for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use an instance logger</p>
</li>
<li>
<p>use the getLog() method of Jooby</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependency-injection"><a class="anchor" href="#dependency-injection"></a><a class="link" href="#dependency-injection">9. Dependency Injection</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Jooby 2.x there is no dependency injection framework. This is another major difference with 1.x which
was built with Guice.</p>
</div>
<div class="paragraph">
<p>This make Jooby 2.x more lightweight than 1.x but most important give you freedom of using the
dependency injection of your choice.</p>
</div>
<div class="sect2">
<h3 id="dependency-injection-dagger"><a class="anchor" href="#dependency-injection-dagger"></a><a class="link" href="#dependency-injection-dagger">9.1. Dagger</a></h3>
<div class="paragraph">
<p>1) Add Dagger to your project</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
  &lt;artifactId&gt;dagger&lt;/artifactId&gt;
  &lt;version&gt;2.20&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'com.google.dagger:dagger:2.20'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Configure annotation processor</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
      &lt;version&gt;...&lt;/version&gt;
      &lt;configuration&gt;
        &lt;annotationProcessorPaths&gt;
          &lt;path&gt;
            &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;
            &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt;
            &lt;version&gt;2.20&lt;/version&gt;
          &lt;/path&gt;
        &lt;/annotationProcessorPaths&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">plugins {
  id "net.ltgt.apt" version "0.21"
}

dependencies {
  apt 'com.google.dagger:dagger-compiler:2.20'
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>3) Bootstrap Dagger from application:</p>
</div>
<div class="listingblock primary">
<div class="title">Dagger</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
     /** Dagger: */
     AppComponent dagger = DaggerAppComponent.builder()      <i class="conum" data-value="1"></i><b>(1)</b>
         .build();

     get("/", ctx -&gt; {
       MyService service = dagger.getMyService();            <i class="conum" data-value="2"></i><b>(2)</b>
       return service.doSomething();
     });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder() <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    get("/") { ctx -&gt;
      val service = dagger.getMyService()     <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use dagger provided objects</td>
</tr>
</tbody></table>
</div>
<h4 id="mvc-routes" class="discrete">MVC routes</h4>
<div class="paragraph">
<p>Integration of MVC routes with Dagger is as simple as:</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Dagger</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    /** Dagger: */
    AppComponent dagger = DaggerAppComponent.builder()  <i class="conum" data-value="1"></i><b>(1)</b>
        .build();

    mvc(dagger.myController());                         <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder() <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    mvc(dagger.myController())                <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register MVC route provided by Dagger</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Due the static nature of Dagger mvc integration identical to normal usage. For custom scopes/lifecycles
Dagger generate a <code>javax.inject.Provider</code> on such use cases you need to switch and use the provider
version of the <code>mvc</code> method:</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Dagger provider</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    /** Dagger: */
    AppComponent dagger = DaggerAppComponent.builder()      <i class="conum" data-value="1"></i><b>(1)</b>
        .build();

    mvc(MyController.class, dagger.myController());         <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    val dagger = DaggerAppComponent.builder()        <i class="conum" data-value="1"></i><b>(1)</b>
        .build()

    mvc(MyController::class, dagger.myController())  <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootstrap dagger component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register MVC route using a Dagger provider</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection-guice"><a class="anchor" href="#dependency-injection-guice"></a><a class="link" href="#dependency-injection-guice">9.2. Guice</a></h3>
<div class="paragraph">
<p>1) Add Guice dependency to your project:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-guice&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-guice:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Install Guice:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing Guice</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.di.Guiceby;
import io.jooby.runApp;

public class App extends Jooby {

  {
    install(new Guiceby());                         <i class="conum" data-value="1"></i><b>(1)</b>

    get("/", ctx -&gt; {
      MyService service = require(MyService.class); <i class="conum" data-value="2"></i><b>(2)</b>
      return service.doSomething();
    });
}

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.di.Guiceby
import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(Guiceby())                        <i class="conum" data-value="1"></i><b>(1)</b>

    get ("/") { ctx -&gt;
      val service = require(MyService::class) <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Guice extension</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#require-java.lang.Class-" target="_blank">require(Class)</a> call is now resolved by Guice</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="dependency-injection-guice-property-injection"><a class="anchor" href="#dependency-injection-guice-property-injection"></a><a class="link" href="#dependency-injection-guice-property-injection">9.2.1. Property Injection</a></h4>
<div class="paragraph">
<p>Configuration properties can be injected using the <code>@Named</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">currency = USD</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import javax.injext.Named;
import javax.injext.Inject;

public class BillingService {

  @Inject
  public BillingService(@Named("currency") String currency) {
    ...
  }

}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class BillingService @Inject constructor(@Named("currency") currency: String) {
  ...
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="dependency-injection-guice-mvc-routes"><a class="anchor" href="#dependency-injection-guice-mvc-routes"></a><a class="link" href="#dependency-injection-guice-mvc-routes">9.2.2. MVC routes</a></h4>
<div class="paragraph">
<p>Guice will also provisioning MVC routes</p>
</div>
<div class="listingblock primary">
<div class="title">MVC and Guice</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.di.Guiceby;
import io.jooby.runApp

public class App extends Jooby {

  {
    install(new Guiceby());    <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController.class);   <i class="conum" data-value="2"></i><b>(2)</b>
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.di.Guiceby
import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(Guiceby())         <i class="conum" data-value="1"></i><b>(1)</b>

    mvc(MyController::class)   <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Guice extension</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register a MVC route</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The lifecycle of <code>MyController</code> is now managed by Guice. Also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Guice, the default scope is <code>prototype</code> (creates a new instance per request)</p>
</li>
<li>
<p>If you prefer a single instance add the <code>javax.inject.Singleton</code> annotation</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection-spring"><a class="anchor" href="#dependency-injection-spring"></a><a class="link" href="#dependency-injection-spring">9.3. Spring</a></h3>
<div class="paragraph">
<p>1) Add Spring dependency to your project:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-spring&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-spring:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Install Spring:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing Spring</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">package myapp;                                       <i class="conum" data-value="1"></i><b>(1)</b>

import static io.jooby.Jooby.runApp;
import io.jooby.di.Springby;

public class App extends Jooby {

  {
    install(new Springby());                         <i class="conum" data-value="2"></i><b>(2)</b>

    get("/", ctx -&gt; {
      MyService service = require(MyService.class);  <i class="conum" data-value="3"></i><b>(3)</b>
      return service.doSomething();
    });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">package myapp                                        <i class="conum" data-value="1"></i><b>(1)</b>

import io.jooby.runApp
import io.jooby.di.Springby

fun main(args: Array&lt;String&gt;) {
  runApp(args) {

    install(new Springby())                          <i class="conum" data-value="2"></i><b>(2)</b>

    get ("/") { ctx -&gt;
      val service = require(MyService::class)        <i class="conum" data-value="3"></i><b>(3)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Spring scan the package <code>myapp</code> and subpackages</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Install Spring module</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#require-java.lang.Class-" target="_blank">require(Class)</a> call is now resolved by Spring</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring uses the application package and sub-packages to scan. If you need extra packages, provide them at creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>install(new Spring("foo", "bar"));</pre>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injection-spring-property-injection"><a class="anchor" href="#dependency-injection-spring-property-injection"></a><a class="link" href="#dependency-injection-spring-property-injection">9.3.1. Property Injection</a></h4>
<div class="paragraph">
<p>Configuration properties can be injected using the <code>@Value</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">currency = USD</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import javax.injext.Inject;
import org.springframework.beans.factory.annotation.Value;

public class BillingService {

  @Inject
  public BillingService(@Value("currency") String currency) {
    ...
  }

}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import javax.injext.Inject
import org.springframework.beans.factory.annotation.Value

class BillingService @Inject constructor(@Value("${currency}") currency: String) {
  ...
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="dependency-injection-spring-mvc-routes"><a class="anchor" href="#dependency-injection-spring-mvc-routes"></a><a class="link" href="#dependency-injection-spring-mvc-routes">9.3.2. MVC routes</a></h4>
<div class="paragraph">
<p>The Spring extension does a bit more in relation to MVC routes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A MVC route annotated with the <code>org.springframework.stereotype.Controller</code> annotation is
automatically registered. No need to register it manually</p>
</li>
<li>
<p>A MVC route provided by Spring is a singleton object by default. Singleton is the default scope in Spring</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">MVC route</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import org.springframework.stereotype.Controller;

@Controller
public class Hello {

   @GET
   public String sayHi() {
     return "Hi Spring!";
   }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import org.springframework.stereotype.Controller

@Controller
class Hello {

   @GET
   fun sayHi(): String {
     return "Hi Spring!"
   }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
<div class="sect2">
<h3 id="dependency-injection-weld"><a class="anchor" href="#dependency-injection-weld"></a><a class="link" href="#dependency-injection-weld">9.4. Weld</a></h3>
<div class="paragraph">
<p>1) Add Weld dependency to your project:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-weld&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-weld:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Install Weld:</p>
</div>
<div class="listingblock primary">
<div class="title">Installing Weld</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.di.Weldby;
import static io.jooby.Jooby.runApp;

public class App extends Jooby {

  {
    install(new Weldby());                          <i class="conum" data-value="1"></i><b>(1)</b>

    get ("/", ctx -&gt; {
      MyService service = require(MyService.class); <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething();
    });
  }

  public static void main(String[] args) {
    runApp(args, App::new);
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.di.Weldby
import io.jooby.runApp

fun main(args: Array&lt;String&gt;) {
  runApp(args) {
    install(Weldby())                               <i class="conum" data-value="1"></i><b>(1)</b>

    get ("/") { ctx -&gt;
      val service = require(MyService::class)       <i class="conum" data-value="2"></i><b>(2)</b>
      service.doSomething()
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install Weld</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/Jooby.html#require-java.lang.Class-" target="_blank">require(Class)</a> call is now resolved by Weld</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="dependency-injection-weld-property-injection"><a class="anchor" href="#dependency-injection-weld-property-injection"></a><a class="link" href="#dependency-injection-weld-property-injection">9.4.1. Property Injection</a></h4>
<div class="paragraph">
<p>Configuration properties can be injected using the <code>@Named</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">application.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs">currency = USD</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import javax.injext.Inject;
import javax.injext.Named;

public class BillingService {

  @Inject
  public BillingService(@Named("currency") String currency) {
    ...
  }

}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import javax.injext.Inject
import javax.injext.Named

class BillingService @Inject constructor(@Named("currency") currency: String) {
  ...
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
<div class="sect3">
<h4 id="dependency-injection-weld-mvc-routes"><a class="anchor" href="#dependency-injection-weld-mvc-routes"></a><a class="link" href="#dependency-injection-weld-mvc-routes">9.4.2. MVC routes</a></h4>
<div class="paragraph">
<p>The Weld extension does a bit more in relation to MVC routes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A MVC route annotated with the <code>io.jooby.annotations.Path</code> annotation is
automatically registered. No need to register it manually</p>
</li>
<li>
<p>The default scope is <code>prototype</code> (creates a new instance per request). If you prefer a single
instance add the <code>javax.inject.Singleton</code> annotation</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">MVC route</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.annotations.*;

@Path("/")
public class Hello {

   @GET
   public String sayHi() {
     return "Hi Weld!";
   }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.annotations.*;

@Path("/")
class Hello {

   @GET
   fun sayHi(): String {
     return "Hi Weld!"
   }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a><a class="link" href="#testing">10. Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will show you how to run unit and integration tests with Jooby.</p>
</div>
<div class="sect2">
<h3 id="testing-unit-testing"><a class="anchor" href="#testing-unit-testing"></a><a class="link" href="#testing-unit-testing">10.1. Unit Testing</a></h3>
<div class="paragraph">
<p>1) Add Jooby test dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-test&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-test:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Write your application:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    get("/", ctx -&gt; "Easy unit testing!");
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-java hljs">class App: Kooby({

  get("/") { ctx -&gt;
    "Easy unit testing!"
  }

})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>3) Write your test:</p>
</div>
<div class="listingblock primary">
<div class="title">TestApp</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.MockRouter;

public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    assertEquals("OK", router.get("/").value());
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.MockRouter

class TestApp {

  @Test
  fun test() {
    val router = MockRouter(App())
    assertEquals("OK", router.get("/").value())
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Simple and easy ♡!</p>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockRouter.html" target="_blank">MockRouter</a> returns the value produced by the route handler. It is possible to get
access and check response metadata:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    get("/", ctx -&gt; ctx
        .setResponseCode(StatusCode.OK)
        .send("Easy unit testing")
    );
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class App: Kooby({
  get("/") { ctx -&gt;
      ctx.responseCode = StatusCode.OK

      ctx.send("Easy unit testing")
  })
})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">Checking response metadata</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    router.get("/", response -&gt; {
      assertEquals(StatusCode.OK, response.getStatusCode());
      assertEquals("Easy unit testing", response.value(String.class));
    });
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class TestApp {

  @Test
  fun test() {
    val router = MockRouter(App())
    router.get("/") { response -&gt;
      assertEquals(StatusCode.OK, response.statusCode)
      assertEquals("Easy unit testing", response.value(String::class))
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>For more complex route context interaction or responses, you can pass in a <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockContext.html" target="_blank">MockContext</a>:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    post("/", ctx -&gt; {
      String name = ctx.form("name").value();
      return name;
    });
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class App: Kooby({
  get("/") { ctx -&gt;
    val name = ctx.form("name").value()
    name
  })
})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="listingblock primary">
<div class="title">Using mock context</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class TestApp {

  @Test
  public void test() {
    MockRouter router = new MockRouter(new App());
    MockContext context = new MockContext()
        .setForm(Formdata.create()
            .put("name", "Test!")
        );
    assertEquals("Test!", router.post("/", context).value());
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">class TestApp {

  @Test
  fun test() {
    MockRouter router = MockRouter(App())
    MockContext context = MockContext().apply {
      form = Formdata.create().apply {
        put("name", "Test!")
      }
    }
    assertEquals("Test!", router.post("/", context).value())
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>Alternative you can provide your own mock context:</p>
</div>
<div class="listingblock primary">
<div class="title">Mockito Context</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

public class TestApp {

  @Test
  public void test() {
    Value name = mock(Value.class);
    when(name.value()).thenReturn("Test!");

    Context context = mock(Context.class);
    when(context.form("name")).thenReturn(name);

    MockRouter router = new MockRouter(new App());

    assertEquals("Test!", router.post("/", context).value());
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import org.mockito.Mockito.mock
import org.mockito.Mockito.when

class TestApp {

  @Test
  fun test() {
    val name = mock(Value::class.java)
    when(name.value()).thenReturn("Test!")

    val context = mock(Context::class.java)
    when(context.form("name")).thenReturn(name)

    MockRouter router = MockRouter(App())

    assertEquals("Test!", router.post("/", context).value())
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>♡ ♡!</p>
</div>
<div class="paragraph">
<p>For MVC routes you might prefer to write a unit test using a mock library. No need to use
<code>MockRouter</code>, but it is possible too.</p>
</div>
<div class="paragraph">
<p>By default the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockRouter.html" target="_blank">MockRouter</a> class execute the route handler. For executing the entire
pipeline use: <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockRouter.html#setFullExecution--" target="_blank">setFullExecution()</a>.</p>
</div>
<div class="paragraph">
<p>Unit testing is simple and easy in Jooby. The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockRouter.html" target="_blank">MockRouter</a> let you to execute route function,
while the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/MockContext.html" target="_blank">MockContext</a> allows you to create an light-weight and mutable context where
you can set HTTP parameters, body, headers, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-integration-testing"><a class="anchor" href="#testing-integration-testing"></a><a class="link" href="#testing-integration-testing">10.2. Integration Testing</a></h3>
<div class="paragraph">
<p>Integration tests are supported via JUnit 5 extension mechanism.</p>
</div>
<div class="paragraph">
<p>1) Add Jooby test dependency:</p>
</div>
<div class="listingblock primary">


<div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.jooby&lt;/groupId&gt;
  &lt;artifactId&gt;jooby-test&lt;/artifactId&gt;
  &lt;version&gt;2.0.0.RC2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-javascript hljs">compile 'io.jooby:jooby-test:2.0.0.RC2-SNAPSHOT'</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>2) Write your application:</p>
</div>
<div class="listingblock primary">
<div class="title">App</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">public class App extends Jooby {
  {
    get("/", ctx -&gt; "Easy testing!");
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-java hljs">class App: Kooby({

  get("/") { ctx -&gt;
    "Easy testing!"
  }

})</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>3) Write your test:</p>
</div>
<div class="listingblock primary">
<div class="title">TestApp</div>

<div class="switch"><div class="switch--item selected">Java</div><div class="switch--item">Kotlin</div></div><div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">import io.jooby.JoobyTest;

@JoobyTest(App.class)
public class TestApp {

  static OkHttpClient client = new OkHttpClient();

  @Test
  public void test() {
    Request request = new Request.Builder()
        .url("http://localhost:8911")
        .build();

    try (Response response = client.newCall(request).execute()) {
      assertEquals("Easy testing!", response.body().string());
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div><div class="content hidden">
<pre class="highlightjs highlight"><code class="language-kotlin hljs">import io.jooby.JoobyTest

@JoobyTest(App.class)
class TestApp {

  companion object {
    const client = OkHttpClient()
  }

  @Test
  fun test() {
    val request = Request.Builder()
        .url("http://localhost:8911")
        .build()

    client.newCall(request).execute().use { response -&gt;
      assertEquals("Easy testing!", response.body().string())
    }
  }
}</code><button class="clipboard">Copy</button></pre>
</div></div>

<div class="paragraph">
<p>The example uses <a href="https://square.github.io/okhttp/" target="_blank">OkHttp</a> client, but you are free to use any other HTTP client.</p>
</div>
<div class="paragraph">
<p>Simple and easy ♡!</p>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/JoobyTest.html" target="_blank">JoobyTest</a> takes care of start and stop the application.</p>
</div>
<div class="paragraph">
<p>Adding the annotation at class-level starts a single application before running tests and stop it
after all them. The default port at class level is: <code>8911</code>.</p>
</div>
<div class="paragraph">
<p>Adding the annotation at method-level starts an application before running the test and stop it
once it finish. The default port at method level is <code>random</code>.</p>
</div>
<div class="paragraph">
<p>Default application port can be configured directly using the <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/JoobyTest.html#port--" target="_blank">port()</a> method:</p>
</div>
<div class="paragraph">
<p><code>@JoobyTest(value = App.class, port = 9999)</code></p>
</div>
<div class="paragraph">
<p>If port is set to zero(0) a random port is selected. You can inject the server port in your test like:</p>
</div>
<div class="listingblock">
<div class="title">Server port injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">@JoobyTest(App.class)
public void test(int serverPort) {

}

@JoobyTest(App.class)
public void anotherTest(int serverPort) {

}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter name must be <code>serverPort</code> and be of type <code>int</code>. This injection let you access to the
random port used for the method-level application test.</p>
</div>
<div class="paragraph">
<p>There is a <code>serverPath</code> value too, which is the entire path to the server:</p>
</div>
<div class="listingblock">
<div class="title">Server path injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs">@JoobyTest(App.class)
public void test(String serverPath) { <i class="conum" data-value="1"></i><b>(1)</b>

}</code><button class="clipboard">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>serverPath</code> variable contains the entire path: <code><a href="http://localhost:port/contextPath" class="bare" target="_blank">http://localhost:port/contextPath</a></code>.</p>
</div>
<div class="paragraph">
<p>Here is the list of available injectable values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int serverPort</code>: Give you the port where the application is listening. This is named type injection (name and type are required).</p>
</li>
<li>
<p><code>String serverPath</code>: Give you the entire server path where the application is listening. This is named type injection (name and type are required).</p>
</li>
<li>
<p><code>io.jooby.Environment</code>: Give you access to the application environment. This is a type injection (name no matter).</p>
</li>
<li>
<p><code>com.typesafe.config.Config</code>: Give you access to the application environment. This is a type injection (name no matter).</p>
</li>
<li>
<p><code>io.jooby.Jooby</code>: Give you access to the application. This is a type injection (name no matter).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can be injected via parameter or instance fields.</p>
</div>
<div class="paragraph">
<p>The <a href="https://static.javadoc.io/io.jooby/jooby/2.0.0.RC2-SNAPSHOT/io/jooby/JoobyTest.html" target="_blank">JoobyTest</a> annotation starts the application using the <code>test</code> environment name. You can
creates a <code>conf/application.test.conf</code> file to override any other values for testing purpose.</p>
</div>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script>
  $(function () {
    /** Tabs: */
    $('.primary').each(function() {
      var primary = $(this);
      var content = primary.children('.content');
      primary.children('.switch').children('.switch--item').on('click', function() {
        var $this = $(this);
        $this.addClass('selected');
        $this.siblings().removeClass('selected');
        content.addClass('hidden');
        $(content[$this.index()]).removeClass('hidden');
      });
    });
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/3.0.2/tocbot.min.js"></script>
<script>
  $(function() {
    var oldtoc = document.getElementById('toctitle').nextElementSibling;
    var newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({
      contentSelector: '#content',
      headingSelector: 'h1, h2, h3, h4, h5',
      ignoreSelector: '.discrete',
      smoothScroll: false
    });
    var handleTocOnResize = function () {
      var width = window.innerWidth
          || document.documentElement.clientWidth
          || document.body.clientWidth;
      if (width < 768) {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          collapseDepth: 6,
          ignoreSelector: '.discrete',
          throttleTimeout: 1000,
          smoothScroll: false
        });
      } else {
        tocbot.refresh();
      }
    };
    window.addEventListener('resize', handleTocOnResize);
    handleTocOnResize();
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script>
  $(function() {
    new ClipboardJS('.clipboard', {
      target: function(b) {
        var p = b.parentNode;
        var target = p.childNodes[0];
        return target;
      }
    }).on('success', function(e) {
      e.clearSelection();
      e.trigger.textContent = 'Copied';
      setTimeout(function() {
        e.trigger.textContent = 'Copy';
      }, 2000);
    });
  });
</script>
<link rel="stylesheet" href="js/styles/agate.min.css">
<script src="js/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>

</body></html>