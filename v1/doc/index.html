<!doctype html>
<html lang="en">
 <head> 
  <meta http-equiv="refresh" content="0; URL=https://jooby.io"> 
  <meta charset="UTF-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <title>jooby: documentation</title> 
  <meta name="description" content="Scalable, fast and modular micro web framework for Java. Build small/large apps easily and quickly with Netty, Undertow or Jetty."> 
  <meta name="keywords" content="Java, Micro Web Framework, Async, Easy to use, Micro, Sinatra, Express, Scalable, Modern, Best, Web, Framework, Lightweight, Microservices, do more, more easily"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="canonical" href="#"> 
  <link rel="publisher" href="#"> 
  <meta name="robots" content="robots.txt"> 
  <meta name="og:title" content="jooby"> 
  <meta name="og:description" content="Scalable, fast and modular micro web framework for Java"> 
  <!--
    og:type
    SI EL TEMPLATE ES UN ARTICULO (NOTA, VIDEO, ETC) CAMBIAR
    "website" por "article"
    --> 
  <meta name="og:type" content="website"> 
  <meta name="og:url" content="https://jooby.org"> 
  <!--
    og:image
    SI ES UNA NOTA Y LA NOTA TIENE UNA IMAGEN DE PREVIEW SE DEBE
    CAMBIAR POR UNA IMAGEN CON LAS SIGUIENTES ESPECIFICACIONES
    ANCHO: 200
    ALTO: 200
    FORMATO: JPG
    --> 
  <meta name="og:image" content="https://jooby.org/resources/images/apps/facebook.jpg"> 
  <meta name="og:site_name" content="jooby"> 
  <meta name="twitter:card" content="summary"> 
  <meta name="twitter:title" content="jooby - do more! more easily!!"> 
  <!--
    twitter:image
    SI ES UNA NOTA Y LA NOTA TIENE UNA IMAGEN DE PREVIEW SE DEBE
    CAMBIAR POR UNA IMAGEN CON LAS SIGUIENTES ESPECIFICACIONES
    ANCHO: 280
    ALTO: 150
    FORMATO: JPG
    TAMAÑO MAXIMO: 1MB
    --> 
  <meta name="twitter:image" content="https://jooby.org/resources/images/apps/twitter.jpg"> 
  <meta name="twitter:site" content="@joobyproject"> 
  <meta name="twitter:creator" content="https://twitter.com/edgarespina"> 
  <meta name="twitter:domain" content="https://jooby.org"> 
  <meta name="twitter:url" content="https://twitter.com/joobyproject"> 
  <meta name="twitter:description" content="Scalable, fast and modular micro web framework for Java"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed57.png" sizes="57x57"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed60.png" sizes="60x60"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed72.png" sizes="72x72"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed76.png" sizes="76x76"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed114.png" sizes="114x114"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed120.png" sizes="120x120"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed144.png" sizes="144x144"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed152.png" sizes="152x152"> 
  <link rel="apple-touch-icon-precomposed" href="/v1/resources/images/apps/precomposed180.png" sizes="180x180"> 
  <link href="/v1/resources/images/apps/favicon.ico" rel="shortcut icon"> 
  <link href="/v1/resources/images/apps/favicon.png" rel="icon" sizes="16x16" type="image/png"> 
  <link href="/v1/resources/images/apps/favicon32.png" rel="icon" sizes="32x32" type="image/png"> 
  <link href="/v1/resources/images/apps/favicon96.png" rel="icon" sizes="96x96" type="image/png"> 
  <link href="/v1/resources/images/apps/android-chrome.png" rel="icon" sizes="192x192" type="image/png"> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,700"> 
  <link rel="stylesheet" href="/v1/resources/styles/application.css"> 
  <link rel="stylesheet" href="/v1/resources/styles/github.css"> 
  <link rel="stylesheet" href="/v1/resources/styles/devices.css"> 
  <link rel="stylesheet" href="/v1/resources/styles/sprites.css"> 
 </head> 
 <body class="page-section page-sidebar"> 
  <header class="site-header"> 
   <div class="row"> 
    <a href="/v1/" title="Home" class="site-logo"><img src="resources/images/logo_jooby-2x.png" alt="Logo Jooby" width="76" height="31"></a> 
    <a class="show-mobile open-menu" href="/v1"><span></span></a> 
    <nav class="site-nav"> 
     <ul> 
      <li class=""><a href="/v1/quickstart" title="Quick start">QUICK START</a></li> 
      <li class="active"><a href="/v1/doc" title="Doc">DOCS</a></li> 
      <li class=""><a href="/v1/modules" title="Modules">MODULES</a></li> 
      <li class=""><a href="/v1/community" title="Community">COMMUNITY</a></li> 
      <li class=""><a href="/v1/faq" title="FAQ">FAQ</a></li> 
      <li><a href="https://javadoc.io/doc/org.jooby/jooby/1.6.6" target="_blank" title="API docs">API DOCS</a></li> 
     </ul> 
    </nav> 
   </div> 
  </header> 
  <main role="main" class="site-content"> 
   <div class="section-title"> 
    <div class="row"> 
     <h1>Documentation</h1> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="section-sidebar" style="position: fixed; left: 120px; top: 160px; bottom: 20px;"> 
     <div class="show-mobile menu-open">
       do more, more easily 
     </div> 
     <ul> 
      <li class="active"> <a href="#do-more-more-easily">do more, more easily</a></li> 
      <li class=""> <a href="#application">application</a> 
       <ul> 
        <li> <a href="#application-life-cycle">life cycle</a></li> 
       </ul></li> 
      <li class=""> <a href="#conf-env-and-logging">conf, env and logging</a> 
       <ul> 
        <li> <a href="#conf-env-and-logging-getting-properties">getting properties</a></li> 
        <li> <a href="#conf-env-and-logging-environment">environment</a></li> 
        <li> <a href="#conf-env-and-logging-turning-features-on-or-off">turning features on or off</a></li> 
        <li> <a href="#conf-env-and-logging-special-properties">special properties</a></li> 
        <li> <a href="#conf-env-and-logging-precedence">precedence</a></li> 
        <li> <a href="#conf-env-and-logging-logging">logging</a></li> 
       </ul></li> 
      <li class=""> <a href="#modules">modules</a> 
       <ul> 
        <li> <a href="#modules-do-less-and-be-flexible">do less and be flexible</a></li> 
        <li> <a href="#modules-creating-modules">creating modules</a></li> 
        <li> <a href="#modules-properties">properties</a></li> 
        <li> <a href="#modules-usage">usage</a></li> 
       </ul></li> 
      <li class=""> <a href="#routes">routes</a> 
       <ul> 
        <li> <a href="#routes-creating-routes">creating routes</a></li> 
        <li> <a href="#routes-route-handler">route handler</a></li> 
        <li> <a href="#routes-path-patterns">path patterns</a></li> 
        <li> <a href="#routes-static-files">static files</a></li> 
        <li> <a href="#routes-precedence-and-order">precedence and order</a></li> 
        <li> <a href="#routes-request-handling">request handling</a></li> 
        <li> <a href="#routes-content-negotiation">content negotiation</a></li> 
        <li> <a href="#routes-interceptors">interceptors</a></li> 
        <li> <a href="#routes-mvc-routes">mvc routes</a></li> 
        <li> <a href="#routes-dynamic-advanced-routing">dynamic / advanced routing</a></li> 
        <li> <a href="#routes-properties">properties</a></li> 
       </ul></li> 
      <li class=""> <a href="#request">request</a> 
       <ul> 
        <li> <a href="#request-parameters">parameters</a></li> 
        <li> <a href="#request-headers">headers</a></li> 
        <li> <a href="#request-body">body</a></li> 
        <li> <a href="#request-form-submit">form submit</a></li> 
        <li> <a href="#request-file-upload">file upload</a></li> 
        <li> <a href="#request-locals">locals</a></li> 
        <li> <a href="#request-flash-scope">flash scope</a></li> 
        <li> <a href="#request-require">require</a></li> 
        <li> <a href="#request-access-log">access log</a></li> 
       </ul></li> 
      <li class=""> <a href="#response">response</a> 
       <ul> 
        <li> <a href="#response-send">send</a></li> 
        <li> <a href="#response-headers">headers</a></li> 
        <li> <a href="#response-send-file">send file</a></li> 
       </ul></li> 
      <li class=""> <a href="#session">session</a> 
       <ul> 
        <li> <a href="#session-usage">usage</a></li> 
        <li> <a href="#session-no-timeout">no timeout</a></li> 
        <li> <a href="#session-cookie">cookie</a></li> 
       </ul></li> 
      <li class=""> <a href="#error-handling">error handling</a> 
       <ul> 
        <li> <a href="#error-handling-default-err-handler">default err handler</a></li> 
        <li> <a href="#error-handling-custom-err-handler">custom err handler</a></li> 
        <li> <a href="#error-handling-status-code">status code</a></li> 
       </ul></li> 
      <li class=""> <a href="#parser-and-renderer">parser and renderer</a> 
       <ul> 
        <li> <a href="#parser-and-renderer-parser">parser</a></li> 
        <li> <a href="#parser-and-renderer-renderer">renderer</a></li> 
        <li> <a href="#parser-and-renderer-view-engine">view engine</a></li> 
       </ul></li> 
      <li class=""> <a href="#thread-model">thread model</a> 
       <ul> 
        <li> <a href="#thread-model-worker-threads">worker threads</a></li> 
        <li> <a href="#thread-model-deferred">deferred</a></li> 
        <li> <a href="#thread-model-executor">executor</a></li> 
        <li> <a href="#thread-model-promise">promise</a></li> 
        <li> <a href="#thread-model-advanced-configuration">advanced configuration</a></li> 
       </ul></li> 
      <li class=""> <a href="#tests">tests</a> 
       <ul> 
        <li> <a href="#tests-unit-tests">unit tests</a></li> 
        <li> <a href="#tests-integration-tests">integration tests</a></li> 
       </ul></li> 
      <li class=""> <a href="#https">https</a> 
       <ul> 
        <li> <a href="#https-certificates">certificates</a></li> 
       </ul></li> 
      <li class=""> <a href="#http-2">http/2</a> 
       <ul> 
        <li> <a href="#http-2-server-push">server push</a></li> 
       </ul></li> 
      <li class=""> <a href="#web-sockets">web sockets</a> 
       <ul> 
        <li> <a href="#web-sockets-usage">usage</a></li> 
        <li> <a href="#web-sockets-send-and-broadcast">send and broadcast</a></li> 
        <li> <a href="#web-sockets-require">require</a></li> 
        <li> <a href="#web-sockets-listener">listener</a></li> 
        <li> <a href="#web-sockets-consumes">consumes</a></li> 
        <li> <a href="#web-sockets-produces">produces</a></li> 
       </ul></li> 
      <li class=""> <a href="#server-sent-events">server-sent events</a> 
       <ul> 
        <li> <a href="#server-sent-events-usage">usage</a></li> 
        <li> <a href="#server-sent-events-structured-data">structured data</a></li> 
        <li> <a href="#server-sent-events-request-parameters">request parameters</a></li> 
        <li> <a href="#server-sent-events-connection-lost">connection lost</a></li> 
        <li> <a href="#server-sent-events-keep-alive-time">keep alive time</a></li> 
        <li> <a href="#server-sent-events-require">require</a></li> 
        <li> <a href="#server-sent-events-example">example</a></li> 
       </ul></li> 
      <li class=""> <a href="#misc">misc</a> 
       <ul> 
        <li> <a href="#misc-cors">cors</a></li> 
        <li> <a href="#misc-xss">xss</a></li> 
       </ul></li> 
     </ul> 
    </div> 
    <div class="section-content"> 
     <div class="datalist" id="do-more-more-easily"> 
      <div class="datalist-title active"> 
       <h2>do more, more easily</h2> 
      </div> 
      <div class="datalist-content"> 
       <ul> 
        <li><strong>Simple</strong> and <strong>effective</strong> programming model for building small and large scale web applications</li> 
        <li>Built with <strong>developer productivity</strong> in mind</li> 
        <li>Plain <strong>Java DSL</strong> for routes (no xml, or similar)</li> 
        <li><strong>Reflection</strong>, <strong>annotations</strong> and <strong>dependency injection</strong> are kept to a <strong>minimum</strong> and in some cases is completely optional</li> 
        <li><strong>No classpath hell</strong>, the default deployment model uses a normal JVM bootstrap</li> 
        <li>Modules are easy to use and do as little as possible</li> 
       </ul> 
       <p><a href="https://jooby.org">Jooby</a> keeps it <strong>simple</strong> yet <strong>powerful</strong>.</p> 
      </div> 
     </div> 
     <div class="datalist" id="application"> 
      <div class="datalist-title "> 
       <h2>application</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>A Jooby app looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span> <span class="c1">// 1.</span>

  <span class="o">{</span>
    <span class="c1">// 2. add a route</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"Hello"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 3. run my app</span>
    <span class="n">run</span><span class="o">(</span><span class="nl">App:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>1) Create a new App extending Jooby</p> 
       <p>2) Define your application in the <code class="highlighter-rouge codehilite">instance initializer</code></p> 
       <p>3) Run the application.</p> 
       <h3 id="application-life-cycle">life cycle</h3> 
       <p>Application provides start and stop events. These events are useful for starting/stopping services.</p> 
       <h4 id="application-onStart-onStop-events">onStart/onStop events</h4> 
       <p>Start/stop callbacks are accessible via application:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
   <span class="n">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"starting app"</span><span class="o">);</span>
   <span class="o">});</span>

   <span class="n">onStop</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"stopping app"</span><span class="o">);</span>
   <span class="o">});</span>

   <span class="n">onStarted</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"app started"</span><span class="o">);</span>
   <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or via module:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyModule</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">conf</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">env</span><span class="o">.</span><span class="na">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"starting module"</span><span class="o">);</span>
    <span class="o">});</span>

    <span class="n">env</span><span class="o">.</span><span class="na">onStop</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"stopping module"</span><span class="o">);</span>
    <span class="o">});</span>

    <span class="n">env</span><span class="o">.</span><span class="na">onStarted</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"app started"</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <code class="highlighter-rouge codehilite">onStart</code> callbacks are part of bootstrap and executed before the server is ready. The <code class="highlighter-rouge codehilite">onStarted</code> callbacks are executed when the server is ready.</p> 
       <p>Modules are covered later all you need to know now is that you can start/stop module as you usually do from your application.</p> 
       <h4 id="application-order">order</h4> 
       <p>Callback order is preserved:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"first"</span><span class="o">);</span>
  <span class="o">});</span>

  <span class="n">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"second"</span><span class="o">);</span>
  <span class="o">});</span>

  <span class="n">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"third"</span><span class="o">);</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Order is useful for service dependencies, for example if <code class="highlighter-rouge codehilite">ServiceB</code> should be started after <code class="highlighter-rouge codehilite">ServiceA</code>.</p> 
       <h4 id="application-service-registry">service registry</h4> 
       <p>You have access to the the service registry from start/stop events:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">onStart</span><span class="o">(</span><span class="n">registry</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">service</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">});</span>

  <span class="n">onStop</span><span class="o">(</span><span class="n">registry</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">service</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="application-PostConstruct-PreDestroy-annotations">PostConstruct/PreDestroy annotations</h4> 
       <p>If you prefer annotations you can do:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

  <span class="nd">@PostConstruct</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">start</span><span class="o">()</span> <span class="o">{</span>
   <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@PreDestroy</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">stop</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

<span class="o">}</span>

<span class="n">App</span><span class="o">.</span><span class="na">java</span><span class="o">:</span>
<span class="o">{</span>
  <span class="n">lifeCycle</span><span class="o">(</span><span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Service must be a <strong>Singleton</strong> object.</p> 
      </div> 
     </div> 
     <div class="datalist" id="conf-env-and-logging"> 
      <div class="datalist-title "> 
       <h2>conf, env and logging</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>Jooby is configurable via Lightbend’s <a href="https://github.com/typesafehub/config" target="_blank">Config</a> library.</p> 
       <p>By default, Jooby expects to find an <code class="highlighter-rouge codehilite">application.conf</code> file at the root of the classpath. You can find the <code class="highlighter-rouge codehilite">.conf</code> file under the <code class="highlighter-rouge codehilite">conf</code> classpath directory.</p> 
       <h3 id="conf-env-and-logging-getting-properties">getting properties</h3> 
       <p>via script:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Config</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">Config</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">myprop</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"myprop"</span><span class="o">);</span>
    <span class="o">...</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>via <code class="highlighter-rouge codehilite">@Named</code> annotation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="n">Controller</span><span class="o">(</span><span class="nd">@Named</span><span class="o">(</span><span class="s">"myprop"</span><span class="o">)</span> <span class="n">String</span> <span class="n">myprop</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>via <a href="/v1/apidocs/org/jooby/Jooby.Module.html" target="_blank">Module</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyModule</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">conf</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">myprop</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"myprop"</span><span class="o">);</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="conf-env-and-logging-type-conversion">type conversion</h4> 
       <p>Automatic type conversion is provided when a type:</p> 
       <p>1) Is a primitive, primitive wrapper or String</p> 
       <p>2) Is an enum</p> 
       <p>3) Has a public <strong>constructor</strong> that accepts a single <strong>String</strong> argument</p> 
       <p>4) Has a static method <strong>valueOf</strong> that accepts a single <strong>String</strong> argument</p> 
       <p>5) Has a static method <strong>fromString</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.util.UUID</code></p> 
       <p>6) Has a static method <strong>forName</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.nio.charset.Charset</code></p> 
       <p>You’re free to inject the entire <code class="highlighter-rouge codehilite">com.typesafe.config.Config</code> object or <code class="highlighter-rouge codehilite">sub-path/tree</code> of it.</p> 
       <h3 id="conf-env-and-logging-environment">environment</h3> 
       <p>Jooby internals and the module system rely on the <code class="highlighter-rouge codehilite">application.env</code> property. By default, this property is set to: <code class="highlighter-rouge codehilite">dev</code>.</p> 
       <p>This special property is represented at runtime with the <a href="/v1/apidocs/org/jooby/Env.html" target="_blank">Env</a> class.</p> 
       <p>For example: a module might decided to create a connection pool, cache, etc. when <code class="highlighter-rouge codehilite">application.env</code> isn’t set to <code class="highlighter-rouge codehilite">dev</code>.</p> 
       <p>The <code class="highlighter-rouge codehilite">application.env</code> property can be set as command line argument as well:</p> 
       <p>Using a <code class="highlighter-rouge codehilite">fat jar</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -jar myfat.jar prod
</code></pre> 
       </div> 
       <p>Using <a href="/v1/doc/stork">stork</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>bin/myapp --start prod
</code></pre> 
       </div> 
       <h3 id="conf-env-and-logging-turning-features-on-or-off">turning features on or off</h3> 
       <p>As described before, the <code class="highlighter-rouge codehilite">application.env</code> property defines the environment where the application is being executed. It’s possible to turn on/off specific features based on the application environment:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">on</span><span class="o">(</span><span class="s">"dev"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">DevModule</span><span class="o">());</span>
  <span class="o">});</span>

  <span class="n">on</span><span class="o">(</span><span class="s">"prod"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">ProdModule</span><span class="o">());</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>There is a <code class="highlighter-rouge codehilite">~</code> (complement) operator:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">on</span><span class="o">(</span><span class="s">"dev"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">DevModule</span><span class="o">());</span>
  <span class="o">}).</span><span class="na">orElse</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">ProdModule</span><span class="o">());</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <code class="highlighter-rouge codehilite">environment callback</code> has access to the <code class="highlighter-rouge codehilite">config</code> object, see:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">on</span><span class="o">(</span><span class="s">"dev"</span><span class="o">,</span> <span class="n">conf</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">DevModule</span><span class="o">(</span><span class="n">conf</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"myprop"</span><span class="o">)));</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="conf-env-and-logging-special-properties">special properties</h3> 
       <p>Here is the list of special properties available in Jooby:</p> 
       <ul> 
        <li><strong>pid</strong>: application process ID.</li> 
        <li><strong>application.name</strong>: describes the name of your application. Default is: <code class="highlighter-rouge codehilite">single package name</code> of where you define your bootstrap class, for example for <code class="highlighter-rouge codehilite">com.foo.App</code> application’s name is <code class="highlighter-rouge codehilite">foo</code>.</li> 
        <li><strong>application.version</strong>: application version. Default is: <code class="highlighter-rouge codehilite">getClass().getPackage().getImplementationVersion()</code> (automatically set by Maven).</li> 
        <li><strong>application.class</strong>: fully qualified name of the bootstrap class.</li> 
        <li><strong>application.secret</strong>: If present, the session cookie will be signed with the <code class="highlighter-rouge codehilite">application.secret</code>.</li> 
        <li><strong>application.tmpdir</strong>: location of the application temporary directory. Default is: <code class="highlighter-rouge codehilite">${java.io.tmpdir}/${application.name}</code>.</li> 
        <li><strong>application.charset</strong>: charset to use. Default is: <code class="highlighter-rouge codehilite">UTF-8</code>.</li> 
        <li><strong>application.lang</strong>: locale to use. Default is: <code class="highlighter-rouge codehilite">Locale.getDefault()</code>.</li> 
        <li><strong>application.dateFormat</strong>: date format to use. Default is: <code class="highlighter-rouge codehilite">dd-MM-yyyy</code>.</li> 
        <li><strong>application.numberFormat</strong>: number format to use. Default is: <code class="highlighter-rouge codehilite">DecimalFormat.getInstance("application.lang")</code>.</li> 
        <li><strong>application.tz</strong>: time zone to use. Default is: <code class="highlighter-rouge codehilite">ZoneId.systemDefault().getId()</code>.</li> 
        <li><strong>runtime.processors</strong>: number of available processors.</li> 
        <li><strong>runtime.processors-plus1</strong>: number of processors.</li> 
        <li><strong>runtime.processors-plus2</strong>: number of processors + 2.</li> 
        <li><strong>runtime.processors-x2</strong>: number of processors * 2.</li> 
       </ul> 
       <h3 id="conf-env-and-logging-precedence">precedence</h3> 
       <p>Configuration files are loaded in the following order:</p> 
       <ul> 
        <li>system properties</li> 
        <li>arguments properties</li> 
        <li>(file://[application].[env].[conf])?</li> 
        <li>(cp://[application].[env].[conf])?</li> 
        <li>([application].[conf])?</li> 
        <li>[module].[conf]*</li> 
       </ul> 
       <p>The first occurence of a property will take precedence.</p> 
       <h4 id="conf-env-and-logging-system-properties">system properties</h4> 
       <p>System properties can override any other property. A system property is set at startup time, like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -Dapplication.env=prod -jar myapp.jar
</code></pre> 
       </div> 
       <h4 id="conf-env-and-logging-arguments-properties">arguments properties</h4> 
       <p>Command line arguments has precedence over <code class="highlighter-rouge codehilite">file system</code> or <code class="highlighter-rouge codehilite">classpath</code> configuration files:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -jar myapp.jar application.env=prod
</code></pre> 
       </div> 
       <p>Or using the shortcut for <code class="highlighter-rouge codehilite">application.env</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -jar myapp.jar prod
</code></pre> 
       </div> 
       <p>Unqualified properties are bound to <code class="highlighter-rouge codehilite">application</code>, so:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -jar myapp.jar port=8888 path=/myapp
</code></pre> 
       </div> 
       <p>automatically translate to:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>java -jar myapp.jar application.port=8888 application.path=/myapp
</code></pre> 
       </div> 
       <h4 id="conf-env-and-logging-file-application-env-conf-">file://[application].[env].[conf]</h4> 
       <p>A <code class="highlighter-rouge codehilite">file system</code> configuration file has precedence over <code class="highlighter-rouge codehilite">classpath</code> configuration file. Usefult to override a <code class="highlighter-rouge codehilite">classpath</code> configuration file.</p> 
       <h4 id="conf-env-and-logging-cp-application-env-conf-">cp://[application].[env].[conf]</h4> 
       <p>A <code class="highlighter-rouge codehilite">classpath system conf</code> file has precedence over <code class="highlighter-rouge codehilite">default conf</code> file.</p> 
       <h4 id="conf-env-and-logging-application-conf">application.conf</h4> 
       <p>The default <code class="highlighter-rouge codehilite">classpath conf</code> file: <code class="highlighter-rouge codehilite">application.conf</code></p> 
       <h4 id="conf-env-and-logging--module-conf-">[module].[conf]</h4> 
       <p>A <a href="/v1/apidocs/org/jooby/Jooby.Module.html" target="_blank">Module</a> might have defined its own set of (default) properties via the <a href="/v1/apidocs/org/jooby/Jooby.Module.html#config--" target="_blank">Module.config</a> method.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">Jdbc</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="conf-env-and-logging-custom-conf">custom .conf</h4> 
       <p>As mentioned earlier, the default <code class="highlighter-rouge codehilite">conf</code> file is <code class="highlighter-rouge codehilite">application.conf</code>, but you can use whatever name you prefer:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">conf</span><span class="o">(</span><span class="s">"myapp.conf"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="conf-env-and-logging-example">example</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>.
└── conf
    ├── application.conf
    ├── application.uat.conf
    ├── application.prod.conf
    ├── logback.xml
    ├── logback.uat.xml
    └── logback.prod.xml
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// import Foo and Bar modules:</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">Foo</span><span class="o">());</span>

  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">Bar</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <ul> 
        <li>Starting the application in <code class="highlighter-rouge codehilite">dev</code> produces a <code class="highlighter-rouge codehilite">conf</code> tree similar to:</li> 
       </ul> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>.
└── system properties
    ├── command line
    ├── application.conf
    ├── foo.conf
    ├── bar.conf
    ├── ...
    └── ...
</code></pre> 
       </div> 
       <ul> 
        <li>Starting the application in <code class="highlighter-rouge codehilite">prod</code> produces a <code class="highlighter-rouge codehilite">conf</code> tree similar to:</li> 
       </ul> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>.
└── system properties
    ├── command line
    ├── application.prod.conf
    ├── application.conf
    ├── foo.conf
    ├── bar.conf
    ├── ...
    └── ...
</code></pre> 
       </div> 
       <p>First-listed are higher priority.</p> 
       <p>For more details, please refer to the <a href="https://github.com/typesafehub/config" target="_blank">config documentation</a>.</p> 
       <h3 id="conf-env-and-logging-logging">logging</h3> 
       <p>Logging is done via <a href="http://logback.qos.ch" target="_blank">logback</a>. Logback bootstrap and configuration is described in detail <a href="http://logback.qos.ch/manual/configuration.html" target="_blank">here</a>.</p> 
       <p>You will usually find the <code class="highlighter-rouge codehilite">logback.xml</code> file inside the <code class="highlighter-rouge codehilite">conf</code> directory. Also, you can define a <code class="highlighter-rouge codehilite">logback.xml</code> file per <code class="highlighter-rouge codehilite">application.env</code> by appending the <code class="highlighter-rouge codehilite">env</code>. See some examples:</p> 
       <ul> 
        <li><code class="highlighter-rouge codehilite">logback.uat.xml</code> when <code class="highlighter-rouge codehilite">application.env = uat</code></li> 
        <li><code class="highlighter-rouge codehilite">logback.prod.xml</code> when <code class="highlighter-rouge codehilite">application.env = prod</code></li> 
       </ul> 
       <p>If the <code class="highlighter-rouge codehilite">logback[.env].xml</code> file isn’t present, <code class="highlighter-rouge codehilite">logback.xml</code> will be used as a fallback.</p> 
      </div> 
     </div> 
     <div class="datalist" id="modules"> 
      <div class="datalist-title "> 
       <h2>modules</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>Modules are a <strong>key concept</strong> for building <strong>reusable</strong> and <strong>configurable</strong> pieces of software.</p> 
       <p>Modules (unlike in other frameworks) are thin and do a lot of work to bootstrap and configure an external library, but they <strong>DO NOT provide a new level of abstraction</strong> nor [do] they provide a custom API to access functionality in that library. Instead they <strong>expose</strong> the <strong>library</strong> components as <strong>they are</strong>.</p> 
       <p>Modules like in <a href="https://github.com/google/guice" target="_blank">Guice</a> are used to wire services, connect data, etc…</p> 
       <p>There is an extensive <a href="/v1/modules">module ecosystem</a> which makes Jooby a <strong>full stack</strong> framework (when needed).</p> 
       <h3 id="modules-do-less-and-be-flexible">do less and be flexible</h3> 
       <p><strong>Do less</strong> might sounds confusing, but is the key to <strong>flexibility</strong>.</p> 
       <p>A module does as <strong>little as possible</strong> (a key difference with other frameworks). A module for a library <code class="highlighter-rouge codehilite">X</code> should:</p> 
       <ul> 
        <li>Bootstrap X</li> 
        <li>Configure X</li> 
        <li>export the API of X</li> 
       </ul> 
       <p>This means that a module should NOT create a wrapper for a library. Instead it should provide a way to extend, configure and use the external library.</p> 
       <blockquote> 
        <p>This principle keeps modules small, maintainable and flexible.</p> 
       </blockquote> 
       <h3 id="modules-creating-modules">creating modules</h3> 
       <p>A module is represented by the <a href="/v1/apidocs/org/jooby/Jooby.Module.html" target="_blank">Jooby.Module</a> class. The configure callback looks like this:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">M1</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">conf</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">binder</span><span class="o">.</span><span class="na">bind</span><span class="o">(...).</span><span class="na">to</span><span class="o">(...);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The configure callback is similar to a <a href="https://github.com/google/guice" target="_blank">Guice module</a>, except you can access to the <a href="/v1/apidocs/org/jooby/Env.html" target="_blank">Env</a> and <a href="https://github.com/typesafehub/config" target="_blank">config</a> objects.</p> 
       <h3 id="modules-properties">properties</h3> 
       <p>In addition to the <strong>configure</strong> callback, a module in <a href="https://jooby.org">Jooby</a> has one additional method: <a href="/v1/apidocs/org/jooby/Jooby.Module.html#config--" target="_blank">Module.config</a>. The <code class="highlighter-rouge codehilite">config</code> method allows a module to set default properties.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">M1</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">config</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">binder</span><span class="o">.</span><span class="na">bind</span><span class="o">(...).</span><span class="na">to</span><span class="o">(...);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">Config</span> <span class="n">config</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ConfigFactory</span><span class="o">.</span><span class="na">parseResources</span><span class="o">(</span><span class="n">getClass</span><span class="o">(),</span> <span class="s">"m1.properties"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="modules-usage">usage</h3> 
       <p>A module must be registered at startup time:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.jooby.Jooby</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>

  <span class="o">{</span>
     <span class="c1">// as lambda</span>
     <span class="n">use</span><span class="o">((</span><span class="n">env</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="n">binder</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">binder</span><span class="o">.</span><span class="na">bind</span><span class="o">(...).</span><span class="na">to</span><span class="o">(...);</span>
     <span class="o">});</span>
     <span class="c1">// as instance</span>
     <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">M1</span><span class="o">());</span>
     <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">M2</span><span class="o">());</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You can start or stop services from a module:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">M1</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">config</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">env</span><span class="o">.</span><span class="na">onStart</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// Start services</span>
      <span class="o">});</span>
      <span class="n">env</span><span class="o">.</span><span class="na">onStop</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// Stop services</span>
      <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or export routes:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">M1</span> <span class="kd">implements</span> <span class="n">Jooby</span><span class="o">.</span><span class="na">Module</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">(</span><span class="n">Env</span> <span class="n">env</span><span class="o">,</span> <span class="n">Config</span> <span class="n">config</span><span class="o">,</span> <span class="n">Binder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Router</span> <span class="n">router</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">router</span><span class="o">();</span>
      <span class="n">router</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/m1"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"I'm a module!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="routes"> 
      <div class="datalist-title "> 
       <h2>routes</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>A route describes the interface for making requests to your application. It combines an HTTP <strong>method</strong> and a <strong>path pattern</strong>.</p> 
       <p>A route has an associated <strong>handler</strong>, which does some job and produces some kind of output (HTTP response).</p> 
       <p>Jooby offers two programming models for writing routes:</p> 
       <ul> 
        <li>Script routes via <strong>lambdas</strong>, like <em>Sinatra</em> or <em>expressjs</em></li> 
        <li>MVC routes via <strong>annotations</strong>, like <em>Jersey</em> or <em>Spring</em> (covered later)</li> 
       </ul> 
       <h3 id="routes-creating-routes">creating routes</h3> 
       <p>A <code class="highlighter-rouge codehilite">script</code> route definition looks like this:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>while an <code class="highlighter-rouge codehilite">MVC</code> route definition looks like this:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.jooby.mvc.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jooby.mvc.Path</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">salute</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"hey jooby"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC routes are <a href="/v1/doc/#routes-mvc-routes">covered later</a> in detail. For simplicity, all the examples use <code class="highlighter-rouge codehilite">script</code> routes, but keep in mind you can do the same with <code class="highlighter-rouge codehilite">MVC</code> routes.</p> 
       <p>A route was created to handle GET requests at the root of our application. Any other HTTP method can be handled the same way.</p> 
       <p>If you need a <code class="highlighter-rouge codehilite">POST</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>or listen to any <code class="highlighter-rouge codehilite">HTTP method</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>It’s also possible to name a route explicitly:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">)</span>
   <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"salute"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>The default route name is <strong>anonymous</strong>. Naming a route is useful for debugging purposes (if you have two or more routes mounted on the same path) and for <a href="#routes-dynamic-advanced-routing">dynamic and advanced routing</a>.</p> 
       <h3 id="routes-route-handler">route handler</h3> 
       <p>Jooby offers several flavors for routes:</p> 
       <h4 id="routes-functional-handler-">functional handler: ()</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>This handler usually produces a constant value. The returned value will be sent to the client.</p> 
       <h4 id="routes-functional-handler-req">functional handler: req</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>
</code></pre> 
       </div> 
       <p>This handler depends on some <code class="highlighter-rouge codehilite">external</code> attribute which is available via the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">Request</a> object. The return value will be sent to the client.</p> 
       <h4 id="routes-handler-req-rsp-">handler: (req, rsp)</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>
</code></pre> 
       </div> 
       <p>This handler depends on some <code class="highlighter-rouge codehilite">external</code> attribute which is available to the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">Request</a> object and the response is explicitly sent via the <a href="/v1/apidocs/org/jooby/Response.html#send(java.lang.Object)" target="_blank">response.send</a> method.</p> 
       <h4 id="routes-filter-req-rsp-chain-">filter: (req, rsp, chain)</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="c1">// do something</span>
  <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>This is the most advanced handler. You have access to the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">Request</a>, the <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">Response</a> and the <a href="/v1/apidocs/org/jooby/Route.Chain.html" target="_blank">Route.Chain</a> objects.</p> 
       <p>From a handler like this, it’s possible to end a response by calling the <a href="/v1/apidocs/org/jooby/Response.html#send(java.lang.Object)" target="_blank">response.send</a> method, abort the request by throwing an <a href="/v1/apidocs/org/jooby/Err.html" target="_blank">Err</a> or allow the request to proceed to the next handler in the pipeline by calling <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(req, rsp)</a>.</p> 
       <h3 id="routes-path-patterns">path patterns</h3> 
       <h4 id="routes-static-patterns">static patterns</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/help"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/mail/inbox"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <h4 id="routes-var-regex-patterns">var/regex patterns</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/user/:id"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>

<span class="c1">// alternative syntax</span>
<span class="n">get</span><span class="o">(</span><span class="s">"/user/{id}"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>

<span class="c1">// matches a path element with the prefix "uid"</span>
<span class="n">get</span><span class="o">(</span><span class="s">"/user/uid{id}"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>

<span class="c1">// regex</span>
<span class="n">get</span><span class="o">(</span><span class="s">"/user/{id:\\d+}"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">intValue</span><span class="o">());</span>
</code></pre> 
       </div> 
       <p>Request parameters will be covered later. For now all you need to know is that you can access a path parameter using <a href="/v1/apidocs/org/jooby/Request.html#param(java.lang.String)" target="_blank">Request.param(String)</a>.</p> 
       <h4 id="routes-ant-style-patterns">ant style patterns</h4> 
       <p><code class="highlighter-rouge codehilite">com/t?st.html</code> - matches <code class="highlighter-rouge codehilite">com/test.html</code> but also <code class="highlighter-rouge codehilite">com/tast.html</code> and <code class="highlighter-rouge codehilite">com/txst.html</code></p> 
       <p><code class="highlighter-rouge codehilite">com/*.html</code> - matches all <code class="highlighter-rouge codehilite">.html</code> files in the <code class="highlighter-rouge codehilite">com</code> directory</p> 
       <p><code class="highlighter-rouge codehilite">com/**/test.html</code> - matches all <code class="highlighter-rouge codehilite">test.html</code> files underneath the <code class="highlighter-rouge codehilite">com</code> path</p> 
       <p><code class="highlighter-rouge codehilite">**</code> - matches any path at any level</p> 
       <p><code class="highlighter-rouge codehilite">*</code> - matches anything except <code class="highlighter-rouge codehilite">/</code></p> 
       <p><code class="highlighter-rouge codehilite">**:name</code> or <code class="highlighter-rouge codehilite"><span class="p">{</span><span class="err">name:**</span><span class="p">}</span></code> - matches any path at any level and binds the match to the request parameter <code class="highlighter-rouge codehilite">name</code></p> 
       <h3 id="routes-static-files">static files</h3> 
       <p>Static files are located inside the <code class="highlighter-rouge codehilite">public</code> directory.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>├── public
    ├── assets
    |   ├── js
    |   |   └── index.js
    |   ├── css
    |   |   └── style.css
    |   └── images
    |       └── logo.png
    └── welcome.html
</code></pre> 
       </div> 
       <p>The <a href="/v1/apidocs/org/jooby/Jooby.html#assets-java.lang.String-" target="_blank">assets</a> method let you expose all the content from a <code class="highlighter-rouge codehilite">folder</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">assets</span><span class="o">(</span><span class="s">"/assets/**"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The asset route handler resolves requests like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>GET /assets/js/index.js
GET /assets/css/style.css
</code></pre> 
       </div> 
       <p>It’s possible to map a single static file to a path:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">assets</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"welcome.html"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A <code class="highlighter-rouge codehilite">GET /</code> will display the static file <code class="highlighter-rouge codehilite">welcome.html</code>.</p> 
       <p>Here is another example with <a href="http://www.webjars.org" target="_blank">webjars</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">assets</span><span class="o">(</span><span class="s">"/assets/**"</span><span class="o">,</span> <span class="s">"/META-INF/resources/webjars/{0}"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>which would respond to the following requests:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>GET /assets/jquery/2.1.3/jquery.js
GET /assets/bootstrap/3.3.4/css/bootstrap.css
</code></pre> 
       </div> 
       <h4 id="routes-file-system-location">file system location</h4> 
       <p>By default the asset handler is able to read files from the <code class="highlighter-rouge codehilite">public</code> folder, which is a classpath folder.</p> 
       <p>It’s possible to specify an <code class="highlighter-rouge codehilite">external</code> file system location as well:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="err">assets(</span><span class="nt">"/static/**"</span><span class="err">,</span><span class="w"> </span><span class="err">Paths.get(</span><span class="nt">"/www"</span><span class="err">));</span><span class="w"> </span><span class="err">}</span><span class="w"> </span></code></pre> 
       </div> 
       <p>A request to <code class="highlighter-rouge codehilite">/static/images/logo.png</code> is translated to the <code class="highlighter-rouge codehilite">/www/images/logo.png</code> file.</p> 
       <h4 id="routes-ETag-Last-Modified-and-Cache-Control">ETag, Last-Modified and Cache-Control</h4> 
       <p>The <code class="highlighter-rouge codehilite">assets.etag</code> and <code class="highlighter-rouge codehilite">assets.lastModified</code> are two boolean properties that control the <code class="highlighter-rouge codehilite">ETag</code> and <code class="highlighter-rouge codehilite">Last-Modified</code> headers. Both are enabled by default.</p> 
       <p>The <code class="highlighter-rouge codehilite">assets.cache.maxAge</code> controls the <code class="highlighter-rouge codehilite">Cache-Control</code> header. Allowed value includes: <code class="highlighter-rouge codehilite">60</code>, <code class="highlighter-rouge codehilite">1h</code>, <code class="highlighter-rouge codehilite">365d</code>, etc. This property is off by default: <code class="highlighter-rouge codehilite">-1</code>.</p> 
       <h4 id="routes-using-a-CDN">using a CDN</h4> 
       <p>The asset handler goes one step forward and adds support for serving files from a <code class="highlighter-rouge codehilite">CDN</code> out of the box.</p> 
       <p>All you have to do is to define a <code class="highlighter-rouge codehilite">assets.cdn</code> property:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="py">assets.cdn</span> <span class="p">=</span> <span class="s">"http://d7471vfo50fqt.cloudfront.net"</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">assets</span><span class="o">(</span><span class="s">"/assets/**"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A <code class="highlighter-rouge codehilite">GET</code> to <code class="highlighter-rouge codehilite">/assets/js/index.js</code> will be redirected to: <code class="highlighter-rouge codehilite">http://d7471vfo50fqt.cloudfront.net/assets/js/index.js</code></p> 
       <p>All these assets features are controlled globally from <code class="highlighter-rouge codehilite">.conf</code> file or individually:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">assets</span><span class="o">(</span><span class="s">"/assets/**"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">etag</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">cdn</span><span class="o">(</span><span class="s">"http://d7471vfo50fqt.cloudfront.net"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="s">"365d"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-assets-module">assets module</h4> 
       <p>There is also a powerful and all-round awesome <a href="/v1/doc/assets">assets</a> module. This module can validate, concatenate, minify or compress JavaScript and CSS assets.</p> 
       <h3 id="routes-precedence-and-order">precedence and order</h3> 
       <p>Routes are executed in the <strong>order they are defined</strong>. That means that the ordering of routes is crucial to the behavior of an application. Let’s examine how this works with some examples:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"first"</span><span class="o">);</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"second"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>A call to <code class="highlighter-rouge codehilite">/abc</code> produces a response of <code class="highlighter-rouge codehilite">first</code>. If we revert the order:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"second"</span><span class="o">);</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"first"</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>It produces a response of <code class="highlighter-rouge codehilite">second</code>.</p> 
       <blockquote> 
        <p>As you can see <strong>ORDER IS VERY IMPORTANT</strong>.</p> 
       </blockquote> 
       <p>How come it’s legal with two or more routes on the same path?</p> 
       <p>Because this is how <strong>filters</strong> for routes are enabled.</p> 
       <p>A route handler accepts a third parameter, commonly named chain, which refers to the next route handler in line:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"first"</span><span class="o">);</span>
  <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/abc"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"second"</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>Again the order of route definition is important. Forgetting this will cause your application behave unpredictably. You will learn more about this behavior in the examples in the next section.</p> 
       <h3 id="routes-request-handling">request handling</h3> 
       <p>When a request matching a route definition is made to the server, the associated callback functions kick in to process the request and send a response. This is called a route pipe or stack.</p> 
       <p>Routes are like a plumbing pipe, with requests starting at the first route and then working their way “down” the route stack processing for each path they match.</p> 
       <p>Each route handler has the capability to send a response or pass the request on to the next route handler in the current stack.</p> 
       <p>Route handlers, also have access to the chain object, which happens to be the next callback function in the pipe. To make the chain object available to the callback function, pass it as a method parameter:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>If there is no matching callback function after the current callback function, next refers to the built-in 404 error handler, and will be triggered when you call it.</p> 
       <p>Try to guess the output of:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"first"</span><span class="o">));</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"second"</span><span class="o">));</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"third"</span><span class="o">));</span>
</code></pre> 
       </div> 
       <p>Will the server print all of them? “first”? “third”?</p> 
       <p>It prints “first”. The act of doing a <a href="/v1/apidocs/org/jooby/Response.html#send-java.lang.Object-" target="_blank">rsp.send()</a> will terminate the flow of the request then and there; the request is not passed on to any other route handler.</p> 
       <p>So, how can you specify multiple handlers for a route, and use them all at the same time? Call the <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(req, rsp)</a> function from the callback, without calling <a href="/v1/apidocs/org/jooby/Response.html#send-java.lang.Object-" target="_blank">rsp.send()</a> (as that would terminate the request). Here is an example:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"first"</span><span class="o">);</span>
  <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"second"</span><span class="o">);</span>
  <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
<span class="o">});</span>


<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"third"</span><span class="o">);</span>
<span class="o">});</span>

</code></pre> 
       </div> 
       <p>Alternatively, if you <strong>always</strong> call <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(req, rsp)</a> just use the <code class="highlighter-rouge codehilite">(req, rsp</code> handler:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"first"</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"second"</span><span class="o">);</span>
<span class="o">});</span>


<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"third"</span><span class="o">);</span>
<span class="o">});</span>

</code></pre> 
       </div> 
       <p>The third argument is required if you need to decide whether the next route needs to be executed or not. If you always call <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(req, rsp)</a> the third argument isn’t required and does exactly what the second argument handler does: it <strong>always</strong> calls <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(req, rsp)</a>.</p> 
       <p>A good example for a filter is to handle e.g. authentication:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// It is OK</span>
    <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">Route</span><span class="o">.</span><span class="na">Err</span><span class="o">(</span><span class="mi">403</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <h3 id="routes-content-negotiation">content negotiation</h3> 
       <p>A route can produce different results based on the <code class="highlighter-rouge codehilite">Accept</code> header:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
  <span class="n">Results</span>
    <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">,</span> <span class="o">()</span>  <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"viewname"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">))</span>
    <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">,</span> <span class="o">()</span>  <span class="o">-&gt;</span> <span class="n">model</span><span class="o">)</span>
    <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">()</span>  <span class="o">-&gt;</span> <span class="n">Status</span><span class="o">.</span><span class="na">NOT_ACCEPTABLE</span><span class="o">)</span>
<span class="o">);</span>
</code></pre> 
       </div> 
       <p>This will perform content-negotiation on the Accept HTTP header of the request object. It selects a handler for the request, based on the acceptable types ordered by their quality factor. If the header is not specified, the first callback is invoked. When no match is found, the server responds with <code class="highlighter-rouge codehilite">406 Not Acceptable</code>, or invokes the default callback: <code class="highlighter-rouge codehilite">**/*</code>.</p> 
       <h3 id="routes-interceptors">interceptors</h3> 
       <p>An interceptor allows to customize an HTTP request and response at three stages:</p> 
       <ul> 
        <li><strong>before</strong> the actual handler is invoked</li> 
        <li><strong>after</strong> the handler was executed, but before we send the response</li> 
        <li>when the response is <strong>complete</strong> and sent</li> 
       </ul> 
       <h4 id="routes-before">before</h4> 
       <p>Allows for customized handler execution chains. It will be invoked before the actual handler.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">before</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You are allowed to modify the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a> and <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">response</a> objects. Please note that the <code class="highlighter-rouge codehilite">before</code> handler is just syntactic sugar for <a href="/v1/apidocs/org/jooby/Route.Filter.html" target="_blank">filter</a>. For example, the <code class="highlighter-rouge codehilite">before</code> handler was implemented as:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">before</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
    <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A <code class="highlighter-rouge codehilite">before</code> handler must be registered before the actual handler you want to intercept.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">before</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
    <span class="k">return</span> <span class="o">...;</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>If you reverse the order, it won’t work.</p> 
       <blockquote> 
        <p><strong>Remember</strong>: routes are executed in the order they are defined and the pipeline is executed as long as you don’t generate a response.</p> 
       </blockquote> 
       <h4 id="routes-after">after</h4> 
       <p>Allows for customization of the response before sending it. It will be invoked at the time a response need to be sent.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">after</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">result</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You are allowed to modify the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a>, <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">response</a> and <a href="/v1/apidocs/org/jooby/Result.html" target="_blank">result</a> object. The handler returns a <a href="/v1/apidocs/org/jooby/Result.html" target="_blank">result</a> which can be the same or an entirely new <a href="/v1/apidocs/org/jooby/Result.html" target="_blank">result</a>. Please note that the <code class="highlighter-rouge codehilite">after</code> handler is just syntactical sugar for <a href="/v1/apidocs/org/jooby/Route.Filter.html" target="_blank">filter</a>. For example, the <code class="highlighter-rouge codehilite">after</code> handler was implemented as:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="k">new</span> <span class="n">Response</span><span class="o">.</span><span class="na">Forwarding</span><span class="o">(</span><span class="n">rsp</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="n">send</span><span class="o">(</span><span class="n">Result</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">after</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Since <code class="highlighter-rouge codehilite">after</code> is implemented by wrapping the <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">response</a> object. An <code class="highlighter-rouge codehilite">after</code> handler must be registered before the actual handler you want to intercept.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">after</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">result</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"hello"</span><span class="o">;</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>If you reverse the order, it won’t work.</p> 
       <blockquote> 
        <p><strong>Remember</strong>: routes are executed in the order they are defined and the pipeline is executed as long you don’t generate a response.</p> 
       </blockquote> 
       <h4 id="routes-complete">complete</h4> 
       <p>Allows for logging and cleaning up of a request. Invoked after the response is sent.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">complete</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">cause</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You are <strong>NOT</strong> allowed to modify the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a> and <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">response</a> objects. The <code class="highlighter-rouge codehilite">cause</code> is an <code class="highlighter-rouge codehilite">Optional</code> with a <code class="highlighter-rouge codehilite">Throwable</code> useful to identify problems. A common use case for the <code class="highlighter-rouge codehilite">complete</code> handler is to clean up the request object and to log responses. Please note that the <code class="highlighter-rouge codehilite">complete</code> handler is just syntactical sugar for <a href="/v1/apidocs/org/jooby/Route.Filter.html" target="_blank">filter</a>. For example, the <code class="highlighter-rouge codehilite">complete</code> handler was implemented as:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Throwable</span><span class="o">&gt;</span> <span class="n">err</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">err</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
      <span class="k">throw</span> <span class="n">cause</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">complete</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A <code class="highlighter-rouge codehilite">complete</code> handler must to be registered before the actual handler you want to intercept.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">complete</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">cause</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code goes here</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"hello"</span><span class="o">;</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>If you reverse the order, it won’t work.</p> 
       <blockquote> 
        <p><strong>Remember</strong>: routes are executed in the order they are defined and the pipeline is executed as long you don’t generate a response.</p> 
       </blockquote> 
       <h4 id="routes-example">example</h4> 
       <p>Suppose you have a transactional resource, like a database connection. The next example shows you how to implement a simple and effective <code class="highlighter-rouge codehilite">transaction-per-request</code> pattern:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// start transaction</span>
  <span class="n">before</span><span class="o">(</span><span class="s">"/api/*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">DataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
    <span class="n">Transaction</span> <span class="n">trx</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
    <span class="n">trx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
    <span class="n">req</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"connection"</span><span class="o">,</span> <span class="n">connection</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">});</span>

  <span class="c1">// commit/rollback transaction</span>
  <span class="n">complete</span><span class="o">(</span><span class="s">"/api/*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">cause</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// unbind connection from request</span>
    <span class="k">try</span><span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">unset</span><span class="o">(</span><span class="s">"connection"</span><span class="o">).</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">Transaction</span> <span class="n">trx</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">cause</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">trx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">trx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>

  <span class="c1">// your transactional routes goes here</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/api/something"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"connection"</span><span class="o">);</span>
    <span class="c1">// work with connection</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="routes-mvc-routes">mvc routes</h3> 
       <p>Mvc routes are similar to <strong>controllers</strong> in <a href="http://spring.io" target="_blank">Spring</a> and <strong>resources</strong> in <a href="https://jersey.java.net/" target="_blank">Jersey</a> with some minor enhancements and simplifications.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRoutes</span> <span class="o">{</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">home</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"home"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Annotations are identical to <a href="https://jersey.java.net/" target="_blank">Jersey/JAX-RS</a> and they can be found under the package <code class="highlighter-rouge codehilite">org.jooby.mvc</code>.</p> 
       <blockquote> 
        <p><strong>NOTE</strong>: Jooby doesn’t implement the <strong>JAX-RS</strong> specification. That is why it has its own version of the annotations.</p> 
       </blockquote> 
       <p>An mvc route can be injected by <a href="https://github.com/google/guice" target="_blank">Guice</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRoutes</span> <span class="o">{</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="n">MyRoutes</span><span class="o">(</span><span class="n">DepA</span> <span class="n">a</span><span class="o">,</span> <span class="n">DepB</span><span class="o">)</span> <span class="o">{</span>
   <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">home</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"home"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/search"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SearchResult</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">SearchResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="o">...;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@POST</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/form"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">MyObject</span> <span class="n">submit</span><span class="o">(</span><span class="n">MyObject</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"success"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <blockquote> 
        <p><strong>NOTE</strong>: MVC routes <strong>are NOT singleton</strong>, unless you explicitly annotated the route as a Singleton:</p> 
       </blockquote> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">javax.inject.Singleton</span><span class="o">;</span>

<span class="nd">@Singleton</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRoutes</span> <span class="o">{</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="n">MyRoutes</span><span class="o">(</span><span class="n">DepA</span> <span class="n">a</span><span class="o">,</span> <span class="n">DepB</span><span class="o">)</span> <span class="o">{</span>
   <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">home</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"home"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/search"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SearchResult</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">SearchResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="o">...;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@POST</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/form"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">MyObject</span> <span class="n">submit</span><span class="o">(</span><span class="n">MyObject</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"success"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-registering-an-mvc-route">registering an mvc route</h4> 
       <p>Mvc routes must be registered, there is <strong>no auto-discover</strong> feature, no classpath scanning, …, etc.</p> 
       <p>The order in which you define your routes is very important and it defines how your app will work.</p> 
       <p>This is one of the reason why mvc routes need to be explicitly registered.</p> 
       <p>The other reason is that declaring the route explicitly helps to reduce bootstrap time.</p> 
       <p>So, how do I register an mvc route?</p> 
       <p>In the same way everything else is registered in <a href="https://jooby.org">Jooby</a>, from your application class:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>
  <span class="o">{</span>
     <span class="n">use</span><span class="o">(</span><span class="n">MyRoutes</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Again, handlers are registered in the order they are declared, so:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/routes"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRoutes</span> <span class="o">{</span>
  
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">first</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"first"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">second</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"second"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">third</span><span class="o">()</span> <span class="o">{</span>
     <span class="k">return</span> <span class="s">"third"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A call to <code class="highlighter-rouge codehilite">/routes</code> will print: <strong>first</strong>, <strong>second</strong> and produces a response of <strong>third</strong>.</p> 
       <p>If you find the <strong>explicit registration</strong> odd or have too many <code class="highlighter-rouge codehilite">MVC routes</code>, checkout the <a href="/v1/doc/scanner">classpath scanner</a> module which automatically find and register <code class="highlighter-rouge codehilite">MVC routes</code>.</p> 
       <h4 id="routes-request-parameters">request parameters</h4> 
       <p>A method parameter represents a HTTP parameter:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="n">String</span> <span class="n">q</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="na">doSearch</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <p>Here <strong>q</strong> can be any of the available parameter types and it will resolved as described in the <a href="#request-parameters">request parameters</a> section.</p> 
       <p>Optional parameters work in the same way, all you have to do is to declare them as <code class="highlighter-rouge codehilite">java.util.Optional</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">q</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="na">doSearch</span><span class="o">(</span><span class="n">q</span><span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="s">"*:*"</span><span class="o">));</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <p>Same for <code class="highlighter-rouge codehilite">multi-value</code> parameters, just declare them as <code class="highlighter-rouge codehilite">java.util.List</code>, <code class="highlighter-rouge codehilite">java.util.Set</code> or <code class="highlighter-rouge codehilite">java.util.SortedSet</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">q</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="na">doSearch</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <blockquote> 
        <p>NOTE: The injected collection is immutable.</p> 
       </blockquote> 
       <p>Same for <a href="/v1/apidocs/org/jooby/Upload.html" target="_blank">file upload</a></p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@POST</span>
   <span class="kd">public</span> <span class="n">Object</span> <span class="n">formPost</span><span class="o">(</span><span class="n">Upload</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <p>Jooby uses the method parameter name and binds that name to a request parameter. If you want an explicit mapping or if the request parameter isn’t a valid Java identifier:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="nd">@Named</span><span class="o">(</span><span class="s">"req-param"</span><span class="o">)</span> <span class="n">String</span> <span class="n">reqParam</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-form-submit">form submit</h4> 
       <p>A form submitted as <code class="highlighter-rouge codehilite">application/x-www-form-urlencoded</code> or <code class="highlighter-rouge codehilite">multipart/form-data</code> doesn’t require anything:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>  <span class="nd">@POST</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">create</span><span class="o">(</span><span class="n">MyObject</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-request-body">request body</h4> 
       <p>Annotate the method parameter with the <a href="/v1/apidocs/org/jooby/mvc/Body.html" target="_blank">@Body</a> annotation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>  <span class="nd">@POST</span>
  <span class="kd">public</span> <span class="n">MyObject</span> <span class="n">create</span><span class="o">(</span><span class="nd">@Body</span> <span class="n">MyObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span> <span class="k">do</span> <span class="n">something</span> <span class="n">with</span> <span class="n">my</span> <span class="n">object</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-request-headers">request headers</h4> 
       <p>Annotate the method parameter with the <a href="/v1/apidocs/org/jooby/mvc/Header.html" target="_blank">@Header</a> annotation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="nd">@Header</span> <span class="n">String</span> <span class="n">myHeader</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or, if the header name isn’t a valid Java identifier:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   <span class="nd">@GET</span>
   <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">search</span><span class="o">(</span><span class="nd">@Header</span><span class="o">(</span><span class="s">"Last-Modified-Since"</span><span class="o">)</span> <span class="kt">long</span> <span class="n">lastModifedSince</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
   <span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-response">response</h4> 
       <p>A methods return type is sent to the client. Some examples:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHi</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// OK(200)</span>
  <span class="k">return</span> <span class="s">"Hi "</span> <span class="o">+</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">Result</span> <span class="nf">dontSayGoodbye</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// NO_CONTENT(204)</span>
  <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">noContent</span><span class="o">();</span>
<span class="o">}</span>

</code></pre> 
       </div> 
       <p>If you want to render a view, just return a <a href="/v1/apidocs/org/jooby/View.html" target="_blank">view</a> instance:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">Result</span> <span class="nf">home</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"home"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>If you need to deal with HTTP metadata like: status code, headers, etc… use a [result] as the return type:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">Result</span> <span class="nf">handler</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// 201 = created</span>
  <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="mi">201</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="routes-dynamic-advanced-routing">dynamic / advanced routing</h3> 
       <p>Dynamic routing allows you to filter a pipeline execution chain and produces a custom or even completely different response.</p> 
       <p>For example, suppose you need to serve different content based on the hostname:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
   <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">hostname</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo.com"</span><span class="o">))</span> <span class="o">{</span>
       <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"/foo-branding"</span><span class="o">,</span> <span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
     <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
       <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"/bar-branding"</span><span class="o">,</span> <span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
     <span class="o">}</span>
   <span class="o">});</span>

   <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)).</span><span class="na">name</span><span class="o">(</span><span class="s">"foo-branding"</span><span class="o">);</span>

   <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"bar"</span><span class="o">)).</span><span class="na">name</span><span class="o">(</span><span class="s">"bar-branding"</span><span class="o">);</span>
<span class="o">}</span>

</code></pre> 
       </div> 
       <p>This application has two routes under root path: <code class="highlighter-rouge codehilite">/</code>. Each of these route has a <code class="highlighter-rouge codehilite">name</code>: <code class="highlighter-rouge codehilite">foo-branding</code> and <code class="highlighter-rouge codehilite">bar-branding</code>.</p> 
       <p>If you load the application from <code class="highlighter-rouge codehilite">http://foo.com</code> the <code class="highlighter-rouge codehilite">foo-branding</code> route will be executed, otherwise the <code class="highlighter-rouge codehilite">bar-branding</code> route.</p> 
       <p>Dynamic routing is done over <a href="/v1/apidocs/org/jooby/Route.html#name--" target="_blank">route.name()</a>. From <a href="/v1/apidocs/org/jooby/Route.Filter.html" target="_blank">filter</a> you provide a <code class="highlighter-rouge codehilite">name filter</code> via <a href="/v1/apidocs/org/jooby/Route.Chain.html#next-java.lang.String-org.jooby.Request-org.jooby.Response-" target="_blank">chain.next(name, req, rsp)</a> method.</p> 
       <p>Or group routes via <a href="/v1/apidocs/org/jooby/Jooby.html#with-java.lang.Runnable-" target="_blank">with(Runnable)</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">with</span><span class="o">(()</span> <span class="o">-&gt;</span> 
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"foo"</span><span class="o">));</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/api"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">...);</span>

  <span class="o">).</span><span class="na">name</span><span class="o">(</span><span class="s">"foo-branding"</span><span class="o">);</span>

  <span class="n">with</span><span class="o">(()</span> <span class="o">-&gt;</span> 
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"bar"</span><span class="o">));</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/api"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">...);</span>

  <span class="o">).</span><span class="na">name</span><span class="o">(</span><span class="s">"bar-branding"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or group routes in their own application and then merge them into the main application:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooBranding</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="n">FooBranding</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="s">"foo-branding"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"foo"</span><span class="o">));</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BarBranding</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="n">BarBranding</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="s">"bar-branding"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"bar"</span><span class="o">));</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**</span>
 <span class="cm">* Merge everything .</span>
 <span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>
  <span class="o">{</span>
     <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">hostname</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo.com"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"/foo-branding"</span><span class="o">,</span> <span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
         <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"/bar-branding"</span><span class="o">,</span> <span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
       <span class="o">}</span>
     <span class="o">});</span>

     <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">FooBranding</span><span class="o">());</span>
     <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">BarBranding</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Routes and routing in <a href="https://jooby.org">Jooby</a> are so powerful!</p> 
       <h3 id="routes-properties">properties</h3> 
       <p>Routes have a few properties that let you extend basic functionality in one way or another including:</p> 
       <ul> 
        <li>attributes</li> 
        <li>with, map and excludes operators</li> 
        <li>consumes/produces types</li> 
       </ul> 
       <h4 id="routes-attributes">attributes</h4> 
       <p>Attributes let you annotate a route at application bootstrap time. It functions like static metadata available at runtime:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="o">..)</span>
    <span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>An attribute consist of a <code class="highlighter-rouge codehilite">name</code> and <code class="highlighter-rouge codehilite">value</code>. Allowed values are <code class="highlighter-rouge codehilite">primitives</code>, <code class="highlighter-rouge codehilite">String</code>, <code class="highlighter-rouge codehilite">enum</code>, <code class="highlighter-rouge codehilite">class</code> or an <code class="highlighter-rouge codehilite">array</code> of these types.</p> 
       <p>Attributes can be accessed at runtime in a request/response cycle. For example, a security module might check for a <code class="highlighter-rouge codehilite">role</code> attribute, a sitemap generator might check for a <code class="highlighter-rouge codehilite">priority</code> attribute, etc.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">chain</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">...;</span>
    <span class="n">String</span> <span class="n">role</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">route</span><span class="o">().</span><span class="na">attr</span><span class="o">(</span><span class="s">"role"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">hasRole</span><span class="o">(</span><span class="n">role</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">chain</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">Err</span><span class="o">(</span><span class="mi">403</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>In MVC routes you can set attributes for all the web methods:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
   <span class="n">use</span><span class="o">(</span><span class="n">Controller</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
     <span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or via <code class="highlighter-rouge codehilite">annotations</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">ANNOTATION_TYPE</span> <span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nd">@interface</span> <span class="n">Role</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">value</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"/path"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminResource</span> <span class="o">{</span>

  <span class="nd">@Role</span><span class="o">(</span><span class="s">"admin"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

<span class="o">}</span>

<span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">route</span><span class="o">().</span><span class="na">attributes</span><span class="o">())</span>
  <span class="o">});</span>
<span class="o">}</span>

</code></pre> 
       </div> 
       <p>The previous example will print: <code class="highlighter-rouge codehilite"><span class="p">{</span><span class="err">role</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">admin</span><span class="p">}</span></code>.</p> 
       <p>Any runtime annotation is automatically added as route attributes following these rules:</p> 
       <ul> 
        <li>If the annotation has a <code class="highlighter-rouge codehilite">value</code> method, then we use the annotation’s name as the attribute name.</li> 
        <li>Otherwise, we use the method name as the attribute name.</li> 
       </ul> 
       <blockquote> 
        <p><strong>request attributes vs route attributes:</strong></p> 
        <p>Route attributes are created at bootstrap. They are global, and once set, they won’t change.</p> 
        <p>On the other hand, request attributes are created in a request/response cycle.</p> 
       </blockquote> 
       <h4 id="routes-with-operator">with operator</h4> 
       <p>The <a href="/v1/apidocs/org/jooby/Jooby.html#with-java.lang.Runnable-" target="_blank">with</a> operator sets attributes, consumes/produces types, exclusions, etc. to one or more routes:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">with</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/admin/1"</span><span class="o">,</span> <span class="o">...);</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/admin/2"</span><span class="o">,</span> <span class="o">...);</span>

  <span class="o">}).</span><span class="na">attr</span><span class="o">(</span><span class="s">"role"</span><span class="o">,</span> <span class="s">"admin"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-map-operator">map operator</h4> 
       <p>The <a href="/v1/apidocs/org/jooby/Jooby.html#map-org.jooby.Route.Mapper-" target="_blank">map</a> operator converts a route output to something else:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// we got bar.. not foo</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/foo"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"foo"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">value</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">);</span>

  <span class="c1">// we got foo.. not bar</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/bar"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">value</span> <span class="o">-&gt;</span> <span class="s">"foo"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>If you want to apply a single <a href="/v1/apidocs/org/jooby/Jooby.html#map-org.jooby.Route.Mapper-" target="_blank">map</a> to several routes:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">with</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/foo"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"foo"</span><span class="o">);</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/bar"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">);</span>

  <span class="o">}).</span><span class="na">map</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="s">"foo or bar"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You can apply a <a href="/v1/apidocs/org/jooby/Route.Mapper.html" target="_blank">Mapper</a> to specific types:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">with</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/str"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"str"</span><span class="o">);</span>

    <span class="n">get</span><span class="o">(</span><span class="s">"/int"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">);</span>

  <span class="o">}).</span><span class="na">map</span><span class="o">(</span><span class="n">String</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="s">"{"</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A call to <code class="highlighter-rouge codehilite">/str</code> produces <code class="highlighter-rouge codehilite"><span class="p">{</span><span class="err">str</span><span class="p">}</span></code>, while <code class="highlighter-rouge codehilite">/int</code> just <code class="highlighter-rouge codehilite">1</code>.</p> 
       <blockquote> 
        <p><strong>NOTE</strong>: You can apply the map operator to routes that produces an output (a.k.a function routes).</p> 
       </blockquote> 
       <p>For example, the <a href="/v1/apidocs/org/jooby/Jooby.html#map-org.jooby.Route.Mapper-" target="_blank">map</a> operator will be silently ignored here:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(...);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-excludes">excludes</h4> 
       <p>The <a href="/v1/apidocs/org/jooby/Route.Definition.html#excludes-java.util.List-" target="_blank">excludes</a> operator ignores what would otherwise have been a route path match:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
   <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="c1">// all except /login</span>
   <span class="o">}).</span><span class="na">excludes</span><span class="o">(</span><span class="s">"/login"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-consumes">consumes</h4> 
       <p>The <a href="/v1/apidocs/org/jooby/Route.Definition.html#consumes-java.util.List-" target="_blank">consumes</a> operator indicates the type of input the route can handle.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">to</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="o">}).</span><span class="na">consumes</span><span class="o">(</span><span class="s">"json"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="routes-produces">produces</h4> 
       <p>The <a href="/v1/apidocs/org/jooby/Route.Definition.html#produces-java.util.List-" target="_blank">produces</a> operator indicates the type of output the route can produce.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MyObject</span><span class="o">();</span>
  <span class="o">}).</span><span class="na">produces</span><span class="o">(</span><span class="s">"json"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="request"> 
      <div class="datalist-title "> 
       <h2>request</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>The request object contains methods for reading parameters, headers and body (amongst others). In the next section, the most important methods of a <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a> object will be explored. If you need more information, please refer to the <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">javadoc</a>.</p> 
       <h3 id="request-parameters">parameters</h3> 
       <p>Retrieval of a parameter is done via the: <a href="/v1/apidocs/org/jooby/Request.html#param-java.lang.String-" target="_blank">req.param(“name”)</a> method.</p> 
       <p>The <a href="/v1/apidocs/org/jooby/Request.html#param-java.lang.String-" target="_blank">req.param(“name”)</a> method <strong>always</strong> returns a <a href="/v1/apidocs/org/jooby/Mutant.html" target="_blank">mutant</a> instance. A <a href="/v1/apidocs/org/jooby/Mutant.html" target="_blank">mutant</a> has several utility methods for doing type conversion:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">iparam</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"intparam"</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>

  <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"str"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="n">String</span> <span class="n">defstr</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"str"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"def"</span><span class="o">);</span>

  <span class="c1">// custom object type using type conversion</span>
  <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"object"</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="c1">// file upload</span>
  <span class="n">Upload</span> <span class="n">upload</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">file</span><span class="o">(</span><span class="s">"file"</span><span class="o">);</span>

  <span class="c1">// multi value parameter</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strList</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"strList"</span><span class="o">).</span><span class="na">toList</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="c1">// custom object type using type conversion</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="n">listObj</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"objList"</span><span class="o">).</span><span class="na">toList</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="c1">// custom object type using type conversion</span>
  <span class="n">Set</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="n">setObj</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"objList"</span><span class="o">).</span><span class="na">toSet</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="c1">// optional parameter</span>
  <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">optStr</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"optional"</span><span class="o">).</span><span class="na">toOptional</span><span class="o">();</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>Multiple parameters can be retrieved at once:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>GET /search?name=John&amp;age=99&amp;address[country]=AR&amp;address[city]=BA
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Profile</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

  <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">country</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/search"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">Profile</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="n">Profile</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">profile</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span> <span class="c1">// print John</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">profile</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span> <span class="c1">// print 99</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">profile</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span> <span class="c1">// print 99</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Bean classes must have a <code class="highlighter-rouge codehilite">default constructor</code> or a constructor annotated with <code class="highlighter-rouge codehilite">javax.inject.Inject</code>.</p> 
       <h4 id="request-parameter-type-and-precedence">parameter type and precedence</h4> 
       <p>A <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a> parameter can be present in:</p> 
       <p>1) <strong>path</strong>: <code class="highlighter-rouge codehilite">/user/:id</code></p> 
       <p>2) <strong>query string</strong>: <code class="highlighter-rouge codehilite">/user?id=...</code></p> 
       <p>3) <strong>form submit</strong> encoded as <code class="highlighter-rouge codehilite">application/x-www-form-urlencoded</code> or <code class="highlighter-rouge codehilite">multipart/form-data</code></p> 
       <p>(parameters take precedence in the order listed)</p> 
       <p>For example purposes, let’s consider a poorly constructed API where we have a route handler that accepts an <strong>id</strong> parameter in all three locations:</p> 
       <p>A call like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>curl -X POST -d "id=third" http://localhost:8080/user/first?id=second
</code></pre> 
       </div> 
       <p>Produces:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/user/:id"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="c1">// path param at idx = 0</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"first"</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">value</span><span class="o">());</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"first"</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">toList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>

  <span class="c1">// query param at idx = 1</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"second"</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">toList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>

  <span class="c1">// form param at idx = 2</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"third"</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">toList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>While clearly bad API design, this is a good example of how parameter precedence works.</p> 
       <h4 id="request-parameter-type-conversion">parameter type conversion</h4> 
       <p>Automatic type conversion is provided when a type:</p> 
       <ul> 
        <li>Is a primitive, primitive wrapper or String</li> 
        <li>Is an enum</li> 
        <li>Is an <a href="/v1/apidocs/org/jooby/Upload.html" target="_blank">file upload</a></li> 
        <li>Has a public <strong>constructor</strong> that accepts a single <strong>String</strong> argument</li> 
        <li>Has a static method <strong>valueOf</strong> that accepts a single <strong>String</strong> argument</li> 
        <li>Has a static method <strong>fromString</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.util.UUID</code></li> 
        <li>Has a static method <strong>forName</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.nio.charset.Charset</code></li> 
        <li>Is an Optional 
         <t>
           , List 
          <t>
            , Set 
           <t>
             or SortedSet 
            <t>
              where T satisfies one of the previous rules 
            </t> 
           </t> 
          </t> 
         </t></li> 
       </ul> 
       <p>Custom type conversion is also possible:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">parser</span><span class="o">((</span><span class="n">type</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getRawType</span><span class="o">()</span> <span class="o">==</span> <span class="n">MyType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// convert the type here</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="n">values</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">MyType</span><span class="o">(</span><span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)));</span>
  <span class="o">}</span>
  <span class="c1">// no luck! move to next converter</span>
  <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">MyType</span> <span class="n">myType</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"value"</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">MyType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>See <a href="/v1/doc/#parser-and-renderer">parser and renderer</a>.</p> 
       <h3 id="request-headers">headers</h3> 
       <p>Retrieval of request headers is done via: <a href="/v1/apidocs/org/jooby/Request.html#header-java.lang.String-" target="_blank">req.header(“name”)</a>. What goes for the <a href="#request-parameters">request params</a> applies for the headers as well.</p> 
       <h3 id="request-body">body</h3> 
       <p>Retrieval of the request body is done via <a href="/v1/apidocs/org/jooby/Request.html#body--" target="_blank">req.body()</a> or <a href="/v1/apidocs/org/jooby/Request.html#body-java.lang.Class-" target="_blank">req.body(Class)</a>.</p> 
       <p>A <a href="/v1/apidocs/org/jooby/Parser.html" target="_blank">parser</a> is responsible for either parsing or converting the HTTP request body to something else.</p> 
       <p>There are a few built-in parsers for reading the body as <code class="highlighter-rouge codehilite">String</code>, <code class="highlighter-rouge codehilite">primitives</code>, …, etc.</p> 
       <p><a href="/v1/doc/#parser-and-renderer">Parsers</a> are explained later. For now, all you need to know is that they can read or parse the HTTP body.</p> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>

  <span class="n">post</span><span class="o">(</span><span class="s">"/save"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">...</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="nd">@POST</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">MyObject</span> <span class="n">save</span><span class="o">(</span><span class="nd">@Body</span> <span class="n">MyObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <blockquote> 
        <p><strong>NOTE</strong>: Don’t use <a href="/v1/apidocs/org/jooby/Request.html#body--" target="_blank">req.body()</a>, <a href="/v1/apidocs/org/jooby/Request.html#body-java.lang.Class-" target="_blank">req.body(Class)</a> or <a href="/v1/apidocs/org/jooby/mvc/Body.html" target="_blank">@Body</a> for a <code class="highlighter-rouge codehilite">POST</code> request encoded as <code class="highlighter-rouge codehilite">application/x-www-form-urlencoded</code> or <code class="highlighter-rouge codehilite">multipart/form-data</code>, see the next section for such requests.</p> 
       </blockquote> 
       <h3 id="request-form-submit">form submit</h3> 
       <p>Form submit parsing is done via <a href="/v1/apidocs/org/jooby/Request.html#params-java.lang.Class-" target="_blank">req.params(Class)</a> or the <a href="/v1/apidocs/org/jooby/Request.html#form-java.lang.Class-" target="_blank">req.form(Class)</a> method:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Contact</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">"application/x-www-form-urlencoded"</span> <span class="na">action=</span><span class="s">"/save"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre> 
       </div> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/save"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="n">Contact</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="c1">// save contact...</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="nd">@POST</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">submit</span><span class="o">(</span><span class="n">Contact</span> <span class="n">contact</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Nested paths are supported via <strong>bracket</strong>: <code class="highlighter-rouge codehilite">[name]</code> or <strong>dot</strong>: <code class="highlighter-rouge codehilite">.name</code> notation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

  <span class="c1">// nested path</span>
  <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Contact</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">state</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">country</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Address</span><span class="o">(</span><span class="n">String</span> <span class="n">line</span><span class="o">,</span> <span class="n">String</span> <span class="n">state</span><span class="o">,</span> <span class="n">String</span> <span class="n">country</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">country</span> <span class="o">=</span> <span class="n">country</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">"application/x-www-form-urlencoded"</span> <span class="na">action=</span><span class="s">"/save"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[line]"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address.state"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[country]"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre> 
       </div> 
       <p>Tabular data is supported as well:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

  <span class="c1">// nested path</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="n">address</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Contact</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">"application/x-www-form-urlencoded"</span> <span class="na">action=</span><span class="s">"/save"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[0]line"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[0]state"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[0]country"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[1]line"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[1]state"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"address[1]country"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre> 
       </div> 
       <blockquote> 
        <p><strong>NOTE</strong>: Constructor injection of nested or tabular objects isn’t supported. Nested/tabular object are injected via either method or field.</p> 
       </blockquote> 
       <p>The injection rules are defined as follows (higher priority first):</p> 
       <ul> 
        <li>There is a only one constructor (nested/tabular data can’t be injected, just simple values).</li> 
        <li>There are more than a single constructor but only one annotated with <code class="highlighter-rouge codehilite">javax.inject.Inject</code> (nested/tabular data can’t be injected, just simple values).</li> 
        <li>There is a setter like method that matches the parameter name, like <code class="highlighter-rouge codehilite">name(String)</code>, <code class="highlighter-rouge codehilite">setName(String)</code>, etc…</li> 
        <li>There is a field that matches the parameter name</li> 
       </ul> 
       <h3 id="request-file-upload">file upload</h3> 
       <p>File uploads are accessible via the: <a href="/v1/apidocs/org/jooby/Request.html#file-java.lang.String-" target="_blank">request.file(name)</a> method:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">action=</span><span class="s">"/upload"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"myfile"</span> <span class="na">type=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="c1">// Script API</span>

<span class="o">{</span>
   <span class="n">post</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">Upload</span> <span class="n">upload</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">file</span><span class="o">(</span><span class="s">"myfile"</span><span class="o">);</span>
     <span class="o">...</span>
     <span class="n">upload</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
   <span class="o">});</span>
<span class="o">}</span>

<span class="c1">// MVC API</span>
<span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span> <span class="nd">@POST</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">upload</span><span class="o">(</span><span class="n">Upload</span> <span class="n">myfile</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">myfile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You must close a <a href="/v1/apidocs/org/jooby/Upload.html" target="_blank">file upload</a> in order to release resources:</p> 
       <h3 id="request-locals">locals</h3> 
       <p>Local attributes (a.k.a request attributes) are bound to the current request. They are created every time a new request is received and destroyed at the end of the request cycle.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="o">...;</span>
    <span class="n">req</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"var"</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/locals"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// optional local</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ifValue</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="na">ifGet</span><span class="o">(</span><span class="s">"var"</span><span class="o">);</span>

    <span class="c1">// required local</span>
    <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"var"</span><span class="o">);</span>

    <span class="c1">// local with default value</span>
    <span class="n">String</span> <span class="n">defvalue</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"var"</span><span class="o">,</span> <span class="s">"defvalue"</span><span class="o">);</span>

    <span class="c1">// all locals</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">locals</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">attributes</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>In <code class="highlighter-rouge codehilite">mvc routes</code> request locals can be injected via the <code class="highlighter-rouge codehilite">@Local</code> annotation by defining a method parameter with the same name as a request local:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">localAttr</span><span class="o">(</span><span class="nd">@Local</span> <span class="n">String</span> <span class="n">var</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// either var will be set to a previously configured value or an error is thrown when this method is requested</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">ifLocalAttr</span><span class="o">(</span><span class="nd">@Local</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">var</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// var will contain an optional that may be empty if no value was previously configured</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Result</span> <span class="n">attributes</span><span class="o">(</span><span class="nd">@Local</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// attributes contains the map of local attributes</span>
  <span class="o">}</span>

</code></pre> 
       </div> 
       <p>Locals that are available by default include:</p> 
       <ul> 
        <li><code class="highlighter-rouge codehilite">path</code>: the request path, i.e. <code class="highlighter-rouge codehilite">/myroute</code></li> 
        <li><code class="highlighter-rouge codehilite">contextPath</code>: application path (a.k.a context path). It is the value defined by: <code class="highlighter-rouge codehilite">application.path</code>.</li> 
        <li>When the <code class="highlighter-rouge codehilite">Assets</code> module is enabled: your asset filesets postfixed with <code class="highlighter-rouge codehilite">_css</code> and <code class="highlighter-rouge codehilite">_js</code></li> 
        <li>When the <code class="highlighter-rouge codehilite">Flash</code> module is enabled: <code class="highlighter-rouge codehilite">flash</code>, the map of flash key/values</li> 
       </ul> 
       <h3 id="request-flash-scope">flash scope</h3> 
       <p>The flash scope is designed to transport success and error messages between requests. It is similar to a <a href="#session">Session</a> but the lifecycle is shorter: <em>data is kept for only one request</em>.</p> 
       <p>The flash scope is implemented as a client side cookie, keeping the application stateless.</p> 
       <h4 id="request-usage">usage</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.jooby.FlashScope</span><span class="o">;</span>

<span class="o">...</span>

<span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">FlashScope</span><span class="o">());</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="na">ifFlash</span><span class="o">(</span><span class="s">"success"</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="s">"Welcome!"</span><span class="o">);</span>
  <span class="o">});</span>

  <span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">req</span><span class="o">.</span><span class="na">flash</span><span class="o">(</span><span class="s">"success"</span><span class="o">,</span> <span class="s">"The item has been created"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <a href="/v1/apidocs/org/jooby/FlashScope.html" target="_blank">FlashScope</a> is also available on mvc routes via the <a href="/v1/apidocs/org/jooby/mvc/Flash.html" target="_blank">@Flash</a> annotation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>
  
  <span class="c1">// Access to the flashScope</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">flashScope</span><span class="o">(</span><span class="nd">@Flash</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">flash</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="c1">// Access to a required flash attribute</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">flashAttr</span><span class="o">(</span><span class="nd">@Flash</span> <span class="n">String</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="c1">// Access to an optional flash attribute</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">optionlFlashAttr</span><span class="o">(</span><span class="nd">@Flash</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span> 
  <span class="o">}</span>
<span class="o">}</span> 
</code></pre> 
       </div> 
       <p>Flash attributes are accessible from templates by prefixing the attribute’s name with <code class="highlighter-rouge codehilite">flash.</code>. Here’s a (handlebars.java)[/doc/hbs] example:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>{{#if flash.success}}
  {{flash.success}}

{{else}}
  Welcome!

{{/if}}
</code></pre> 
       </div> 
       <h3 id="request-require">require</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Request.html" target="_blank">request</a> object has access to the application <a href="/v1/apidocs/org/jooby/Registry.html" target="_blank">registry</a> which give you access to application services.</p> 
       <p>Access to the registry is available via: <a href="/v1/apidocs/org/jooby/Request.html#require-com.google.inject.Key-" target="_blank">request.require(type)</a> methods:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">foo</span><span class="o">.</span><span class="na">bar</span><span class="o">();</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>Of course, the <code class="highlighter-rouge codehilite">require</code> method doesn’t make sense on <code class="highlighter-rouge codehilite">MVC routes</code>, because in that case you can inject dependencies:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">Foo</span> <span class="n">foo</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="n">Controller</span><span class="o">(</span><span class="n">Foo</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">foo</span> <span class="o">=</span> <span class="n">foo</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">foo</span><span class="o">.</span><span class="na">bar</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="request-access-log">access log</h3> 
       <p>Log all matching incoming requests using the <a href="https://en.wikipedia.org/wiki/Common_Log_Format" target="_blank">NCSA format</a> (a.k.a common log format).</p> 
       <h4 id="request-usage">usage</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLog</span><span class="o">());</span>

  <span class="o">...</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Output looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>127.0.0.1 - - [04/Oct/2016:17:51:42 +0000] "GET / HTTP/1.1" 200 2
</code></pre> 
       </div> 
       <p>You probably want to configure the <code class="highlighter-rouge codehilite">RequestLog</code> logger to save output into a new file:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"ACCESS"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;file&gt;</span>access.log<span class="nt">&lt;/file&gt;</span>

  <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fileNamePattern&gt;</span>access.%d{yyyy-MM-dd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
  <span class="nt">&lt;/rollingPolicy&gt;</span>

  <span class="nt">&lt;encoder&gt;</span>
    <span class="nt">&lt;pattern&gt;</span>%msg%n<span class="nt">&lt;/pattern&gt;</span>
  <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>

<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"org.jooby.RequestLogger"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"ACCESS"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/logger&gt;</span>
</code></pre> 
       </div> 
       <p>Since authentication is provided via a module or custom filter, there is no concept of a logged in or authenticated user. You can still log the current user by setting a user id provider at construction time:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="c1">// authenticate user and set local attribute</span>
    <span class="n">String</span> <span class="n">userId</span> <span class="o">=</span> <span class="o">...;</span>
    <span class="n">req</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
  <span class="o">});</span>

  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">(</span><span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"userId"</span><span class="o">);</span>
  <span class="o">}));</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>In this example, an application filter sets a <code class="highlighter-rouge codehilite">userId</code> request attribute and then that <code class="highlighter-rouge codehilite">userId</code> is provided to the {@link RequestLogger}.</p> 
       <h4 id="request-custom-log-function">custom log function</h4> 
       <p>By default all logging uses <a href="http://logback.qos.ch" target="_blank">logback</a> which is why the <code class="highlighter-rouge codehilite">org.jooby.RequestLogger</code> was configured in <code class="highlighter-rouge codehilite">logback.xml</code>.</p> 
       <p>If you want to log somewhere else, or want to use a different logging implementation:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseLogger</span><span class="o">()</span>
    <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">line</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
    <span class="o">}));</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Rather than printing the <code class="highlighter-rouge codehilite">NCSA</code> line to stdout, it can of course be written to a database, a JMS queue, etc.</p> 
       <h4 id="request-latency">latency</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">()</span>
      <span class="o">.</span><span class="na">latency</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>This will append an entry at the end of the <code class="highlighter-rouge codehilite">NCSA</code> output representing the number of <code class="highlighter-rouge codehilite">ms</code> it took to process the request.</p> 
       <h4 id="request-extended">extended</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">()</span>
      <span class="o">.</span><span class="na">extended</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Extend the <code class="highlighter-rouge codehilite">NCSA</code> by adding the <code class="highlighter-rouge codehilite">Referer</code> and <code class="highlighter-rouge codehilite">User-Agent</code> headers to the output.</p> 
       <h4 id="request-dateFormatter">dateFormatter</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">()</span>
      <span class="o">.</span><span class="na">dateFormatter</span><span class="o">(</span><span class="n">ts</span> <span class="o">-&gt;</span> <span class="o">...));</span>

  <span class="c1">// OR</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">()</span>
      <span class="o">.</span><span class="na">dateFormatter</span><span class="o">(</span><span class="n">DateTimeFormatter</span><span class="o">...));</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Override the default formatter for the request arrival time defined by: <a href="/v1/apidocs/org/jooby/Request.html#timestamp----" target="_blank">Request#timestamp()</a>. You can provide a function or an instance of <code class="highlighter-rouge codehilite">DateTimeFormatter</code>.</p> 
       <p>The default formatter uses the default server time zone, provided by <code class="highlighter-rouge codehilite">ZoneId#systemDefault()</code>. It’s possible to simply override the time zone as well:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">RequestLogger</span><span class="o">()</span>
     <span class="o">.</span><span class="na">dateFormatter</span><span class="o">(</span><span class="n">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"UTC"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="response"> 
      <div class="datalist-title "> 
       <h2>response</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>The response object contains methods for reading and setting headers, status code and body (amongst other things). In the next section you will encounter the most important methods of the response object. If you need more information please refer to the <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">javadoc</a>.</p> 
       <h3 id="response-send">send</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Response.html#send-org.jooby.Result-" target="_blank">rsp.send</a> method is responsible for sending and writing data into the HTTP response.</p> 
       <p>A <a href="/v1/apidocs/org/jooby/Renderer.html" target="_blank">renderer</a> is responsible for converting a Java Object into something else (json, html, etc..).</p> 
       <p>Let’s consider a simple example:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"hey jooby"</span><span class="o">));</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="s">"hey jooby"</span><span class="o">);</span> <span class="c1">// or just return a value and Jooby will call send for you.</span>
</code></pre> 
       </div> 
       <p>The <strong>send</strong> method will ask the <a href="/v1/apidocs/org/jooby/Renderer.html" target="_blank">Renderer API</a> to format an object and write a response.</p> 
       <p>The resulting <code class="highlighter-rouge codehilite">Content-Type</code> when not set is <code class="highlighter-rouge codehilite">text/html</code>.</p> 
       <p>The resulting <code class="highlighter-rouge codehilite">Status Code</code> when not set is <code class="highlighter-rouge codehilite">200</code>.</p> 
       <p>Some examples:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="c1">// text/html with 200</span>
   <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="o">...;</span>
   <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="c1">// text/plain with 200 explicitly </span>
   <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="o">...;</span>
   <span class="n">rsp</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>Alternative:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="c1">// text/plain with 200 explicitly </span>
   <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="o">...;</span>
   <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="mi">200</span><span class="o">)</span>
        <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <h3 id="response-headers">headers</h3> 
       <p>Retrieval of response headers is done via <a href="/v1/apidocs/org/jooby/Response.html#header-java.lang.String-" target="_blank">rsp.header(“name”)</a>. This method returns a <a href="/v1/apidocs/org/jooby/Mutant.html" target="_blank">Mutant</a> which can be converted to any of the supported types.</p> 
       <p>Setting a header is pretty straightforward as well:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">rsp</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Header-Name"</span><span class="o">,</span> <span class="n">value</span><span class="o">).</span><span class="na">header</span><span class="o">(</span><span class="s">"Header2"</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</code></pre> 
       </div> 
       <h3 id="response-send-file">send file</h3> 
       <p>The send file API is available through the <a href="/v1/apidocs/org/jooby/Response.html#download-java.lang.String-" target="_blank">rsp.download*</a> methods:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/download"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">rsp</span><span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="s">"myfile"</span><span class="o">,</span> <span class="k">new</span> <span class="n">File</span><span class="o">(...));</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <code class="highlighter-rouge codehilite">download</code> method sets the following headers:</p> 
       <ul> 
        <li> <p><code class="highlighter-rouge codehilite">Content-Disposition</code></p> </li> 
        <li> <p><code class="highlighter-rouge codehilite">Content-Length</code></p> </li> 
        <li> <p><code class="highlighter-rouge codehilite">Content-Type</code></p> </li> 
       </ul> 
       <p>In the next example we explicitly set some of these:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/download"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">rsp</span>
      <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename=myfile.txt;"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(...));</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="session"> 
      <div class="datalist-title "> 
       <h2>session</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>Sessions are created on demand via: <a href="/v1/apidocs/org/jooby/Request.html#ifSession--" target="_blank">req.ifSession()</a> or <a href="/v1/apidocs/org/jooby/Request.html#session--" target="_blank">req.session()</a>.</p> 
       <p>Sessions have a lot of uses cases but the most commons are: authentication, storing information about current user, etc.</p> 
       <p>A session attribute must be a <code class="highlighter-rouge codehilite">String</code> or a primitive. The session doesn’t allow storing of arbitrary objects. It’s intended as a simple mechanism to store basic data.</p> 
       <h3 id="session-usage">usage</h3> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">session</span><span class="o">();</span>

    <span class="c1">// set attribute</span>
    <span class="n">session</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>

    <span class="c1">// get attribute</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The previous example will use an <code class="highlighter-rouge codehilite">in-memory</code> session. The next example uses a cookie:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">cookieSession</span><span class="o">();</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">session</span><span class="o">();</span>

    <span class="c1">// set attribute</span>
    <span class="n">session</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>

    <span class="c1">// get attribute</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The cookie session store depends on the <code class="highlighter-rouge codehilite">application.secret</code> property. The cookie will be signed with the value of this property.</p> 
       <p>As an alternative to the <code class="highlighter-rouge codehilite">memory</code> or the <code class="highlighter-rouge codehilite">cookie</code> stores, you can choose any one of the <a href="/v1/doc/session">high performance session stores</a> provided by <a href="https://jooby.org">Jooby</a>. There are provided session stores for <code class="highlighter-rouge codehilite">redis</code>, <code class="highlighter-rouge codehilite">memcached</code>, <code class="highlighter-rouge codehilite">mongodb</code>, <code class="highlighter-rouge codehilite">cassandra</code>, <code class="highlighter-rouge codehilite">couchbase</code>, <code class="highlighter-rouge codehilite">hazelcast</code> and <a href="/v1/doc/session">a lot more</a>.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">cookieSession</span><span class="o">();</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">session</span><span class="o">();</span>

    <span class="c1">// set attribute</span>
    <span class="n">session</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>

    <span class="c1">// get attribute</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="session-no-timeout">no timeout</h3> 
       <p>There is no timeout for sessions from the perspective of the server. By default, a session will expire when the user close the browser (a.k.a session cookie) or the cookie session has expired via the <code class="highlighter-rouge codehilite">maxAge</code> attribute.</p> 
       <p>Session store implementations might or might not implement a server <code class="highlighter-rouge codehilite">timeout</code>.</p> 
       <h3 id="session-cookie">cookie</h3> 
       <h4 id="session-max-age">max-age</h4> 
       <p>The <code>session.cookie.maxAge</code> sets the maximum age in seconds. A positive value indicates that the cookie will expire after that many seconds have passed. Note that the value is the <i>maximum</i> age when the cookie will expire, not the cookie’s current age.</p> 
       <p>A negative value means that the cookie is not stored persistently and will be deleted when the browser exits.</p> 
       <p>Default maxAge is: <code>-1</code>.</p> 
       <h4 id="session-signed-cookie">signed cookie</h4> 
       <p>If the <code>application.secret</code> property has been set, the session cookie will be signed with it.</p> 
       <h4 id="session-cookie-name">cookie name</h4> 
       <p>The <code>session.cookie.name</code> indicates the name of the cookie that hold the session ID, by default: <code>jooby.sid</code>. The cookie’s name can be explicitly set with <a href="/v1/apidocs/org/jooby/Cookie.Definition.html#name-java.lang.String-" target="_blank">cookie.name(“name”)</a> on <a href="/v1/apidocs/org/jooby/Session.Definition.html#cookie" target="_blank">Session.Definition#cookie()</a>.</p> 
      </div> 
     </div> 
     <div class="datalist" id="error-handling"> 
      <div class="datalist-title "> 
       <h2>error handling</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>An error handler in Jooby is represented by the <a href="/v1/apidocs/org/jooby/Err.Handler.html" target="_blank">Err.Handler</a> class and allows you to log and render exceptions.</p> 
       <blockquote> 
        <p>NOTE: All headers are reset while generating the error response.</p> 
       </blockquote> 
       <h3 id="error-handling-default-err-handler">default err handler</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Err.DefHandler.html" target="_blank">default error handler</a> does content negotiation and optionally displays friendly error pages using a naming convention.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">TemplateEngine</span><span class="o">());</span> <span class="c1">// Hbs, Ftl, etc...</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">Json</span><span class="o">());</span> <span class="c1">// A json renderer</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
    <span class="o">...</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h4 id="error-handling-html">html</h4> 
       <p>If a request to <code class="highlighter-rouge codehilite">/</code> has an <code class="highlighter-rouge codehilite">Accept: text/html</code> header. Then, the default Err handler will ask to a <a href="/v1/apidocs/org/jooby/View.Engine.html" target="_blank">View.Engine</a> to render the <code class="highlighter-rouge codehilite">err</code> view.</p> 
       <p>The default model has these attributes:</p> 
       <ul> 
        <li>message: exception string</li> 
        <li>stacktrace: exception stack-trace as an array of string</li> 
        <li>status: status code, like <code class="highlighter-rouge codehilite">400</code></li> 
        <li>reason: status code reason, like <code class="highlighter-rouge codehilite">BAD REQUEST</code></li> 
       </ul> 
       <p>Here is a simple <code class="highlighter-rouge codehilite">public/err.html</code> error page:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
  {{ "{{status" }}}}:{{ "{{reason" }}}}
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre> 
       </div> 
       <p>The HTTP status code of the response will be set as well.</p> 
       <h4 id="error-handling-no-html">no html</h4> 
       <p>If a request to <code class="highlighter-rouge codehilite">/</code> has an <code class="highlighter-rouge codehilite">Accept: application/json</code> header, the default Err handler will use a <a href="/v1/apidocs/org/jooby/Renderer.html" target="_blank">renderer</a> to render the <code class="highlighter-rouge codehilite">err</code> model.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"stacktrace"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">}</span><span class="w"> </span></code></pre> 
       </div> 
       <p>In both cases, the error model is the result of <code class="highlighter-rouge codehilite">err.toMap()</code> which creates a lightweight version of the exception.</p> 
       <p>The HTTP status code of the response will be set as well.</p> 
       <h3 id="error-handling-custom-err-handler">custom err handler</h3> 
       <p>If the default view resolution and/or err model isn’t enough, you can create your own Err handler:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">err</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">err</span><span class="o">(</span><span class="s">"err found: "</span><span class="o">,</span> <span class="n">err</span><span class="o">);</span>
    <span class="c1">// do what ever you want here</span>
    <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(...);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The Err handlers are executed in the order they were provided (like routes, parsers and renderers). The first Err handler that send an output wins!</p> 
       <h4 id="error-handling-catch-a-specific-exception-or-status-code">catch a specific exception or status code</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">err</span><span class="o">(</span><span class="n">MyException1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyException1</span> <span class="n">cause</span> <span class="o">=</span> <span class="o">(</span><span class="n">MyException1</span><span class="o">)</span> <span class="n">err</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
    <span class="c1">// handle MyException1</span>
  <span class="o">});</span>

  <span class="n">err</span><span class="o">(</span><span class="n">MyException2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyException2</span> <span class="n">cause</span> <span class="o">=</span> <span class="o">(</span><span class="n">MyException2</span><span class="o">)</span> <span class="n">err</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
    <span class="c1">// handle MyException2</span>
  <span class="o">});</span>

  <span class="n">err</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle any other exception</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or you can catch exception base on their response status code (see next section):</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">err</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle 404</span>
  <span class="o">});</span>

  <span class="n">err</span><span class="o">(</span><span class="mi">503</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle 503</span>
  <span class="o">});</span>

  <span class="n">err</span><span class="o">((</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle any other exception</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="error-handling-status-code">status code</h3> 
       <p>The default status code for errors is <code class="highlighter-rouge codehilite">500</code>, except for:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>| Exception                          | Status Code |
| ---------------------------------- | ----------- |
| java.lang.IllegalArgumentException |     400     |
|                                    |             |
| java.util.NoSuchElementException   |     400     |
|                                    |             |
| java.io.FileNotFoundException      |     404     |
</code></pre> 
       </div> 
       <h4 id="error-handling-custom-status-codes">custom status codes</h4> 
       <p>Just throw an <a href="/v1/apidocs/org/jooby/Err.html" target="_blank">Err</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="k">throw</span> <span class="k">new</span> <span class="nf">Err</span><span class="p">(</span><span class="mi">403</span><span class="o">);</span>
</code></pre> 
       </div> 
       <p>or add a new entry in the <code class="highlighter-rouge codehilite">application.conf</code> file:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="py">err.com.security.Forbidden</span> <span class="p">=</span> <span class="s">403</span>
</code></pre> 
       </div> 
       <p>When you now throw a <code class="highlighter-rouge codehilite">com.security.Forbidden</code> exception, the status code will be <code class="highlighter-rouge codehilite">403</code>.</p> 
      </div> 
     </div> 
     <div class="datalist" id="parser-and-renderer"> 
      <div class="datalist-title "> 
       <h2>parser and renderer</h2> 
      </div> 
      <div class="datalist-content"> 
       <h3 id="parser-and-renderer-parser">parser</h3> 
       <p>A <a href="/v1/apidocs/org/jooby/Parser.html" target="_blank">Parser</a> is responsible for parsing the HTTP parameters or body to something else.</p> 
       <p>Automatic type conversion is provided when a type:</p> 
       <ul> 
        <li>Is a primitive, primitive wrapper or String</li> 
        <li>Is an enum</li> 
        <li>Is an <a href="/v1/apidocs/org/jooby/Upload.html" target="_blank">Upload</a></li> 
        <li>Has a public <strong>constructor</strong> that accepts a single <strong>String</strong> argument</li> 
        <li>Has a static method <strong>valueOf</strong> that accepts a single <strong>String</strong> argument</li> 
        <li>Has a static method <strong>fromString</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.util.UUID</code></li> 
        <li>Has a static method <strong>forName</strong> that accepts a single <strong>String</strong> argument. Like <code class="highlighter-rouge codehilite">java.nio.charset.Charset</code></li> 
        <li>Is an Optional 
         <t>
           , List 
          <t>
            , Set 
           <t>
             or SortedSet 
            <t>
              where T satisfies one of previous rules 
            </t> 
           </t> 
          </t> 
         </t></li> 
       </ul> 
       <h4 id="parser-and-renderer-custom-parser">custom parser</h4> 
       <p>Suppose you want to write a custom parser to convert a value into an <code class="highlighter-rouge codehilite">integer</code>. In practice you won’t need a parser like that since it’s already provided, this is just an example.</p> 
       <p>Let’s see how to create our custom HTTP param parser:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">parser</span><span class="o">((</span><span class="n">type</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="c1">// 1</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getRawType</span><span class="o">()</span> <span class="o">==</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 2</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="n">values</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="c1">// 3</span>
  <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="kt">int</span> <span class="n">intValue</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"v"</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
   <span class="o">...</span>
<span class="o">});</span>

</code></pre> 
       </div> 
       <p>Let’s have a closer look:</p> 
       <p>1) Check if current type matches our target type</p> 
       <p>2) Add a param callback</p> 
       <p>3) Can’t deal with current type, ask the next parser to resolve it</p> 
       <p>Now, when asking for the HTTP body:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="kt">int</span> <span class="n">intValue</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">intValue</span><span class="o">();</span>
   <span class="o">...</span>
<span class="o">});</span>

</code></pre> 
       </div> 
       <p>The custom parser won’t be able to parse the HTTP body, since it only works on HTTP parameters. In order to extend the custom parser and use it for the HTTP body:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">parser</span><span class="o">((</span><span class="n">type</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="c1">// 1</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getRawType</span><span class="o">()</span> <span class="o">==</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 2</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="n">values</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
       <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">body</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">text</span><span class="o">()));</span>
  <span class="o">}</span>
  <span class="c1">// 3</span>
  <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">});</span>

</code></pre> 
       </div> 
       <p>Now it’s possible to ask for a HTTP param and/or body:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="kt">int</span> <span class="n">intValue</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"v"</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
   <span class="o">...</span>
<span class="o">});</span>

<span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="kt">int</span> <span class="n">intValue</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">intValue</span><span class="o">();</span>
   <span class="o">...</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>The <a href="/v1/apidocs/org/jooby/Parser.html" target="_blank">parser</a> API is very powerful. It lets you apply a parser to a HTTP parameter, set of parameters (like a form post), file uploads or a body. You are also free to choose if your parser applies for a Java Type and/or a Media Type, like the <code class="highlighter-rouge codehilite">Content-Type</code> header.</p> 
       <p>For example a generic JSON parser looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">parser</span><span class="o">((</span><span class="n">type</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">type</span><span class="o">().</span><span class="na">name</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">body</span> <span class="o">-&gt;</span> <span class="n">fromJSON</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">text</span><span class="o">()));</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>Parsers are executed in the order they are defined.</p> 
       <p>If a parameter parser isn’t able to resolve a parameter a <code class="highlighter-rouge codehilite">BAD REQUEST(400)</code> error will be generated.</p> 
       <p>If a body parser isn’t able to resolve a parameter an <code class="highlighter-rouge codehilite">UNSUPPORTED_MEDIA_TYPE(415)</code> error will be generated.</p> 
       <h3 id="parser-and-renderer-renderer">renderer</h3> 
       <p>A <a href="/v1/apidocs/org/jooby/Renderer.html" target="_blank">Renderer</a> converts a Java Object to a series of bytes or text and writes them to the HTTP response.</p> 
       <p>There are a few built-in renderers:</p> 
       <ul> 
        <li>stream: copy an inputstream to the HTTP response and set a default type of: <code class="highlighter-rouge codehilite">application/octet-stream</code></li> 
        <li>bytes: copy bytes to the HTTP response and set a default type of: <code class="highlighter-rouge codehilite">application/octet-stream</code></li> 
        <li>byteBuffer: copy bytes to the HTTP response and set a default type of: <code class="highlighter-rouge codehilite">application/octet-stream</code></li> 
        <li>readable: copy a readable object to the HTTP response and a default type of: <code class="highlighter-rouge codehilite">text/html</code></li> 
        <li>text: copy the toString() result to the HTTP response and set a default type of: <code class="highlighter-rouge codehilite">text/html</code></li> 
       </ul> 
       <h4 id="parser-and-renderer-custom-renderer">custom renderer</h4> 
       <p>Suppose you want to apply custom rendering for <code class="highlighter-rouge codehilite">MyObject</code>. The renderer is as simple as:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">render</span><span class="o">((</span><span class="n">value</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="n">instanceOf</span> <span class="n">MyObject</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">ctx</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="n">MyObject</span><span class="o">();</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>A generic JSON renderer will look like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="n">render</span><span class="o">((</span><span class="n">value</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">accepts</span><span class="o">(</span><span class="s">"json"</span><span class="o">))</span> <span class="o">{</span>
     <span class="n">ctx</span>
       <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"json"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">toJson</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="n">MyObject</span><span class="o">();</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <p>The renderer API is simple and powerful. Renderers are executed in the order they were defined. The renderer which writes the response first wins!</p> 
       <h3 id="parser-and-renderer-view-engine">view engine</h3> 
       <p>A <a href="/v1/apidocs/org/jooby/View.Engine.html" target="_blank">view engine</a> is a specialized <a href="/v1/apidocs/org/jooby/Renderer.html" target="_blank">renderer</a> that ONLY accepts instances of a <a href="/v1/apidocs/org/jooby/View.html" target="_blank">view</a>.</p> 
       <p>A <a href="/v1/apidocs/org/jooby/View.html" target="_blank">view</a> carries the template name + model data:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">MyTemplateEngine</span><span class="o">());</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"viewname"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"model"</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>In order to support multiple view engines, a view engine is allowed to throw a <code class="highlighter-rouge codehilite">java.io.FileNotFoundException</code> when it’s unable to resolve a template. This passes control to the next view resolver giving it a chance to load the template.</p> 
       <p>There’s not much more to say about views and template engines, further details and documentation is provided in the specific <a href="/v1/doc/parser-and-renderer">module</a>.</p> 
      </div> 
     </div> 
     <div class="datalist" id="thread-model"> 
      <div class="datalist-title "> 
       <h2>thread model</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>You can see <a href="https://jooby.org">Jooby</a> as an <code class="highlighter-rouge codehilite">event loop server</code> thanks to the supported web servers: <a href="/v1/doc/netty">Netty</a>, <a href="/v1/doc/jetty">Jetty</a> and <a href="/v1/doc/undertow">Undertow</a>. The default web server is <a href="/v1/doc/netty">Netty</a>.</p> 
       <p><a href="https://jooby.org">Jooby</a> isn’t a traditional <code class="highlighter-rouge codehilite">thread server</code> where a HTTP request is bound to a thread.</p> 
       <p>In <a href="https://jooby.org">Jooby</a> all the HTTP IO operations are performed in async &amp; non blocking fashion. HTTP IO operations run in an IO thread (a.k.a event loop) while the application logic (your code) <strong>always run in a worker thread</strong>.</p> 
       <h3 id="thread-model-worker-threads">worker threads</h3> 
       <p>The <strong>worker thread</strong> pool is provided by one of the supported web servers: <a href="/v1/doc/netty">Netty</a>, <a href="/v1/doc/jetty">Jetty</a> or <a href="/v1/doc/undertow">Undertow</a>. To simplify application programming you can <strong>block a worker thread</strong>, for example you can safely run a <strong>jdbc</strong> query in a <strong>worker thread</strong>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/search-db"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">try</span><span class="o">(</span><span class="n">Connection</span> <span class="n">db</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">Connection</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">try</span><span class="o">(</span><span class="n">Statement</span> <span class="n">stt</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">createStatement</span><span class="o">())</span> <span class="o">{</span>
        <span class="o">...</span>
      <span class="o">}</span> 
    <span class="o">}</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The web server can accept as many connections it can (as its on non blocking) while the worker thread might block.</p> 
       <p>The default worker thread pool is <code class="highlighter-rouge codehilite">20/100</code>. The optimal size depends on the <strong>business</strong> and <strong>work load</strong> your application is supposed to handle. It’s recommended to start with the default setup and then tune the size of the thread pool if the need arises.</p> 
       <p><a href="https://jooby.org">Jooby</a> favors simplicity over complexity hence allowing your <strong>code</strong> to block. However, it also provides you with more advanced options that will allow you to build async and reactive applications.</p> 
       <h3 id="thread-model-deferred">deferred</h3> 
       <p>Async processing is achieved via: <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> result, with a <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> result an application can produces a result from a <strong>thread of its choice</strong>:</p> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/async"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">...;</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/async"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Deferred</span> <span class="n">async</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Deferred</span><span class="o">.</span><span class="na">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">return</span> <span class="o">...;</span>
    <span class="o">});</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <p>The previous examples are just <code class="highlighter-rouge codehilite">syntactic sugar</code> for:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>  return new Deferred(deferred -&gt; {
     try {
       deferred.resolve(...);
     } catch (Throwable x) {
       deferred.reject(x);
     }
  });
</code></pre> 
       </div> 
       <p>You can get more <code class="highlighter-rouge codehilite">syntactic sugar</code> if you add the <a href="/v1/apidocs/org/jooby/AsyncMapper.html" target="_blank">AsyncMapper</a> to your application:</p> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">map</span><span class="o">(</span><span class="k">new</span> <span class="n">AsyncMapper</span><span class="o">());</span>
  
   <span class="n">get</span><span class="o">(</span><span class="s">"/async"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
     <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">callable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
       <span class="k">return</span> <span class="o">...;</span>
     <span class="o">};</span> 
    <span class="k">return</span> <span class="n">callable</span><span class="o">;</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/async"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">async</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">return</span> <span class="o">...;</span>
    <span class="o">};</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <a href="/v1/apidocs/org/jooby/AsyncMapper.html" target="_blank">AsyncMapper</a> converts <code class="highlighter-rouge codehilite">java.util.concurrent.Callable</code> and <code class="highlighter-rouge codehilite">java.util.concurrent.CompletableFuture</code> objects to <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> objects.</p> 
       <p>Another important thing to notice is that the deferred will run in the <strong>caller thread</strong> (i.e. worker thread), so by default there is <strong>no context switch</strong> involved in obtaining a <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> result:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/async"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">callerThread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">Deferred</span><span class="o">.</span><span class="na">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="n">callerThread</span><span class="o">,</span> <span class="n">Thread</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
      <span class="k">return</span> <span class="o">...;</span>
    <span class="o">});</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>This might not seem optimal at first, but there are some benefits to this:</p> 
       <ul> 
        <li> <p>It makes it very easy to set up a default executor (this will be explained shortly)</p> </li> 
        <li> <p>It provides better integration with async &amp; reactive libraries. A <code class="highlighter-rouge codehilite">direct</code> executor avoids the need of switching to a new thread and then probably dispatch (again) to a different thread provided by a library.</p> </li> 
       </ul> 
       <h3 id="thread-model-executor">executor</h3> 
       <p>As previously mentioned, the default executor runs in the caller thread (a.k.a direct executor). Let’s see how to override the default executor:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">executor</span><span class="o">(</span><span class="k">new</span> <span class="n">ForkJoinPool</span><span class="o">());</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/async"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">...;</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Done! Now all our <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> results run in a <code class="highlighter-rouge codehilite">ForkJoinPool</code>. It’s also possible to specify an alternative executor:</p> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">executor</span><span class="o">(</span><span class="k">new</span> <span class="n">ForkJoinPool</span><span class="o">());</span>

  <span class="n">executor</span><span class="o">(</span><span class="s">"jdbc"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">...;</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/db"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(</span><span class="s">"jdbc"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">...;</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">jooby</span><span class="o">.</span><span class="na">Deferred</span><span class="o">.</span><span class="na">deferred</span><span class="o">;</span>
<span class="o">...</span>

  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Deferred</span> <span class="n">home</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">return</span> <span class="o">...;</span>
    <span class="o">});</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/db"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Deferred</span> <span class="n">db</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">deferred</span><span class="o">(</span><span class="s">"jdbc"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">return</span> <span class="o">...;</span>
    <span class="o">});</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <p>It’s worth mentioning that the <a href="/v1/apidocs/org/jooby/Jooby.html#executor-java.util.concurrent.ExecutorService-" target="_blank">executor(ExecutorService)</a> methods automatically <code class="highlighter-rouge codehilite">shutdown</code> at application shutdown time.</p> 
       <h3 id="thread-model-promise">promise</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> contains two useful methods:</p> 
       <ul> 
        <li><a href="/v1/apidocs/org/jooby/Deferred.html#resolve-java.lang.Object-" target="_blank">deferred#resolve</a></li> 
        <li><a href="/v1/apidocs/org/jooby/Deferred.html#reject-java.lang.Throwable-" target="_blank">deferred#reject</a></li> 
       </ul> 
       <p>These two methods allow you to use a <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object as a <code class="highlighter-rouge codehilite">promise</code>:</p> 
       <p>Script API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">promise</span><span class="o">(</span><span class="n">deferred</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">deferred</span><span class="o">.</span><span class="na">resolve</span><span class="o">(...);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">deferred</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>MVC API:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">Deferred</span> <span class="n">promise</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Deferred</span><span class="o">(</span><span class="n">deferred</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">deferred</span><span class="o">.</span><span class="na">resolve</span><span class="o">(...);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">deferred</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <strong>“promise”</strong> version of the <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object is a key concept for integrating with external libraries.</p> 
       <h3 id="thread-model-advanced-configuration">advanced configuration</h3> 
       <p>Suppose you want to build a truly async application and after a <strong>deep analysis</strong> of your business demands you realize your application needs to:</p> 
       <ul> 
        <li>Access a database</li> 
        <li>Call a remote service</li> 
        <li>Make a CPU intensive computation</li> 
       </ul> 
       <p>These are the 3 points where your application is supposed to block and wait for a result.</p> 
       <p>Let’s start by reducing the <strong>worker thread pool</strong> to the number of <strong>available processors</strong>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>server.threads.Min = ${runtime.processors}
server.threads.Max = ${runtime.processors}
</code></pre> 
       </div> 
       <p>With this change, you need to be careful to <strong>avoid any blocking code</strong> on routes, otherwise performance will suffer.</p> 
       <p>Let’s create a custom thread pool for each blocking access:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"db"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">());</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"remote"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">32</span><span class="o">));</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"intensive"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>For <code class="highlighter-rouge codehilite">database</code> access, we use a <code class="highlighter-rouge codehilite">cached</code> executor which will grow without a limit but free and release threads that are idle after <code class="highlighter-rouge codehilite">60s</code>.</p> 
       <p>For <code class="highlighter-rouge codehilite">remote</code> service, we use a <code class="highlighter-rouge codehilite">fixed</code> executor of <code class="highlighter-rouge codehilite">32</code> threads. The number <code class="highlighter-rouge codehilite">32</code> is just a random number for the purpose of the example.</p> 
       <p>For <code class="highlighter-rouge codehilite">intensive</code> computations, we use a <code class="highlighter-rouge codehilite">single</code> thread executor. Computation is too expensive and we want <strong>one and only one</strong> running at any time.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"db"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">());</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"remote"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">32</span><span class="o">));</span>
  <span class="n">executor</span><span class="o">(</span><span class="s">"intensive"</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">());</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/nonblocking"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"I'm nonblocking"</span><span class="o">);</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/list"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(</span><span class="s">"db"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Database</span> <span class="n">db</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
  <span class="o">});</span>
  
  <span class="n">get</span><span class="o">(</span><span class="s">"/remote"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(</span><span class="s">"remote"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">RemoteService</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">RemoteService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="na">call</span><span class="o">();</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/compute"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(</span><span class="s">"intensive"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">someCPUIntensiveTask</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Here’s the same example with <a href="https://github.com/ReactiveX/RxJava" target="_blank">rx java</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/nonblocking"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"I'm nonblocking"</span><span class="o">);</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/list"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Database</span> <span class="n">db</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Observable</span><span class="o">.&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">create</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onNext</span><span class="o">(</span><span class="n">db</span><span class="o">.</span><span class="na">fetch</span><span class="o">());</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onCompleted</span><span class="o">();</span>
    <span class="o">}).</span><span class="na">subscribeOn</span><span class="o">(</span><span class="n">Schedulers</span><span class="o">.</span><span class="na">io</span><span class="o">())</span>
      <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nl">deferred:</span><span class="o">:</span><span class="n">resolve</span><span class="o">,</span> <span class="nl">deferred:</span><span class="o">:</span><span class="n">reject</span><span class="o">);</span>
    <span class="o">}));</span>
  <span class="o">});</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/remote"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">RemoteService</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">RemoteService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Observable</span><span class="o">.&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">create</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onNext</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">call</span><span class="o">());</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onCompleted</span><span class="o">();</span>
    <span class="o">}).</span><span class="na">subscribeOn</span><span class="o">(</span><span class="n">Schedulers</span><span class="o">.</span><span class="na">io</span><span class="o">())</span>
      <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nl">deferred:</span><span class="o">:</span><span class="n">resolve</span><span class="o">,</span> <span class="nl">deferred:</span><span class="o">:</span><span class="n">reject</span><span class="o">);</span>
    <span class="o">}));</span>
  <span class="o">});</span>
  
  <span class="n">get</span><span class="o">(</span><span class="s">"/compute"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Observable</span><span class="o">.&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">create</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onNext</span><span class="o">(</span><span class="n">someCPUIntensiveTask</span><span class="o">());</span>
      <span class="n">s</span><span class="o">.</span><span class="na">onCompleted</span><span class="o">();</span>
    <span class="o">}).</span><span class="na">subscribeOn</span><span class="o">(</span><span class="n">Schedulers</span><span class="o">.</span><span class="na">computation</span><span class="o">())</span>
      <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nl">deferred:</span><span class="o">:</span><span class="n">resolve</span><span class="o">,</span> <span class="nl">deferred:</span><span class="o">:</span><span class="n">reject</span><span class="o">);</span>
    <span class="o">}));</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The main differences are:</p> 
       <ul> 
        <li>the default executor is kept <code class="highlighter-rouge codehilite">direct</code>. No new thread is created and context switching is avoided.</li> 
        <li>the <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object is used as a <code class="highlighter-rouge codehilite">promise</code> and integrate with <a href="https://github.com/ReactiveX/RxJava" target="_blank">rx java</a>.</li> 
        <li>different thread pool semantics is achieved with the help of <a href="http://reactivex.io/documentation/scheduler.html" target="_blank">rx schedulers</a>.</li> 
       </ul> 
       <p>This is just another example to demonstrate the value of the <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object, since a <a href="/v1/doc/rxjava">rxjava</a> module is provided which takes care of binding the <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object into <code class="highlighter-rouge codehilite">Observables</code>.</p> 
       <p>That sums up everything about the <a href="/v1/apidocs/org/jooby/Deferred.html" target="_blank">deferred</a> object. It allows you to build async and reactive applications and at the same time: <strong>keep it simple</strong> (a Jooby design goal).</p> 
       <p>You’re also invited to check out the available <a href="/v1/doc/async">async/reactive modules</a>.</p> 
      </div> 
     </div> 
     <div class="datalist" id="tests"> 
      <div class="datalist-title "> 
       <h2>tests</h2> 
      </div> 
      <div class="datalist-content"> 
       <p>This section will show you how to run unit and integration tests with Jooby.</p> 
       <h3 id="tests-unit-tests">unit tests</h3> 
       <p>There are two available programming models:</p> 
       <ul> 
        <li>the script programming model; and</li> 
        <li>the mvc programming model</li> 
       </ul> 
       <p>Testing <code class="highlighter-rouge codehilite">MVC</code> routes is pretty straightforward since a route is bound to a method of some class. This makes it simple to mock and run unit tests against these kinds of routes.</p> 
       <p>To test <code class="highlighter-rouge codehilite">script</code> routes is more involved since a route is represented by a <code class="highlighter-rouge codehilite">lambda</code> and there is no easy or simple way to get access to the lambda object.</p> 
       <p>For this reason there’s a <a href="/v1/apidocs/org/jooby/test/MockRouter.html" target="_blank">MockRouter</a> provided to simplify unit testing of <code class="highlighter-rouge codehilite">script routes</code>:</p> 
       <h4 id="tests-usage">usage</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>

  <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/test"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"Hello unit tests!"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A unit test for this route, looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">simpleTest</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockRouter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">())</span>
     <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/test"</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Hello unit tests!"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Just create a new instance of <a href="/v1/apidocs/org/jooby/test/MockRouter.html" target="_blank">MockRouter</a> with your application and call one of the HTTP method, like <code class="highlighter-rouge codehilite">get</code>, <code class="highlighter-rouge codehilite">post</code>, etc…</p> 
       <h4 id="tests-mocks">mocks</h4> 
       <p>You’re free to choose the mock library of your choice. Here is an example using <a href="http://easymock.org" target="_blank">EasyMock</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/mock"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="na">path</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A test with <a href="http://easymock.org" target="_blank">EasyMock</a> looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldGetRequestPath</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="n">EasyMock</span><span class="o">.</span><span class="na">createMock</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="n">expect</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">path</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"/mypath"</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">replay</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>

  <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockRouter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">(),</span> <span class="n">req</span><span class="o">)</span>
     <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/mock"</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"/mypath"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>You can mock a <a href="/v1/apidocs/org/jooby/Response.html" target="_blank">Response</a> object similarly:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/mock"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"OK"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A test with <a href="http://easymock.org" target="_blank">EasyMock</a> looks like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldUseResponseSend</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Request</span> <span class="n">req</span> <span class="o">=</span> <span class="n">EasyMock</span><span class="o">.</span><span class="na">createMock</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="n">Response</span> <span class="n">rsp</span> <span class="o">=</span> <span class="n">EasyMock</span><span class="o">.</span><span class="na">createMock</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="n">rsp</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"OK"</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">replay</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>

  <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockRouter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">(),</span> <span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">)</span>
     <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/mock"</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"OK"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">rsp</span><span class="o">);</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>What about external dependencies? This is handled similarly:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">HelloService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">require</span><span class="o">(</span><span class="n">HelloService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">salute</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldMockExternalDependencies</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">HelloService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">EasyMock</span><span class="o">.</span><span class="na">createMock</span><span class="o">(</span><span class="n">HelloService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="n">expect</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">salute</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">(</span><span class="s">"Hola!"</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">replay</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>

  <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockRouter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">())</span>
     <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">service</span><span class="o">)</span>
     <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Hola!"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

  <span class="n">EasyMock</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The <a href="/v1/apidocs/org/jooby/test/MockRouter.html#set-java.lang.Object-" target="_blank">MockRouter#set(Object)</a> calls push and will register an external dependency (usually a mock). This makes it possible to resolve services from <code class="highlighter-rouge codehilite">require</code> calls.</p> 
       <h4 id="tests-deferred">deferred</h4> 
       <p>Mocking of promises is possible as well:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">promise</span><span class="o">(</span><span class="n">deferred</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">deferred</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="s">"OK"</span><span class="o">);</span>
  <span class="o">}));</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldMockPromises</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockRouter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">())</span>
     <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"OK"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The previous test works for deferred routes:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">deferred</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"OK"</span><span class="o">;</span>
  <span class="o">}));</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="tests-integration-tests">integration tests</h3> 
       <p>Integration tests are possible thanks to a <a href="https://github.com/junit-team/junit4/wiki/Rules" target="_blank">JUnit Rule</a>.</p> 
       <p>You can choose between <code class="highlighter-rouge codehilite">@ClassRule</code> or <code class="highlighter-rouge codehilite">@Rule</code>. The following example uses <code class="highlighter-rouge codehilite">ClassRule</code>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.jooby.test.JoobyRule</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntegrationTest</span> <span class="o">{</span>

  <span class="nd">@ClassRule</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">JoobyRule</span> <span class="n">bootstrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JoobyRule</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">());</span>
  
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Here <strong>one</strong> and <strong>only one</strong> instance will be created, which means the application will start before the first test and stop after the last test. Application state is <strong>shared</strong> between tests.</p> 
       <p>With <code class="highlighter-rouge codehilite">Rule</code> on the other hand, a new application is created per test. If you have N tests, the application will start and stop N times:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">org.jooby.test.JoobyRule</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntegrationTest</span> <span class="o">{</span>

  <span class="nd">@Rule</span>
  <span class="kd">private</span> <span class="n">JoobyRule</span> <span class="n">bootstrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JoobyRule</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Again you are free to select the HTTP client of your choice, like <a href="https://hc.apache.org/httpcomponents-client-ga/tutorial/html/fluent.html" target="_blank">Fluent Apache HTTP client</a>, <a href="https://github.com/rest-assured/rest-assured" target="_blank">REST Assured</a>, etc.</p> 
       <p>Here is a full example with <a href="https://github.com/rest-assured/rest-assured" target="_blank">REST Assured</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.jooby.Jooby</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">Jooby</span> <span class="o">{</span>

  <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"I'm real"</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>

<span class="kn">import</span> <span class="nn">org.jooby.test.JoobyRyle</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntegrationTest</span> <span class="o">{</span>

  <span class="nd">@ClassRule</span>
  <span class="kd">static</span> <span class="n">JoobyRule</span> <span class="n">bootstrap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JoobyRule</span><span class="o">(</span><span class="k">new</span> <span class="n">MyApp</span><span class="o">());</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">integrationTestJustWorks</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">then</span><span class="o">()</span>
      <span class="o">.</span><span class="na">assertThat</span><span class="o">()</span>
      <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">equalTo</span><span class="o">(</span><span class="s">"I'm real"</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>That’s all for now, enjoy testing!</p> 
      </div> 
     </div> 
     <div class="datalist" id="https"> 
      <div class="datalist-title "> 
       <h2>https</h2> 
      </div> 
      <div class="datalist-content"> 
       <p><code class="highlighter-rouge codehilite">HTTPS</code> is supported across the available <a href="/v1/doc/servers">server implementations</a>. To enable <code class="highlighter-rouge codehilite">HTTPS</code>, you need to set:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>application.securePort = 8443
</code></pre> 
       </div> 
       <p>Or programmatically like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">securePort</span><span class="o">(</span><span class="mi">8443</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="https-certificates">certificates</h3> 
       <p><a href="https://jooby.org">Jooby</a> comes with a <strong>self-signed certificate</strong>, useful for development and test. But of course, you should <strong>NEVER use it in the real world</strong>.</p> 
       <p>In order to setup HTTPS with a real certificate, you need to set these properties:</p> 
       <ul> 
        <li><code class="highlighter-rouge codehilite">ssl.keystore.cert</code>: An X.509 certificate chain file in PEM format. It can be an absolute path or a classpath resource.</li> 
        <li><code class="highlighter-rouge codehilite">ssl.keystore.key</code>: A PKCS#8 private key file in PEM format. It can be an absolute path or a classpath resource.</li> 
       </ul> 
       <p>Optionally, you can set these properties too:</p> 
       <ul> 
        <li><code class="highlighter-rouge codehilite">ssl.keystore.password</code>: Password of the keystore.key (if any). Default is: null/empty.</li> 
        <li><code class="highlighter-rouge codehilite">ssl.trust.cert</code>: Trusted certificates for verifying the remote endpoint’s certificate. The file should contain an X.509 certificate chain in PEM format. Default uses the system default.</li> 
        <li><code class="highlighter-rouge codehilite">ssl.session.cacheSize</code>: Set the size of the cache used for storing SSL session objects. 0 to use the default value.</li> 
        <li><code class="highlighter-rouge codehilite">ssl.session.timeout</code>: Timeout for the cached SSL session objects, in seconds. 0 to use the default value.</li> 
       </ul> 
       <p>As you can see, setup is very simple. All you need is your <code class="highlighter-rouge codehilite">.crt</code> and <code class="highlighter-rouge codehilite">.key</code> files.</p> 
       <p>At startup you will see a line similar to this one:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>    https://localhost:8443
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="http-2"> 
      <div class="datalist-title "> 
       <h2>http/2</h2> 
      </div> 
      <div class="datalist-content"> 
       <p><code class="highlighter-rouge codehilite">HTTP/2.0</code> is supported across the available <a href="/v1/doc/servers">server implementations</a>. To enable <code class="highlighter-rouge codehilite">HTTP/2.0</code> you need to set these properties:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>server.http2.enabled = true

application.securePort = 8443
</code></pre> 
       </div> 
       <p>Or programmatically like:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// HTTP/2.0 clear text (a.k.a h2c)</span>
  <span class="n">http2</span><span class="o">();</span>

  <span class="c1">// HTTP/2.0 over TLS</span>
  <span class="n">securePort</span><span class="o">(</span><span class="mi">8443</span><span class="o">);</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="n">req</span><span class="o">.</span><span class="na">protocol</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Browsers don’t support <code class="highlighter-rouge codehilite">H2C</code> (H2 clear text) which is why you need to configure <a href="/v1/doc/#https">HTTPS</a> as well.</p> 
       <p>At <code class="highlighter-rouge codehilite">bootstrap time</code> you will see a <code class="highlighter-rouge codehilite">+h2</code> flag that indicates that <code class="highlighter-rouge codehilite">HTTP/2.0</code> is enabled:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>   http://localhost:8080/ +h2
   https://localhost:8443/ +h2
</code></pre> 
       </div> 
       <p>Some servers require special configuration (besides <a href="/v1/doc/#https">HTTPS</a>). So it’s always good practice to check the <code class="highlighter-rouge codehilite">HTTP/2.0</code> section of the server implementation to learn more about current support, limitations and/or configuration steps.</p> 
       <h3 id="http-2-server-push">server push</h3> 
       <p>Server push is supported via <a href="/v1/apidocs/org/jooby/Request.html#push-java.lang.String-" target="_blank">Request.push</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// HTTP/2.0 clear text (a.k.a h2c)</span>
  <span class="n">http2</span><span class="o">();</span>

  <span class="c1">// HTTP/2.0 over TLS</span>
  <span class="n">securePort</span><span class="o">(</span><span class="mi">8443</span><span class="o">);</span>

  <span class="n">assets</span><span class="o">(</span><span class="s">"/js/**"</span><span class="o">);</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">req</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s">"/js/home.js"</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">Results</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"home"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>When the <em>browser</em> requests the <code class="highlighter-rouge codehilite">home</code> page, we will send the <code class="highlighter-rouge codehilite">/js/home.js</code> resource as well!</p> 
       <p>That’s all, but keep in mind that each server implementation might require some extra configuration steps to work, please check out the <a href="/v1/doc/servers">server documentation</a> for more details.</p> 
      </div> 
     </div> 
     <div class="datalist" id="web-sockets"> 
      <div class="datalist-title "> 
       <h2>web sockets</h2> 
      </div> 
      <div class="datalist-content"> 
       <h3 id="web-sockets-usage">usage</h3> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">ws</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">message</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">value</span><span class="o">()));</span>

    <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"connected"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A <a href="/v1/apidocs/org/jooby/WebSocket.html" target="_blank">WebSocket</a> consists of a <strong>path pattern</strong> and a <a href="/v1/apidocs/org/jooby/WebSocket.Handler.html" target="_blank">handler</a>.</p> 
       <p>A <strong>path pattern</strong> can be as simple or complex as you need. All the path patterns supported by routes are supported.</p> 
       <p>The <a href="/v1/apidocs/org/jooby/WebSocket.OnOpen.html" target="_blank">onOpen</a> listener is executed on new connections, from there it’s possible to listen for messages and errors or to send data to the client.</p> 
       <p>Keep in mind that a <strong>WebSocket</strong> is different from a route. There is no stack/pipe or chain.</p> 
       <p>You can mount a socket to a path used by a route, but you can’t have two or more WebSockets under the same path.</p> 
       <h3 id="web-sockets-send-and-broadcast">send and broadcast</h3> 
       <p>As seen earlier, a <a href="/v1/apidocs/org/jooby/WebSocket.html" target="_blank">web socket</a> can send data to the client via the <a href="/v1/apidocs/org/jooby/WebSocket.html#send-java.lang.Object-" target="_blank">ws.send(…)</a> method.</p> 
       <p>The <a href="/v1/apidocs/org/jooby/WebSocket.html#broadcast-java.lang.Object-" target="_blank">ws.broadcast(…)</a> method does the same thing, but will send to all connected clients.</p> 
       <h3 id="web-sockets-require">require</h3> 
       <p>Access to existing services is provided through the <a href="/v1/apidocs/org/jooby/WebSocket.html#require-com.google.inject.Key-" target="_blank">ws.require(type)</a> method:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="n">ws</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">A</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">});</span>
</code></pre> 
       </div> 
       <h3 id="web-sockets-listener">listener</h3> 
       <p>As with <strong>routes</strong> you can choose between <strong>two flavors</strong> for <code class="highlighter-rouge codehilite">WebSocket</code> listeners:</p> 
       <p>script:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">ws</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">MyDatabase</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">msg</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
      <span class="n">database</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
      <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"Got: "</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>class:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">ws</span><span class="o">(</span><span class="n">MyHandler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyHandler</span> <span class="kd">implements</span> <span class="n">WebSocket</span><span class="o">.</span><span class="na">OnMessage</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="n">WebSocket</span> <span class="n">ws</span><span class="o">;</span>
  
  <span class="n">MyDatabase</span> <span class="n">db</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="n">MyHandle</span><span class="o">(</span><span class="n">WebSocket</span> <span class="n">ws</span><span class="o">,</span> <span class="n">MyDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ws</span> <span class="o">=</span> <span class="n">ws</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">db</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">database</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"Got: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Optionally, your listener could implement <a href="/v1/apidocs/org/jooby/WebSocket.OnOpen.html" target="_blank">onOpen</a>, <a href="/v1/apidocs/org/jooby/WebSocket.OnClose.html" target="_blank">onClose</a> or <a href="/v1/apidocs/org/jooby/WebSocket.OnError.html" target="_blank">onError</a>. If you need all of them, use the <a href="/v1/apidocs/org/jooby/WebSocket.Handler.html" target="_blank">handler</a> interface.</p> 
       <h3 id="web-sockets-consumes">consumes</h3> 
       <p>A WebSocket can define a type to consume:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">ws</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">message</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">});</span>

    <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"connected"</span><span class="o">);</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">consumes</span><span class="o">(</span><span class="s">"json"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or via annotation for class listeners:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">)</span>
<span class="nd">@Consumes</span><span class="o">(</span><span class="s">"json"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyHandler</span> <span class="kd">implements</span> <span class="n">WebSocket</span><span class="o">.</span><span class="na">OnMessage</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">MyObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
   <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>This is just a utility method for parsing a socket message into a Java Object. Consumes in WebSockets has nothing to do with content negotiation. Content negotiation is a route concept, it doesn’t apply for WebSockets.</p> 
       <h3 id="web-sockets-produces">produces</h3> 
       <p>A WebSocket can define a type to produce:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">ws</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyResponseObject</span> <span class="n">object</span> <span class="o">=</span> <span class="o">..;</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="s">"json"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or via annotation for class listeners:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">)</span>
<span class="nd">@Consumes</span><span class="o">(</span><span class="s">"json"</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="s">"json"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyHandler</span> <span class="kd">implements</span> <span class="n">WebSocket</span><span class="o">.</span><span class="na">OnMessage</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">MyObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">ws</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="k">new</span> <span class="n">MyResponseObject</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>This is just a utility method for formatting Java Objects as text messages. Produces in WebSockets has nothing to do with content negotiation. Content negotiation is a route concept, it doesn’t apply for WebSockets.</p> 
      </div> 
     </div> 
     <div class="datalist" id="server-sent-events"> 
      <div class="datalist-title "> 
       <h2>server-sent events</h2> 
      </div> 
      <div class="datalist-content"> 
       <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events" target="_blank">Server-Sent Events</a> (SSE) is a mechanism that allows the server to push data to the client once the client-server connection is established. After the connection has been established by the client, the server can send to the client whenever a new <strong>chunk</strong> of data is available. In contrast with websockets, SSE can only be used to send from the server to the client and not the other way round.</p> 
       <h3 id="server-sent-events-usage">usage</h3> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="c1">// 1. connected</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span> <span class="c1">// 2. send/push data</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Simple, effective and easy to use. The callback will be executed when a new client is connected. Inside the callback you can send data, listen for connection close events, etc.</p> 
       <p>The factory method <a href="/v1/apidocs/org/jooby/Sse.html#event-java.lang.Object-" target="_blank">sse.event(Object)</a> will let you set event attributes:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">sse</span><span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="s">"data"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"myevent"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">retry</span><span class="o">(</span><span class="mi">5000L</span><span class="o">)</span>
        <span class="o">.</span><span class="na">send</span><span class="o">();</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="server-sent-events-structured-data">structured data</h3> 
       <p>Other than raw/string data you can also send structured data, like <code class="highlighter-rouge codehilite">json</code>, <code class="highlighter-rouge codehilite">xml</code>, etc..</p> 
       <p>The next example will send two messages, one in <code class="highlighter-rouge codehilite">json</code> format and one in <code class="highlighter-rouge codehilite">text/plain</code> format:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">MyJsonRenderer</span><span class="o">());</span>

  <span class="n">sse</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="s">"json"</span><span class="o">);</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="s">"plain"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Or if your need only one format, just:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="k">new</span> <span class="n">MyJsonRenderer</span><span class="o">());</span>

  <span class="n">sse</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
  <span class="o">}).</span><span class="na">produces</span><span class="o">(</span><span class="s">"json"</span><span class="o">);</span> <span class="c1">// json by default</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="server-sent-events-request-parameters">request parameters</h3> 
       <p>Request access is provided by a <strong>two argument</strong> callback:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/events/:id"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">sse</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
    <span class="n">MyObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">findObject</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="server-sent-events-connection-lost">connection lost</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Sse.html#onClose-javaslang.control.Try.CheckedRunnable-" target="_blank">sse.onClose(Runnable)</a> callback allows you to clean and release resources on connection close. A connection is closed when you call the <a href="/v1/apidocs/org/jooby/Sse.html#close--" target="_blank">sse.close()</a> method or when the remote client closes the connection.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/events/:id"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">sse</span><span class="o">.</span><span class="na">onClose</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="c1">// clean up resources</span>
    <span class="o">});</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>A connection close event is detected and fired when you attempt to send some data.</p> 
       <h3 id="server-sent-events-keep-alive-time">keep alive time</h3> 
       <p>The keep alive time feature can be used to prevent connections from timing out:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/events/:id"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">sse</span><span class="o">.</span><span class="na">keepAlive</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <p>The previous example will send a <code class="highlighter-rouge codehilite">':'</code> message (empty comment) every 15 seconds to keep the connection alive. If the client drops the connection, then the <a href="/v1/apidocs/org/jooby/Sse.html#onClose-javaslang.control.Try.CheckedRunnable-" target="_blank">sse.onClose(Runnable)</a> event will be fired.</p> 
       <p>This feature is useful when you want to detect close events without waiting for the next time you send an event. If on the other hand your application already generates events every 15 seconds, the use of keep alive is unnecessary.</p> 
       <h3 id="server-sent-events-require">require</h3> 
       <p>The <a href="/v1/apidocs/org/jooby/Sse.html#require-java.lang.Class-" target="_blank">sse.require(Type)</a> methods gives you access to application services:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">sse</span><span class="o">(</span><span class="s">"/events/:id"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">MyService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">sse</span><span class="o">.</span><span class="na">require</span><span class="o">(</span><span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
       <h3 id="server-sent-events-example">example</h3> 
       <p>The next example will generate a new event every 60 seconds. It recovers from a server shutdown by using the <a href="/v1/apidocs/org/jooby/Sse.html#lastEventId--" target="_blank">sse.lastEventId()</a> and cleans resources on connection close.</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="c1">// creates an executor service</span>
  <span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

  <span class="n">sse</span><span class="o">(</span><span class="s">"/events"</span><span class="o">,</span> <span class="n">sse</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="c1">// if we go down, recover from last event ID we sent. Otherwise, start from zero.</span>
    <span class="kt">int</span> <span class="n">lastId</span> <span class="o">=</span> <span class="n">sse</span><span class="o">.</span><span class="na">lastEventId</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">AtomicInteger</span> <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">lastId</span><span class="o">);</span>

    <span class="c1">// send events every 60s</span>
    <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">Integer</span> <span class="n">id</span> <span class="o">=</span> <span class="n">next</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
      <span class="n">Object</span> <span class="n">data</span> <span class="o">=</span> <span class="n">findDataById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="c1">// send data and id</span>
      <span class="n">sse</span><span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">send</span><span class="o">();</span>
    <span class="o">},</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>

    <span class="c1">// on connection lost, cancel 60s task</span>
    <span class="n">sse</span><span class="o">.</span><span class="na">onClose</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">future</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">});</span>

<span class="o">}</span>
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="datalist" id="misc"> 
      <div class="datalist-title "> 
       <h2>misc</h2> 
      </div> 
      <div class="datalist-content"> 
       <h3 id="misc-cors">cors</h3> 
       <p>Cross-origin resource sharing (<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" target="_blank">CORS</a>) is a mechanism that allows restricted resources (e.g. fonts, JavaScript, etc.) on a web page to be requested from another domain outside the domain from which the resource originated.</p> 
       <h4 id="misc-usage">usage</h4> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">use</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">CorsHandler</span><span class="o">());</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Previous example, will handle CORS request (simple or preflight).</p> 
       <p>Default options are defined via <code class="highlighter-rouge codehilite">.conf</code> file:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="err">cors</span> <span class="err">{</span>
  <span class="c"># Configures the Access-Control-Allow-Origin CORS header. Possibly values: *, domain, regex or a list of previous values. </span>
  <span class="c"># Example: </span>
  <span class="c"># "*" </span>
  <span class="c"># ["http://foo.com"] </span>
  <span class="c"># ["http://*.com"] </span>
  <span class="c"># ["http://foo.com", "http://bar.com"] </span>
  <span class="py">origin</span><span class="p">:</span> <span class="s">"*"</span>

  <span class="c"># If true, set the Access-Control-Allow-Credentials header </span>
  <span class="py">credentials</span><span class="p">:</span> <span class="s">true</span>

  <span class="c"># Allowed methods: Set the Access-Control-Allow-Methods header </span>
  <span class="py">allowedMethods</span><span class="p">:</span> <span class="s">[GET, POST]</span>

  <span class="c"># Allowed headers: set the Access-Control-Allow-Headers header. Possibly values: *, header name or a list of previous values. </span>
  <span class="c"># Examples </span>
  <span class="c"># "*" </span>
  <span class="c"># Custom-Header </span>
  <span class="c"># [Header-1, Header-2] </span>
  <span class="py">allowedHeaders</span><span class="p">:</span> <span class="s">[X-Requested-With, Content-Type, Accept, Origin]</span>

  <span class="c"># Preflight max age: number of seconds that preflight requests can be cached by the client </span>
  <span class="py">maxAge</span><span class="p">:</span> <span class="s">30m</span>

  <span class="c"># Set the Access-Control-Expose-Headers header </span>
  <span class="c"># exposedHeaders: [] </span>
<span class="err">}</span>
</code></pre> 
       </div> 
       <p><code class="highlighter-rouge codehilite">CORS</code> options are represented at runtime by the <a href="/v1/apidocs/org/jooby/handlers/Cors.html" target="_blank">Cors</a> handler.</p> 
       <h3 id="misc-xss">xss</h3> 
       <p><a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank">Cross-site scripting (XSS)</a> is a type of security vulnerability typically found in web applications. XSS enables attackers to inject client-side scripts into web pages viewed by other users.</p> 
       <p><a href="https://jooby.org">Jooby</a> provides a few XSS escapers and a simple and flexible way to provide custom and/or more featured XSS escapers.</p> 
       <p>Default XSS escapers are <code class="highlighter-rouge codehilite">urlFragment</code>, <code class="highlighter-rouge codehilite">formParam</code>, <code class="highlighter-rouge codehilite">pathSegment</code> and <code class="highlighter-rouge codehilite">html</code>, all provided by <a href="https://github.com/google/guava" target="_blank">Guava</a>.</p> 
       <p>More advanced and feature rich escapers like <code class="highlighter-rouge codehilite">js</code>, <code class="highlighter-rouge codehilite">css</code>, <code class="highlighter-rouge codehilite">sql</code> are provided via <a href="/v1/doc/security">modules</a>.</p> 
       <h4 id="misc-usage">usage</h4> 
       <p>There are a couple of ways to use XSS escape functions:</p> 
       <h5>Applying an XSS escaper to param or header:</h5> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">safeParam</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="s">"html"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>

    <span class="n">String</span> <span class="n">safeHeader</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="s">"html"</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <p>Here <code class="highlighter-rouge codehilite">input</code> is the <code class="highlighter-rouge codehilite">param/header</code> that you want to escape with the <code class="highlighter-rouge codehilite">html</code> escaper.</p> 
       <h5>Applying multiple XSS escapers:</h5> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">safeInput</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="s">"urlFragment"</span><span class="o">,</span> <span class="s">"html"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h5>Applying an XSS escaper to form/bean:</h5> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="o">{</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyForm</span> <span class="n">form</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="s">"html"</span><span class="o">);</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre> 
       </div> 
       <h5>Applying an XSS escaper from template engines</h5> 
       <p>Template engines usually provide built in methods to escape <code class="highlighter-rouge codehilite">HTML</code>. However, <a href="https://jooby.org">Jooby</a> will also integrate its XSS escapers with the template engine of your choice:</p> 
       <p><a href="/v1/doc/hbs">handlebars</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="p">{</span><span class="err">{xss</span><span class="w"> </span><span class="err">input</span><span class="w"> </span><span class="nt">"js"</span><span class="w"> </span><span class="nt">"html"</span><span class="err">}}</span><span class="w"> </span></code></pre> 
       </div> 
       <p><a href="/v1/doc/pebble">pebble</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code><span class="p">{</span><span class="err">{xss</span><span class="w"> </span><span class="err">(input,</span><span class="w"> </span><span class="nt">"js"</span><span class="err">,</span><span class="w"> </span><span class="nt">"html"</span><span class="err">)}}</span><span class="w"> </span></code></pre> 
       </div> 
       <p><a href="/v1/doc/ftl">freemarker</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>${xss (input, "js", "html")}
</code></pre> 
       </div> 
       <p><a href="/v1/doc/jade">jade</a>:</p> 
       <div class="highlighter-rouge codehilite"> 
        <div class="copy-bar"> 
         <span class="icon-clipboard-big copy-button octicon octicon-clippy" title="copy to clipboard"></span> 
        </div> 
        <pre class="highlight"><code>p= xss.apply(input, "js", "html")
</code></pre> 
       </div> 
       <h4 id="misc-modules">modules</h4> 
       <ul> 
        <li><a href="/v1/doc/unbescape">unbescape</a>: XSS escapers via <a href="https://github.com/unbescape/unbescape" target="_blank">unbescape</a></li> 
        <li><a href="/v1/doc/csl">csl</a>: XSS escapers via <a href="https://github.com/coverity/coverity-security-library" target="_blank">coverity-security-library</a></li> 
       </ul> 
      </div> 
     </div> 
    </div> 
   </div> 
  </main> 
  <footer class="site-footer"> 
   <div class="row"> 
    <p class="pull-left">©2014-2019 <a href="https://twitter.com/joobyproject" target="_blank">The Jooby Project</a>, all rights reserved.</p> 
    <div class="follow-us pull-right"> 
     <p>Follow us</p> 
     <a href="https://github.com/jooby-project/jooby" title="Follow us on Github" target="_blank" rel="nofollow"><span class="icon-github-medium-circle"></span></a> 
     <a href="https://twitter.com/joobyproject" title="Follow us on Twitter" target="_blank" rel="nofollow"><span class="icon-twitter-medium-circle"></span></a> 
    </div> 
   </div> 
  </footer> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> 
  <script>window.jQuery || document.write('<script src="resources/scripts/libs/jquery-2.1.4.min.js"><\/script>')</script> 
  <script src="resources/scripts/libs/swiper.min.js"></script> 
  <script src="resources/scripts/application.js"></script> 
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57151281-1', 'auto');
      ga('send', 'pageview');
    </script>   
 </body>
</html>